[{"title":"scrollWidth,clientWidth,offsetWidthçš„åŒºåˆ«","url":"/2019/12/07/scrollWidth,clientWidth,offsetWidthçš„åŒºåˆ«/","content":"\n# scrollWidth,clientWidth,offsetWidthçš„åŒºåˆ«\n\n## æ€»ä½“è¯´æ˜\n\n### å…ƒç´ å¯¹è±¡ï¼š\n\n- offsetLeftã€offsetTopå±æ€§ï¼šè·å–å…ƒç´ ç›¸å¯¹äºæ–‡æ¡£å·¦ä¸Šè§’çš„åæ ‡ä½ç½®ã€‚\n\n* scrollWidthï¼šå¯¹è±¡çš„**å®é™…å†…å®¹**çš„å®½åº¦ï¼Œä¸åŒ…æ‹¬è¾¹çº¿å®½åº¦ï¼Œä¼šéšå¯¹è±¡ä¸­å†…å®¹è¶…è¿‡å¯è§†åŒºåè€Œå˜å¤§ã€‚\n\n  scrollWidth=å…ƒç´ çš„width+padding\n\n* clientWidthï¼šå¯¹è±¡å†…å®¹çš„**å¯è§†åŒºçš„å®½åº¦**ï¼Œä¸åŒ…æ‹¬æ»šåŠ¨æ¡ç­‰è¾¹çº¿ï¼Œä¼šéšå¯¹è±¡æ˜¾ç¤ºå¤§å°çš„å˜åŒ–è€Œæ”¹å˜ã€‚\n\n  clientWidth=å…ƒç´ çš„width+padding\n\n* offsetWidthï¼šå¯¹è±¡**æ•´ä½“çš„å®é™…å®½åº¦**ï¼ŒåŒ…æ‹¬æ»šåŠ¨æ¡ç­‰è¾¹çº¿ï¼Œä¼šéšå¯¹è±¡æ˜¾ç¤ºå¤§å°çš„å˜åŒ–è€Œæ”¹å˜ã€‚\n\n  offsetWidth=å…ƒç´ çš„width+padding+border\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g7aq0kktmyj30gx0gqtam.jpg)\n\n###windowå¯¹è±¡ï¼š\n\n* innerWidthï¼šçª—å£ä¸­æ–‡æ¡£æ˜¾ç¤ºåŒºåŸŸçš„å®½åº¦ï¼Œä¸åŒ…æ‹¬èœå•æ ã€å·¥å…·æ ç­‰éƒ¨åˆ†ã€‚è¯¥å±æ€§å¯è¯»å¯å†™ã€‚æµè§ˆå™¨çª—å£çš„å†…éƒ¨å®½åº¦ï¼ˆå¯¹äºIE9+ã€Chromeã€Firefoxã€Opera ä»¥åŠ Safariï¼‰\n* pageXOffsetï¼šæ•´æ•°åªè¯»å±æ€§ï¼Œè¡¨ç¤ºæ–‡æ¡£å‘å³æ»šåŠ¨è¿‡çš„åƒç´ æ•°ã€‚IEä¸æ”¯æŒè¯¥å±æ€§ï¼Œä½¿ç”¨bodyå…ƒç´ çš„scrollLeftå±æ€§æ›¿ä»£ã€‚\n\n* \n\n##æƒ…å†µä¸€\n\nå…ƒç´ å†…æ— å†…å®¹æˆ–è€…å†…å®¹ä¸è¶…è¿‡å¯è§†åŒºï¼Œæ»šåŠ¨ä¸å‡ºç°æˆ–ä¸å¯ç”¨çš„æƒ…å†µä¸‹ã€‚\n\n* scrollWidth=clientWidthï¼Œä¸¤è€…çš†ä¸ºå†…å®¹å¯è§†åŒºçš„å®½åº¦ã€‚\n* offsetWidthä¸ºå…ƒç´ çš„å®é™…å®½åº¦ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g7aoj7ezc9j30eo07hjs6.jpg)\n\n##æƒ…å†µäºŒ\n\nå…ƒç´ çš„å†…å®¹è¶…è¿‡å¯è§†åŒºï¼Œæ»šåŠ¨æ¡å‡ºç°å’Œå¯ç”¨çš„æƒ…å†µä¸‹ã€‚\n\n* scrollWidth>clientWidthã€‚\n* scrollWidthä¸ºå®é™…å†…å®¹çš„å®½åº¦ã€‚\n* clientWidthæ˜¯å†…å®¹å¯è§†åŒºçš„å®½åº¦ã€‚\n* offsetWidthæ˜¯å…ƒç´ çš„å®é™…å®½åº¦ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g7aokjodirj30h40a1q41.jpg)\n\n## é’ˆå¯¹æ–‡æ¡£(document)çš„å„ä¸ªheightã€widthã€topã€leftçš„è¯´æ˜\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g7apu7784cj30dw0fa0tw.jpg)\n\n## é’ˆå¯¹ç½‘é¡µä¸­ä¸€ä¸ªdivçš„å„ä¸ªå±æ€§å€¼çš„è¯´æ˜\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g7apvi51ygj30jg0ga400.jpg)","tags":["CSS"],"categories":["CSS"]},{"title":"å¾ªç¯ä¸­çš„å¼‚æ­¥æ“ä½œé—®é¢˜å°ç»“","url":"/2019/11/26/JSäº‹ä»¶æœºåˆ¶ copy/","content":"\n# å¾ªç¯ä¸­çš„å¼‚æ­¥æ“ä½œé—®é¢˜å°ç»“\n\nå¾ªç¯çš„å¼‚æ­¥æ“ä½œä¸»è¦æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š\n\n- å¦‚ä½•ç¡®ä¿å¾ªç¯çš„æ‰€æœ‰å¼‚æ­¥æ“ä½œå®Œæˆä¹‹åæ‰§è¡ŒæŸä¸ªå…¶ä»–æ“ä½œ\n- å¾ªç¯ä¸­çš„ä¸‹ä¸€æ­¥æ“ä½œä¾èµ–äºå‰ä¸€æ­¥çš„æ“ä½œï¼Œå¦‚ä½•è§£å†³\n\n## ä¸éœ€ç­‰å¾…ç»“æœ\n\nè¦å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªåŒ¿åå‡½æ•°å®šä¹‰ä¸ºå¼‚æ­¥çš„ï¼š\n\n```javascript\nasync function processArray(array){\n  array.forEach(async (item)=>{\n    await delayedLog(item)\n  })\n  console.log('Done!')\n}\n```\n\nä½†æ˜¯è¿™æ ·çš„è¯ forEach æ–¹æ³•å°±ç›¸å½“äºå¼‚æ­¥çš„äº†ï¼Œä¸ä¼šç­‰å¾…éå†å®Œæ‰€æœ‰çš„ item å°†ä¼šè¾“å‡ºï¼š\n\n```text\nDone!\n1\n2\n3\n```\n\nå¦‚æœä½ ä¸éœ€è¦ç­‰å¾…è¿™ä¸ªå¾ªç¯å®Œæˆï¼Œè¿™æ ·å°±å·²ç»å¯ä»¥äº†ã€‚ä½†æ˜¯å¤§éƒ¨åˆ†æƒ…å†µæˆ‘ä»¬è¿˜æ˜¯éœ€è¦ç­‰å¾…è¿™ä¸ªå¾ªç¯å®Œæˆæ‰è¿›è¡Œä¹‹åçš„æ“ä½œã€‚\n\n## å¦‚ä½•ç¡®ä¿å¾ªç¯çš„æ‰€æœ‰å¼‚æ­¥æ“ä½œå®Œæˆä¹‹åæ‰§è¡ŒæŸä¸ªå…¶ä»–æ“ä½œ\n\n### æ–¹æ³•ä¸€ï¼šè®¾ç½®ä¸€ä¸ªflagï¼Œåœ¨æ¯ä¸ªå¼‚æ­¥æ“ä½œä¸­å¯¹flagè¿›è¡Œæ£€æµ‹\n\n```javascript\nlet flag = 0;\nfor(let i = 0; i < len; i++) {\n  flag++;\n  Database.save_method().exec().then((data) => {\n      if(flag === len) {\n            // your code\n      }\n  })\n}\n```\n\n### æ–¹æ³•äºŒï¼šå°†æ‰€æœ‰çš„å¾ªç¯æ”¾åœ¨ä¸€ä¸ªpromiseä¸­ï¼Œä½¿ç”¨thenå¤„ç†\n\n```javascript\n new Promise(function(resolve){\n      resolve()\n }).then(()=> {\n     for(let i = 0; i < len; i++) {\n           Database.save_method().exec()\n     }\n}).then(() => {\n    // your code\n})\n```\n\n### æ–¹æ³•ä¸‰ï¼šä¸²è¡Œéå†\n\nè¦ç­‰å¾…æ‰€æœ‰çš„ç»“æœè¿”å›ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å›åˆ°è€å¼çš„ for å¾ªç¯å†™æ³•ï¼š\n\n```javascript\nasync function processArray(array){\n  for(const item of array){\n    await delayedLog(item)\n  }\n  console.log('Done!')\n}\n```\n\næœ€åçš„ç»“æœç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼š\n\n```text\n1\n2\n3\nDone!\n```\n\n### æ–¹æ³•å››ï¼šå¹¶è¡Œéå†\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g7c606vfgvj30tg081mxe.jpg)\n\n```javascript\nasync function processArray(array){\n  //map array to promise\n  const promises=array.map(delayedLog)\n  await Promise.all(promises)\n  console.log('Done!')\n}\n```\n\nï¼ˆæ³¨æ„ï¼šå¯¹äºç‰¹åˆ«å¤§çš„æ•°ç»„ä¸å»ºè®®ä½¿ç”¨è¿™ç§å†™æ³•ï¼Œå¤ªå¤šçš„å¹¶è¡Œä»»åŠ¡ä¼šåŠ é‡ CPU å’Œå†…å­˜çš„è´Ÿè·ï¼‰\n\n## å¾ªç¯ä¸­çš„ä¸‹ä¸€æ­¥æ“ä½œä¾èµ–äºå‰ä¸€æ­¥çš„æ“ä½œï¼Œå¦‚ä½•è§£å†³\n\n### æ–¹æ³•ä¸€ï¼šä½¿ç”¨é€’å½’ï¼Œåœ¨å¼‚æ­¥æ“ä½œå®Œæˆä¹‹åè°ƒç”¨ä¸‹ä¸€æ¬¡å¼‚æ­¥æ“ä½œ\n\n```javascript\nfunction loop(i){\n  i++;\n  Database.save_method().exec().then(() => {\n      loop(i)\n    })\n}\n```\n\n### æ–¹æ³•äºŒï¼šä½¿ç”¨asyncå’Œawaitï¼ˆä¸²è¡Œéå†ï¼‰\n\n```javascript\nasync function loop() {\n    for(let i = 0; i < len; i++) {\n         await Database.save_method().exec();\n    }\n}\n```\n\n# å¦‚ä½•ä¼˜é›…åœ°å†™jså¼‚æ­¥å¾ªç¯\n\n## å¾ªç¯çš„æ–¹å¼\n\nå‡è®¾æˆ‘ä»¬æœ‰ä¸ªæ•°ç»„ï¼ŒåŒ…å« 5 ä¸ªæ•°å­—ï¼š`let times = [100, 150, 200, 250, 300]`ï¼› \nè¿˜æœ‰ä¸€ä¸ªå¼‚æ­¥çš„ç¡è§‰æ–¹æ³•ï¼š`sleep(time, cb)`ã€‚\n\n```javascript\nimport Promise from 'bluebird';\n\n// å½“æ²¡æœ‰ cb æ—¶ï¼Œè¿”å›ä¸€ä¸ª Promise å¯¹è±¡\nexport default function sleep(time, cb) {  \n    if (cb) {\n        setTimeout(cb, time);\n    } else {\n        return new Promise(resolve => {\n            setTimeout(resolve, time);\n        });\n    }\n};\n```\n\nç°åœ¨è¦å»å¾ªç¯ç¡è¿™å‡ ä¸ªæ•°å­—ï¼Œé—®ä½ æœ‰å“ªäº›ç¡æ³•ï¼ŸğŸ¤”\n\nä¸ºäº†æ–¹ä¾¿äº¤æµï¼Œæˆ‘å°±ç»™è¿™å‡ ä¸ªç¡æ³•èµ·ä¸ªåå­—ï¼š\n\n1. All inï¼šä½ å¦‚æœèµ¶æ—¶é—´åˆä¸æ‹…å¿ƒæ¶ˆè€—è¿‡åº¦ï¼Œä½ å¯ä»¥ä¸€æ¬¡æ€§éƒ½ç¡äº†ï¼›\n2. One by oneï¼šä½ æƒ³ç»†æ°´é•¿æµï¼Œä½ å¯ä»¥ä¸€ä¸ªä¸€ä¸ªç¡ï¼›\n3. With concurrencyï¼šä½ å®³ç¾åœ°ä½ä¸‹å¤´ï¼Œè¯´ä¸€æ¬¡èƒ½ä¸èƒ½ç¡ä¸¤ä¸ªã€‚\n\n> ä½œä¸ºä¸€æ®µæœ‰èŠ‚æ“çš„ä»£ç ï¼Œè‚¯å®šè¦å‘Šè¯‰å…¶ä»–äººä½ ç¡å®Œäº†ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»æœ‰å…¨éƒ¨å®Œæˆçš„å›è°ƒï¼Œå¦åˆ™æˆ‘ä»¬æ¥ä¸‹æ¥çš„äº¤æµä¼šæ¯«æ— æ„ä¹‰ã€‚\n\næœ¬æ–‡ç›®çš„æ˜¯å’Œå¤§å®¶æ¢è®¨å¦‚ä½•å†™å‡ºä¼˜é›…çš„å¼‚æ­¥å¾ªç¯ä»£ç ï¼Œå¹¶ä¸æ˜¯å»å®ç°è¿™äº›å¾ªç¯æ§åˆ¶çš„é€»è¾‘ï¼›è€Œä¿æŒä»£ç ä¼˜é›…ï¼Œä¸ªäººä»¥ä¸ºæœ€å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨è¾ƒæ–°çš„è¯­è¨€ç‰¹æ€§ï¼Œå…¶æ¬¡æ˜¯ä½¿ç”¨ä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼Œæœ€åæ‰æ˜¯è‡ªå·±æ’¸ã€‚ä¸‹é¢ä¼šä½¿ç”¨ [Async](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fcaolan%2Fasync)ã€[Promise(bluebird)](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fpetkaantonov%2Fbluebird) å’Œ ES7 ä¸­çš„ `async/await` å¯¹æ¯”ä¸‹å®ç°è¿™å‡ ç§å¾ªç¯çš„åŒºåˆ«ã€‚\n\n### All in\n\n![All in](https://tva1.sinaimg.cn/large/006y8mN6ly1g7c606vfgvj30tg081mxe.jpg)\n\nè¿™ç§æ–¹å¼æ•ˆç‡æ˜¯æœ€é«˜çš„ï¼Œè€—æ—¶å–å†³äºå¾ªç¯ä¸­æœ€æ…¢çš„é‚£ä¸ªå¼‚æ­¥æ–¹æ³•ã€‚å¯¹èµ„æºçš„æ¶ˆè€—ä¹Ÿæ˜¯æœ€å¤§çš„ï¼Œå¦‚æœå¤§é‡å¾ªç¯è¯·æ±‚åç«¯æœåŠ¡ï¼Œå¾ˆæœ‰å¯èƒ½é€ æˆç¬æ—¶æ‹¥å µçš„æƒ…å†µã€‚\n\nå¦‚æœè‡ªå·±å®ç°ï¼Œè¿™ä¹Ÿæ˜¯æœ€ç®€å•çš„åœºæ™¯ï¼ŒåŠ ä¸€ä¸ªå®Œæˆè®¡æ•°å™¨ï¼Œæ¯ä¸ªå¼‚æ­¥æ–¹æ³•å®Œå°±ç»™è¿™ä¸ªå®Œæˆè®¡æ•°å™¨åŠ  1ï¼Œç„¶åæ£€æŸ¥å®Œæˆæ•°æ˜¯ä¸æ˜¯ç­‰äºæ•°ç»„é•¿åº¦ï¼Œä¸€æ—¦ç›¸ç­‰å°±è¡¨ç¤ºæ‰€æœ‰çš„å¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œé€šçŸ¥å…¨éƒ¨å®Œæˆçš„å›è°ƒã€‚\n\n#### ä½¿ç”¨ async.eachï¼š\n\n```javascript\nimport { each } from 'async';  \nimport sleep from './sleep';\n\nlet times = [100, 150, 200, 250, 300];\n\nconsole.log('sleep start');  \nconsole.time('async all in');  \neach(times, sleep, (err) => {  \n    console.timeEnd('async all in');\n    console.log('sleep complete');\n});\n// sleep start\n// async all in: 304.627ms\n// sleep complete\n```\n\n#### ä½¿ç”¨ Promise.allï¼š\n\n```javascript\nimport Promise from 'bluebird';  \nimport sleep from './sleep';\n\nlet times = [100, 150, 200, 250, 300];\n\nconsole.log('sleep start');  \nconsole.time('promise all in');  \nPromise.all(times.map(time => sleep(time))).then(() => {  \n    console.timeEnd('promise all in');\n    console.log('sleep complete');\n});\n// sleep start\n// promise all in: 305.509ms\n// sleep complete\n```\n\n#### ä½¿ç”¨ES7 async/awaitï¼š\n\n```javascript\nimport sleep from './sleep';\n\nlet times = [100, 150, 200, 250, 300];\n\n(async function() {\n    console.log('sleep start');\n    console.time('es7 all in');\n    for await (let i of times.map(time => sleep(time))) {}\n    console.timeEnd('es7 all in');\n    console.log('sleep complete');\n}());\n// sleep start\n// es7 all in: 305.986ms\n// sleep complete\n```\n\n### One by one\n\n![One by one](https://tva1.sinaimg.cn/large/006y8mN6ly1g7c65nlncwj30tg04374g.jpg)\n\nè¿™ç§æ–¹å¼æ•ˆç‡æœ€ä½ï¼Œæœ‰ç‚¹ç±»ä¼¼äºåŒæ­¥è¯­è¨€ä¸­çš„å¾ªç¯ï¼Œä¸€ä¸ªæ¥ç€ä¸€ä¸ªæ‰§è¡Œï¼Œè€—æ—¶è‡ªç„¶ä¹Ÿå°±æ˜¯æ‰€æœ‰å¼‚æ­¥æ–¹æ³•è€—æ—¶çš„æ€»å’Œã€‚å¯¹èµ„æºçš„æ¶ˆè€—æœ€å°ã€‚\n\nè¿™ä¸ªå®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼ŒæŠŠæ•°ç»„çœ‹åšä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¯æ¬¡ä»é˜Ÿåˆ—`shift`å‡ºä¸€ä¸ªä»£å…¥å¼‚æ­¥æ–¹æ³•æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆå°±å¼€å§‹é€’å½’è°ƒç”¨è¿™ä¸ªè¿‡ç¨‹ï¼Œå½“é˜Ÿåˆ—é•¿åº¦ä¸ºç©ºå°±è¡¨ç¤ºæ‰€æœ‰çš„å¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œç»“æŸé€’å½’ï¼Œé€šçŸ¥å…¨éƒ¨å®Œæˆçš„å›è°ƒã€‚\n\n#### ä½¿ç”¨ async.eachSeriesï¼š\n\n```javascript\nimport { eachSeries } from 'async';  \nimport sleep from './sleep';\n\nlet times = [100, 150, 200, 250, 300];\n\nconsole.log('sleep start');  \nconsole.time('async one by one');  \neachSeries(times, sleep, (err) => {  \n    console.timeEnd('async one by one');\n    console.log('sleep complete');\n});\n// sleep start\n// async one by one: 1020.078ms\n// sleep complete\n```\n\n#### ä½¿ç”¨ Promise.reduceï¼š\n\n```javascript\nimport Promise from 'bluebird';  \nimport sleep from './sleep';\n\nlet times = [100, 150, 200, 250, 300];\n\nconsole.log('sleep start');  \nconsole.time('promise one by one');  \nPromise.reduce(times, (last, curr) => {  \n    return sleep(curr);\n}, 0).then(() => {\n    console.timeEnd('promise one by one');\n    console.log('sleep complete');\n});\n// sleep start\n// promise one by one: 1023.014ms\n// sleep complete\n```\n\n#### ä½¿ç”¨ES7 async/awaitï¼š\n\n```javascript\nimport sleep from './sleep';\n\nlet times = [100, 150, 200, 250, 300];\n\n(async function() {\n    console.log('sleep start');\n    console.time('es7 one by one');\n    for (let time of times) {\n        await sleep(time);\n    }\n    console.timeEnd('es7 one by one');\n    console.log('sleep complete');\n}());\n// sleep start\n// es7 one by one: 1025.513ms\n// sleep complete\n```\n\n### With concurrency\n\nè¿™ç§æ–¹å¼ç¨å¾®å¤æ‚äº›ï¼Œä½†ä¹Ÿæ˜¯æœ€çµæ´»çš„æ–¹å¼ï¼Œå¯ä»¥éšå¿ƒæ§åˆ¶å¹¶å‘æ•°ã€‚æ•ˆç‡å’Œè€—æ—¶å–å†³äºé­”æ³•æ•°å­— `concurrency`ï¼Œå½“ `concurrency` å¤§äºæˆ–ç­‰äºæ•°ç»„é•¿åº¦æ—¶ï¼Œå®ƒå°±ç­‰åŒäº **All in** æ–¹å¼ï¼›å½“ `concurrency` ä¸º 1 æ—¶ï¼Œå®ƒå°±ç­‰åŒäº **One by one** æ–¹å¼ã€‚æ‰€ä»¥è€—æ—¶å’Œå¯¹èµ„æºçš„æ¶ˆè€—éƒ½ä¼šä»‹äºä»¥ä¸Šä¸¤ç§æ–¹å¼ä¹‹é—´ã€‚\n\n**With concurrency** æœ¬èº«åœ¨å®ç°ä¸Šä¹Ÿä¼šæœ‰ä¸åŒçš„æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯é¢„åˆ†ç»„å’Œä»»åŠ¡æ± ã€‚\n\n#### é¢„åˆ†ç»„\n\n![Pre Group](https://tva1.sinaimg.cn/large/006y8mN6ly1g7c66v9wx3j30tg05074j.jpg)\n\né¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æå‰å°†æ•°ç»„å†…å®¹æŒ‰ `concurrency` åˆ†å¥½ç»„ï¼Œç»„å†…æ˜¯ä»¥ **All in** æ–¹å¼æ‰§è¡Œï¼Œç»„ä¹‹é—´åˆ™æ˜¯ä»¥ **One by one** çš„æ–¹å¼æ‰§è¡Œã€‚\n\nå°±ä»¥ä¸Šæ–‡çš„ä¾‹å­ï¼Œå‡å¦‚ `concurrency` ä¸º 2ï¼Œ`times` é¢„å…ˆåˆ†ç»„æˆï¼š`[[100, 150], [200, 250], [300]]`ï¼Œè¿™æ ·è€—æ—¶ä¼šæ˜¯ 700ï¼ˆ150 + 250 + 300ï¼‰ã€‚\n\nè¿™ä¸ªå®ç°æ–¹å¼å¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶å¹¶å‘æ•°ï¼Œä¼˜ç‚¹å°±æ˜¯ç®€å•ï¼Œç¼ºç‚¹æ˜¯å¹¶ä¸èƒ½è¾¾åˆ°æ•ˆç‡æœ€å¤§åŒ–ã€‚\n\n#### ä»»åŠ¡æ± \n\n![Task Pool](https://tva1.sinaimg.cn/large/006y8mN6ly1g7c67an02oj30tg066q38.jpg)\n\nä»»åŠ¡æ± çš„æ–¹å¼å°±æ˜¯è®¾ç½®ä¸€ä¸ªå®¹é‡ä¸º `concurrency` çš„æ± å­ï¼Œæ¯”å¦‚å®¹é‡ä¸º 2ï¼Œåˆå§‹åŒ–æ”¾å…¥ä¸¤ä¸ªä»»åŠ¡ï¼Œæ¯å½“æœ‰ä»»åŠ¡å®Œæˆï¼Œå°±ç»§ç»­å¾€æ± å­æ·»åŠ æ–°çš„ä»»åŠ¡ï¼Œç›´åˆ°æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆã€‚ä¸Šæ–‡çš„ä¾‹å­æ‰§è¡Œè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š\n\n1. `time = 0; pool = [100, 150]`ï¼šæ”¾å…¥ `100` å’Œ `150`\n2. `time = 100; pool = [150, 200]`ï¼š`100` ç»“æŸï¼Œæ”¾å…¥ `200`\n3. `time = 150; pool = [200, 250]`ï¼š`150` ç»“æŸï¼Œæ”¾å…¥ `250`\n4. `time = 300; pool = [250, 300]`ï¼š`200` ç»“æŸï¼Œæ”¾å…¥ `300`\n5. `time = 400; pool = [300]`ï¼š`250` ç»“æŸï¼Œæ²¡æœ‰æ›´å¤šä»»åŠ¡\n6. `time = 600; pool = []`ï¼š`300` ç»“æŸï¼Œå¾ªç¯å®Œæ¯•\n\nå¾—å‡ºæ¥çš„è€—æ—¶æ˜¯ 600ï¼Œæ¯”é¢„åˆ†ç»„çš„æ–¹å¼æ•ˆç‡æ›´é«˜ï¼Œè€Œä¸”åŒæ ·èƒ½æœ‰æ•ˆæ§åˆ¶å¹¶å‘ä¸ªæ•°ã€‚async å’Œ bluebird ä¹Ÿæœ‰ç›¸å…³çš„æ–¹æ³•ä¾›ç›´æ¥ä½¿ç”¨ã€‚\n\n#### ä½¿ç”¨ async.eachLimitï¼š\n\n```javascript\nimport { eachLimit } from 'async';  \nimport sleep from './sleep';\n\nlet times = [100, 150, 200, 250, 300];\n\nconsole.log('sleep start');  \nconsole.time('async with concurrency');  \neachLimit(times, 2, sleep, (err) => {  \n    console.timeEnd('async with concurrency');\n    console.log('sleep complete');\n});\n// sleep start\n// async with concurrency: 611.498ms\n// sleep complete\n```\n\n#### ä½¿ç”¨ Promise.mapï¼ˆbluebird ç‰¹æœ‰ apiï¼‰ï¼š\n\n```javascript\nimport Promise from 'bluebird';  \nimport sleep from './sleep';\n\nlet times = [100, 150, 200, 250, 300];\n\nconsole.log('sleep start');  \nconsole.time('promise one by one');  \nPromise.map(times, (time) => {  \n    return sleep(time);\n}, {\n    concurrency: 2\n}).then(() => {\n    console.timeEnd('promise one by one');\n    console.log('sleep complete');\n});\n// sleep start\n// promise with concurrency: 616.601ms\n// sleep complete\n```\n\n#### ä½¿ç”¨ES7 async/awaitï¼š\n\n> `pool` æ–¹æ³•æ¥è‡ª[davetemplin/async-parallel](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fdavetemplin%2Fasync-parallel%2Fblob%2Fmaster%2Findex.ts%23L153)\n\n```javascript\nimport sleep from './sleep';\n\nlet times = [100, 150, 200, 250, 300];\n\n(async function() {\n    console.log('sleep start');\n    console.time('es7 with concurrency');\n    await pool(2, async () => {\n        await sleep(times.shift());\n        return times.length > 0;\n    });\n    console.timeEnd('es7 with concurrency');\n    console.log('sleep complete');\n}());\n\nasync function pool(size, task) {  \n    var active = 0;\n    var done = false;\n    var errors = [];\n    return new Promise((resolve, reject) => {\n        next();\n        function next() {\n            while (active < size && !done) {\n                active += 1;\n                task()\n                    .then(more => {\n                        if (--active === 0 && (done || !more))\n                            errors.length === 0 ? resolve() : reject(errors);\n                        else if (more)\n                            next();\n                        else\n                            done = true;\n                    })\n                    .catch(err => {\n                        errors.push(err);\n                        done = true;\n                        if (--active === 0)\n                            reject(errors);\n                    });\n            }\n        }\n    });\n}\n// sleep start\n// es7 with concurrency: 612.197ms\n// sleep complete\n```\n\n## æ€»ç»“\n\nå¥½äº†ï¼Œåˆ°è¿™åº”è¯¥å¯ä»¥ç»™è¿™ä¸‰ç§å¾ªç¯æ–¹å¼æ‰“ä¸‹åˆ†äº†ï¼š\n\n| **å¾ªç¯æ–¹å¼**         | æ•ˆç‡ | æ¶ˆè€— | çµæ´»åº¦ | å¤æ‚åº¦ |\n| -------------------- | ---- | ---- | ------ | ------ |\n| **All in**           | é«˜   | é«˜   | ä½     | ä½     |\n| **One by one**       | ä½   | ä½   | ä½     | ä½     |\n| **With concurrency** | ä¸­   | ä¸­   | é«˜     | é«˜     |\n\nä¹ä¸€çœ‹ **With concurrency** æ˜¯å®Œèƒœï¼Œå…¶å®å¹¶æ²¡æœ‰ã€‚**All in** å’Œ **One by one** è™½ç„¶çµæ´»åº¦ä½ï¼Œä½†æ˜¯åº”ç”¨çš„åœºæ™¯è¿˜æ˜¯éå¸¸å¹¿æ³›çš„ã€‚è¦æ±‚æ•ˆç‡ä¼˜å…ˆå°±ä½¿ç”¨ **All in**ï¼›å¦‚æœæœ‰ä¸‹ä¸€æ¬¡å¾ªç¯ä¾èµ–ä¸Šä¸€æ¬¡å¾ªç¯ç»“æœçš„åœºæ™¯ï¼Œå°±å¿…é¡»ä½¿ç”¨ **One by One**ã€‚\n\nå†è¯´ä¸‹ä¸Šé¢ asyncã€bluebirdã€ES7 å¯¹è¿™ä¸‰ç§å¾ªç¯æ–¹å¼çš„å®ç°ã€‚éœ€æ±‚ä¸€ç›´åœ¨å˜ï¼Œasync éœ€è¦ä¿®æ”¹çš„ä»£ç éå¸¸å°‘ï¼Œç”šè‡³åªè¦æ”¹ä¸‹æ–¹æ³•åå°±å¯ä»¥ï¼Œæ–¹æ³•å®šä¹‰ç®€å•ä¼˜é›…ï¼Œè¿™å¯èƒ½ä¹Ÿæ˜¯ async æ˜“ä¸Šæ‰‹çš„åŸå› ï¼›bluebird åœ¨ `Promise` æ ‡å‡†åŸºç¡€ä¸Šæ·»åŠ çš„æ–¹æ³•éå¸¸å®ç”¨ï¼Œå¦‚ï¼šmapã€join...ï¼Œä»¥è‡³äºæˆ‘å‡ ä¹æ˜¯æ²¡æœ‰ä½¿ç”¨è¿‡åŸç”Ÿ `Promise` ğŸ˜‚ï¼›ES7 æ–°å¢çš„ `async/await` è¯­æ³•ç‰¹æ€§ç¡®å®å‡è½»äº†ç¼–å†™å¼‚æ­¥ä»£ç çš„ç—›è‹¦ï¼ŒåŒæ—¶è¿˜å¢å¼ºäº†ä»£ç çš„å¯è¯»æ€§ã€‚\n\n","tags":["JavaScript"],"categories":["JavaScript"]},{"title":"ä¼ªç±»å’Œä¼ªå…ƒç´ ","url":"/2019/11/16/ä¼ªç±»å’Œä¼ªå…ƒç´ /","content":"\n# ä¼ªç±»å’Œä¼ªå…ƒç´ \n\n`css`å¼•å…¥ä¼ªç±»å’Œä¼ªå…ƒç´ æ¦‚å¿µæ˜¯ä¸ºäº†æ ¼å¼åŒ–æ–‡æ¡£æ ‘ä»¥å¤–çš„ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼ªç±»å’Œä¼ªå…ƒç´ æ˜¯ç”¨æ¥ä¿®é¥°ä¸åœ¨æ–‡æ¡£æ ‘ä¸­çš„éƒ¨åˆ†ã€‚\n\n- ä¼ªç±»ç”¨äºå½“å·²æœ‰å…ƒç´ å¤„äºçš„æŸä¸ªçŠ¶æ€æ—¶ï¼Œä¸ºå…¶æ·»åŠ å¯¹åº”çš„æ ·å¼ï¼Œè¿™ä¸ªçŠ¶æ€æ˜¯æ ¹æ®ç”¨æˆ·è¡Œä¸ºè€ŒåŠ¨æ€å˜åŒ–çš„ã€‚æ¯”å¦‚è¯´ï¼Œå½“ç”¨æˆ·æ‚¬åœåœ¨æŒ‡å®šçš„å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`:hover`æ¥æè¿°è¿™ä¸ªå…ƒç´ çš„çŠ¶æ€ã€‚è™½ç„¶å®ƒå’Œæ™®é€šçš„`css`ç±»ç›¸ä¼¼ï¼Œå¯ä»¥ä¸ºå·²æœ‰çš„å…ƒç´ æ·»åŠ æ ·å¼ï¼Œä½†æ˜¯å®ƒåªæœ‰å¤„äº`dom`æ ‘æ— æ³•æè¿°çš„çŠ¶æ€ä¸‹æ‰èƒ½ä¸ºå…ƒç´ æ·»åŠ æ ·å¼ï¼Œæ‰€ä»¥å°†å…¶ç§°ä¸ºä¼ªç±»ã€‚\n- ä¼ªå…ƒç´ ç”¨äºåˆ›å»ºä¸€äº›ä¸åœ¨æ–‡æ¡£æ ‘ä¸­çš„å…ƒç´ ï¼Œå¹¶ä¸ºå…¶æ·»åŠ æ ·å¼ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`:before`æ¥åœ¨ä¸€ä¸ªå…ƒç´ å‰å¢åŠ ä¸€äº›æ–‡æœ¬ï¼Œå¹¶ä¸ºè¿™äº›æ–‡æœ¬æ·»åŠ æ ·å¼ã€‚è™½ç„¶ç”¨æˆ·å¯ä»¥çœ‹åˆ°è¿™äº›æ–‡æœ¬ï¼Œä½†æ˜¯è¿™äº›æ–‡æœ¬å®é™…ä¸Šä¸åœ¨æ–‡æ¡£æ ‘ä¸­ã€‚\n\nä¼ªç±»çš„æ•ˆæœå¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªå®é™…çš„ç±»æ¥è¾¾åˆ°ï¼Œè€Œä¼ªå…ƒç´ çš„æ•ˆæœåˆ™éœ€è¦é€šè¿‡æ·»åŠ ä¸€ä¸ªå®é™…çš„å…ƒç´ æ‰èƒ½è¾¾åˆ°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»–ä»¬ä¸€ä¸ªç§°ä¸ºä¼ªç±»ï¼Œä¸€ä¸ªç§°ä¸ºä¼ªå…ƒç´ çš„åŸå› ã€‚\n\nä¼ªç±»å’Œä¼ªå…ƒç´ çš„æ ¹æœ¬åŒºåˆ«åœ¨äºï¼šå®ƒä»¬æ˜¯å¦åˆ›é€ äº†**æ–°**çš„å…ƒç´ ,,   è¿™ä¸ªæ–°åˆ›é€ çš„å…ƒç´ å°±å«  \"ä¼ªæ— ç´ \" ã€‚\n\n##ä¼ªç±»\n\nä¼ªç±»å‰é¢æ˜¯ä¸€ä¸ªå†’å·ï¼Œ`E:first-child`ä¼šå¯¹ç°æœ‰çš„å…ƒç´ è¿›è¡Œç­›é€‰\n\n- `:link`:é€‰æ‹©æœªè®¿é—®çš„é“¾æ¥\n\n- `:visited`:é€‰æ‹©å·²è®¿é—®çš„é“¾æ¥\n\n- `:hover`:é€‰æ‹©é¼ æ ‡æŒ‡é’ˆæµ®åŠ¨åœ¨å…¶ä¸Šçš„å…ƒç´ \n\n- `:active`:é€‰æ‹©æ´»åŠ¨çš„é“¾æ¥\n\n- `:focus`:é€‰æ‹©è·å–ç„¦ç‚¹çš„è¾“å…¥å­—æ®µ\n\n- `:not()`:ä¸€ä¸ªå¦å®šä¼ªç±»ï¼Œç”¨äºåŒ¹é…ä¸ç¬¦åˆå‚æ•°é€‰æ‹©å™¨çš„å…ƒç´ ã€‚\n\n- `:first-child`:åŒ¹é…å…ƒç´ çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ ã€‚\n\n- `:last-child`:åŒ¹é…å…ƒç´ çš„æœ€åä¸€ä¸ªå­å…ƒç´ ã€‚\n\n- ` :first-of-type`:åŒ¹é…å±äºå…¶çˆ¶å…ƒç´ çš„é¦–ä¸ªç‰¹å®šç±»å‹çš„å­å…ƒç´ çš„æ¯ä¸ªå…ƒç´ ã€‚\n\n- ` :last-of-type`:åŒ¹é…å±äºå…¶çˆ¶å…ƒç´ çš„æœ€åä¸€ä¸ªç‰¹å®šç±»å‹çš„å­å…ƒç´ çš„æ¯ä¸ªå…ƒç´ ã€‚\n\n- `:nth-child`:`:nth-child `æ ¹æ®å…ƒç´ çš„ä½ç½®åŒ¹é…ä¸€ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ï¼Œå®ƒæ¥å—ä¸€ä¸ª an+b å½¢å¼çš„å‚æ•°ï¼Œan+b åŒ¹é…åˆ°çš„å…ƒç´ \n\n- `:nth-last-child`:` :nth-last-child` ä¸`:nth-child `ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒæ˜¯ä»æœ€åä¸€ä¸ªå­å…ƒç´ å¼€å§‹è®¡æ•°çš„ã€‚\n\n- `:nth-of-type`:`:nth-of-type` ä¸ `nth-child `ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒæ˜¯åªåŒ¹é…ç‰¹å®šç±»å‹çš„å…ƒç´ ã€‚\n\n- `:nth-last-type`:`:nth-last-of-type` ä¸ `nth-of-type `ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒæ˜¯ä»æœ€åä¸€ä¸ªå­å…ƒç´ å¼€å§‹è®¡æ•°çš„ã€‚\n\n- `:only-child` :å½“å…ƒç´ æ˜¯å…¶çˆ¶å…ƒç´ ä¸­å”¯ä¸€ä¸€ä¸ªç‰¹å®šç±»å‹çš„å­å…ƒç´ æ—¶ï¼Œ`:only-child `åŒ¹é…è¯¥å…ƒç´ ã€‚\n\n- `:target` :å½“URLå¸¦æœ‰é”šåç§°ï¼ŒæŒ‡å‘æ–‡æ¡£å†…æŸä¸ªå…·ä½“çš„å…ƒç´ æ—¶ï¼Œ`:target`åŒ¹é…è¯¥å…ƒç´ ã€‚\n\n- `:checked`:` :checked `åŒ¹é…è¢«é€‰ä¸­çš„ input å…ƒç´ ï¼Œè¿™ä¸ª input å…ƒç´ åŒ…æ‹¬ radio å’Œ checkboxã€‚\n\n- `:default`: åŒ¹é…é»˜è®¤é€‰ä¸­çš„å…ƒç´ \n\n- `:disabled`: åŒ¹é…ç¦ç”¨çš„è¡¨å•å…ƒç´ ã€‚\n\n- `:empty` :åŒ¹é…æ²¡æœ‰å­å…ƒç´ çš„å…ƒç´ \n\n- `:enabled`: åŒ¹é…æ²¡æœ‰è®¾ç½® disabled å±æ€§çš„è¡¨å•å…ƒç´ ã€‚\n\n- `:in-range`: åŒ¹é…åœ¨æŒ‡å®šåŒºåŸŸå†…å…ƒç´ ã€‚\n\n- `:out-of-range`: ä¸`:in-range `ç›¸åï¼Œå®ƒåŒ¹é…ä¸åœ¨æŒ‡å®šåŒºåŸŸå†…çš„å…ƒç´ ã€‚\n\n- `:indeterminate`:indeterminate çš„è‹±æ–‡æ„æ€æ˜¯â€œ ä¸ç¡®å®šçš„â€ã€‚å½“æŸç»„ä¸­çš„å•é€‰æ¡†æˆ–å¤é€‰æ¡†è¿˜æ²¡æœ‰é€‰å–çŠ¶æ€æ—¶ï¼Œ:indeterminate åŒ¹é…è¯¥ç»„ä¸­æ‰€æœ‰çš„å•é€‰æ¡†æˆ–å¤é€‰æ¡†ã€‚\n\n- `:valid` :åŒ¹é…æ¡ä»¶éªŒè¯æ­£ç¡®çš„è¡¨å•å…ƒç´ ã€‚\n\n- `:invalid`: ä¸`:valid` ç›¸åï¼ŒåŒ¹é…æ¡ä»¶éªŒè¯é”™è¯¯çš„è¡¨å•å…ƒç´ ã€‚\n\n- `:optional `:åŒ¹é…æ˜¯å…·æœ‰ optional å±æ€§çš„è¡¨å•å…ƒç´ ã€‚å½“è¡¨å•å…ƒç´ æ²¡æœ‰è®¾ç½®ä¸º required æ—¶ï¼Œå³ä¸º optional å±æ€§ã€‚\n\n- `:required`: ä¸`:optional `ç›¸ååŒ¹é…è®¾ç½®äº† required å±æ€§çš„è¡¨å•å…ƒç´ ã€‚\n\n- `:read-only`: åŒ¹é…è®¾ç½®äº†åªè¯»å±æ€§çš„å…ƒç´ ï¼Œè¡¨å•å…ƒç´ å¯ä»¥é€šè¿‡è®¾ç½®â€œreadonlyâ€ å±æ€§æ¥å®šä¹‰å…ƒç´ åªè¯»ã€‚\n\n- `:read-write`: åŒ¹é…å¤„äºç¼–è¾‘çŠ¶æ€çš„å…ƒç´ ã€‚inputï¼Œtextarea å’Œè®¾ç½®äº† contenteditable çš„ HTML å…ƒç´ è·å–ç„¦ç‚¹æ—¶å³å¤„äºç¼–è¾‘çŠ¶æ€ã€‚\n\n- `:scope`: åŒ¹é…å¤„äº style ä½œç”¨åŸŸä¸‹çš„å…ƒç´ ã€‚å½“ style æ²¡æœ‰è®¾ç½® scope å±æ€§æ—¶ï¼Œstyle å†…çš„æ ·å¼ä¼šå¯¹æ•´ä¸ª html èµ·ä½œç”¨ã€‚\n\n- `:dir `:åŒ¹é…æŒ‡å®šé˜…è¯»æ–¹å‘çš„å…ƒç´ ï¼Œå½“ HTML å…ƒç´ ä¸­è®¾ç½®äº† dir å±æ€§æ—¶è¯¥ä¼ªç±»æ‰èƒ½ç”Ÿæ•ˆã€‚ç°æ—¶æ”¯æŒçš„é˜…è¯»æ–¹å‘æœ‰ä¸¤ç§ï¼šltrï¼ˆä»å·¦å¾€å³ï¼‰å’Œ rtlï¼ˆä»å³å¾€å·¦ï¼‰ã€‚ç›®å‰ï¼Œåªæœ‰ç«ç‹æµè§ˆå™¨æ”¯æŒ:dir ä¼ªç±»ï¼Œå¹¶åœ¨ç«ç‹æµè§ˆå™¨ä¸­ä½¿ç”¨æ—¶éœ€è¦æ·»åŠ å‰ç¼€ ( -moz-dir() )ã€‚\n\n- `:lang `:åŒ¹é…è®¾ç½®äº†ç‰¹å®šè¯­è¨€çš„å…ƒç´ ï¼Œè®¾ç½®ç‰¹å®šè¯­è¨€å¯ä»¥é€šè¿‡ä¸ºäº† HTML å…ƒç´ è®¾ç½® lang=â€â€ å±æ€§ï¼Œè®¾ç½® meta å…ƒç´ çš„ charset=â€â€ å±æ€§ï¼Œæˆ–è€…æ˜¯åœ¨ http å¤´éƒ¨ä¸Šè®¾ç½®è¯­è¨€å±æ€§ã€‚\n\n  å®é™…ä¸Šï¼Œlang=â€â€ å±æ€§ä¸åªå¯ä»¥åœ¨ html æ ‡ç­¾ä¸Šè®¾ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶ä»–çš„å…ƒç´ ä¸Šè®¾ç½®ã€‚\n\n* `:root `:åŒ¹é…æ–‡æ¡£çš„æ ¹å…ƒç´ ã€‚ä¸€èˆ¬çš„ html æ–‡ä»¶çš„æ ¹å…ƒç´ æ˜¯ html å…ƒç´ ï¼Œè€Œ SVG æˆ– XML æ–‡ä»¶çš„æ ¹å…ƒç´ åˆ™å¯èƒ½æ˜¯å…¶ä»–å…ƒç´ ã€‚\n* `:fullscreen`: åŒ¹é…å¤„äºå…¨å±æ¨¡å¼ä¸‹çš„å…ƒç´ ã€‚å…¨å±æ¨¡å¼ä¸æ˜¯é€šè¿‡æŒ‰ F11 æ¥æ‰“å¼€çš„å…¨å±æ¨¡å¼ï¼Œè€Œæ˜¯é€šè¿‡ Javascript çš„ Fullscreen API æ¥æ‰“å¼€çš„ï¼Œä¸åŒçš„æµè§ˆå™¨æœ‰ä¸åŒçš„ Fullscreen APIã€‚ç›®å‰ï¼Œ:fullscreen éœ€è¦æ·»åŠ å‰ç¼€æ‰èƒ½ä½¿ç”¨ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g79wl6d5ouj30gi0exq4h.jpg)\n\n##ä¼ªå…ƒç´ \n\nä¼ªå…ƒç´ å‰é¢æ˜¯ä¸¤ä¸ªå†’å·ï¼Œ`E::first-line`ä¼šåˆ›é€ å‡ºä¸å­˜åœ¨çš„æ–°å…ƒç´ ï¼Œç”±äºcsså¯¹å•å†’å·çš„ä¼ªå…ƒç´ ä¹Ÿæ”¯æŒï¼Œæ‰€ä»¥è¿™æ ·å¾ˆå®¹æ˜“è®©æ–°å­¦è€…æ··æ·†ã€‚ä½†å®é™…ä¸Šç°åœ¨css3å·²ç»æ˜ç¡®è§„å®šäº†ä¼ªç±»å•å†’å·ï¼Œä¼ªå…ƒç´ åŒå†’å·çš„è§„åˆ™ã€‚\n\n- `::before/:before`åœ¨è¢«é€‰å…ƒç´ å‰æ’å…¥å†…å®¹ã€‚éœ€è¦ä½¿ç”¨ content å±æ€§æ¥æŒ‡å®šè¦æ’å…¥çš„å†…å®¹ã€‚è¢«æ’å…¥çš„å†…å®¹å®é™…ä¸Šä¸åœ¨æ–‡æ¡£æ ‘ä¸­ã€‚\n\n- `::after/:after` åœ¨è¢«å…ƒç´ åæ’å…¥å†…å®¹ï¼Œå…¶ç”¨æ³•å’Œç‰¹æ€§ä¸`:before`ç›¸ä¼¼ã€‚\n\n  å¯¹äºä¼ªå…ƒç´  `:before` å’Œ `:after` è€Œè¨€ï¼Œå±æ€§ `content` æ˜¯å¿…é¡»è®¾ç½®çš„ï¼Œæˆ‘ä»¬çŸ¥é“å±æ€§çš„å€¼å¯ä»¥ä¸ºå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æœ‰å…¶å®ƒå½¢å¼ï¼Œæ¯”å¦‚æŒ‡å‘ä¸€å¼ å›¾ç‰‡çš„ `URL:`\n\n  `content: url('img/icon.png')`\n\n- `::first-letter/:first-letter` åŒ¹é…å…ƒç´ ä¸­æ–‡æœ¬çš„é¦–å­—æ¯ã€‚è¢«ä¿®é¥°çš„é¦–å­—æ¯ä¸åœ¨æ–‡æ¡£æ ‘ä¸­\n\n- `::first-line/:first-line` åŒ¹é…å…ƒç´ ä¸­ç¬¬ä¸€è¡Œçš„æ–‡æœ¬ã€‚è¿™ä¸ªä¼ªå…ƒç´ åªèƒ½ç”¨åœ¨å—å…ƒç´ ä¸­ï¼Œä¸èƒ½ç”¨åœ¨å†…è”å…ƒç´ ä¸­ã€‚\n\n- `::selection` åŒ¹é…ç”¨æˆ·è¢«ç”¨æˆ·é€‰ä¸­æˆ–è€…å¤„äºé«˜äº®çŠ¶æ€çš„éƒ¨åˆ†ã€‚åœ¨ç«ç‹æµè§ˆå™¨ä½¿ç”¨æ—¶éœ€è¦æ·»åŠ `-moz`å‰ç¼€ã€‚è¯¥ä¼ªå…ƒç´ åªæ”¯æŒåŒå†’å·çš„å½¢å¼ã€‚\n\n- `::placeholder` åŒ¹é…å ä½ç¬¦çš„æ–‡æœ¬ï¼Œåªæœ‰å…ƒç´ è®¾ç½®äº†`placeholder`å±æ€§æ—¶ï¼Œè¯¥ä¼ªå…ƒç´ æ‰èƒ½ç”Ÿæ•ˆã€‚\n\n  ä¼ªå…ƒç´ ä¸æ˜¯`CSS`çš„æ ‡å‡†ï¼Œå®ƒçš„å®ç°å¯èƒ½åœ¨å°†æ¥ä¼šæœ‰æ‰€æ”¹å˜ï¼Œæ‰€ä»¥è¦å†³å®šä½¿ç”¨æ—¶å¿…é¡»è°¨æ…ã€‚åœ¨ä¸€äº›æµè§ˆå™¨ä¸­ï¼ˆ`IE10`å’Œ`Firefox18`åŠå…¶ä»¥ä¸‹ç‰ˆæœ¬ï¼‰ä¼šä½¿ç”¨å•å†’å·çš„å½¢å¼ã€‚\n\n* `::backdrop` ç”¨äºæ”¹å˜å…¨å±æ¨¡å¼ä¸‹çš„èƒŒæ™¯é¢œè‰²ï¼Œå…¨å±æ¨¡å¼çš„é»˜è®¤é¢œè‰²ä¸ºé»‘è‰²ã€‚è¯¥ä¼ªå…ƒç´ åªæ”¯æŒåŒå†’å·çš„å½¢å¼\n\næ³¨æ„ï¼š\n\n* é…åˆä¼ªç±»ä½¿ç”¨\n  - ä¼ªå…ƒç´  `:before` è¿˜å¯ä»¥é…åˆä¼ªç±»ä½¿ç”¨ï¼Œè¿™é‡Œä¸¾ç»å¸¸ä¸ `:before` é…åˆä½¿ç”¨çš„ä¼ªç±» `:hover` ä¸ºä¾‹ï¼š\n\n```css\n.before:hover:before{content:'you before'; color:red;}\n<div class=\"before\"> me</div>\n```\n\n- é…åˆå–å€¼å‡½æ•° `attr()` ä½¿ç”¨\n\n```css\na::before{content: attr(title)}\n<a href=\"https://blog.ihoey.com\" title=\"æ¢¦é­‡å°æ ˆ\"></a>\n\næ•ˆæœ\n<a href=\"https://blog.ihoey.com\" title=\"æ¢¦é­‡å°æ ˆ\">æ¢¦é­‡å°æ ˆ</a>\n```\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g79wlwrg6aj30dn05w3yy.jpg)","tags":["CSS","ä¼ªå…ƒç´ ","ä¼ªç±»"],"categories":["CSS"]},{"title":"sass&lesså¯¹æ¯”","url":"/2019/11/11/sass&lesså¯¹æ¯”/","content":"\n# sass&less\n\n##ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ CSS é¢„å¤„ç†å™¨ï¼Ÿ\n\nä½œä¸ºå‰ç«¯å¼€å‘äººå‘˜ï¼Œå¤§å®¶éƒ½çŸ¥é“ï¼ŒJs ä¸­å¯ä»¥è‡ªå®šä¹‰å˜é‡ï¼Œè€Œ CSS ä»…ä»…æ˜¯ä¸€ä¸ªæ ‡è®°è¯­è¨€ï¼Œä¸æ˜¯ç¼–ç¨‹è¯­è¨€ï¼Œå› æ­¤ä¸å¯ä»¥è‡ªå®šä¹‰å˜é‡ï¼Œä¸å¯ä»¥å¼•ç”¨ç­‰ç­‰ã€‚\n\n**CSS æœ‰å…·ä½“ä»¥ä¸‹å‡ ä¸ªç¼ºç‚¹ï¼š**\n\nè¯­æ³•ä¸å¤Ÿå¼ºå¤§ï¼Œæ¯”å¦‚æ— æ³•åµŒå¥—ä¹¦å†™ï¼Œå¯¼è‡´æ¨¡å—åŒ–å¼€å‘ä¸­éœ€è¦ä¹¦å†™å¾ˆå¤šé‡å¤çš„é€‰æ‹©å™¨ï¼›\n\næ²¡æœ‰å˜é‡å’Œåˆç†çš„æ ·å¼å¤ç”¨æœºåˆ¶ï¼Œä½¿å¾—é€»è¾‘ä¸Šç›¸å…³çš„å±æ€§å€¼å¿…é¡»ä»¥å­—é¢é‡çš„å½¢å¼é‡å¤è¾“å‡ºï¼Œå¯¼è‡´éš¾ä»¥ç»´æŠ¤ã€‚\n\nè¿™å°±å¯¼è‡´äº†æˆ‘ä»¬åœ¨å·¥ä½œä¸­æ— ç«¯å¢åŠ äº†è®¸å¤šå·¥ä½œé‡ã€‚è€Œä½¿ç”¨ CSS é¢„å¤„ç†å™¨ï¼Œæä¾› CSS ç¼ºå¤±çš„æ ·å¼å±‚å¤ç”¨æœºåˆ¶ã€å‡å°‘å†—ä½™ä»£ç ï¼Œæé«˜æ ·å¼ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚å¤§å¤§æé«˜äº†æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚\n\nä½†æ˜¯ï¼ŒCSS é¢„å¤„ç†å™¨ä¹Ÿä¸æ˜¯ä¸‡é‡‘æ²¹ï¼ŒCSS çš„å¥½å¤„åœ¨äºç®€ä¾¿ã€éšæ—¶éšåœ°è¢«ä½¿ç”¨å’Œè°ƒè¯•ã€‚é¢„ç¼–è¯‘ CSS æ­¥éª¤çš„åŠ å…¥ï¼Œè®©æˆ‘ä»¬å¼€å‘å·¥ä½œæµä¸­å¤šäº†ä¸€ä¸ªç¯èŠ‚ï¼Œè°ƒè¯•ä¹Ÿå˜å¾—æ›´éº»çƒ¦äº†ã€‚æ›´å¤§çš„é—®é¢˜åœ¨äºï¼Œé¢„ç¼–è¯‘å¾ˆå®¹æ˜“é€ æˆåä»£é€‰æ‹©å™¨çš„æ»¥ç”¨ã€‚\n\næ‰€ä»¥æˆ‘ä»¬åœ¨å®é™…é¡¹ç›®ä¸­è¡¡é‡é¢„ç¼–è¯‘æ–¹æ¡ˆæ—¶ï¼Œè¿˜æ˜¯å¾—æƒ³æƒ³ï¼Œæ¯”èµ·å¸¦æ¥çš„é¢å¤–ç»´æŠ¤å¼€é”€ï¼ŒCSS é¢„å¤„ç†å™¨æœ‰æ²¡æœ‰è§£å†³æ›´å¤§çš„éº»çƒ¦ã€‚\n\n## ä¸»è¦åŒºåˆ«ï¼š\n\né¦–å…ˆ sass å’Œ less éƒ½æ˜¯ css çš„é¢„ç¼–è¯‘å¤„ç†è¯­è¨€ï¼Œä»–ä»¬å¼•å…¥äº† mixinsï¼Œå‚æ•°ï¼ŒåµŒå¥—è§„åˆ™ï¼Œè¿ç®—ï¼Œé¢œè‰²ï¼Œåå­—ç©ºé—´ï¼Œä½œç”¨åŸŸï¼ŒJavaScript èµ‹å€¼ç­‰ åŠ å¿«äº† css å¼€å‘æ•ˆç‡,å½“ç„¶è¿™ä¸¤è€…éƒ½å¯ä»¥é…åˆ gulp å’Œ grunt ç­‰å‰ç«¯æ„å»ºå·¥å…·ä½¿ç”¨\n\nsass å’Œ less**ä¸»è¦åŒºåˆ«:åœ¨äºå®ç°æ–¹å¼ less æ˜¯åŸºäº JavaScript çš„åœ¨å®¢æˆ·ç«¯å¤„ç† æ‰€ä»¥å®‰è£…çš„æ—¶å€™ç”¨ npmï¼Œsass æ˜¯åŸºäº ruby æ‰€ä»¥åœ¨æœåŠ¡å™¨å¤„ç†ã€‚**\n\n## SASS ä»‹ç»\n\nSass æ˜¯ Ruby å¼€å‘è€…ä¸ºå‰ç«¯å¼€å‘æä¾›çš„å¤„ç† CSS çš„å·¥å…·ã€‚å®ƒä¸º CSS æä¾›æ›´åŠ¨æ€çš„è®¾å®šæ–¹å¼ï¼Œå…è®¸ç¼–è¯‘ã€å˜é‡ã€å‡½æ•°â€¦â€¦æ€»ä¹‹ï¼Œä½¿ CSS æ›´åŠ¨æ€ï¼Œä¹Ÿæ›´åƒä¸€é—¨çœŸæ­£çš„å¯ç¼–ç¨‹è¯­è¨€ã€‚\n\n1. Sass æ˜¯åŸºäº Ruby å¼€å‘çš„ï¼Œæ‰€ä»¥å¼€å‘ç¯å¢ƒé¦–å…ˆéœ€è¦å®‰è£… Rubyã€‚\n2. æµè§ˆå™¨ä¸­æ— æ³•ç¼–è¯‘ Sassï¼Œæ‰€ä»¥è¦å…ˆç¼–è¯‘å¥½ css æ–‡ä»¶ï¼Œå†äº¤ç»™æµè§ˆå™¨ã€‚Sass**ä¸èƒ½**åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ç›´æ¥è¿è¡Œã€‚\n\n##Less ä»‹ç»\n\nLess æ˜¯æ™šäº›äº§ç”Ÿçš„è¯­è¨€ï¼ŒåŸºäº JS è¿›è¡Œå¼€å‘ï¼Œåœ¨ Node ä¸­è¿›è¡Œç¼–è¯‘ã€‚æ‰€ä»¥ä½¿ç”¨æ—¶ä¸éœ€è¦å®‰è£…å…¶ä»–è¯­è¨€ï¼Œä¸è¿‡è¦è®°å¾—**å…ˆå¯¼å…¥ less æ–‡ä»¶ï¼Œç„¶åå¯¼å…¥ less.js**ã€‚æä¾› CDN åœ°å€åœ¨è¿™é‡Œï¼š\n\n```html\n<script src=\"https://cdn.bootcss.com/less.js/3.0.4/less.js\"></script>\n<script src=\"https://cdn.bootcss.com/less.js/3.0.4/less.min.js\"></script>\n```\n\nå½“ç„¶ Less ä¹Ÿæä¾›æœåŠ¡å™¨ç«¯çš„ç¼–è¯‘åŠŸèƒ½ã€‚\n\n## Stylus ä»‹ç»\n\n[Stylus](https://link.juejin.im?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttp%3A%2F%2Flearnboost.github.io%2Fstylus%2F)ç›¸å¯¹å‰ä¸¤è€…è¾ƒæ–°ï¼Œå¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£ä»‹ç»çš„åŠŸèƒ½ã€‚\n\n1.æ¥è‡ª NodeJS ç¤¾åŒºï¼Œæ‰€ä»¥å’Œ NodeJS èµ°å¾—å¾ˆè¿‘ï¼Œä¸ JavaScript è”ç³»éå¸¸ç´§å¯†ã€‚è¿˜æœ‰ä¸“é—¨ JavaScript APIï¼š[learnboost.github.io/stylus/docsâ€¦](https://link.juejin.im?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttp%3A%2F%2Flearnboost.github.io%2Fstylus%2Fdocs%2Fjs.html)\n\n2.æ”¯æŒ Ruby ä¹‹ç±»ç­‰ç­‰æ¡†æ¶\n\n3.æ›´å¤šæ›´å¼ºå¤§çš„æ”¯æŒå’ŒåŠŸèƒ½\n\nä»¥ stylus çš„è§’åº¦æ¥è¯´,stylus æ›´åŠ æ³¨é‡å¯¹ javascript( [learnboost.github.io/stylus/docsâ€¦](https://link.juejin.im?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttp%3A%2F%2Flearnboost.github.io%2Fstylus%2Fdocs%2Fjs.html) ) çš„åˆ©ç”¨ã€‚ å½“ç”¨æˆ·è§‰å¾—å†™ stylus å‡½æ•°é‡åˆ°äº†è¿‡äºå¤æ‚æˆ–è€…æ— æ³•æµ‹è¯•ï¼Œstylus è¯­æ³•ä¸æ”¯æŒç­‰éœ€æ±‚æ—¶ï¼Œ ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ js æ¥å®ç°è¿™ä¸ªå‡½æ•°å¹¶ä¸”åœ¨ stylus ä¸­è°ƒç”¨ã€‚\n\nå…¶æ¬¡ä»ç¼–è¯‘å™¨æºç ä¸Šæ¥çœ‹ï¼šstylus åº”è¯¥æ¯” less.js æ›´æœ‰æ¡ç†ï¼Œ æ„Ÿè§‰å¦‚æœæœªæ¥ç¤¾åŒºæ·»åŠ åŠŸèƒ½çš„è¯ï¼Œstylus çš„æºç æ·»åŠ èµ·åŠŸèƒ½æ¥ä¼šæ›´ç®€å•ï¼ŒåŒæ ·ï¼Œç›®å‰ stylus çš„åŠŸèƒ½ä¹Ÿæ›´å¤æ‚ã€‚\n\nstylus å’Œ sass å¦ä¸€ä¸ªåŒºåˆ«åœ¨äº sass æœ¬èº«ä¼šå»ºè®®ï¼Œä»¥ä¸‹åˆ’çº¿(\\_) æ‰“å¤´çš„æ–‡ä»¶åœ¨é™æ€èµ„æºæ‰“åŒ…çš„æ—¶å€™ä¸ä¼šè¢«ç¼–è¯‘æˆ .css æ–‡ä»¶ã€åªæ˜¯ä½œä¸ºä¸€ç§ import å­˜åœ¨ã€‘ã€‚è€Œ stylus æ²¡æœ‰è¿™æ–¹é¢çš„è§„èŒƒã€‚\n\nåŒæ—¶å†™è¿‡ stylus å’Œ sassï¼Œ å°±è¯­æ³•ç®€æ´æ¥çœ‹ï¼Œ stylus åœ¨è¿™æ–¹é¢å äº†å¾ˆå¤§çš„ä¾¿å®œã€‚\n\n## [ä¸‰è€…å¯¹æ¯”](https://cloud.tencent.com/developer/article/1092653)\n\n- ### å˜é‡\n\nSass: \\$var\nLess: @var\nä¸¤ç§è¯­è¨€éƒ½ä¼šæœ‰ä½œç”¨åŸŸçš„é—®é¢˜ã€‚ä¸€ä¸ªå˜é‡åªèƒ½åœ¨å®ƒè¢«å®šä¹‰çš„ä»£ç å—ä¸­ä½¿ç”¨ã€‚é‡å¤å®šä¹‰çš„å˜é‡ä¼šæŠ¥é”™ã€‚\n\nStylus å¯¹å˜é‡åæ²¡æœ‰ä»»ä½•é™å®šï¼Œä½ å¯ä»¥æ˜¯ \\$ å¼€å§‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»»æ„çš„å­—ç¬¦ï¼Œè€Œä¸”ä¸å˜é‡å€¼ä¹‹é—´å¯ä»¥ç”¨å†’å·ã€ç©ºæ ¼éš”å¼€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ Stylus (0.22.4) å°†ä¼šç¼–è¯‘ @ å¼€å§‹çš„å˜é‡ï¼Œä½†å…¶å¯¹åº”çš„å€¼å¹¶ä¸ä¼šèµ‹äºˆè¯¥å˜é‡ï¼Œæ¢å¥è¯è¯´ï¼Œåœ¨ Stylus çš„å˜é‡åä¸è¦ç”¨ @ å¼€å¤´ã€‚\n\n- ### è¿ç®—èµ‹å€¼ï¼š\n\nåªè¦ä¿æŒå•ä½ç»Ÿä¸€æˆ–å¯ç›¸äº’è½¬æ¢ï¼Œå°±å¯ä»¥è¿›è¡Œè¿ç®—ï¼ŒåŒ…æ‹¬é¢œè‰²åœ¨å†…ï¼š\nSass:\n\n```scss\np {\n  cursor: e + -resize;\n}\n// ç¼–è¯‘ä¸º\n// p {\n//   cursor: e-resize;\n// }\n\nbody {\n  margin: (14px/2);\n  top: 50px + 100px;\n  right: $var * 10%;\n}\n```\n\nLess:\n\n```less\n@base: 5%;\n@filler: @base * 2;\n@other: @base + @filler;\n\ncolor: #888 / 4;\nbackground-color: @base-color + #111;\nheight: 100% / 2 + @filler;\n\n@var: 1px + 5;\n\nwidth: (@var + 5) * 2;\n\nborder: (@width * 2) solid black;\n```\n\n- ### åµŒå¥—\n\nSass å’Œ Less å‡å…è®¸å…ƒç´ åµŒå¥—ã€‚å¦‚æœçˆ¶å­é€‰æ‹©å™¨å‡ç”¨é€—å·åˆ†å¼€ï¼Œé‚£ä¹ˆç¼–è¯‘æ—¶ä¼šæŒ‰ç»“åˆå¾‹æ‹†å¼€ç¼–è¯‘ã€‚\nSass å’Œ Less æŒ‡ä»£ä¸Šå±‚å…ƒç´ å‡ä½¿ç”¨`&`ç¬¦å·ã€‚\n\n- ### ç»§æ‰¿\n\nSass ä¸­ï¼Œå†™å¥½çš„é€‰æ‹©å™¨è¿›è¡Œé›†æˆï¼Œéœ€è¦`@extend`å…³é”®å­—ã€‚ï¼ˆsytlus ä¸ sass ç›¸åŒï¼‰\nLess ä¸­ï¼Œç›´æ¥å†™å…¥å³å¯ï¼š`.be-extend-class;`\n\n- ### Mixin\n\nSass ä¸­ï¼Œéœ€è¦è¿›è¡Œ Mixin æ“ä½œçš„é€‰æ‹©å™¨éœ€è¦`@mixin`å…³é”®å­—ï¼Œé€‰æ‹©å™¨åå¯ä»¥ä¼ å…¥å˜é‡å’Œé»˜è®¤å€¼ã€‚\n\n```scss\n@mixin left($value: 10px) padding: $value;\n```\n\nä½¿ç”¨æ—¶ä½¿ç”¨`@include`å…³é”®å­—ï¼Œå¹¶å¯ä»¥æ›´æ–°å˜é‡ï¼š\n\n```scss\n@include left @include left(20px);\n```\n\nLess ä¸­ Mixin å’Œç»§æ‰¿æ„Ÿè§‰æ›´ç›¸ä¼¼ï¼Œé€‰æ‹©å™¨åœ¨ä¹¦å†™æ—¶å°±ç•™å¥½äº†å˜é‡ï¼Œç›´æ¥ç»§æ‰¿æˆ–æ›´æ–°å˜é‡å³å¯ï¼š\n\n```less\n.be-extend-class(@width: 10px) {\n  padding: @width;\n}\n// ä½¿ç”¨\n.be-extend-class;\n.be-extend-class(20px);\n```\n\nsassï¼šåœ¨ sass å®šä¹‰ Mixins å’Œ lessã€stylus æœ‰æ‰€ä¸åŒï¼Œåœ¨å£°æ˜ Mixins æ—¶éœ€è¦ä½¿ç”¨â€œ@mixinâ€,ç„¶ååé¢ç´§è·Ÿ Mixins çš„åï¼Œä»–ä¹Ÿå¯ä»¥å®šä¹‰å‚æ•°ï¼ŒåŒæ—¶å¯ä»¥ç»™è¿™ä¸ªå‚æ•°è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä½†å‚æ•°åæ˜¯ä½¿ç”¨â€œ\\$â€ç¬¦å·å¼€å§‹ï¼Œè€Œä¸”å’Œå‚æ•°å€¼ä¹‹é—´éœ€è¦ä½¿ç”¨å†’å·ï¼ˆï¼šï¼‰åˆ†å¼€ã€‚å¦å¤–åœ¨ sass ä¸­è°ƒç”¨ Mixins éœ€è¦ä½¿ç”¨â€œ@includeâ€ï¼Œç„¶ååœ¨å…¶åç´§è·Ÿä½ è¦è°ƒç”¨çš„ Mixins åã€‚\n\nlessï¼šless ä¸­å£°æ˜ Mixins å’Œ CSS å®šä¹‰æ ·å¼éå¸¸ç±»ä¼¼ï¼Œå¯ä»¥å°† Mixins çœ‹æˆæ˜¯ä¸€ä¸ªé€‰æ‹©å™¨ï¼Œå½“ç„¶ Mixins ä¹Ÿå¯ä»¥è®¾ç½®å‚æ•°ï¼Œå¹¶ç»™å‚æ•°è®¾ç½®é»˜è®¤å€¼ã€‚ä¸è¿‡è®¾ç½®å‚æ•°çš„å˜é‡åæ˜¯ä½¿ç”¨â€œ@â€å¼€å§‹ï¼ŒåŒæ ·å‚æ•°å’Œé»˜è®¤å‚æ•°å€¼ä¹‹é—´éœ€è¦ä½¿ç”¨å†’å·ï¼ˆï¼šï¼‰åˆ†å¼€ã€‚\n\nstylusï¼šstylus å’Œå‰ä¸¤è€…ä¹Ÿç•¥æœ‰ä¸åŒï¼Œä»–å¯ä»¥ä¸ä½¿ç”¨ä»»ä½•ç¬¦å·ï¼Œå°±æ˜¯ç›´æ¥å®šä¹‰ Mixins åï¼Œç„¶ååœ¨å®šä¹‰å‚æ•°å’Œé»˜è®¤å€¼ä¹‹é—´ç”¨ç­‰å·ï¼ˆ=ï¼‰æ¥è¿æ¥ã€‚\n\n- ### æ³¨é‡Š\n\nä¸¤ç§è¯­è¨€ç›¸åŒï¼šå¤šè¡Œæ³¨é‡Šæ ¼å¼å¯ä¿ç•™ï¼Œå•è¡Œæ³¨é‡Šæ ¼å¼ä¼šåœ¨ç¼–è¯‘æ—¶è¢«åˆ é™¤ã€‚\n\n```scss\n/* ä¼šè¢«ä¿ç•™çš„æ³¨é‡Šæ ¼å¼ */\n// ä¸ä¿å­˜çš„æ³¨é‡Šæ ¼å¼\n```\n\n- ### é¢œè‰²è¿ç®—ï¼š\n\nCSS é¢„å¤„ç†å™¨æä¾›ä¸€ç³»åˆ—**é¢œè‰²å‡½æ•°**å¸®åŠ©ç”Ÿæˆä¸»é¢˜ç³»åˆ—é¢œè‰²ï¼š\nSassï¼š\n\n```scss\nlighten(#cc3, 10%) // #d6d65c\ndarken(#cc3, 10%) // #a3a329\ngrayscale(#cc3) // #808080 ç°åº¦\ncomplement(#cc3) // #33c\n```\n\nLessï¼š\n\n```less\nlighten(@color, 10%);     // return a color which is 10% *lighter* than @color\ndarken(@color, 10%);      // return a color which is 10% *darker* than @color\n\nsaturate(@color, 10%);    // return a color 10% *more* saturated than @color\ndesaturate(@color, 10%);  // return a color 10% *less* saturated than @color\n\nfadein(@color, 10%);      // return a color 10% *less* transparent than @color\nfadeout(@color, 10%);     // return a color 10% *more* transparent than @color\nfade(@color, 50%);        // return @color with 50% transparency\n\nspin(@color, 10);         // return a color with a 10 degree larger in hue than @color\nspin(@color, -10);        // return a color with a 10 degree smaller hue than @color\n\nmix(@color1, @color2);    // return a mix of @color1 and @color2\n\n```\n\nstylusï¼š\n\n```stylus\nlighten(color, 10%); /* è¿”å›çš„é¢œè‰²åœ¨'color'åŸºç¡€ä¸Šå˜äº®10% */\ndarken(color, 10%);  /* è¿”å›çš„é¢œè‰²åœ¨'color'åŸºç¡€ä¸Šå˜æš—10% */\nsaturate(color, 10%);   /* è¿”å›çš„é¢œè‰²åœ¨'color'åŸºç¡€ä¸Šé¥±å’Œåº¦å¢åŠ 10% */\ndesaturate(color, 10%); /* è¿”å›çš„é¢œè‰²åœ¨'color'åŸºç¡€ä¸Šé¥±å’Œåº¦é™ä½10% */\n\n```\n\n- ### æ’å…¥æ–‡ä»¶\n\nä¸¤ç§è¯­è¨€ç›¸åŒï¼Œä½¿ç”¨@import å…³é”®å­—å¼•å…¥ã€‚æ³¨æ„åç¼€åï¼Œå¯ä»¥ç›´æ¥å¯¼å…¥ css æ–‡ä»¶ã€‚åç¼€åä¸º css çš„æ–‡ä»¶ä¸ä¼šè¢«é¢„å¤„ç†å™¨å¤„ç†ã€‚\n\n```scss\n@import \"path/filename.scss\";\n\n@import \"lib.less\";\n@import \"lib.css\";\n```\n\n- ### ==é«˜çº§è¯­æ³•ï¼š==\n\n#### SASS\n\nåœ¨ Sass ä¸­ï¼Œéœ€è¦ç”¨ Sass è‡ªå·±çš„ä¸€å¥—è¯­è¨€ç¼–ç¨‹ï¼š\n\n1. æ¡ä»¶ if-else\n\n```scss\n@if lightness($color) > 30% {\n  background-color: #000;\n} @else {\n  background-color: #fff;\n}\n```\n\n2. å¾ªç¯\n\nfor:\n\n```scss\n@for $i from 1 to 10 {\n  .border-#{$i} {\n    border: #{$i}px solid blue;\n  }\n}\n```\n\nwhile:\n\n```scss\n$i: 6;\n@while $i > 0 {\n  .item-#{$i} {\n    width: 2em * $i;\n  }\n  $i: $i - 2;\n}\n```\n\neach:\n\n```scss\n@each $member in a, b, c, d {\n  .#{$member} {\n    background-image: url(\"/image/#{$member}.jpg\");\n  }\n}\n```\n\n3. è‡ªå®šä¹‰å‡½æ•°\n\néœ€è¦`@function`ã€`@return`å…³é”®å­—ã€‚\n\n```scss\n@function double($n) {\n  @return $n * 2;\n}\n\n#sidebar {\n  width: double(5px);\n}\n```\n\n#### Less\n\nLess æ˜¯ä½¿ç”¨ JS ä½œä¸ºç¼–è¯‘ç¯å¢ƒçš„ï¼Œæ‰€ä»¥å®ƒæ”¯æŒ JS è¯­æ³•ã€‚\n\n1. å­—ç¬¦ä¸²æ’å€¼\n\n```less\n@base-url: \"http://assets.fnord.com\";\nbackground-image: url(\"@{base-url}/images/bg.png\");\n```\n\n2. ç”¨åå¼•å·ä½¿ç”¨ JS è¯­æ³•ï¼š\n\n```less\n@var: ` \"hello\" .toUpperCase() + \"!\" `;\n```\n\n3. ç›´æ¥è®¿é—® JS ç¯å¢ƒ\n\n```less\n@height: `document.body.clientHeight`;\n```\n","tags":["CSS","SASS","LESS"],"categories":["CSS"]},{"title":"oh-my-zsh git å‘½ä»¤ç¼©å†™","url":"/2019/11/05/oh-my-zsh git å‘½ä»¤ç¼©å†™/","content":"\n#oh-my-zsh git å‘½ä»¤ç¼©å†™\n\nå–œæ¬¢ç”¨ git å‘½ä»¤è¡Œï¼Œå¹³æ—¶èƒ½å°‘æ‰“å‡ ä¸ªå­—è¿˜æ˜¯ä¼šèŠ‚çœä¸å°‘æ—¶é—´çš„ã€‚\n\n## å¸¸ç”¨\n\n```javascript\nalias ga='git add'\nalias gb='git branch'\nalias gba='git branch -a'\nalias gbd='git branch -d'\nalias gcam='git commit -a -m'\nalias gcb='git checkout -b'\nalias gco='git checkout'\nalias gcp='git cherry-pick'\nalias gd='git diff'\nalias gfo='git fetch origin'\nalias ggpush='git push origin $(git_current_branch)'\nalias ggsup='git branch --set-upstream-to=origin/$(git_current_branch)'\nalias glgp='git log --stat -p'\nalias gm='git merge'\nalias gp='git push'\nalias gst='git status'\nalias gsta='git stash save'\nalias gstp='git stash pop'\n```\n\n## å…¨éƒ¨\n\nå‚è€ƒï¼šhttps://github.com/robbyrussell/oh-my-zsh/blob/master/plugins/git/git.plugin.zsh\n\n```javascript\nalias g='git'\n\nalias ga='git add'\nalias gaa='git add --all'\nalias gapa='git add --patch'\nalias gau='git add --update'\n\nalias gb='git branch'\nalias gba='git branch -a'\nalias gbd='git branch -d'\nalias gbda='git branch --no-color --merged | command grep -vE \"^(\\*|\\s*(master|develop|dev)\\s*$)\" | command xargs -n 1 git branch -d'\nalias gbl='git blame -b -w'\nalias gbnm='git branch --no-merged'\nalias gbr='git branch --remote'\nalias gbs='git bisect'\nalias gbsb='git bisect bad'\nalias gbsg='git bisect good'\nalias gbsr='git bisect reset'\nalias gbss='git bisect start'\n\nalias gc='git commit -v'\nalias gc!='git commit -v --amend'\nalias gcn!='git commit -v --no-edit --amend'\nalias gca='git commit -v -a'\nalias gca!='git commit -v -a --amend'\nalias gcan!='git commit -v -a --no-edit --amend'\nalias gcans!='git commit -v -a -s --no-edit --amend'\nalias gcam='git commit -a -m'\nalias gcsm='git commit -s -m'\nalias gcb='git checkout -b'\nalias gcf='git config --list'\nalias gcl='git clone --recursive'\nalias gclean='git clean -fd'\nalias gpristine='git reset --hard && git clean -dfx'\nalias gcm='git checkout master'\nalias gcd='git checkout develop'\nalias gcmsg='git commit -m'\nalias gco='git checkout'\nalias gcount='git shortlog -sn'\ncompdef _git gcount\nalias gcp='git cherry-pick'\nalias gcpa='git cherry-pick --abort'\nalias gcpc='git cherry-pick --continue'\nalias gcs='git commit -S'\n\nalias gd='git diff'\nalias gdca='git diff --cached'\nalias gdct='git describe --tags `git rev-list --tags --max-count=1`'\nalias gdt='git diff-tree --no-commit-id --name-only -r'\nalias gdw='git diff --word-diff'\n\ngdv() { git diff -w \"$@\" | view - }\ncompdef _git gdv=git-diff\n\nalias gf='git fetch'\nalias gfa='git fetch --all --prune'\nalias gfo='git fetch origin'\n\nfunction gfg() { git ls-files | grep $@ }\ncompdef _grep gfg\n\nalias gg='git gui citool'\nalias gga='git gui citool --amend'\n\nggf() {\n  [[ \"$#\" != 1 ]] && local b=\"$(git_current_branch)\"\n  git push --force origin \"${b:=$1}\"\n}\ncompdef _git ggf=git-checkout\n\nggl() {\n  if [[ \"$#\" != 0 ]] && [[ \"$#\" != 1 ]]; then\n    git pull origin \"${*}\"\n  else\n    [[ \"$#\" == 0 ]] && local b=\"$(git_current_branch)\"\n    git pull origin \"${b:=$1}\"\n  fi\n}\ncompdef _git ggl=git-checkout\n\nggp() {\n  if [[ \"$#\" != 0 ]] && [[ \"$#\" != 1 ]]; then\n    git push origin \"${*}\"\n  else\n    [[ \"$#\" == 0 ]] && local b=\"$(git_current_branch)\"\n    git push origin \"${b:=$1}\"\n  fi\n}\ncompdef _git ggp=git-checkout\n\nggpnp() {\n  if [[ \"$#\" == 0 ]]; then\n    ggl && ggp\n  else\n    ggl \"${*}\" && ggp \"${*}\"\n  fi\n}\ncompdef _git ggpnp=git-checkout\n\nggu() {\n  [[ \"$#\" != 1 ]] && local b=\"$(git_current_branch)\"\n  git pull --rebase origin \"${b:=$1}\"\n}\ncompdef _git ggu=git-checkout\n\nalias ggpur='ggu'\ncompdef _git ggpur=git-checkout\n\nalias ggpull='git pull origin $(git_current_branch)'\ncompdef _git ggpull=git-checkout\n\nalias ggpush='git push origin $(git_current_branch)'\ncompdef _git ggpush=git-checkout\n\nalias ggsup='git branch --set-upstream-to=origin/$(git_current_branch)'\nalias gpsup='git push --set-upstream origin $(git_current_branch)'\n\nalias ghh='git help'\n\nalias gignore='git update-index --assume-unchanged'\nalias gignored='git ls-files -v | grep \"^[[:lower:]]\"'\nalias git-svn-dcommit-push='git svn dcommit && git push github master:svntrunk'\ncompdef _git git-svn-dcommit-push=git\n\nalias gk='\\gitk --all --branches'\ncompdef _git gk='gitk'\nalias gke='\\gitk --all $(git log -g --pretty=%h)'\ncompdef _git gke='gitk'\n\nalias gl='git pull'\nalias glg='git log --stat'\nalias glgp='git log --stat -p'\nalias glgg='git log --graph'\nalias glgga='git log --graph --decorate --all'\nalias glgm='git log --graph --max-count=10'\nalias glo='git log --oneline --decorate'\nalias glol=\"git log --graph --pretty='%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit\"\nalias glola=\"git log --graph --pretty='%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --all\"\nalias glog='git log --oneline --decorate --graph'\nalias gloga='git log --oneline --decorate --graph --all'\nalias glp=\"_git_log_prettily\"\ncompdef _git glp=git-log\n\nalias gm='git merge'\nalias gmom='git merge origin/master'\nalias gmt='git mergetool --no-prompt'\nalias gmtvim='git mergetool --no-prompt --tool=vimdiff'\nalias gmum='git merge upstream/master'\n\nalias gp='git push'\nalias gpd='git push --dry-run'\nalias gpoat='git push origin --all && git push origin --tags'\ncompdef _git gpoat=git-push\nalias gpu='git push upstream'\nalias gpv='git push -v'\n\nalias gr='git remote'\nalias gra='git remote add'\nalias grb='git rebase'\nalias grba='git rebase --abort'\nalias grbc='git rebase --continue'\nalias grbi='git rebase -i'\nalias grbm='git rebase master'\nalias grbs='git rebase --skip'\nalias grh='git reset HEAD'\nalias grhh='git reset HEAD --hard'\nalias grmv='git remote rename'\nalias grrm='git remote remove'\nalias grset='git remote set-url'\nalias grt='cd $(git rev-parse --show-toplevel || echo \".\")'\nalias gru='git reset --'\nalias grup='git remote update'\nalias grv='git remote -v'\n\nalias gsb='git status -sb'\nalias gsd='git svn dcommit'\nalias gsi='git submodule init'\nalias gsps='git show --pretty=short --show-signature'\nalias gsr='git svn rebase'\nalias gss='git status -s'\nalias gst='git status'\nalias gsta='git stash save'\nalias gstaa='git stash apply'\nalias gstc='git stash clear'\nalias gstd='git stash drop'\nalias gstl='git stash list'\nalias gstp='git stash pop'\nalias gsts='git stash show --text'\nalias gsu='git submodule update'\n\nalias gts='git tag -s'\nalias gtv='git tag | sort -V'\n\nalias gunignore='git update-index --no-assume-unchanged'\nalias gunwip='git log -n 1 | grep -q -c \"\\-\\-wip\\-\\-\" && git reset HEAD~1'\nalias gup='git pull --rebase'\nalias gupv='git pull --rebase -v'\nalias glum='git pull upstream master'\n\nalias gwch='git whatchanged -p --abbrev-commit --pretty=medium'\nalias gwip='git add -A; git rm $(git ls-files --deleted) 2> /dev/null; git commit --no-verify -m \"--wip-- [skip ci]\"'\n```\n","tags":["git"],"categories":["git"]},{"title":"Object.prototype.toStringæ–¹æ³•çš„åŸç†","url":"/2019/10/28/Object.prototype.toStringæ–¹æ³•çš„åŸç†/","content":"\n# Object.prototype.toString æ–¹æ³•çš„åŸç†\n\n## ECMAScript 3\n\n### Object.prototype.toString æ–¹æ³•çš„è§„èŒƒ\n\nåœ¨**toString**æ–¹æ³•è¢«è°ƒç”¨æ—¶,ä¼šæ‰§è¡Œä¸‹é¢çš„æ“ä½œæ­¥éª¤:\n\n1. è·å– this å¯¹è±¡çš„[[Class]]å±æ€§çš„å€¼.\n2. è®¡ç®—å‡ºä¸‰ä¸ªå­—ç¬¦ä¸²**\"[object \",**ç¬¬ä¸€æ­¥çš„æ“ä½œç»“æœ Result(1), ä»¥åŠ **\"]\"**è¿æ¥åçš„æ–°å­—ç¬¦ä¸².\n3. è¿”å›ç¬¬äºŒæ­¥çš„æ“ä½œç»“æœ Result(2).\n\n### [[Class]]\n\n[[Class]]æ˜¯ä¸€ä¸ªå†…éƒ¨å±æ€§,æ‰€æœ‰çš„å¯¹è±¡(åŸç”Ÿå¯¹è±¡å’Œå®¿ä¸»å¯¹è±¡)éƒ½æ‹¥æœ‰è¯¥å±æ€§.åœ¨è§„èŒƒä¸­,[[Class]]æ˜¯è¿™ä¹ˆå®šä¹‰çš„\n\n| å†…éƒ¨å±æ€§  | æè¿°                             |\n| --------- | -------------------------------- |\n| [[Class]] | ä¸€ä¸ªå­—ç¬¦ä¸²å€¼,è¡¨æ˜äº†è¯¥å¯¹è±¡çš„ç±»å‹. |\n\nç„¶åç»™äº†ä¸€æ®µè§£é‡Š:\n\n> æ‰€æœ‰å†…ç½®å¯¹è±¡çš„[[Class]]å±æ€§çš„å€¼æ˜¯ç”±æœ¬è§„èŒƒå®šä¹‰çš„.æ‰€æœ‰å®¿ä¸»å¯¹è±¡çš„[[Class]]å±æ€§çš„å€¼å¯ä»¥æ˜¯ä»»æ„å€¼,ç”šè‡³å¯ä»¥æ˜¯å†…ç½®å¯¹è±¡ä½¿ç”¨è¿‡çš„[[Class]]å±æ€§çš„å€¼.[[Class]]å±æ€§çš„å€¼å¯ä»¥ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªåŸç”Ÿå¯¹è±¡å±äºå“ªç§å†…ç½®ç±»å‹.éœ€è¦æ³¨æ„çš„æ˜¯,é™¤äº†é€šè¿‡**Object.prototype.toString**æ–¹æ³•ä¹‹å¤–,æœ¬è§„èŒƒæ²¡æœ‰æä¾›ä»»ä½•å…¶ä»–æ–¹å¼æ¥è®©ç¨‹åºè®¿é—®è¯¥å±æ€§çš„å€¼\n\nä¹Ÿå°±æ˜¯è¯´,æŠŠ Object.prototype.toString æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²,å»æ‰å‰é¢å›ºå®šçš„**\"[object \"**å’Œåé¢å›ºå®šçš„**\"]\",**å°±æ˜¯å†…éƒ¨å±æ€§[[class]]çš„å€¼,ä¹Ÿå°±è¾¾åˆ°äº†åˆ¤æ–­å¯¹è±¡ç±»å‹çš„ç›®çš„ã€‚\n\n### [[Class]]çš„å€¼\n\nåœ¨ ES3 ä¸­,è§„èŒƒæ–‡æ¡£å¹¶æ²¡æœ‰æ€»ç»“å‡º[[class]]å†…éƒ¨å±æ€§ä¸€å…±æœ‰å‡ ç§,ä¸è¿‡æˆ‘ä»¬å¯ä»¥è‡ªå·±ç»Ÿè®¡ä¸€ä¸‹,åŸç”Ÿå¯¹è±¡çš„[[class]]å†…éƒ¨å±æ€§çš„å€¼ä¸€å…±æœ‰ 10 ç§.åˆ†åˆ«æ˜¯:`\"Array\"`, `\"Boolean\"`, `\"Date\"`, `\"Error\"`, `\"Function\"`, `\"Math\"`, `\"Number\"`, `\"Object\"`, `\"RegExp\"`, `\"String\".`\n\n## ECMAScript 5\n\n### Object.prototype.toString æ–¹æ³•çš„è§„èŒƒ\n\nåœ¨**toString**æ–¹æ³•è¢«è°ƒç”¨æ—¶,ä¼šæ‰§è¡Œä¸‹é¢çš„æ“ä½œæ­¥éª¤:\n\n1. å¦‚æœ**this**çš„å€¼ä¸º**undefined**,åˆ™è¿”å›`\"[object Undefined]\"`.\n2. å¦‚æœ**this**çš„å€¼ä¸º**null**,åˆ™è¿”å›`\"[object Null]\"`.\n3. è®©*O*æˆä¸ºè°ƒç”¨ ToObject(**this)**çš„ç»“æœ.\n4. è®©*class*æˆä¸º*O*çš„å†…éƒ¨å±æ€§[[Class]]çš„å€¼.\n5. è¿”å›ä¸‰ä¸ªå­—ç¬¦ä¸²**\"[object \",** _class_, ä»¥åŠ **\"]\"**è¿æ¥åçš„æ–°å­—ç¬¦ä¸².\n\nå¯ä»¥çœ‹å‡º,ES5 æ¯” ES3 å¤šäº† 1,2,3 æ­¥.ç¬¬ 1,2 æ­¥å±äºæ–°è§„åˆ™,æ¯”è¾ƒç‰¹æ®Š,å› ä¸º\"`Undefined\"`å’Œ\"`Null\"`å¹¶ä¸å±äº[[class]]å±æ€§çš„å€¼,éœ€è¦æ³¨æ„çš„æ˜¯,è¿™é‡Œå’Œä¸¥æ ¼æ¨¡å¼æ— å…³(å¤§éƒ¨åˆ†å‡½æ•°åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹,this çš„å€¼æ‰ä¼šä¿æŒ undefined æˆ– null,éä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šè‡ªåŠ¨æˆä¸ºå…¨å±€å¯¹è±¡).ç¬¬ 3 æ­¥å¹¶ä¸ç®—æ˜¯æ–°è§„åˆ™,å› ä¸ºåœ¨ ES3 çš„å¼•æ“ä¸­,ä¹Ÿéƒ½ä¼šåœ¨è¿™ä¸€æ­¥å°†ä¸‰ç§åŸå§‹å€¼ç±»å‹è½¬æ¢æˆå¯¹åº”çš„åŒ…è£…å¯¹è±¡,åªæ˜¯è§„èŒƒä¸­æ²¡å†™å‡ºæ¥.\n\n### [[Class]]\n\nES5 ä¸­,[[Class]]å±æ€§çš„è§£é‡Šæ›´åŠ è¯¦ç»†:\n\n> æ‰€æœ‰å†…ç½®å¯¹è±¡çš„[[Class]]å±æ€§çš„å€¼æ˜¯ç”±æœ¬è§„èŒƒå®šä¹‰çš„.æ‰€æœ‰å®¿ä¸»å¯¹è±¡çš„[[Class]]å±æ€§çš„å€¼å¯ä»¥æ˜¯é™¤äº†\"Arguments\", \"Array\", \"Boolean\", \"Date\", \"Error\", \"Function\", \"JSON\", \"Math\", \"Number\", \"Object\", \"RegExp\", \"String\"ä¹‹å¤–çš„çš„ä»»ä½•å­—ç¬¦ä¸².[[Class]]å†…éƒ¨å±æ€§æ˜¯å¼•æ“å†…éƒ¨ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡å±äºå“ªç§ç±»å‹çš„å€¼çš„.éœ€è¦æ³¨æ„çš„æ˜¯,é™¤äº†é€šè¿‡**Object.prototype.toString**æ–¹æ³•ä¹‹å¤–,æœ¬è§„èŒƒæ²¡æœ‰æä¾›ä»»ä½•å…¶ä»–æ–¹å¼æ¥è®©ç¨‹åºè®¿é—®è¯¥å±æ€§çš„å€¼\n\n### å¯¹æ¯” ES3\n\n- ç¬¬ä¸€ä¸ªå·®åˆ«å°±æ˜¯[[class]]å†…éƒ¨å±æ€§çš„å€¼å¤šäº†ä¸¤ç§,æˆäº† 12 ç§\n  - ä¸€ç§æ˜¯ arguments å¯¹è±¡çš„[[class]]æˆäº†\"Arguments\",è€Œä¸æ˜¯ä»¥å‰çš„\"Object\"\n  - å¤šä¸ªäº†å…¨å±€å¯¹è±¡ JSON,å®ƒçš„[[class]]å€¼ä¸º\"JSON\".\n- ç¬¬äºŒä¸ªå·®åˆ«å°±æ˜¯,å®¿ä¸»å¯¹è±¡çš„[[class]]å†…éƒ¨å±æ€§çš„å€¼,ä¸èƒ½å’Œè¿™ 12 ç§å€¼å†²çªï¼ˆä¸è¿‡åœ¨æ”¯æŒ ES3 çš„æµè§ˆå™¨ä¸­,è²Œä¼¼ä¹Ÿæ²¡æœ‰å‘ç°å“ªäº›å®¿ä¸»å¯¹è±¡æ•…æ„ä½¿ç”¨é‚£ 10 ä¸ªå€¼ï¼‰\n\n## ECMAScript 6\n\n**[[class]]å†…éƒ¨å±æ€§æ²¡æœ‰äº†**,å–è€Œä»£ä¹‹çš„æ˜¯å¦å¤–ä¸€ä¸ªå†…éƒ¨å±æ€§[[NativeBrand]].[[NativeBrand]]å±æ€§æ˜¯è¿™ä¹ˆå®šä¹‰çš„:\n\n| å†…éƒ¨å±æ€§        | å±æ€§å€¼                       | æè¿°                                                            |\n| --------------- | ---------------------------- | --------------------------------------------------------------- |\n| [[NativeBrand]] | æšä¸¾ NativeBrand çš„ä¸€ä¸ªæˆå‘˜. | è¯¥å±æ€§çš„å€¼å¯¹åº”ä¸€ä¸ªæ ‡å¿—å€¼(tag value),å¯ä»¥ç”¨æ¥åŒºåˆ†åŸç”Ÿå¯¹è±¡çš„ç±»å‹. |\n\n### [[NativeBrand]]å±æ€§ï¼ˆ`internal slot`ï¼‰\n\n[[NativeBrand]]å†…éƒ¨å±æ€§ç”¨æ¥è¯†åˆ«æŸä¸ªåŸç”Ÿå¯¹è±¡æ˜¯å¦ä¸ºç¬¦åˆæœ¬è§„èŒƒçš„æŸä¸€ç§ç‰¹å®šç±»å‹çš„å¯¹è±¡.[[NativeBrand]]å†…éƒ¨å±æ€§çš„å€¼ä¸ºä¸‹é¢è¿™äº›æšä¸¾ç±»å‹çš„å€¼ä¸­çš„ä¸€ä¸ª:NativeFunction, NativeArray, StringWrapper, BooleanWrapper, NumberWrapper, NativeMath, NativeDate, NativeRegExp, NativeError, NativeJSON, NativeArguments, NativePrivateName.[[NativeBrand]]å†…éƒ¨å±æ€§ä»…ç”¨æ¥åŒºåˆ†åŒºåˆ†ç‰¹å®šç±»å‹çš„ ECMAScript åŸç”Ÿå¯¹è±¡.åªæœ‰åœ¨è¡¨ 10 ä¸­æ˜ç¡®æŒ‡å‡ºçš„å¯¹è±¡ç±»å‹æ‰æœ‰[[NativeBrand]]å†…éƒ¨å±æ€§.\n\n| å±æ€§å€¼            | å¯¹åº”ç±»å‹             |\n| ----------------- | -------------------- |\n| NativeFunction    | Function objects     |\n| NativeArray       | Array objects        |\n| StringWrapper     | String objects       |\n| BooleanWrapper    | Boolean objects      |\n| NumberWrapper     | Number objects       |\n| NativeMath        | The Math object      |\n| NativeDate        | Date objects         |\n| NativeRegExp      | RegExp objects       |\n| NativeError       | Error objects        |\n| NativeJSON        | The JSON object      |\n| NativeArguments   | Arguments objects    |\n| NativePrivateName | Private Name objects |\n\nå¯è§,å’Œ[[class]]ä¸åŒçš„æ˜¯,å¹¶ä¸æ˜¯æ¯ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰[[NativeBrand]].\n\n### Object.prototype.toString æ–¹æ³•çš„è§„èŒƒ:\n\nåœ¨**toString**æ–¹æ³•è¢«è°ƒç”¨æ—¶,ä¼šæ‰§è¡Œä¸‹é¢çš„æ“ä½œæ­¥éª¤:\n\n1. å¦‚æœ**this**çš„å€¼ä¸º**undefined**,åˆ™è¿”å›`\"[object Undefined]\"`.\n2. å¦‚æœ**this**çš„å€¼ä¸º**null**,åˆ™è¿”å›`\"[object Null]\"`.\n3. è®©*O*æˆä¸ºè°ƒç”¨ ToObject(**this)**çš„ç»“æœ.\n4. å¦‚æœ*O*æœ‰[[NativeBrand]]å†…éƒ¨å±æ€§,è®©*tag*æˆä¸ºè¡¨ 29 ä¸­å¯¹åº”çš„å€¼.\n5. å¦åˆ™\n   1. è®©*hasTag*æˆä¸ºè°ƒç”¨*O*çš„[[HasProperty]]å†…éƒ¨æ–¹æ³•åçš„ç»“æœ,å‚æ•°ä¸º@@toStringTag.\n   2. å¦‚æœ*hasTag*ä¸º**false**,åˆ™è®©*tag*ä¸º`\"Object\"`.\n   3. å¦åˆ™,\n      1. è®©*tag*æˆä¸ºè°ƒç”¨*O*çš„[[Get]]å†…éƒ¨æ–¹æ³•åçš„ç»“æœ,å‚æ•°ä¸º@@toStringTag.\n      2. å¦‚æœ*tag*æ˜¯ä¸€ä¸ª abrupt completion,åˆ™è®©*tag*æˆä¸º NormalCompletion(`\"???\"`).\n      3. è®©*tag*æˆä¸º*tag*.[[value]].\n      4. å¦‚æœ Type(_tag_)ä¸æ˜¯å­—ç¬¦ä¸²,åˆ™è®©*tag æˆä¸º*`\"???\"`.\n      5. å¦‚æœ*tag*çš„å€¼ä¸º`\"Arguments\"`, `\"Array\"`, `\"Boolean\"`, `\"Date\"`, `\"Error\"`, `\"Function\"`, `\"JSON\"`, `\"Math\"`, `\"Number\"`, `\"Object\"`, `\"RegExp\"`,`æˆ–è€…\"String\"ä¸­çš„ä»»ä¸€ä¸ª,åˆ™è®©`*tag*æˆä¸ºå­—ç¬¦ä¸²`\"~\"å’Œ`*tag*å½“å‰çš„å€¼è¿æ¥åçš„ç»“æœ.\n6. è¿”å›ä¸‰ä¸ªå­—ç¬¦ä¸²\"[object \", tag, and \"]\"è¿æ¥åçš„æ–°å­—ç¬¦ä¸².\n\n### ES6 é‡Œçš„æ–°ç±»å‹ Map,Set\n\nES6 é‡Œçš„æ–°ç±»å‹ Map,Set ç­‰,éƒ½æ²¡æœ‰åœ¨è¡¨ 29 ä¸­.å®ƒä»¬åœ¨æ‰§è¡Œ toString æ–¹æ³•çš„æ—¶å€™è¿”å›çš„æ˜¯ä»€ä¹ˆ?\n\n```javascript\nconsole.log(Object.prototype.toString.call(Map())); //\"[object Map]\"\nconsole.log(Object.prototype.toString.call(Set())); //\"[object Set]\"\n```\n\nMap.prototype.@@toStringTag\n\n@@toStringTag å±æ€§çš„åˆå§‹å€¼ä¸ºå­—ç¬¦ä¸²**\"Map\"**.\n","tags":["JavaScript"],"categories":["JavaScript"]},{"title":"å‡½æ•°å¼ç¼–ç¨‹","url":"/2019/10/21/å‡½æ•°å¼ç¼–ç¨‹/","content":"\n# å‡½æ•°å¼ç¼–ç¨‹\n\n## ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç¼–ç¨‹\n\n### å®šä¹‰ï¼š\n\nå‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œä¸»è¦æ˜¯åˆ©ç”¨å‡½æ•°æŠŠè¿ç®—è¿‡ç¨‹å°è£…èµ·æ¥ï¼Œé€šè¿‡ç»„åˆå„ç§å‡½æ•°æ¥è®¡ç®—ç»“æœã€‚å‡½æ•°å¼ç¼–ç¨‹æ„å‘³ç€ä½ å¯ä»¥åœ¨æ›´çŸ­çš„æ—¶é—´å†…ç¼–å†™å…·æœ‰æ›´å°‘é”™è¯¯çš„ä»£ç ã€‚\n\nä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬è¦æŠŠå­—ç¬¦ä¸² `functional programming is great` å˜æˆæ¯ä¸ªå•è¯é¦–å­—æ¯å¤§å†™ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š\n\n```javascript\nvar string = \"functional programming is great\";\nvar result = string\n  .split(\" \")\n  .map(v => v.slice(0, 1).toUpperCase() + v.slice(1))\n  .join(\" \");\n```\n\nä¸Šé¢çš„ä¾‹å­å…ˆç”¨ split æŠŠå­—ç¬¦ä¸²è½¬æ¢æ•°ç»„ï¼Œç„¶åå†é€šè¿‡ map æŠŠå„å…ƒç´ çš„é¦–å­—æ¯è½¬æ¢æˆå¤§å†™ï¼Œæœ€åé€šè¿‡ join æŠŠæ•°ç»„è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚ æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯ `join(map(split(str)))`,ä½“ç°äº†å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒæ€æƒ³ï¼š **é€šè¿‡å‡½æ•°å¯¹æ•°æ®è¿›è¡Œè½¬æ¢**ã€‚\n\n### ç‰¹ç‚¹ï¼š\n\nç”±æ­¤æˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼Œå‡½æ•°å¼ç¼–ç¨‹æœ‰ä¸¤ä¸ªåŸºæœ¬ç‰¹ç‚¹ï¼š\n\n- é€šè¿‡å‡½æ•°æ¥å¯¹æ•°æ®è¿›è¡Œè½¬æ¢\n- é€šè¿‡ä¸²è”å¤šä¸ªå‡½æ•°æ¥æ±‚ç»“æœ\n\n## å¯¹æ¯”å£°æ˜å¼ä¸å‘½ä»¤å¼\n\n- å‘½ä»¤å¼ï¼šæˆ‘ä»¬é€šè¿‡ç¼–å†™ä¸€æ¡åˆä¸€æ¡æŒ‡ä»¤å»è®©è®¡ç®—æœºæ‰§è¡Œä¸€äº›åŠ¨ä½œï¼Œè¿™å…¶ä¸­ä¸€èˆ¬éƒ½ä¼šæ¶‰åŠåˆ°å¾ˆå¤šç¹æ‚çš„ç»†èŠ‚ã€‚å‘½ä»¤å¼ä»£ç ä¸­é¢‘ç¹ä½¿ç”¨è¯­å¥,æ¥å®ŒæˆæŸä¸ªè¡Œä¸ºã€‚æ¯”å¦‚ forã€ifã€switchã€throw ç­‰è¿™äº›è¯­å¥ã€‚\n- å£°æ˜å¼ï¼šæˆ‘ä»¬é€šè¿‡å†™è¡¨è¾¾å¼çš„æ–¹å¼æ¥å£°æ˜æˆ‘ä»¬æƒ³å¹²ä»€ä¹ˆï¼Œè€Œä¸æ˜¯é€šè¿‡ä¸€æ­¥ä¸€æ­¥çš„æŒ‡ç¤ºã€‚è¡¨è¾¾å¼é€šå¸¸æ˜¯æŸäº›å‡½æ•°è°ƒç”¨çš„å¤åˆã€ä¸€äº›å€¼å’Œæ“ä½œç¬¦ï¼Œç”¨æ¥è®¡ç®—å‡ºç»“æœå€¼ã€‚\n\n```javascript\n//å‘½ä»¤å¼\nvar CEOs = [];\nfor (var i = 0; i < companies.length; i++) {\n  CEOs.push(companies[i].CEO);\n}\n\n//å£°æ˜å¼\nvar CEOs = companies.map(c => c.CEO);\n```\n\nä»ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å£°æ˜å¼çš„å†™æ³•æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œæ— éœ€å…³å¿ƒå¦‚ä½•è¿›è¡Œè®¡æ•°å™¨è¿­ä»£ï¼Œè¿”å›çš„æ•°ç»„å¦‚ä½•æ”¶é›†ï¼Œå®ƒæŒ‡æ˜çš„æ˜¯åšä»€ä¹ˆï¼Œè€Œä¸æ˜¯æ€ä¹ˆåšã€‚**å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ä¸ªæ˜æ˜¾çš„å¥½å¤„å°±æ˜¯è¿™ç§å£°æ˜å¼çš„ä»£ç **ï¼Œå¯¹äºæ— å‰¯ä½œç”¨çš„çº¯å‡½æ•°ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥ä¸è€ƒè™‘å‡½æ•°å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä¸“æ³¨äºç¼–å†™ä¸šåŠ¡ä»£ç ã€‚\n\n## å¸¸è§ç‰¹æ€§\n\n### æ— å‰¯ä½œç”¨\n\næŒ‡è°ƒç”¨å‡½æ•°æ—¶ä¸ä¼šä¿®æ”¹å¤–éƒ¨çŠ¶æ€ï¼Œå³ä¸€ä¸ªå‡½æ•°è°ƒç”¨ n æ¬¡åä¾ç„¶è¿”å›åŒæ ·çš„ç»“æœã€‚\n\n```javascript\nvar a = 1;\n// å«æœ‰å‰¯ä½œç”¨ï¼Œå®ƒä¿®æ”¹äº†å¤–éƒ¨å˜é‡ a\n// å¤šæ¬¡è°ƒç”¨ç»“æœä¸ä¸€æ ·\nfunction test1() {\n  a++;\n  return a;\n}\n\n// æ— å‰¯ä½œç”¨ï¼Œæ²¡æœ‰ä¿®æ”¹å¤–éƒ¨çŠ¶æ€\n// å¤šæ¬¡è°ƒç”¨ç»“æœä¸€æ ·\nfunction test2(a) {\n  return a + 1;\n}\n```\n\n### é€æ˜å¼•ç”¨\n\næŒ‡ä¸€ä¸ªå‡½æ•°åªä¼šç”¨åˆ°ä¼ é€’ç»™å®ƒçš„å˜é‡ä»¥åŠè‡ªå·±å†…éƒ¨åˆ›å»ºçš„å˜é‡ï¼Œä¸ä¼šä½¿ç”¨åˆ°å…¶ä»–å˜é‡ã€‚\n\n```javascript\nvar a = 1;\nvar b = 2;\n// å‡½æ•°å†…éƒ¨ä½¿ç”¨çš„å˜é‡å¹¶ä¸å±äºå®ƒçš„ä½œç”¨åŸŸ\nfunction test1() {\n  return a + b;\n}\n// å‡½æ•°å†…éƒ¨ä½¿ç”¨çš„å˜é‡æ˜¯æ˜¾å¼ä¼ é€’è¿›å»çš„\nfunction test2(a, b) {\n  return a + b;\n}\n```\n\n### ä¸å¯å˜å˜é‡\n\næŒ‡çš„æ˜¯ä¸€ä¸ªå˜é‡ä¸€æ—¦åˆ›å»ºåï¼Œå°±ä¸èƒ½å†è¿›è¡Œä¿®æ”¹ï¼Œä»»ä½•ä¿®æ”¹éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å˜é‡ã€‚ä½¿ç”¨ä¸å¯å˜å˜é‡æœ€å¤§çš„å¥½å¤„æ˜¯çº¿ç¨‹å®‰å…¨ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è®¿é—®åŒä¸€ä¸ªä¸å¯å˜å˜é‡ï¼Œè®©å¹¶è¡Œå˜å¾—æ›´å®¹æ˜“å®ç°ã€‚ ç”±äº JavaScript åŸç”Ÿä¸æ”¯æŒä¸å¯å˜å˜é‡ï¼Œéœ€è¦é€šè¿‡ç¬¬ä¸‰æ–¹åº“æ¥å®ç°ã€‚ (å¦‚ Immutable.jsï¼ŒMori ç­‰ç­‰)\n\n```javascript\nvar obj = Immutable({ a: 1 });\nvar obj2 = obj.set(\"a\", 2);\nconsole.log(obj); // Immutable({ a: 1 })\nconsole.log(obj2); // Immutable({ a: 2 })\n```\n\n### å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘\n\næˆ‘ä»¬å¸¸è¯´å‡½æ•°æ˜¯ JavaScript çš„\"ç¬¬ä¸€ç­‰å…¬æ°‘\"ï¼ŒæŒ‡çš„æ˜¯å‡½æ•°ä¸å…¶ä»–æ•°æ®ç±»å‹ä¸€æ ·ï¼Œå¤„äºå¹³ç­‰åœ°ä½ï¼Œå¯ä»¥èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°ï¼Œæˆ–è€…ä½œä¸ºåˆ«çš„å‡½æ•°çš„è¿”å›å€¼ã€‚ä¸‹æ–‡å°†è¦ä»‹ç»çš„é—­åŒ…ã€é«˜é˜¶å‡½æ•°ã€å‡½æ•°æŸ¯é‡ŒåŒ–å’Œå‡½æ•°ç»„åˆéƒ½æ˜¯å›´ç»•è¿™ä¸€ç‰¹æ€§çš„åº”ç”¨\n\n## å¸¸è§çš„å‡½æ•°å¼ç¼–ç¨‹æ¨¡å‹\n\n### 1.é—­åŒ…ï¼ˆClosureï¼‰\n\nå¦‚æœä¸€ä¸ªå‡½æ•°å¼•ç”¨äº†è‡ªç”±å˜é‡ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°å°±æ˜¯ä¸€ä¸ªé—­åŒ…ã€‚ä½•è°“è‡ªç”±å˜é‡ï¼Ÿè‡ªç”±å˜é‡æ˜¯æŒ‡ä¸å±äºè¯¥å‡½æ•°ä½œç”¨åŸŸçš„å˜é‡(æ‰€æœ‰å…¨å±€å˜é‡éƒ½æ˜¯è‡ªç”±å˜é‡ï¼Œä¸¥æ ¼æ¥è¯´å¼•ç”¨äº†å…¨å±€å˜é‡çš„å‡½æ•°éƒ½æ˜¯é—­åŒ…ï¼Œä½†è¿™ç§é—­åŒ…å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬è¯´çš„é—­åŒ…æ˜¯æŒ‡å‡½æ•°å†…éƒ¨çš„å‡½æ•°)ã€‚\n\né—­åŒ…çš„å½¢æˆæ¡ä»¶ï¼š\n\n- å­˜åœ¨å†…ã€å¤–ä¸¤å±‚å‡½æ•°\n- å†…å±‚å‡½æ•°å¯¹å¤–å±‚å‡½æ•°çš„å±€éƒ¨å˜é‡è¿›è¡Œäº†å¼•ç”¨\n\né—­åŒ…çš„ç”¨é€”:\n**å¯ä»¥å®šä¹‰ä¸€äº›ä½œç”¨åŸŸå±€é™çš„æŒä¹…åŒ–å˜é‡ï¼Œè¿™äº›å˜é‡å¯ä»¥ç”¨æ¥åšç¼“å­˜æˆ–è€…è®¡ç®—çš„ä¸­é—´é‡ç­‰**ã€‚\n\n```javascript\n// ç®€å•çš„ç¼“å­˜å·¥å…·\n// åŒ¿åå‡½æ•°åˆ›é€ äº†ä¸€ä¸ªé—­åŒ…\nconst cache = (function() {\n  const store = {};\n\n  return {\n    get(key) {\n      return store[key];\n    },\n    set(key, val) {\n      store[key] = val;\n    }\n  };\n})();\nconsole.log(cache); //{get: Æ’, set: Æ’}\ncache.set(\"a\", 1);\ncache.get(\"a\"); // 1\n```\n\nä¸Šé¢ä¾‹å­æ˜¯ä¸€ä¸ªç®€å•çš„ç¼“å­˜å·¥å…·çš„å®ç°ï¼ŒåŒ¿åå‡½æ•°åˆ›é€ äº†ä¸€ä¸ªé—­åŒ…ï¼Œä½¿å¾— store å¯¹è±¡ ï¼Œä¸€ç›´å¯ä»¥è¢«å¼•ç”¨ï¼Œä¸ä¼šè¢«å›æ”¶ã€‚\n\né—­åŒ…çš„å¼Šç«¯:**æŒä¹…åŒ–å˜é‡ä¸ä¼šè¢«æ­£å¸¸é‡Šæ”¾ï¼ŒæŒç»­å ç”¨å†…å­˜ç©ºé—´ï¼Œå¾ˆå®¹æ˜“é€ æˆå†…å­˜æµªè´¹**ï¼Œæ‰€ä»¥ä¸€èˆ¬éœ€è¦ä¸€äº›é¢å¤–æ‰‹åŠ¨çš„æ¸…ç†æœºåˆ¶ã€‚\n\n### 2.é«˜é˜¶å‡½æ•°\n\nå‡½æ•°å¼ç¼–ç¨‹å€¾å‘äºå¤ç”¨ä¸€ç»„é€šç”¨çš„å‡½æ•°åŠŸèƒ½æ¥å¤„ç†æ•°æ®ï¼Œå®ƒé€šè¿‡ä½¿ç”¨é«˜é˜¶å‡½æ•°æ¥å®ç°ã€‚**é«˜é˜¶å‡½æ•°æŒ‡çš„æ˜¯ä¸€ä¸ªå‡½æ•°ä»¥å‡½æ•°ä¸ºå‚æ•°ï¼Œæˆ–ä»¥å‡½æ•°ä¸ºè¿”å›å€¼ï¼Œæˆ–è€…æ—¢ä»¥å‡½æ•°ä¸ºå‚æ•°åˆä»¥å‡½æ•°ä¸ºè¿”å›å€¼**ã€‚\n\né«˜é˜¶å‡½æ•°ç»å¸¸ç”¨äºï¼š\n\n- æŠ½è±¡æˆ–éš”ç¦»è¡Œä¸ºã€ä½œç”¨ï¼Œå¼‚æ­¥æ§åˆ¶æµç¨‹ä½œä¸ºå›è°ƒå‡½æ•°ï¼Œpromisesï¼Œmonads ç­‰\n- åˆ›å»ºå¯ä»¥æ³›ç”¨äºå„ç§æ•°æ®ç±»å‹çš„åŠŸèƒ½\n- éƒ¨åˆ†åº”ç”¨äºå‡½æ•°å‚æ•°ï¼ˆåå‡½æ•°åº”ç”¨ï¼‰æˆ–åˆ›å»ºä¸€ä¸ªæŸ¯é‡ŒåŒ–çš„å‡½æ•°ï¼Œç”¨äºå¤ç”¨æˆ–å‡½æ•°å¤åˆã€‚\n- æ¥å—ä¸€ä¸ªå‡½æ•°åˆ—è¡¨å¹¶è¿”å›ä¸€äº›ç”±è¿™ä¸ªåˆ—è¡¨ä¸­çš„å‡½æ•°ç»„æˆçš„å¤åˆå‡½æ•°ã€‚\n\nJavaScript è¯­è¨€æ˜¯åŸç”Ÿæ”¯æŒé«˜é˜¶å‡½æ•°çš„, ä¾‹å¦‚ Array.prototype.mapï¼ŒArray.prototype.filter å’Œ Array.prototype.reduce æ˜¯ JavaScript ä¸­å†…ç½®çš„ä¸€äº›é«˜é˜¶å‡½æ•°ï¼Œä½¿ç”¨é«˜é˜¶å‡½æ•°ä¼šè®©æˆ‘ä»¬çš„ä»£ç æ›´æ¸…æ™°ç®€æ´ã€‚\n\n#### map\n\nmap() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶ç»“æœæ˜¯è¯¥æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½è°ƒç”¨ä¸€ä¸ªæä¾›çš„å‡½æ•°åè¿”å›çš„ç»“æœã€‚map ä¸ä¼šæ”¹å˜åŸæ•°ç»„ã€‚\n\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«åç§°å’Œç§ç±»å±æ€§çš„å¯¹è±¡æ•°ç»„ï¼Œæˆ‘ä»¬æƒ³è¦è¿™ä¸ªæ•°ç»„ä¸­æ‰€æœ‰åç§°å±æ€§æ”¾åœ¨ä¸€ä¸ªæ–°æ•°ç»„ä¸­ï¼Œå¦‚ä½•å®ç°å‘¢ï¼Ÿ\n\n```javascript\n// ä¸ä½¿ç”¨é«˜é˜¶å‡½æ•°\nvar animals = [\n  { name: \"Fluffykins\", species: \"rabbit\" },\n  { name: \"Caro\", species: \"dog\" },\n  { name: \"Hamilton\", species: \"dog\" },\n  { name: \"Harold\", species: \"fish\" },\n  { name: \"Ursula\", species: \"cat\" },\n  { name: \"Jimmy\", species: \"fish\" }\n];\nvar names = [];\nfor (let i = 0; i < animals.length; i++) {\n  names.push(animals[i].name);\n}\nconsole.log(names); //[\"Fluffykins\", \"Caro\", \"Hamilton\", \"Harold\", \"Ursula\", \"Jimmy\"]\n// ä½¿ç”¨é«˜é˜¶å‡½æ•°\nvar animals = [\n  { name: \"Fluffykins\", species: \"rabbit\" },\n  { name: \"Caro\", species: \"dog\" },\n  { name: \"Hamilton\", species: \"dog\" },\n  { name: \"Harold\", species: \"fish\" },\n  { name: \"Ursula\", species: \"cat\" },\n  { name: \"Jimmy\", species: \"fish\" }\n];\nvar names = animals.map(x => x.name);\nconsole.log(names); //[\"Fluffykins\", \"Caro\", \"Hamilton\", \"Harold\", \"Ursula\", \"Jimmy\"]\n```\n\n#### filter\n\nfilter() æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰é€šè¿‡å›è°ƒå‡½æ•°æµ‹è¯•çš„å…ƒç´ ã€‚filter ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è°ƒç”¨ä¸€æ¬¡ callback å‡½æ•°ï¼Œ callback å‡½æ•°è¿”å› true è¡¨ç¤ºè¯¥å…ƒç´ é€šè¿‡æµ‹è¯•ï¼Œä¿ç•™è¯¥å…ƒç´ ï¼Œfalse åˆ™ä¸ä¿ç•™ã€‚filter ä¸ä¼šæ”¹å˜åŸæ•°ç»„ï¼Œå®ƒè¿”å›è¿‡æ»¤åçš„æ–°æ•°ç»„ã€‚\n\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«åç§°å’Œç§ç±»å±æ€§çš„å¯¹è±¡æ•°ç»„ã€‚ æˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªåªåŒ…å«ç‹—ï¼ˆspecies: \"dog\"ï¼‰çš„æ•°ç»„ã€‚å¦‚ä½•å®ç°å‘¢ï¼Ÿ\n\n```javascript\n// ä¸ä½¿ç”¨é«˜é˜¶å‡½æ•°\nvar animals = [\n  { name: \"Fluffykins\", species: \"rabbit\" },\n  { name: \"Caro\", species: \"dog\" },\n  { name: \"Hamilton\", species: \"dog\" },\n  { name: \"Harold\", species: \"fish\" },\n  { name: \"Ursula\", species: \"cat\" },\n  { name: \"Jimmy\", species: \"fish\" }\n];\nvar dogs = [];\nfor (var i = 0; i < animals.length; i++) {\n  if (animals[i].species === \"dog\") dogs.push(animals[i]);\n}\nconsole.log(dogs);\n// ä½¿ç”¨é«˜é˜¶å‡½æ•°\nvar animals = [\n  { name: \"Fluffykins\", species: \"rabbit\" },\n  { name: \"Caro\", species: \"dog\" },\n  { name: \"Hamilton\", species: \"dog\" },\n  { name: \"Harold\", species: \"fish\" },\n  { name: \"Ursula\", species: \"cat\" },\n  { name: \"Jimmy\", species: \"fish\" }\n];\nvar dogs = animals.filter(x => x.species === \"dog\");\nconsole.log(dogs); // {name: \"Caro\", species: \"dog\"}\n// { name: \"Hamilton\", species: \"dog\" }\n```\n\n#### reduce\n\nreduce æ–¹æ³•å¯¹è°ƒç”¨æ•°ç»„çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œæœ€åç”Ÿæˆä¸€ä¸ªå•ä¸€çš„å€¼å¹¶è¿”å›ã€‚ reduce æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š1ï¼‰reducer å‡½æ•°ï¼ˆå›è°ƒï¼‰ï¼Œ2ï¼‰ä¸€ä¸ªå¯é€‰çš„ initialValueã€‚\n\nå‡è®¾æˆ‘ä»¬è¦å¯¹ä¸€ä¸ªæ•°ç»„çš„æ±‚å’Œï¼š\n\n```javascript\n// ä¸ä½¿ç”¨é«˜é˜¶å‡½æ•°\nconst arr = [5, 7, 1, 8, 4];\nlet sum = 0;\nfor (let i = 0; i < arr.length; i++) {\n  sum = sum + arr[i];\n}\nconsole.log(sum); //25\n// ä½¿ç”¨é«˜é˜¶å‡½æ•°\nconst arr = [5, 7, 1, 8, 4];\nconst sum = arr.reduce(\n  (accumulator, currentValue) => accumulator + currentValue,\n  0\n);\nconsole.log(sum); //25\n```\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹å›¾ï¼Œå½¢è±¡ç”ŸåŠ¨å±•ç¤ºä¸‰è€…çš„åŒºåˆ«ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6ixh3e6euj30ml0bnwf2.jpg)\n\n### 3.å‡½æ•°æŸ¯é‡ŒåŒ–\n\næŸ¯é‡ŒåŒ–åˆç§°éƒ¨åˆ†æ±‚å€¼ï¼ŒæŸ¯é‡ŒåŒ–å‡½æ•°ä¼šæ¥æ”¶ä¸€äº›å‚æ•°ï¼Œç„¶åä¸ä¼šç«‹å³æ±‚å€¼ï¼Œè€Œæ˜¯ç»§ç»­è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œå°†ä¼ å…¥çš„å‚æ•°é€šè¿‡é—­åŒ…çš„å½¢å¼ä¿å­˜ï¼Œç­‰åˆ°è¢«çœŸæ­£æ±‚å€¼çš„æ—¶å€™ï¼Œå†ä¸€æ¬¡æ€§æŠŠæ‰€æœ‰ä¼ å…¥çš„å‚æ•°è¿›è¡Œæ±‚å€¼ã€‚\n\n```javascript\n// æ™®é€šå‡½æ•°\nfunction add(x, y) {\n  return x + y;\n}\nadd(1, 2); // 3\n// å‡½æ•°æŸ¯é‡ŒåŒ–\nvar add = function(x) {\n  return function(y) {\n    return x + y;\n  };\n};\nvar increment = add(1);\nincrement(2); // 3\n```\n\nè¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª add å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚è°ƒç”¨ add ä¹‹åï¼Œè¿”å›çš„å‡½æ•°å°±é€šè¿‡é—­åŒ…çš„æ–¹å¼è®°ä½äº† add çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•æ¥å®ç°ä¸€ä¸ªç®€æ˜“çš„æŸ¯é‡ŒåŒ–å‡½æ•°å‘¢ï¼Ÿ\n\n```javascript\nfunction curryIt(fn) {\n  // å‚æ•°fnå‡½æ•°çš„å‚æ•°ä¸ªæ•°\n  var n = fn.length;\n  var args = [];\n  return function(arg) {\n    args.push(arg);\n    if (args.length < n) {\n      return arguments.callee; // è¿”å›è¿™ä¸ªå‡½æ•°çš„å¼•ç”¨\n    } else {\n      return fn.apply(this, args);\n    }\n  };\n}\nfunction add(a, b, c) {\n  return [a, b, c];\n}\nvar c = curryIt(add);\nvar c1 = c(1);\nvar c2 = c1(2);\nvar c3 = c2(3);\nconsole.log(c3); //[1, 2, 3]\n```\n\nç”±æ­¤æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒæŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§â€œé¢„åŠ è½½â€å‡½æ•°çš„æ–¹æ³•ï¼Œé€šè¿‡ä¼ é€’è¾ƒå°‘çš„å‚æ•°ï¼Œå¾—åˆ°ä¸€ä¸ªå·²ç»è®°ä½äº†è¿™äº›å‚æ•°çš„æ–°å‡½æ•°ï¼ŒæŸç§æ„ä¹‰ä¸Šè®²ï¼Œè¿™æ˜¯ä¸€ç§å¯¹å‚æ•°çš„â€œç¼“å­˜â€ï¼Œæ˜¯ä¸€ç§éå¸¸é«˜æ•ˆçš„ç¼–å†™å‡½æ•°çš„æ–¹æ³•ï¼\n\n### 4.å‡½æ•°ç»„åˆ (Composition)\n\nå‰é¢æåˆ°è¿‡ï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯é€šè¿‡ä¸²è”å‡½æ•°æ¥æ±‚å€¼ã€‚ç„¶è€Œï¼Œéšç€ä¸²è”å‡½æ•°æ•°é‡çš„å¢å¤šï¼Œä»£ç çš„å¯è¯»æ€§å°±ä¼šä¸æ–­ä¸‹é™ã€‚å‡½æ•°ç»„åˆå°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ã€‚\nå‡è®¾æœ‰ä¸€ä¸ª compose å‡½æ•°ï¼Œå®ƒå¯ä»¥æ¥å—å¤šä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚å½“æˆ‘ä»¬ä¸ºè¿™ä¸ªæ–°å‡½æ•°ä¼ é€’å‚æ•°æ—¶ï¼Œè¯¥å‚æ•°å°±ä¼šã€Œæµã€è¿‡å…¶ä¸­çš„å‡½æ•°ï¼Œæœ€åè¿”å›ç»“æœã€‚\n\n```javascript\n//ä¸¤ä¸ªå‡½æ•°çš„ç»„åˆ\nvar compose = function(f, g) {\n  return function(x) {\n    return f(g(x));\n  };\n};\n\n//æˆ–è€…\nvar compose = (f, g) => x => f(g(x));\nvar add1 = x => x + 1;\nvar mul5 = x => x * 5;\ncompose(\n  mul5,\n  add1\n)(2); // =>15\n```\n","tags":["JavaScript"],"categories":["JavaScript"]},{"title":"IP","url":"/2019/10/13/IP/","content":"\n# IP\n\nIPï¼ˆIPv4ã€IPv6ï¼‰ç›¸å½“äº OSI å‚è€ƒæ¨¡å‹ä¸­çš„ç¬¬ 3 å±‚â€”â€”ç½‘ç»œå±‚ã€‚ç½‘ç»œå±‚çš„ä¸»è¦ä½œç”¨æ˜¯â€œ**å®ç°ç»ˆç«¯èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡**â€ã€‚è¿™ç§ç»ˆç«¯èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ä¹Ÿå«â€œç‚¹å¯¹ç‚¹é€šä¿¡â€ã€‚\n\nç½‘ç»œçš„ä¸‹ä¸€å±‚â€”â€”æ•°æ®é“¾è·¯å±‚çš„ä¸»è¦ä½œç”¨æ˜¯åœ¨äº’è¿åŒä¸€ç§æ•°æ®é“¾è·¯çš„èŠ‚ç‚¹ä¹‹é—´è¿›è¡ŒåŒ…ä¼ é€’ã€‚è€Œä¸€æ—¦è·¨è¶Šå¤šç§æ•°æ®é“¾è·¯ï¼Œå°±éœ€è¦å€ŸåŠ©ç½‘ç»œå±‚ã€‚ç½‘ç»œå±‚å¯ä»¥è·¨è¶Šä¸åŒçš„æ•°æ®é“¾è·¯ï¼Œå³ä½¿æ˜¯åœ¨ä¸åŒçš„æ•°æ®é“¾è·¯ä¸Šä¹Ÿèƒ½å®ç°ä¸¤ç«¯èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®åŒ…ä¼ è¾“ã€‚\n\n**IP å¤§è‡´åˆ†ä¸ºä¸‰å¤§ä½œç”¨æ¨¡å—ï¼Œå®ƒä»¬æ˜¯ IP å¯»å€ã€è·¯ç”±ï¼ˆæœ€ç»ˆèŠ‚ç‚¹ä¸ºæ­¢çš„è½¬å‘ï¼‰ä»¥åŠ IP åˆ†åŒ…ä¸ç»„åŒ…ã€‚**\n\n## TCP/IP åŸºç¡€\n\näº’è”ç½‘è¿›è¡Œé€šä¿¡æ—¶ï¼Œéœ€è¦ç›¸åº”çš„ç½‘ç»œåè®®ï¼ŒTCP/IP åŸæœ¬å°±æ˜¯ä¸ºä½¿ç”¨äº’è”ç½‘è€Œå¼€å‘åˆ¶å®šçš„åè®®æ—ã€‚å› æ­¤ï¼Œäº’è”ç½‘çš„åè®®å°±æ˜¯ TCP/IPï¼ŒTCP/IP å°±æ˜¯äº’è”ç½‘çš„åè®®ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6zhns2grvj30lc0eojse.jpg)\n\næ¯ä¸ªåˆ†å±‚ä¸­ï¼Œéƒ½ä¼šå¯¹æ‰€å‘é€çš„æ•°æ®é™„åŠ ä¸€ä¸ªé¦–éƒ¨ï¼Œåœ¨è¿™ä¸ªé¦–éƒ¨ä¸­åŒ…å«äº†è¯¥å±‚å¿…è¦çš„ä¿¡æ¯ï¼Œå¦‚å‘é€çš„ç›®æ ‡åœ°å€ä»¥åŠåè®®ç›¸å…³ä¿¡æ¯ã€‚é€šå¸¸ï¼Œä¸ºåè®®æä¾›çš„ä¿¡æ¯ä¸ºåŒ…é¦–éƒ¨ï¼Œæ‰€è¦å‘é€çš„å†…å®¹ä¸ºæ•°æ®ã€‚åœ¨ä¸‹ä¸€å±‚çš„è§’åº¦çœ‹ï¼Œä»ä¸Šä¸€å±‚æ”¶åˆ°çš„åŒ…å…¨éƒ¨éƒ½è¢«è®¤ä¸ºæ˜¯æœ¬å±‚çš„æ•°æ®ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6zhmr7ldbj30fk0dz751.jpg)\n\nç½‘ç»œä¸­ä¼ è¾“çš„æ•°æ®åŒ…ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä¸€éƒ¨åˆ†æ˜¯åè®®æ‰€è¦ç”¨åˆ°çš„é¦–éƒ¨ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯ä¸Šä¸€å±‚ä¼ è¿‡æ¥çš„æ•°æ®ã€‚é¦–éƒ¨çš„ç»“æ„ç”±åè®®çš„å…·ä½“è§„èŒƒè¯¦ç»†å®šä¹‰ã€‚åœ¨æ•°æ®åŒ…çš„é¦–éƒ¨ï¼Œæ˜ç¡®æ ‡æ˜äº†åè®®åº”è¯¥å¦‚ä½•è¯»å–æ•°æ®ã€‚åè¿‡æ¥è¯´ï¼Œçœ‹åˆ°é¦–éƒ¨ï¼Œä¹Ÿå°±èƒ½å¤Ÿäº†è§£è¯¥åè®®å¿…è¦çš„ä¿¡æ¯ä»¥åŠæ‰€è¦å¤„ç†çš„æ•°æ®ã€‚**åŒ…é¦–éƒ¨å°±åƒåè®®çš„è„¸ã€‚**\n\n### æ•°æ®å¤„ç†æµç¨‹\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6zhpvepe5j30lg0lkdis.jpg)\n\n1. åº”ç”¨ç¨‹åºå¤„ç†\n   é¦–å…ˆåº”ç”¨ç¨‹åºä¼šè¿›è¡Œç¼–ç å¤„ç†ï¼Œè¿™äº›ç¼–ç ç›¸å½“äº OSI çš„è¡¨ç¤ºå±‚åŠŸèƒ½ï¼›\n   ç¼–ç è½¬åŒ–åï¼Œé‚®ä»¶ä¸ä¸€å®šé©¬ä¸Šè¢«å‘é€å‡ºå»ï¼Œè¿™ç§ä½•æ—¶å»ºç«‹é€šä¿¡è¿æ¥ä½•æ—¶å‘é€æ•°æ®çš„ç®¡ç†åŠŸèƒ½ï¼Œç›¸å½“äº OSI çš„ä¼šè¯å±‚åŠŸèƒ½ã€‚\n2. TCP æ¨¡å—çš„å¤„ç†\n   TCP æ ¹æ®åº”ç”¨çš„æŒ‡ç¤ºï¼Œè´Ÿè´£å»ºç«‹è¿æ¥ã€å‘é€æ•°æ®ä»¥åŠæ–­å¼€è¿æ¥ã€‚TCP æä¾›å°†åº”ç”¨å±‚å‘æ¥çš„æ•°æ®é¡ºåˆ©å‘é€è‡³å¯¹ç«¯çš„å¯é ä¼ è¾“ã€‚ä¸ºäº†å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œéœ€è¦åœ¨åº”ç”¨å±‚æ•°æ®çš„å‰ç«¯é™„åŠ ä¸€ä¸ª TCP é¦–éƒ¨ã€‚\n3. IP æ¨¡å—çš„å¤„ç†\n   IP å°† TCP ä¼ è¿‡æ¥çš„ TCP é¦–éƒ¨å’Œ TCP æ•°æ®åˆèµ·æ¥å½“åšè‡ªå·±çš„æ•°æ®ï¼Œå¹¶åœ¨ TCP é¦–éƒ¨çš„å‰ç«¯åŠ ä¸Šè‡ªå·±çš„ IP é¦–éƒ¨ã€‚IP åŒ…ç”Ÿæˆåï¼Œå‚è€ƒè·¯ç”±æ§åˆ¶è¡¨å†³å®šæ¥å—æ­¤ IP åŒ…çš„è·¯ç”±æˆ–ä¸»æœºã€‚\n4. ç½‘ç»œæ¥å£ï¼ˆä»¥å¤ªç½‘é©±åŠ¨ï¼‰çš„å¤„ç†\n   ä» IP ä¼ è¿‡æ¥çš„ IP åŒ…å¯¹äºä»¥å¤ªç½‘æ¥è¯´å°±æ˜¯æ•°æ®ã€‚ç»™è¿™äº›æ•°æ®é™„åŠ ä¸Šä»¥å¤ªç½‘é¦–éƒ¨å¹¶è¿›è¡Œå‘é€å¤„ç†ï¼Œç”Ÿæˆçš„ä»¥å¤ªç½‘æ•°æ®åŒ…å°†é€šè¿‡ç‰©ç†å±‚ä¼ è¾“ç»™æ¥æ”¶ç«¯ã€‚\n5. ç½‘ç»œæ¥å£ï¼ˆä»¥å¤ªç½‘é©±åŠ¨ï¼‰çš„å¤„ç†\n   ä¸»æœºæ”¶åˆ°ä»¥å¤ªç½‘åŒ…åï¼Œé¦–å…ˆä»ä»¥å¤ªç½‘åŒ…é¦–éƒ¨æ‰¾åˆ° MAC åœ°å€åˆ¤æ–­æ˜¯å¦ä¸ºå‘é€ç»™è‡ªå·±çš„åŒ…ï¼Œè‹¥ä¸æ˜¯åˆ™ä¸¢å¼ƒæ•°æ®ã€‚\n   å¦‚æœæ˜¯å‘é€ç»™è‡ªå·±çš„åŒ…ï¼Œåˆ™ä»ä»¥å¤ªç½‘åŒ…é¦–éƒ¨ä¸­çš„ç±»å‹ç¡®å®šæ•°æ®ç±»å‹ï¼Œå†ä¼ ç»™ç›¸åº”çš„æ¨¡å—ï¼Œå¦‚ IPã€ARP ç­‰ã€‚è¿™é‡Œçš„ä¾‹å­åˆ™æ˜¯ IP ã€‚\n6. IP æ¨¡å—çš„å¤„ç†\n   IP æ¨¡å—æ¥æ”¶åˆ° æ•°æ®åä¹Ÿåšç±»ä¼¼çš„å¤„ç†ã€‚ä»åŒ…é¦–éƒ¨ä¸­åˆ¤æ–­æ­¤ IP åœ°å€æ˜¯å¦ä¸è‡ªå·±çš„ IP åœ°å€åŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ™æ ¹æ®é¦–éƒ¨çš„åè®®ç±»å‹å°†æ•°æ®å‘é€ç»™å¯¹åº”çš„æ¨¡å—ï¼Œå¦‚ TCPã€UDPã€‚è¿™é‡Œçš„ä¾‹å­åˆ™æ˜¯ TCPã€‚\n   å¦å¤–å—ï¼Œå¯¹äºæœ‰è·¯ç”±å™¨çš„æƒ…å†µï¼Œæ¥æ”¶ç«¯åœ°å€å¾€å¾€ä¸æ˜¯è‡ªå·±çš„åœ°å€ï¼Œæ­¤æ—¶ï¼Œéœ€è¦å€ŸåŠ©è·¯ç”±æ§åˆ¶è¡¨ï¼Œåœ¨è°ƒæŸ¥åº”è¯¥é€å¾€çš„ä¸»æœºæˆ–è·¯ç”±å™¨ä¹‹åå†è¿›è¡Œè½¬å‘æ•°æ®ã€‚\n7. TCP æ¨¡å—çš„å¤„ç†\n   åœ¨ TCP æ¨¡å—ä¸­ï¼Œé¦–å…ˆä¼šè®¡ç®—ä¸€ä¸‹æ ¡éªŒå’Œï¼Œåˆ¤æ–­æ•°æ®æ˜¯å¦è¢«ç ´åã€‚ç„¶åæ£€æŸ¥æ˜¯å¦åœ¨æŒ‰ç…§åºå·æ¥æ”¶æ•°æ®ã€‚æœ€åæ£€æŸ¥ç«¯å£å·ï¼Œç¡®å®šå…·ä½“çš„åº”ç”¨ç¨‹åºã€‚æ•°æ®è¢«å®Œæ•´åœ°æ¥æ”¶ä»¥åï¼Œä¼šä¼ ç»™ç”±ç«¯å£å·è¯†åˆ«çš„åº”ç”¨ç¨‹åºã€‚\n8. åº”ç”¨ç¨‹åºçš„å¤„ç†\n   æ¥æ”¶ç«¯åº”ç”¨ç¨‹åºä¼šç›´æ¥æ¥æ”¶å‘é€ç«¯å‘é€çš„æ•°æ®ã€‚é€šè¿‡è§£ææ•°æ®ï¼Œå±•ç¤ºç›¸åº”çš„å†…å®¹ã€‚\n\n## IP æœåŠ¡çš„ä¸»è¦ç‰¹ç‚¹\n\nIP åè®®ä¸ºä¸Šå±‚åè®®æä¾›æ— çŠ¶æ€ã€æ— è¿æ¥ã€ä¸å¯é çš„æœåŠ¡ã€‚\n\n- ###### æ— çŠ¶æ€\n\næ— çŠ¶æ€æ˜¯æŒ‡ IP é€šä¿¡åŒæ–¹ä¸åŒæ­¥ä¼ è¾“æ•°æ®çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ‰€æœ‰ IP æ•°æ®æŠ¥çš„å‘é€ã€ä¼ è¾“ã€æ¥å—éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹ã€æ²¡æœ‰ä¸Šä¸‹æ–‡å…³ç³»çš„ã€‚è¿™ç§æœåŠ¡ä¼˜ç‚¹åœ¨äºç®€å•ã€é«˜æ•ˆã€‚æœ€å¤§çš„ç¼ºç‚¹æ˜¯æ— æ³•å¤„ç†ä¹±åºå’Œé‡å¤çš„ IP æ•°æ®æŠ¥ï¼Œç¡®ä¿ IP æ•°æ®æŠ¥å®Œæ•´çš„å·¥ä½œåªèƒ½äº¤ç»™ä¸Šå±‚åè®®æ¥å®Œæˆã€‚\n\n- ###### æ— è¿æ¥\n\næ— è¿æ¥æ˜¯æŒ‡ IP é€šä¿¡åŒæ–¹éƒ½ä¸é•¿ä¹…åœ°ç»´æŒå¯¹æ–¹çš„ä»»ä½•ä¿¡æ¯ã€‚ä¸Šå±‚åè®®æ¯æ¬¡å‘é€æ•°æ®çš„æ—¶å€™ï¼Œéƒ½éœ€è¦æ˜ç¡®æŒ‡å‡ºå¯¹æ–¹çš„ IP åœ°å€ã€‚\n\n- ###### ä¸å¯é \n\nä¸å¯é æ˜¯æŒ‡ IP åè®®ä¸èƒ½ä¿è¯ IP æ•°æ®æŠ¥å‡†ç¡®åˆ°è¾¾æ¥æ”¶ç«¯ï¼Œå®ƒæŒ‡æ‰¿è¯ºå°½æœ€å¤§åŠªåŠ›äº¤ä»˜ã€‚IP æ¨¡å—ä¸€æ—¦æ£€æµ‹åˆ°æ•°æ®æŠ¥å‘é€å¤±è´¥ï¼Œå°±é€šçŸ¥ä¸Šå±‚åè®®ï¼Œè€Œä¸ä¼šè¯•å›¾é‡ä¼ ã€‚\n\n## IP åœ°å€\n\n### IP åœ°å€æ¦‚è¿°\n\n- åœ¨è®¡ç®—æœºé€šä¿¡ä¸­ï¼Œä¸ºäº†è¯†åˆ«é€šä¿¡å¯¹ç«¯ï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªç±»ä¼¼äºåœ°å€çš„è¯†åˆ«ç è¿›è¡Œæ ‡è¯†ã€‚åœ¨æ•°æ®é“¾è·¯ä¸­çš„ MAC åœ°å€æ­£æ˜¯ç”¨æ¥æ ‡è¯†åŒä¸€ä¸ªé“¾è·¯ä¸­ä¸åŒè®¡ç®—æœºçš„ä¸€ç§è¯†åˆ«ç ã€‚\n- ä½œä¸ºç½‘ç»œå±‚çš„ IP ,ä¹Ÿæœ‰è¿™ç§åœ°å€ä¿¡æ¯ï¼Œä¸€èˆ¬å«åš IP åœ°å€ã€‚IP åœ°å€ç”¨äºåœ¨â€œ**è¿æ¥åˆ°ç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºä¸­è¯†åˆ«å‡ºè¿›è¡Œé€šä¿¡çš„ç›®æ ‡åœ°å€**â€ã€‚å› æ­¤ï¼Œåœ¨ TCP/IP é€šä¿¡ä¸­æ‰€æœ‰ä¸»æœºæˆ–è·¯ç”±å™¨å¿…é¡»è®¾å®šè‡ªå·±çš„ IP åœ°å€ã€‚\n- ä¸è®ºä¸€å°ä¸»æœºä¸å“ªç§æ•°æ®é“¾è·¯è¿æ¥ï¼Œå…¶ IP åœ°å€çš„å½¢å¼éƒ½ä¿æŒä¸å˜ã€‚\n- IP åœ°å€ï¼ˆIPv4 åœ°å€ï¼‰ç”± 32 ä½æ­£æ•´æ•°æ¥è¡¨ç¤ºã€‚IP åœ°å€åœ¨è®¡ç®—æœºå†…éƒ¨ä»¥äºŒè¿›åˆ¶æ–¹å¼è¢«å¤„ç†ã€‚ç„¶è€Œï¼Œç”±äºæˆ‘ä»¬å¹¶ä¸ä¹ æƒ¯äºé‡‡ç”¨äºŒè¿›åˆ¶æ–¹å¼ï¼Œæˆ‘ä»¬å°† 32 ä½çš„ IP åœ°å€ä»¥æ¯ 8 ä½ä¸ºä¸€ç»„ï¼Œåˆ†æˆ 4 ç»„ï¼Œæ¯ç»„ä»¥ â€œ.â€ éš”å¼€ï¼Œå†å°†æ¯ç»„æ•°è½¬æ¢æˆåè¿›åˆ¶æ•°ã€‚å¦‚ä¸‹ï¼š\n\n| 2^8      | 2^8      | 2^8      | 2^8      |             |\n| -------- | -------- | -------- | -------- | ----------- |\n| 10101100 | 00010100 | 00000001 | 00000001 | ï¼ˆ2 è¿›åˆ¶ï¼‰  |\n| 172.     | 20.      | 1.       | 1        | ï¼ˆ10 è¿›åˆ¶ï¼‰ |\n\n### IP åœ°å€ç”±ç½‘ç»œå’Œä¸»æœºä¸¤éƒ¨åˆ†æ ‡è¯†ç»„æˆ\n\n- å¦‚ä¸‹å›¾ï¼Œç½‘ç»œæ ‡è¯†åœ¨æ•°æ®é“¾è·¯çš„æ¯ä¸ªæ®µé…ç½®ä¸åŒçš„å€¼ã€‚ç½‘ç»œæ ‡è¯†å¿…é¡»ä¿è¯ç›¸äº’è¿æ¥çš„æ¯ä¸ªæ®µçš„åœ°å€ä¸ç›¸é‡å¤ã€‚è€Œç›¸åŒæ®µå†…ç›¸è¿çš„ä¸»æœºå¿…é¡»æœ‰ç›¸åŒçš„ç½‘ç»œåœ°å€ã€‚IP åœ°å€çš„â€œä¸»æœºæ ‡è¯†â€åˆ™ä¸å…è®¸åœ¨åŒä¸€ä¸ªç½‘æ®µå†…é‡å¤å‡ºç°ã€‚ç”±æ­¤ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ç½‘ç»œåœ°å€å’Œä¸»æœºåœ°å€ï¼Œåœ¨ç›¸äº’è¿æ¥çš„æ•´ä¸ªç½‘ç»œä¸­ä¿è¯æ¯å°ä¸»æœºçš„ IP åœ°å€éƒ½ä¸ä¼šç›¸äº’é‡å ã€‚å³ **IP åœ°å€å…·æœ‰äº†å”¯ä¸€æ€§**ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g70l2qlpa6j30k80hiwhe.jpg)\n\n- å¦‚ä¸‹å›¾ï¼ŒIP åŒ…è¢«è½¬å‘åˆ°é€”ä¸­æŸä¸ªè·¯ç”±å™¨æ—¶ï¼Œæ­£æ˜¯**åˆ©ç”¨ç›®æ ‡ IP åœ°å€çš„ç½‘ç»œæ ‡è¯†è¿›è¡Œè·¯ç”±**ã€‚å› ä¸ºå³ä½¿ä¸çœ‹ä¸»æœºæ ‡è¯†ï¼Œåªè¦ä¸€è§åˆ°ç½‘ç»œæ ‡è¯†å°±èƒ½åˆ¤æ–­å‡ºæ˜¯å¦ä¸ºè¯¥ç½‘æ®µå†…çš„ä¸»æœºã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g70l4my99cj30k40auabx.jpg)\n\n### IP åœ°å€çš„åˆ†ç±»\n\n**IP åœ°å€åˆ†ä¸ºå››ä¸ªçº§åˆ«ï¼Œåˆ†åˆ«ä¸º A ç±»ã€B ç±»ã€C ç±»ã€D ç±»ã€‚å®ƒæ ¹æ® IP åœ°å€ä¸­ä»ç¬¬ 1 ä½åˆ°ç¬¬ 4 ä½çš„æ¯”ç‰¹åˆ—å¯¹å…¶ç½‘ç»œæ ‡è¯†å’Œä¸»æœºæ ‡è¯†è¿›è¡ŒåŒºåˆ†ã€‚**\n\n- **A ç±» IP åœ°å€æ˜¯é¦–ä½ä»¥ â€œ0â€ å¼€å¤´çš„åœ°å€ã€‚**ä»ç¬¬ 1 ä½åˆ°ç¬¬ 8 ä½æ˜¯å®ƒçš„ç½‘ç»œæ ‡è¯†ã€‚ç”¨åè¿›åˆ¶è¡¨ç¤ºçš„è¯ï¼Œ0.0.0.0~127.0.0.0 æ˜¯ A ç±»çš„ç½‘ç»œåœ°å€ã€‚A ç±»åœ°å€çš„å 24 ä½ç›¸å½“äºä¸»æœºæ ‡è¯†ã€‚å› æ­¤ï¼Œä¸€ä¸ªç½‘æ®µå†…å¯å®¹çº³çš„ä¸»æœºåœ°å€ä¸Šé™ä¸º 16,777,214 ä¸ªã€‚\n- **B ç±» IP åœ°å€æ˜¯å‰ä¸¤ä½ â€œ10â€ çš„åœ°å€ã€‚**ä»ç¬¬ 1 ä½åˆ°ç¬¬ 16 ä½æ˜¯å®ƒçš„ç½‘ç»œæ ‡è¯†ã€‚ç”¨åè¿›åˆ¶è¡¨ç¤ºçš„è¯ï¼Œ128.0.0.0~191.255.0.0 æ˜¯ B ç±»çš„ç½‘ç»œåœ°å€ã€‚B ç±»åœ°å€çš„å 16 ä½ç›¸å½“äºä¸»æœºæ ‡è¯†ã€‚å› æ­¤ï¼Œä¸€ä¸ªç½‘æ®µå†…å¯å®¹çº³çš„ä¸»æœºåœ°å€ä¸Šé™ä¸º 65,534 ä¸ªã€‚\n- **C ç±» IP åœ°å€æ˜¯å‰ä¸‰ä½ä¸º â€œ110â€ çš„åœ°å€ã€‚**ä»ç¬¬ 1 ä½åˆ°ç¬¬ 24 ä½æ˜¯å®ƒçš„ç½‘ç»œæ ‡è¯†ã€‚ç”¨åè¿›åˆ¶è¡¨ç¤ºçš„è¯ï¼Œ192.0.0.0~223.255.255.0 æ˜¯ C ç±»çš„ç½‘ç»œåœ°å€ã€‚C ç±»åœ°å€çš„å 8 ä½ç›¸å½“äºä¸»æœºæ ‡è¯†ã€‚å› æ­¤ï¼Œä¸€ä¸ªç½‘æ®µå†…å¯å®¹çº³çš„ä¸»æœºåœ°å€ä¸Šé™ä¸º 254 ä¸ªã€‚\n- **D ç±» IP åœ°å€æ˜¯å‰å››ä½ä¸º â€œ1110â€ çš„åœ°å€ã€‚**ä»ç¬¬ 1 ä½åˆ°ç¬¬ 32 ä½æ˜¯å®ƒçš„ç½‘ç»œæ ‡è¯†ã€‚ç”¨åè¿›åˆ¶è¡¨ç¤ºçš„è¯ï¼Œ224.0.0.0~239.255.255.255 æ˜¯ D ç±»çš„ç½‘ç»œåœ°å€ã€‚D ç±»åœ°å€æ²¡æœ‰ä¸»æœºæ ‡è¯†ï¼Œå¸¸ç”¨äºå¤šæ’­ã€‚\n- åœ¨åˆ†é… IP åœ°å€æ—¶å…³äºä¸»æœºæ ‡è¯†æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ã€‚å³è¦ç”¨æ¯”ç‰¹ä½è¡¨ç¤ºä¸»æœºåœ°å€æ—¶ï¼Œä¸å¯ä»¥å…¨éƒ¨ä¸º 0 æˆ–å…¨éƒ¨ä¸º 1ã€‚å› ä¸ºå…¨éƒ¨ä¸º 0 åªæœ‰åœ¨è¡¨ç¤ºå¯¹åº”çš„ç½‘ç»œåœ°å€æˆ– IP åœ°å€ä¸å¯ä»¥è·çŸ¥çš„æƒ…å†µä¸‹æ‰ä½¿ç”¨ã€‚è€Œå…¨éƒ¨ä¸º 1 çš„ä¸»æœºé€šå¸¸ä½œä¸ºå¹¿æ’­åœ°å€ã€‚å› æ­¤ï¼Œåœ¨åˆ†é…è¿‡ç¨‹ä¸­ï¼Œåº”è¯¥å»æ‰è¿™ä¸¤ç§æƒ…å†µã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ C ç±»åœ°å€æ¯ä¸ªç½‘æ®µæœ€å¤šåªèƒ½æœ‰ 254ï¼ˆ 28 - 2 = 254ï¼‰ä¸ªä¸»æœºåœ°å€çš„åŸå› ã€‚\n\n### å¹¿æ’­åœ°å€\n\n- å¹¿æ’­åœ°å€ç”¨äºåœ¨åŒä¸€ä¸ªé“¾è·¯ä¸­ç›¸äº’è¿æ¥çš„ä¸»æœºä¹‹é—´å‘é€æ•°æ®åŒ…ã€‚å°† IP åœ°å€ä¸­çš„ä¸»æœºåœ°å€éƒ¨åˆ†å…¨éƒ¨è®¾ç½®ä¸º 1ï¼Œå°±æˆäº†å¹¿æ’­åœ°å€ã€‚\n- å¹¿æ’­åˆ†ä¸ºæœ¬åœ°å¹¿æ’­å’Œç›´æ¥å¹¿æ’­ä¸¤ç§ã€‚åœ¨æœ¬ç½‘ç»œå†…çš„å¹¿æ’­å«åšæœ¬åœ°å¹¿æ’­ï¼›åœ¨ä¸åŒç½‘ç»œä¹‹é—´çš„å¹¿æ’­å«åšç›´æ¥å¹¿æ’­ã€‚\n\n### IP å¤šæ’­\n\n- å¤šæ’­ç”¨äºå°†åŒ…å‘é€ç»™ç‰¹å®šç»„å†…çš„æ‰€æœ‰ä¸»æœºã€‚ç”±äºå…¶ç›´æ¥ä½¿ç”¨ IP åœ°å€ï¼Œå› æ­¤ä¹Ÿä¸å­˜åœ¨å¯é ä¼ è¾“ã€‚\n\n- ç›¸æ¯”äºå¹¿æ’­ï¼Œå¤šæ’­æ—¢å¯ä»¥ç©¿é€è·¯ç”±å™¨ï¼Œåˆå¯ä»¥å®ç°åªç»™é‚£äº›å¿…è¦çš„ç»„å‘é€æ•°æ®åŒ…ã€‚è¯·çœ‹ä¸‹å›¾ï¼š\n\n  ![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g70l8g7veoj30f70jjn02.jpg)\n\n- å¤šæ’­ä½¿ç”¨ D ç±»åœ°å€ã€‚å› æ­¤ï¼Œå¦‚æœä»é¦–ä½å¼€å§‹åˆ°ç¬¬ 4 ä½æ˜¯ â€œ1110â€ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯å¤šæ’­åœ°å€ã€‚è€Œå‰©ä¸‹çš„ 28 ä½å¯ä»¥æˆä¸ºå¤šæ’­çš„ç»„ç¼–å·ã€‚\n\n- æ­¤å¤–ï¼Œ å¯¹äºå¤šæ’­ï¼Œæ‰€æœ‰çš„ä¸»æœºï¼ˆè·¯ç”±å™¨ä»¥å¤–çš„ä¸»æœºå’Œç»ˆç«¯ä¸»æœºï¼‰å¿…é¡»å±äº 224.0.0.1 çš„ç»„ï¼Œæ‰€æœ‰çš„è·¯ç”±å™¨å¿…é¡»å±äº 224.0.0.2 çš„ç»„ã€‚\n\n### å­ç½‘æ©ç \n\n- ç°åœ¨ä¸€ä¸ª IP åœ°å€çš„ç½‘ç»œæ ‡è¯†å’Œä¸»æœºæ ‡è¯†å·²ä¸å†å—é™äºè¯¥åœ°å€çš„ç±»åˆ«ï¼Œè€Œæ˜¯ç”±ä¸€ä¸ªå«åšâ€œå­ç½‘æ©ç â€çš„è¯†åˆ«ç é€šè¿‡å­ç½‘ç½‘ç»œåœ°å€ç»†åˆ†å‡ºæ¯” A ç±»ã€B ç±»ã€C ç±»æ›´å°ç²’åº¦çš„ç½‘ç»œã€‚è¿™ç§æ–¹å¼å®é™…ä¸Šå°±æ˜¯å°†åŸæ¥ A ç±»ã€B ç±»ã€C ç±»ç­‰åˆ†ç±»ä¸­çš„ä¸»æœºåœ°å€éƒ¨åˆ†ç”¨ä½œå­ç½‘åœ°å€ï¼Œå¯ä»¥å°†åŸç½‘ç»œåˆ†ä¸ºå¤šä¸ªç‰©ç†ç½‘ç»œçš„ä¸€ç§æœºåˆ¶ã€‚\n- å­ç½‘æ©ç ç”¨äºŒè¿›åˆ¶æ–¹å¼è¡¨ç¤ºçš„è¯ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª 32 ä½çš„æ•°å­—ã€‚å®ƒå¯¹åº” IP åœ°å€ç½‘ç»œæ ‡è¯†éƒ¨åˆ†çš„ä½å…¨éƒ¨ä¸º â€œ1â€ï¼Œå¯¹åº” IP åœ°å€ä¸»æœºæ ‡è¯†çš„éƒ¨åˆ†åˆ™å…¨éƒ¨ä¸º â€œ0â€ã€‚ç”±æ­¤ï¼Œä¸€ä¸ª IP åœ°å€å¯ä»¥ä¸å†å—é™äºè‡ªå·±çš„ç±»åˆ«ï¼Œè€Œæ˜¯å¯ä»¥ç”¨è¿™æ ·çš„å­ç½‘æ©ç è‡ªç”±åœ°å®šä½è‡ªå·±çš„ç½‘ç»œæ ‡è¯†é•¿åº¦ã€‚å½“ç„¶ï¼Œå­ç½‘æ©ç å¿…é¡»æ˜¯ IP åœ°å€çš„é¦–ä½å¼€å§‹è¿ç»­çš„ â€œ1â€ã€‚\n- å¯¹äºå­ç½‘æ©ç ï¼Œç›®å‰æœ‰ä¸¤ç§è¡¨ç¤ºæ–¹å¼ã€‚ç¬¬ä¸€ç§æ˜¯ï¼Œå°† IP åœ°å€ä¸å­ç½‘æ©ç çš„åœ°å€åˆ†åˆ«ç”¨ä¸¤è¡Œæ¥è¡¨ç¤ºã€‚ä»¥ 172.20.100.52 çš„å‰ 26 ä½æ˜¯ç½‘ç»œåœ°å€çš„æƒ…å†µä¸ºä¾‹ï¼Œå¦‚ä¸‹ï¼š\n\n| IP åœ°å€  | 172. | 20.  | 100. | 52  |\n| -------- | ---- | ---- | ---- | --- |\n| å­ç½‘æ©ç  | 255. | 255. | 255. | 192 |\n|          |      |      |      |     |\n| ç½‘ç»œåœ°å€ | 172. | 20.  | 100. | 0   |\n| å­ç½‘æ©ç  | 255. | 255. | 255. | 192 |\n|          |      |      |      |     |\n| å¹¿æ’­åœ°å€ | 172. | 20.  | 100. | 63  |\n| å­ç½‘æ©ç  | 255. | 255. | 255. | 192 |\n\n- ç¬¬äºŒç§è¡¨ç¤ºæ–¹å¼æ˜¯ï¼Œåœ¨æ¯ä¸ª IP åœ°å€åé¢è¿½åŠ ç½‘ç»œåœ°å€çš„ä½æ•°ç”¨ â€œ/ â€ éš”å¼€ï¼Œå¦‚ä¸‹ï¼š\n\n| IP åœ°å€  | 172. | 20. | 100. | 52  | / 26 |\n| -------- | ---- | --- | ---- | --- | ---- |\n| ç½‘ç»œåœ°å€ | 172. | 20. | 100. | 0   | / 26 |\n| å¹¿æ’­åœ°å€ | 172. | 20. | 100. | 63  | / 26 |\n\n- å¦å¤–ï¼Œåœ¨ç¬¬äºŒç§æ–¹å¼ä¸‹è®°è¿°ç½‘ç»œåœ°å€æ—¶å¯ä»¥çœç•¥åé¢çš„ â€œ0â€ ã€‚ä¾‹å¦‚ï¼š172.20.0.0/26 è·Ÿ 172.20/26 å…¶å®æ˜¯ä¸€ä¸ªæ„æ€ã€‚\n\n## è·¯ç”±\n\n- å‘é€æ•°æ®åŒ…æ—¶æ‰€ä½¿ç”¨çš„åœ°å€æ˜¯ç½‘ç»œå±‚çš„åœ°å€ï¼Œå³ IP åœ°å€ã€‚ç„¶è€Œä»…ä»…æœ‰ IP åœ°å€è¿˜ä¸è¶³ä»¥å®ç°å°†æ•°æ®åŒ…å‘é€åˆ°å¯¹ç«¯ç›®æ ‡åœ°å€ï¼Œåœ¨æ•°æ®å‘é€è¿‡ç¨‹ä¸­è¿˜éœ€è¦ç±»ä¼¼äºâ€œæŒ‡æ˜è·¯ç”±å™¨æˆ–ä¸»æœºâ€çš„ä¿¡æ¯ï¼Œä»¥ä¾¿çœŸæ­£å‘å¾€ç›®æ ‡åœ°å€ã€‚ä¿å­˜è¿™ç§ä¿¡æ¯çš„å°±æ˜¯è·¯ç”±æ§åˆ¶è¡¨ã€‚\n- è¯¥è·¯ç”±æ§åˆ¶è¡¨çš„å½¢æˆæ–¹å¼æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯ç®¡ç†å‘˜æ‰‹åŠ¨è®¾ç½®ï¼Œå¦ä¸€ç§æ˜¯è·¯ç”±å™¨ä¸å…¶ä»–è·¯ç”±å™¨ç›¸äº’äº¤æ¢ä¿¡æ¯æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚å‰è€…ä¹Ÿå«åšé™æ€è·¯ç”±æ§åˆ¶ï¼Œè€Œåè€…å«åšåŠ¨æ€è·¯ç”±æ§åˆ¶ã€‚\n- IP åè®®å§‹ç»ˆè®¤ä¸ºè·¯ç”±è¡¨æ˜¯æ­£ç¡®çš„ã€‚ç„¶åï¼ŒIP æœ¬èº«å¹¶æ²¡æœ‰å®šä¹‰åˆ¶ä½œè·¯ç”±æ§åˆ¶è¡¨çš„åè®®ã€‚å³ IP æ²¡æœ‰åˆ¶ä½œè·¯ç”±æ§åˆ¶è¡¨çš„æœºåˆ¶ã€‚è¯¥è¡¨ç¤ºç”±ä¸€ä¸ªå«åšâ€œè·¯ç”±åè®®â€çš„åè®®åˆ¶ä½œè€Œæˆã€‚\n\n### IP åœ°å€ä¸è·¯ç”±æ§åˆ¶\n\n- IP åœ°å€çš„ç½‘ç»œåœ°å€éƒ¨åˆ†ç”¨äºè¿›è¡Œè·¯ç”±æ§åˆ¶ã€‚\n- è·¯ç”±æ§åˆ¶è¡¨ä¸­è®°å½•ç€ç½‘ç»œåœ°å€ä¸ä¸‹ä¸€æ­¥åº”è¯¥å‘é€è‡³è·¯ç”±å™¨çš„åœ°å€ã€‚\n- åœ¨å‘é€ IP åŒ…æ—¶ï¼Œé¦–å…ˆè¦ç¡®å®š IP åŒ…é¦–éƒ¨ä¸­çš„ç›®æ ‡åœ°å€ï¼Œå†ä»è·¯ç”±æ§åˆ¶è¡¨ä¸­æ‰¾åˆ°ä¸è¯¥åœ°å€å…·æœ‰ç›¸åŒç½‘ç»œåœ°å€çš„è®°å½•ï¼Œæ ¹æ®è¯¥è®°å½•å°† IP åŒ…è½¬å‘ç»™ç›¸åº”çš„ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ã€‚å¦‚æœè·¯ç”±æ§åˆ¶è¡¨ä¸­å­˜åœ¨å¤šæ¡ç›¸åŒç½‘ç»œåœ°å€çš„è®°å½•ï¼Œå°±é€‰æ‹©ä¸€ä¸ªæœ€ä¸ºå»åˆçš„ç½‘ç»œåœ°å€ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g70ldgjh6gj30ka0gen0n.jpg)\n\n### è·¯ç”±åŒ¹é…\n\nè·¯ç”±åŒ¹é…é¡ºåºï¼š\n1ï¼‰ ç›´æ¥åŒ¹é…ï¼ŒæŸ¥æ‰¾è·¯ç”±è¡¨ä¸­æ˜¯å¦ç”±ä¸ç›®æ ‡ IP åœ°å€å®Œå…¨åŒ¹é…çš„ä¸»æœº IP åœ°å€ï¼Œæ‰¾åˆ°åˆ™åŒ¹é…æˆåŠŸï¼Œæ²¡æœ‰çš„è¯è½¬ 2ï¼›\n2ï¼‰æŸ¥æ‰¾æ˜¯å¦æœ‰ä¸ç›®æ ‡ IP åœ°å€å…·æœ‰ç›¸åŒç½‘ç»œ ID çš„ IP åœ°å€ï¼Œæ‰¾åˆ°åˆ™åŒ¹é…æˆåŠŸï¼Œæ²¡æœ‰çš„è¯è½¬ 3ï¼›\n3ï¼‰æŸ¥çœ‹æ˜¯å¦æœ‰é»˜è®¤ç½‘å…³ï¼Œæœ‰åˆ™è½¬å‘ç»™å®ƒï¼Œæ²¡æœ‰çš„è¯ï¼Œè·¯ç”±æŸ¥æ‰¾å¤±è´¥ï¼Œç”± ICMP è¿”å›é”™è¯¯ä¿¡æ¯ã€‚\n\n### è·¯ç”±æ›´æ–°\n\né€šè¿‡ route å‘½ä»¤æˆ–å…¶ä»–å·¥å…·å¯ä»¥æ‰‹å·¥ä¿®æ”¹è·¯ç”±è¡¨ï¼Œæ˜¯é™æ€è·¯ç”±æ›´æ–°æ–¹å¼ã€‚å¯¹äºå¤§å‹è·¯ç”±å™¨ï¼Œå®ƒä»¬é€šå¸¸é€šè¿‡ BGPã€RIPã€OSPF ç­‰åè®®è¿›è¡ŒåŠ¨æ€è·¯ç”±æ›´æ–°ã€‚\n\n## IP åˆ†åŒ…ä¸ç»„åŒ…\n\n- æ¯ç§æ•°æ®é“¾è·¯çš„æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMTUï¼‰éƒ½ä¸å°½ç›¸åŒï¼Œå› ä¸ºæ¯ä¸ªä¸åŒç±»å‹çš„æ•°æ®é“¾è·¯çš„ä½¿ç”¨ç›®çš„ä¸åŒã€‚ä½¿ç”¨ç›®çš„ä¸åŒï¼Œå¯æ‰¿è½½çš„ MTU ä¹Ÿå°±ä¸åŒã€‚\n- ä»»ä½•ä¸€å°ä¸»æœºéƒ½æœ‰å¿…è¦å¯¹ IP åˆ†ç‰‡è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚åˆ†ç‰‡å¾€å¾€åœ¨ç½‘ç»œä¸Šé‡åˆ°æ¯”è¾ƒå¤§çš„æŠ¥æ–‡æ— æ³•ä¸€ä¸‹å­å‘é€å‡ºå»æ—¶æ‰ä¼šè¿›è¡Œå¤„ç†ã€‚\n- ç»è¿‡åˆ†ç‰‡ä¹‹åçš„ IP æ•°æ®æŠ¥åœ¨è¢«é‡ç»„çš„æ—¶å€™ï¼Œåªèƒ½ç”±ç›®æ ‡ä¸»æœºè¿›è¡Œã€‚è·¯ç”±å™¨è™½ç„¶åšåˆ†ç‰‡ä½†ä¸ä¼šè¿›è¡Œé‡ç»„ã€‚\n\n### è·¯å¾„ MTU å‘ç°\n\n- åˆ†ç‰‡æœºåˆ¶ä¹Ÿæœ‰å®ƒçš„ä¸è¶³ã€‚å¦‚è·¯ç”±å™¨çš„å¤„ç†è´Ÿè·åŠ é‡ä¹‹ç±»ã€‚å› æ­¤ï¼Œåªè¦å…è®¸ï¼Œæ˜¯ä¸å¸Œæœ›ç”±è·¯ç”±å™¨è¿›è¡Œ IP æ•°æ®åŒ…çš„åˆ†ç‰‡å¤„ç†çš„ã€‚\n- ä¸ºäº†åº”å¯¹åˆ†ç‰‡æœºåˆ¶çš„ä¸è¶³ï¼Œâ€œè·¯å¾„ MTU å‘ç°â€ æŠ€æœ¯åº”è¿è€Œç”Ÿã€‚è·¯å¾„ MTU æŒ‡çš„æ˜¯ï¼Œä»å‘é€ç«¯ä¸»æœºåˆ°æ¥æ”¶ç«¯ä¸»æœºä¹‹é—´ä¸éœ€è¦åˆ†ç‰‡æ˜¯æœ€å¤§ MTU çš„å¤§å°ã€‚å³è·¯å¾„ä¸­å­˜åœ¨çš„æ‰€æœ‰æ•°æ®é“¾è·¯ä¸­æœ€å°çš„ MTU ã€‚\n- è¿›è¡Œè·¯å¾„ MTU å‘ç°ï¼Œå°±å¯ä»¥é¿å…åœ¨ä¸­é€”çš„è·¯ç”±å™¨ä¸Šè¿›è¡Œåˆ†ç‰‡å¤„ç†ï¼Œä¹Ÿå¯ä»¥åœ¨ TCP ä¸­å‘é€æ›´å¤§çš„åŒ…ã€‚\n\n## IPv4\n\n### IPv4 å¤´éƒ¨\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g70lsqccjaj30eh064dge.jpg)\n\n- ###### å¤´éƒ¨é•¿åº¦\n\næ ‡è¯†è¯¥ IP å¤´éƒ¨æœ‰å¤šå°‘ä¸ª 32 ä½ bit å­—ï¼ˆ4 å­—èŠ‚ï¼‰ï¼Œç”±äº 4 ä½æœ€å¤§æè¿° 15ï¼Œæ‰€ä»¥ IP å¤´éƒ¨æœ€å¤§é•¿åº¦ä¸º 60 å­—èŠ‚ã€‚\n\n- ###### 8 ä¸ºæœåŠ¡ä½\n\nåŒ…æ‹¬ 3 ä½ä¼˜å…ˆæƒä½ï¼Œ4 ä¸º TOS å­—æ®µå’Œ 1 ä½ä¿ç•™å­—æ®µã€‚\n4 ä¸º TOS å­—æ®µåˆ†åˆ«è¡¨ç¤ºï¼šæœ€å°å»¶æ—¶ï¼Œæœ€å¤§ååé‡ã€æœ€é«˜å¯é æ€§å’Œæœ€å°è´¹ç”¨ã€‚å…¶ä¸­æœ€å¤šèƒ½é€‰æ‹©ä¸€ä½ç½® 1ï¼Œåº”ç”¨ç¨‹åºæ ¹æ®å®é™…éœ€è¦æ¥è®¾ç½®æœåŠ¡ç±»å‹ã€‚\n\n- ###### 16 ä½æ ‡è¯†\n\nå”¯ä¸€æ ‡è¯†ä¸»æœºå‘é€çš„æ¯ä¸€ä¸ªæ•°æ®æŠ¥ã€‚å…¶åˆå§‹å€¼ç”±ç³»ç»Ÿéšæœºç”Ÿæˆï¼›æ¯å‘ä¸€ä¸ªæ•°æ®æŠ¥å°±åŠ  1ã€‚æ¯ä¸ªåˆ†ç‰‡ä¸­å…·æœ‰ç›¸åŒçš„æ ‡è¯†å€¼ã€‚\n\n- ###### åˆ†ç‰‡åç§»\n\næœ‰ 3 ä½ç”¨äºæ ‡è¯†åç§»ï¼Œç¬¬ä¸€ä½ä¿ç•™ï¼Œç¬¬äºŒä½ DF å­—æ®µï¼ˆç¦æ­¢åˆ†ç‰‡æ ‡è¯†ï¼‰ï¼Œç¬¬ä¸‰ä½ MF å­—æ®µï¼ˆæ›´å¤šåˆ†ç‰‡æ ‡è¯†ï¼Œæœ€åä¸€ä¸ªåˆ†ç‰‡ä¸º 0ï¼Œå…¶ä»–åˆ†ç‰‡ç½® 1ï¼‰ã€‚13 ä½åç§»æ˜¯å‹‡æ•¢å°†å®é™…å€¼å·¦ç§»ä¸‰ä½å¾—åˆ°çš„ï¼Œå› æ­¤è¦æ±‚æ•°æ®éƒ¨åˆ†çš„é•¿åº¦æ˜¯ 8 çš„å€æ•°ã€‚\n\n- ###### 8 ä½åè®®\n\næ ‡è¯†ä¸Šå±‚åè®®ï¼Œ1 æ˜¯ ICMPï¼Œ6 æ˜¯ TCPï¼Œ17 æ˜¯ UDPã€‚\n\n- ###### 16 ä½å¤´éƒ¨æ ¡éªŒå’Œ\n\nIP æ¨¡å—æ¥å—æ•°æ®åï¼Œé¦–å…ˆå¯¹æ•°æ®æŠ¥å¤´éƒ¨åš CRC æ ¡éªŒï¼Œç¡®ä¿ IP å¤´éƒ¨åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ— æŸååï¼Œå†åˆ†æå…¶å¤´éƒ¨å…·ä½“ä¿¡æ¯ã€‚\n\n## IPv6\n\nIPv6ï¼ˆIP version 6ï¼‰æ˜¯ä¸ºäº†æ ¹æœ¬è§£å†³ IPv4 åœ°å€è€—å°½çš„é—®é¢˜è€Œè¢«æ ‡å‡†åŒ–çš„ç½‘é™…åè®®ã€‚IPv4 çš„åœ°å€é•¿åº¦ä¸º 4 ä¸ª 8 ä½å­—èŠ‚ï¼Œå³ 32 æ¯”ç‰¹ã€‚è€Œ IPv6 çš„åœ°å€é•¿åº¦åˆ™æ˜¯åŸæ¥çš„ 4 å€ï¼Œå³ 128 æ¯”ç‰¹ï¼Œä¸€èˆ¬å†™æˆ 8 ä¸ª 16 ä½å­—èŠ‚ã€‚\n\nIPv6 åè®®å¹¶ä¸æ˜¯ IPv4 çš„ç®€å•æ‰©å±•ï¼Œè€Œæ˜¯å®Œå…¨ç‹¬ç«‹çš„åè®®ã€‚ä»ä»¥å¤ªç½‘å¸§å°è£…çš„æ•°æ®ç±»å‹æ¥çœ‹ï¼Œå‰è€…ç±»å‹æ˜¯ 0X86ddï¼Œåè€…æ˜¯ 0x8600ï¼Œæ˜¯å®Œå…¨ä¸åŒçš„ç±»å‹ã€‚\n\nIPv6 è§£å†³äº†ç½‘ç»œåœ°å€ä¸è¶³çš„é—®é¢˜ï¼Œå…¶å¤´éƒ¨å¢åŠ äº†å¤šæ’­å’Œæµçš„åŠŸèƒ½ï¼Œå¼•å…¥äº†è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œè¿˜å¢åŠ äº†ç½‘ç»œå®‰å…¨çš„åŠŸèƒ½ã€‚\n\n### IPv6 å¤´éƒ¨å›ºå®šéƒ¨åˆ†\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g70lv0wgqij30em05ydg6.jpg)\n\n- ###### æµæ ‡ç­¾\n\næ˜¯ IPv6 æ–°å¢åŠ çš„å­—æ®µï¼Œç”¨äºå¯¹æŸäº›è¿æ¥çš„æœåŠ¡è´¨é‡æœ‰ç‰¹æ®Šè¦æ±‚çš„é€šä¿¡ï¼Œæ¯”å¦‚éŸ³é¢‘æˆ–è€…è§†é¢‘ç­‰å®æ—¶æ•°æ®ä¼ é€’ã€‚\n\n- ###### ä¸‹ä¸€ä¸ªåŒ…å¤´\n\næŒ‡å‡ºç´§è·Ÿ IPv6 å›ºå®šå¤´éƒ¨åçš„åŒ…å¤´ç±»å‹ï¼Œå¦‚æ‹“å±•å¤´ï¼Œæˆ–è€…æŸä¸ªä¸Šå±‚åè®®å¤´ï¼ˆICMPï¼ŒTCPï¼ŒUDPï¼‰ï¼Œå®ƒç±»ä¼¼ IPv4 ä¸­çš„åè®®å­—æ®µï¼Œä¸”ç›¸åŒçš„å–å€¼å…·æœ‰ç›¸åŒçš„å«ä¹‰ã€‚\n\n### IPv6 çš„ç‰¹ç‚¹\n\n- IP å¾—çŸ¥çš„æ‰©å¤§ä¸è·¯ç”±æ§åˆ¶è¡¨çš„èšåˆã€‚\n- æ€§èƒ½æå‡ã€‚åŒ…é¦–éƒ¨é•¿åº¦é‡‡ç”¨å›ºå®šçš„å€¼ï¼ˆ40 å­—èŠ‚ï¼‰ï¼Œä¸å†é‡‡ç”¨é¦–éƒ¨æ£€éªŒç ã€‚ç®€åŒ–é¦–éƒ¨ç»“æ„ï¼Œå‡è½»è·¯ç”±å™¨è´Ÿæ‹…ã€‚è·¯ç”±å™¨ä¸å†åšåˆ†ç‰‡å¤„ç†ã€‚\n- æ”¯æŒå³æ’å³ç”¨åŠŸèƒ½ã€‚å³ä½¿æ²¡æœ‰ DHCP æœåŠ¡å™¨ä¹Ÿå¯ä»¥å®ç°è‡ªåŠ¨åˆ†é… IP åœ°å€ã€‚\n- é‡‡ç”¨è®¤è¯ä¸åŠ å¯†åŠŸèƒ½ã€‚åº”å¯¹ä¼ªé€  IP åœ°å€çš„ç½‘ç»œå®‰å…¨åŠŸèƒ½ä»¥åŠé˜²æ­¢çº¿è·¯çªƒå¬çš„åŠŸèƒ½ã€‚\n- å¤šæ’­ã€Mobile IP æˆä¸ºæ‰©å±•åŠŸèƒ½ã€‚\n\n### IPv6 ä¸­ IP åœ°å€çš„æ ‡è®°æ–¹æ³•\n\n- ä¸€èˆ¬äººä»¬å°† 128 æ¯”ç‰¹ IP åœ°å€ä»¥æ¯ 16 æ¯”ç‰¹ä¸ºä¸€ç»„ï¼Œæ¯ç»„ç”¨å†’å·ï¼ˆâ€œï¼šâ€ï¼‰éš”å¼€è¿›è¡Œæ ‡è®°ã€‚\n- è€Œä¸”å¦‚æœå‡ºç°è¿ç»­çš„ 0 æ—¶è¿˜å¯ä»¥å°†è¿™äº› 0 çœç•¥ï¼Œå¹¶ç”¨ä¸¤ä¸ªå†’å·ï¼ˆâ€œï¼šï¼šâ€ï¼‰éš”å¼€ã€‚ä½†æ˜¯ï¼Œä¸€ä¸ª IP åœ°å€ä¸­åªå…è®¸å‡ºç°ä¸€æ¬¡ä¸¤ä¸ªè¿ç»­çš„å†’å·ã€‚\n\n### IPv6 åœ°å€çš„ç»“æ„\n\n- IPv6 ç±»ä¼¼ IPv4ï¼Œä¹Ÿæ˜¯é€šè¿‡ IP åœ°å€çš„å‰å‡ ä½æ ‡è¯† IP åœ°å€çš„ç§ç±»ã€‚\n- åœ¨äº’è”ç½‘é€šä¿¡ä¸­ï¼Œä½¿ç”¨ä¸€ç§å…¨å±€çš„å•æ’­åœ°å€ã€‚å®ƒæ˜¯äº’è”ç½‘ä¸­å”¯ä¸€çš„ä¸€ä¸ªåœ°å€ï¼Œä¸éœ€è¦æ­£å¼åˆ†é… IP åœ°å€ã€‚\n\n| æœªå®šä¹‰           | 0000 ... 0000ï¼ˆ128 æ¯”ç‰¹ï¼‰ | ï¼šï¼š/ 128    |\n| ---------------- | ------------------------- | ------------ |\n| ç¯å›åœ°å€         | 0000 ... 0001ï¼ˆ128 æ¯”ç‰¹ï¼‰ | ï¼šï¼š1 / 128  |\n| å”¯ä¸€æœ¬åœ°åœ°å€     | 1111 110                  | FC00ï¼š/ 7    |\n| é“¾è·¯æœ¬åœ°å•æ’­åœ°å€ | 1111 1110 10              | FE80ï¼šï¼š/ 10 |\n| å¤šæ’­åœ°å€         | 1111 1111                 | FF00ï¼šï¼š/ 8  |\n| å…¨å±€å•æ’­åœ°å€     | ï¼ˆå…¶ä»–ï¼‰                  |              |\n\n### å…¨å±€å•æ’­åœ°å€\n\n- å…¨å±€å•æ’­åœ°å€æ˜¯æŒ‡ä¸–ç•Œä¸Šå”¯ä¸€çš„ä¸€ä¸ªåœ°å€ã€‚å®ƒæ˜¯äº’è”ç½‘é€šä¿¡ä»¥åŠå„ä¸ªåŸŸå†…éƒ¨é€šä¿¡ä¸­æœ€ä¸ºå¸¸ç”¨çš„ä¸€ä¸ª IPv6 åœ°å€ã€‚\n- æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç°åœ¨ IPv6 çš„ç½‘ç»œä¸­æ‰€ä½¿ç”¨çš„æ ¼å¼ä¸ºï¼Œn = 48ï¼Œm = 16 ä»¥åŠ 128 - n - m = 64ã€‚å³å‰ 64 æ¯”ç‰¹ä¸ºç½‘ç»œæ ‡è¯†ï¼Œå 64 æ¯”ç‰¹ä¸ºä¸»æœºæ ‡è¯†ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g70lktamkvj30lt08qmxq.jpg)\n\n### é“¾è·¯æœ¬åœ°å•æ’­åœ°å€\n\né“¾è·¯æœ¬åœ°å•æ’­åœ°å€æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªæ•°æ®é“¾è·¯å†…å”¯ä¸€çš„åœ°å€ã€‚å®ƒç”¨äºä¸ç»è¿‡è·¯ç”±å™¨ï¼Œåœ¨åŒä¸€ä¸ªé“¾è·¯ä¸­çš„é€šä¿¡ã€‚é€šå¸¸æ¥å£ ID ä¿å­˜ 64 æ¯”ç‰¹ç‰ˆçš„ MAC åœ°å€ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g70llnrbecj30lg052weo.jpg)\n\n### å”¯ä¸€æœ¬åœ°åœ°å€\n\n- å”¯ä¸€æœ¬åœ°åœ°å€æ˜¯ä¸è¿›è¡Œäº’è”ç½‘é€šä¿¡æ—¶æ‰€ç”¨çš„åœ°å€ã€‚\n- å”¯ä¸€æœ¬åœ°åœ°å€è™½ç„¶ä¸ä¼šä¸äº’è”ç½‘è¿æ¥ï¼Œä½†æ˜¯ä¹Ÿä¼šå°½å¯èƒ½åœ°éšæœºç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„å…¨å±€ IDã€‚\n- L é€šå¸¸è¢«ç½®ä¸º 1\n- å…¨å±€ ID çš„å€¼éšæœºå†³å®š\n- å­ç½‘ ID æ˜¯æŒ‡è¯¥åŸŸå­ç½‘åœ°å€\n- æ¥å£ ID å³ä¸ºæ¥å£çš„ ID\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g70lmkuopyj30ms053mxf.jpg)\n\n### IPv6 åˆ†æ®µå¤„ç†\n\n- IPv6 çš„åˆ†ç‰‡å¤„ç†åªåœ¨ä½œä¸ºèµ·ç‚¹çš„å‘é€ç«¯ä¸»æœºä¸Šè¿›è¡Œï¼Œè·¯ç”±å™¨ä¸å‚ä¸åˆ†ç‰‡ã€‚\n- IPv6 ä¸­æœ€å° MTU ä¸º 1280 å­—èŠ‚ï¼Œå› æ­¤ï¼Œåœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­å¯¹äºé‚£äº›æœ‰ä¸€å®šç³»ç»Ÿèµ„æºé™åˆ¶çš„è®¾å¤‡æ¥è¯´ï¼Œä¸éœ€è¦è¿›è¡Œâ€œè·¯å¾„ MTU å‘ç°â€ï¼Œè€Œæ˜¯åœ¨å‘é€ IP åŒ…æ—¶ç›´æ¥ä»¥ 1280 å­—èŠ‚ä¸ºå•ä½åˆ†ç‰‡é€å‡ºã€‚\n\n### IP é¦–éƒ¨ï¼ˆæš‚ç•¥ï¼‰\n\n## IP åè®®ç›¸å…³æŠ€æœ¯\n\nIP æ—¨åœ¨è®©æœ€ç»ˆç›®æ ‡ä¸»æœºæ”¶åˆ°æ•°æ®åŒ…ï¼Œä½†æ˜¯åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ä»…ä»…æœ‰ IP æ˜¯æ— æ³•å®ç°é€šä¿¡çš„ã€‚å¿…é¡»è¿˜æœ‰èƒ½å¤Ÿè§£æä¸»æœºåç§°å’Œ MAC åœ°å€çš„åŠŸèƒ½ï¼Œä»¥åŠæ•°æ®åŒ…åœ¨å‘é€è¿‡ç¨‹ä¸­å¼‚å¸¸æƒ…å†µå¤„ç†çš„åŠŸèƒ½ã€‚\n\n### DNS\n\n- æˆ‘ä»¬å¹³å¸¸åœ¨è®¿é—®æŸä¸ªç½‘ç«™æ—¶ä¸é€‚ç”¨ IP åœ°å€ï¼Œè€Œæ˜¯ç”¨ä¸€ä¸²ç”±ç½—é©¬å­—å’Œç‚¹å·ç»„æˆçš„å­—ç¬¦ä¸²ã€‚è€Œä¸€èˆ¬ç”¨æˆ·åœ¨ä½¿ç”¨ TCP/IP è¿›è¡Œé€šä¿¡æ—¶ä¹Ÿä¸ä½¿ç”¨ IP åœ°å€ã€‚èƒ½å¤Ÿè¿™æ ·åšæ˜¯å› ä¸ºæœ‰äº† DNS ï¼ˆDomain Name Systemï¼‰åŠŸèƒ½çš„æ”¯æŒã€‚DNS å¯ä»¥å°†é‚£ä¸²å­—ç¬¦ä¸²è‡ªåŠ¨è½¬æ¢ä¸ºå…·ä½“çš„ IP åœ°å€ã€‚\n- è¿™ç§ DNS ä¸ä»…é€‚ç”¨äº IPv4ï¼Œè¿˜é€‚ç”¨äº IPv6ã€‚\n\n### ARP\n\n- åªè¦ç¡®å®šäº† IP åœ°å€ï¼Œå°±å¯ä»¥å‘è¿™ä¸ªç›®æ ‡åœ°å€å‘é€ IP æ•°æ®æŠ¥ã€‚ç„¶è€Œï¼Œåœ¨åº•å±‚æ•°æ®é“¾è·¯å±‚ï¼Œè¿›è¡Œå®é™…é€šä¿¡æ—¶å´æœ‰å¿…è¦äº†è§£æ¯ä¸ª IP åœ°å€æ‰€å¯¹åº”çš„ MAC åœ°å€ã€‚\n- ARP æ˜¯ä¸€ç§è§£å†³åœ°å€é—®é¢˜çš„åè®®ã€‚ä»¥ç›®æ ‡ IP åœ°å€ä¸ºçº¿ç´¢ï¼Œç”¨æ¥å®šä½ä¸‹ä¸€ä¸ªåº”è¯¥æ¥æ”¶æ•°æ®åˆ†åŒ…çš„ç½‘ç»œè®¾å¤‡å¯¹åº”çš„ MAC åœ°å€ã€‚ä¸è¿‡ ARP åªé€‚ç”¨äº IPv4ï¼Œä¸èƒ½ç”¨äº IPv6ã€‚IPv6 ä¸­å¯ä»¥ç”¨ ICMPv6 æ›¿ä»£ ARP å‘é€é‚»å±…æ¢ç´¢æ¶ˆæ¯ã€‚\n- RARP æ˜¯å°† ARP åè¿‡æ¥ï¼Œä» MAC åœ°å€å®šä½ IP åœ°å€çš„ä¸€ç§åè®®ã€‚\n\n### ICMP\n\n- ICMP çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼Œç¡®è®¤ IP åŒ…æ˜¯å¦æˆåŠŸé€è¾¾ç›®æ ‡åœ°å€ï¼Œé€šçŸ¥åœ¨å‘é€è¿‡ç¨‹å½“ä¸­ IP åŒ…è¢«åºŸå¼ƒçš„å…·ä½“åŸå› ï¼Œæ”¹å–„ç½‘ç»œè®¾ç½®ç­‰ã€‚\n- IPv4 ä¸­ ICMP ä»…ä½œä¸ºä¸€ä¸ªè¾…åŠ©ä½œç”¨æ”¯æŒ IPv4ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ IPv4 æ—¶æœŸï¼Œå³ä½¿æ²¡æœ‰ ICMPï¼Œä»ç„¶å¯ä»¥å®ç° IP é€šä¿¡ã€‚ç„¶è€Œï¼Œåœ¨ IPv6 ä¸­ï¼ŒICMP çš„ä½œç”¨è¢«æ‰©å¤§ï¼Œå¦‚æœæ²¡æœ‰ ICMPv6ï¼ŒIPv6 å°±æ— æ³•è¿›è¡Œæ­£å¸¸é€šä¿¡ã€‚\n\n### DHCP\n\n- å¦‚æœé€ä¸€ä¸ºæ¯ä¸€å°ä¸»æœºè®¾ç½® IP åœ°å€ä¼šæ˜¯éå¸¸ç¹ççš„äº‹æƒ…ã€‚ç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨ä½¿ç”¨ç¬”è®°æœ¬ç”µè„‘ã€åªèƒ½ç»ˆç«¯ä»¥åŠå¹³æ¿ç”µè„‘ç­‰è®¾å¤‡æ—¶ï¼Œæ¯ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°çš„åœ°æ–¹ï¼Œéƒ½è¦é‡æ–°è®¾ç½® IP åœ°å€ã€‚\n- äºæ˜¯ï¼Œä¸ºäº†å®ç°è‡ªåŠ¨è®¾ç½® IP åœ°å€ã€ç»Ÿä¸€ç®¡ç† IP åœ°å€åˆ†é…ï¼Œå°±äº§ç”Ÿäº† DHCPï¼ˆDynamic Host Configuration Protocolï¼‰åè®®ã€‚æœ‰äº† DHCPï¼Œè®¡ç®—æœºåªè¦è¿æ¥åˆ°ç½‘ç»œï¼Œå°±å¯ä»¥è¿›è¡Œ TCP/IP é€šä¿¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒDHCP è®©å³æ’å³ç”¨å˜å¾—å¯èƒ½ã€‚\n- DHCP ä¸ä»…åœ¨ IPv4 ä¸­ï¼Œåœ¨ IPv6 ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚\n\n### NAT\n\n- NATï¼ˆNetwork Address Translatorï¼‰æ˜¯ç”¨äºåœ¨æœ¬åœ°ç½‘ç»œä¸­ä½¿ç”¨ç§æœ‰åœ°å€ï¼Œåœ¨è¿æ¥äº’è”ç½‘æ—¶è½¬è€Œä½¿ç”¨å…¨å±€ IP åœ°å€çš„æŠ€æœ¯ã€‚\n- é™¤è½¬æ¢ IP åœ°å€å¤–ï¼Œè¿˜å‡ºç°äº†å¯ä»¥è½¬æ¢ TCPã€UDP ç«¯å£å·çš„ NAPTï¼ˆNetwork Address Ports Translatorï¼‰æŠ€æœ¯ï¼Œç”±æ­¤å¯ä»¥å®ç°ç”¨ä¸€ä¸ªå…¨å±€ IP åœ°å€ä¸å¤šä¸ªä¸»æœºçš„é€šä¿¡ã€‚\n- NATï¼ˆNAPTï¼‰å®é™…ä¸Šæ˜¯ä¸ºæ­£åœ¨é¢ä¸´åœ°å€æ¯ç«­çš„ IPv4 è€Œå¼€å‘çš„æŠ€æœ¯ã€‚ä¸è¿‡ï¼Œåœ¨ IPv6 ä¸­ä¸ºäº†æé«˜ç½‘ç»œå®‰å…¨ä¹Ÿåœ¨ä½¿ç”¨ NATï¼Œåœ¨ IPv4 å’Œ IPv6 ä¹‹é—´çš„ç›¸äº’é€šä¿¡å½“ä¸­å¸¸å¸¸ä½¿ç”¨ NAT-PTã€‚\n\n### IP éš§é“\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g70lqkzre9j30ht04caaa.jpg)\n\n- å¦‚ä¸Šå›¾çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œç½‘ç»œ A ä¸ç½‘ç»œ B ä¹‹é—´æ— æ³•ç›´æ¥è¿›è¡Œé€šä¿¡ï¼Œä¸ºäº†è®©å®ƒä»¬ä¹‹é—´æ­£å¸¸é€šä¿¡ï¼Œè¿™æ—¶å¿…é¡»å¾—é‡‡ç”¨ IP éš§é“çš„åŠŸèƒ½ã€‚\n- IP éš§é“å¯ä»¥å°†é‚£äº›ä»ç½‘ç»œ A å‘è¿‡æ¥çš„ IPv6 çš„åŒ…ç»Ÿåˆä¸ºä¸€ä¸ªæ•°æ®ï¼Œå†ä¸ºä¹‹è¿½åŠ ä¸€ä¸ª IPv4 çš„é¦–éƒ¨ä»¥åè½¬å‘ç»™ç½‘ç»œ Cã€‚\n- ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç´§æ¥ç€ IP é¦–éƒ¨çš„æ˜¯ TCP æˆ– UDP çš„é¦–éƒ¨ã€‚ç„¶è€Œï¼Œç°åœ¨çš„åº”ç”¨å½“ä¸­â€œ IP é¦–éƒ¨çš„åé¢è¿˜æ˜¯ IP é¦–éƒ¨â€æˆ–è€…â€œ IP é¦–éƒ¨çš„åé¢æ˜¯ IPv6 çš„é¦–éƒ¨â€ç­‰æƒ…å†µä¸æ—¥ä¿±å¢ã€‚è¿™ç§åœ¨ç½‘ç»œå±‚çš„é¦–éƒ¨åé¢è¿½åŠ ç½‘ç»œå±‚é¦–éƒ¨çš„é€šä¿¡æ–¹æ³•å°±å«åšâ€œ IP éš§é“â€ã€‚\n","tags":["æµè§ˆå™¨","TCP/IP"],"categories":["æµè§ˆå™¨"]},{"title":"Http/1.0çš„Keep-Aliveå’ŒHttp/2.0çš„å¤šè·¯å¤ç”¨å¯¹æ¯”","url":"/2019/10/04/Http1.0çš„Keep-Aliveå’ŒHttp2.0çš„å¤šè·¯å¤ç”¨å¯¹æ¯” copy/","content":"\n# Http/1.0 çš„ Keep-Alive å’Œ Http/2.0 çš„å¤šè·¯å¤ç”¨å¯¹æ¯”\n\n## Http/1.0 çš„ Keep-Alive\n\nåœ¨æ²¡æœ‰`Keep-Alive`å‰ï¼Œæˆ‘ä»¬ä¸æœåŠ¡å™¨è¯·æ±‚æ•°æ®çš„æµç¨‹æ˜¯è¿™æ ·ï¼š\n\n![clipboard.png](https://tva1.sinaimg.cn/large/006y8mN6ly1g6nsz9l0hxj30ac0caq3x.jpg)\n\n- æµè§ˆå™¨è¯·æ±‚`//static.mtime.cn/a.js`-->è§£æåŸŸå-->HTTP è¿æ¥-->æœåŠ¡å™¨å¤„ç†æ–‡ä»¶-->è¿”å›æ•°æ®-->æµè§ˆå™¨è§£æã€æ¸²æŸ“æ–‡ä»¶\n- æµè§ˆå™¨è¯·æ±‚`//static.mtime.cn/b.js`-->è§£æåŸŸå-->HTTP è¿æ¥-->æœåŠ¡å™¨å¤„ç†æ–‡ä»¶-->è¿”å›æ•°æ®-->æµè§ˆå™¨è§£æã€æ¸²æŸ“æ–‡ä»¶\n- ...\n- è¿™æ ·å¾ªç¯ä¸‹å»ï¼Œç›´è‡³å…¨éƒ¨æ–‡ä»¶ä¸‹è½½å®Œæˆã€‚\n\nè¿™ä¸ªæµç¨‹æœ€å¤§çš„é—®é¢˜å°±æ˜¯ï¼š**æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå»ºç«‹ä¸€æ¬¡ HTTP è¿æ¥**ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ 3 æ¬¡æ¡æ‰‹ 4 æ¬¡æŒ¥æ‰‹ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨ä¸€æ¬¡è¯·æ±‚è¿‡ç¨‹ä¸­å ç”¨äº†ç›¸å½“é•¿çš„æ—¶é—´ï¼Œè€Œä¸”é€»è¾‘ä¸Šæ˜¯éå¿…éœ€çš„ï¼Œå› ä¸ºä¸é—´æ–­çš„è¯·æ±‚æ•°æ®ï¼Œç¬¬ä¸€æ¬¡å»ºç«‹è¿æ¥æ˜¯æ­£å¸¸çš„ï¼Œä»¥åå°±å ç”¨è¿™ä¸ªé€šé“ï¼Œä¸‹è½½å…¶ä»–æ–‡ä»¶ï¼Œè¿™æ ·æ•ˆç‡å¤šé«˜å•Šï¼ä½ çŒœå¯¹äº†ï¼Œè¿™å°±æ˜¯`Keep-Alive`ã€‚\n\n### `Keep-Alive`è§£å†³çš„é—®é¢˜\n\n`Keep-Alive`è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼šä¸€å®šæ—¶é—´å†…ï¼ŒåŒä¸€åŸŸåå¤šæ¬¡è¯·æ±‚æ•°æ®ï¼Œåªå»ºç«‹ä¸€æ¬¡ HTTP è¯·æ±‚ï¼Œå…¶ä»–è¯·æ±‚å¯å¤ç”¨æ¯ä¸€æ¬¡å»ºç«‹çš„è¿æ¥é€šé“ï¼Œä»¥è¾¾åˆ°æé«˜è¯·æ±‚æ•ˆç‡çš„é—®é¢˜ã€‚è¿™é‡Œé¢æ‰€è¯´çš„**ä¸€å®šæ—¶é—´**æ˜¯å¯ä»¥é…ç½®çš„ï¼Œä¸ç®¡ä½ ç”¨çš„æ˜¯`Apache`è¿˜æ˜¯`nginx`ã€‚\n\n### `HTTP1.1`è¿˜æ˜¯å­˜åœ¨æ•ˆç‡é—®é¢˜\n\nå¦‚ä¸Šé¢æ‰€è¯´ï¼Œåœ¨`HTTP1.1`ä¸­æ˜¯é»˜è®¤å¼€å¯äº†`Keep-Alive`ï¼Œä»–è§£å†³äº†å¤šæ¬¡è¿æ¥çš„é—®é¢˜ï¼Œä½†æ˜¯ä¾ç„¶æœ‰ä¸¤ä¸ªæ•ˆç‡ä¸Šçš„é—®é¢˜ï¼š\n\n- ç¬¬ä¸€ä¸ªï¼š**ä¸²è¡Œçš„æ–‡ä»¶ä¼ è¾“**ã€‚å½“è¯·æ±‚ a æ–‡ä»¶æ—¶ï¼Œb æ–‡ä»¶åªèƒ½ç­‰å¾…ï¼Œç­‰å¾… a è¿æ¥åˆ°æœåŠ¡å™¨ã€æœåŠ¡å™¨å¤„ç†æ–‡ä»¶ã€æœåŠ¡å™¨è¿”å›æ–‡ä»¶ï¼Œè¿™ä¸‰ä¸ªæ­¥éª¤ã€‚æˆ‘ä»¬å‡è®¾è¿™ä¸‰æ­¥ç”¨æ—¶éƒ½æ˜¯ 1 ç§’ï¼Œé‚£ä¹ˆ a æ–‡ä»¶ç”¨æ—¶ä¸º 3 ç§’ï¼Œb æ–‡ä»¶ä¼ è¾“å®Œæˆç”¨æ—¶ä¸º 6 ç§’ï¼Œä¾æ­¤ç±»æ¨ã€‚ï¼ˆæ³¨ï¼šæ­¤é¡¹è®¡ç®—æœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼Œå°±æ˜¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨æ˜¯å•é€šé“ä¼ è¾“ï¼‰\n- ç¬¬äºŒä¸ªï¼š**è¿æ¥æ•°è¿‡å¤š**ã€‚æˆ‘ä»¬å‡è®¾`Apache`è®¾ç½®äº†æœ€å¤§å¹¶å‘æ•°ä¸º 300ï¼Œå› ä¸ºæµè§ˆå™¨é™åˆ¶ï¼Œæµè§ˆå™¨å‘èµ·çš„æœ€å¤§è¯·æ±‚æ•°ä¸º 6ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å™¨èƒ½æ‰¿è½½çš„æœ€é«˜å¹¶å‘ä¸º 50ï¼Œå½“ç¬¬ 51 ä¸ªäººè®¿é—®æ—¶ï¼Œå°±éœ€è¦ç­‰å¾…å‰é¢æŸä¸ªè¯·æ±‚å¤„ç†å®Œæˆã€‚\n\n## HTTP/2 çš„å¤šè·¯å¤ç”¨\n\nHTTP/2 çš„å¤šè·¯å¤ç”¨å°±æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°çš„ä¸¤ä¸ªæ€§èƒ½é—®é¢˜ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œä»–æ˜¯å¦‚ä½•è§£å†³çš„ã€‚\n\n- è§£å†³ç¬¬ä¸€ä¸ªï¼šåœ¨`HTTP1.1`çš„åè®®ä¸­ï¼Œæˆ‘ä»¬ä¼ è¾“çš„`request`å’Œ`response`éƒ½æ˜¯åŸºæœ¬äºæ–‡æœ¬çš„ï¼Œè¿™æ ·å°±ä¼šå¼•å‘ä¸€ä¸ªé—®é¢˜ï¼šæ‰€æœ‰çš„æ•°æ®å¿…é¡»æŒ‰é¡ºåºä¼ è¾“ï¼Œæ¯”å¦‚éœ€è¦ä¼ è¾“ï¼š`hello world`ï¼Œåªèƒ½ä»`h`åˆ°`d`ä¸€ä¸ªä¸€ä¸ªçš„ä¼ è¾“ï¼Œä¸èƒ½å¹¶è¡Œä¼ è¾“ï¼Œå› ä¸ºæ¥æ”¶ç«¯å¹¶ä¸çŸ¥é“è¿™äº›å­—ç¬¦çš„é¡ºåºï¼Œæ‰€ä»¥å¹¶è¡Œä¼ è¾“åœ¨`HTTP1.1`æ˜¯ä¸èƒ½å®ç°çš„ã€‚\n\n![clipboard.png](https://tva1.sinaimg.cn/large/006y8mN6ly1g6nszfhktpj30kp05lmxt.jpg)\n\n`HTTP/2`å¼•å…¥`äºŒè¿›åˆ¶æ•°æ®å¸§`å’Œ`æµ`çš„æ¦‚å¿µï¼Œå…¶ä¸­å¸§å¯¹æ•°æ®è¿›è¡Œé¡ºåºæ ‡è¯†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™æ ·æµè§ˆå™¨æ”¶åˆ°æ•°æ®ä¹‹åï¼Œå°±å¯ä»¥æŒ‰ç…§åºåˆ—å¯¹æ•°æ®è¿›è¡Œåˆå¹¶ï¼Œè€Œä¸ä¼šå‡ºç°åˆå¹¶åæ•°æ®é”™ä¹±çš„æƒ…å†µã€‚åŒæ ·æ˜¯å› ä¸ºæœ‰äº†åºåˆ—ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥å¹¶è¡Œçš„ä¼ è¾“æ•°æ®ï¼Œè¿™å°±æ˜¯`æµ`æ‰€åšçš„äº‹æƒ…ã€‚\n\n![clipboard.png](https://tva1.sinaimg.cn/large/006y8mN6ly1g6nszichcoj30fm0aft9y.jpg)\n\n- è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼š`HTTP/2`å¯¹åŒä¸€åŸŸåä¸‹æ‰€æœ‰è¯·æ±‚éƒ½æ˜¯åŸºäº`æµ`ï¼Œä¹Ÿå°±æ˜¯è¯´åŒä¸€åŸŸåä¸ç®¡è®¿é—®å¤šå°‘æ–‡ä»¶ï¼Œä¹Ÿåª**å»ºç«‹ä¸€è·¯è¿æ¥**ã€‚åŒæ ·`Apache`çš„æœ€å¤§è¿æ¥æ•°ä¸º 300ï¼Œå› ä¸ºæœ‰äº†è¿™ä¸ªæ–°ç‰¹æ€§ï¼Œæœ€å¤§çš„å¹¶å‘å°±å¯ä»¥æå‡åˆ° 300ï¼Œæ¯”åŸæ¥æå‡äº† 6 å€ï¼\n\n## **å¤šè·¯å¤ç”¨å’Œ keep alive åŒºåˆ«ï¼Ÿ**\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6nt1pb7xkj30ln0l940f.jpg)\n\n1ï¼‰çº¿å¤´é˜»å¡ï¼ˆHead-of-Line Blockingï¼‰ï¼ŒHTTP1.X è™½ç„¶å¯ä»¥é‡‡ç”¨ keep alive æ¥è§£å†³å¤ç”¨ TCP çš„é—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯æ— æ³•è§£å†³è¯·æ±‚é˜»å¡é—®é¢˜ã€‚\n\n2ï¼‰æ‰€è°“è¯·æ±‚é˜»å¡æ„æ€å°±æ˜¯ä¸€æ¡ TCP çš„ connection åœ¨åŒä¸€æ—¶é—´åªèƒ½å…è®¸ä¸€ä¸ªè¯·æ±‚ç»è¿‡ï¼Œè¿™æ ·å‡å¦‚åç»­è¯·æ±‚æƒ³è¦å¤ç”¨è¿™ä¸ªé“¾æ¥å°±å¿…é¡»ç­‰åˆ°å‰ä¸€ä¸ªå®Œæˆæ‰è¡Œï¼Œæ­£å¦‚ä¸Šå›¾å·¦è¾¹è¡¨ç¤ºçš„ã€‚\n\n3ï¼‰ä¹‹æ‰€ä»¥æœ‰è¿™ä¸ªé—®é¢˜å°±æ˜¯å› ä¸º HTTP1.x éœ€è¦æ¯æ¡è¯·æ±‚éƒ½æ˜¯å¯æ˜¯è¯†åˆ«ï¼ŒæŒ‰é¡ºåºå‘é€ï¼Œå¦åˆ™ server å°±æ— æ³•åˆ¤æ–­è¯¥ç›¸åº”å“ªä¸ªå…·ä½“çš„è¯·æ±‚ã€‚\n\n4ï¼‰HTTP2 é‡‡ç”¨å¤šè·¯å¤ç”¨æ˜¯æŒ‡ï¼Œåœ¨åŒä¸€ä¸ªåŸŸåä¸‹ï¼Œå¼€å¯ä¸€ä¸ª TCP çš„ connectionï¼Œæ¯ä¸ªè¯·æ±‚ä»¥ stream çš„æ–¹å¼ä¼ è¾“ï¼Œæ¯ä¸ª stream æœ‰å”¯ä¸€æ ‡è¯†ï¼Œconnection ä¸€æ—¦å»ºç«‹ï¼Œåç»­çš„è¯·æ±‚éƒ½å¯ä»¥å¤ç”¨è¿™ä¸ª connection å¹¶ä¸”å¯ä»¥åŒæ—¶å‘é€ï¼Œserver ç«¯å¯ä»¥æ ¹æ® stream çš„å”¯ä¸€æ ‡è¯†æ¥ç›¸åº”å¯¹åº”çš„è¯·æ±‚ã€‚\n","tags":["HTTP","æµè§ˆå™¨"],"categories":["æµè§ˆå™¨"]},{"title":"CSS æ¸…é™¤æµ®åŠ¨","url":"/2019/09/29/CSS æ¸…é™¤æµ®åŠ¨/","content":"\n# CSS æ¸…é™¤æµ®åŠ¨\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6tbm9sca0j30op0fh0tp.jpg)\n\n## æµ®åŠ¨æ˜¯ä»€ä¹ˆï¼Ÿ\n\nW3school ä¸­ç»™å‡ºçš„æµ®åŠ¨å®šä¹‰ä¸º**æµ®åŠ¨çš„æ¡†å¯ä»¥å‘å·¦æˆ–å‘å³ç§»åŠ¨ï¼Œç›´åˆ°å®ƒçš„å¤–è¾¹ç¼˜ç¢°åˆ°åŒ…å«æ¡†æˆ–å¦ä¸€ä¸ªæµ®åŠ¨æ¡†çš„è¾¹æ¡†ä¸ºæ­¢ã€‚**ç”±äºæµ®åŠ¨æ¡†è„±ç¦»æ–‡æ¡£çš„æ™®é€šæµä¸­ï¼Œæ‰€ä»¥æ–‡æ¡£çš„æ™®é€šæµä¸­çš„å—æ¡†è¡¨ç°å¾—å°±åƒæµ®åŠ¨æ¡†ä¸å­˜åœ¨ä¸€æ ·ã€‚\n\n## æµ®åŠ¨çš„ç‰¹ç‚¹\n\næµ®åŠ¨çš„ç‰¹ç‚¹ï¼Œå¯ä»¥ç”¨å…«ä¸ªå­—æ€»ç»“ï¼š**è„±æ ‡ã€è´´è¾¹ã€å­—å›´å’Œæ”¶ç¼©ã€‚**\n\nä¸ºäº†æ›´å¥½è¯´æ˜ï¼Œè¯·çœ‹ä¸‹å›¾ï¼š\nå½“æ¡† 1 å‘å·¦æµ®åŠ¨æ—¶ï¼Œå®ƒè„±ç¦»æ–‡æ¡£æµï¼ˆ**è„±æ ‡**ï¼‰å¹¶ä¸”å‘å·¦ç§»åŠ¨ï¼ˆ**è´´è¾¹**ï¼‰ï¼Œç›´åˆ°å®ƒçš„å·¦è¾¹ç¼˜ç¢°åˆ°åŒ…å«æ¡†çš„å·¦è¾¹ç¼˜ã€‚å› ä¸ºå®ƒä¸å†å¤„äºæ–‡æ¡£æµä¸­ï¼Œæ‰€ä»¥å®ƒä¸å æ®ç©ºé—´ï¼Œå®é™…ä¸Šè¦†ç›–ä½äº†æ¡† 2ï¼Œä½¿æ¡† 2 ä»è§†å›¾ä¸­æ¶ˆå¤±ã€‚å¦‚æœæ¡† 2 ä¸­æœ‰æ–‡å­—ï¼Œå°±ä¼šå›´ç€æ¡† 1 æ’å¼€ï¼ˆ**å­—å›´**ï¼‰ã€‚\n\nå¦‚æœæŠŠæ‰€æœ‰ä¸‰ä¸ªæ¡†éƒ½å‘å·¦æµ®åŠ¨ï¼Œé‚£ä¹ˆæ¡† 1 å‘å·¦æµ®åŠ¨ç›´åˆ°ç¢°åˆ°åŒ…å«æ¡†ï¼Œå¦å¤–ä¸¤ä¸ªæ¡†å‘å·¦æµ®åŠ¨ç›´åˆ°ç¢°åˆ°å‰ä¸€ä¸ªæµ®åŠ¨æ¡†ã€‚\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6tc3n56n2j30em06haa4.jpg)\nä¸‹é¢ç€é‡è®²è§£ä¸‹ç¬¬å››ä¸ªç‰¹ç‚¹--**æ”¶ç¼©**\n\nä¸€ä¸ªæµ®åŠ¨çš„å†…è”å…ƒç´ ï¼ˆæ¯”å¦‚ span img æ ‡ç­¾ï¼‰ä¸éœ€è¦è®¾ç½® displayï¼šblock å°±å¯ä»¥è®¾ç½®å®½åº¦ã€‚\n\n```html\n<head>\n  <style>\n    div {\n      float: left;\n      background-color: greenyellow;\n    }\n  </style>\n</head>\n<body>\n  <div>\n    è¿™æ˜¯ä¸€æ®µæ–‡å­—\n  </div>\n</body>\n```\n\nå¾—åˆ°ä»¥ä¸‹çš„æ•ˆæœï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6tc6sc8yzj30qo01ft8h.jpg)\næˆ‘ä»¬éƒ½çŸ¥é“ div æ ‡ç­¾æ˜¯å—çº§å…ƒç´ ï¼Œä¼šç‹¬å ä¸€è¡Œï¼Œç„¶è€Œä¸Šé¢çš„ä¾‹å­ä¸­å°† div è®¾ç½®ä¸ºå·¦æµ®åï¼Œå…¶å®½åº¦ä¸å†æ˜¯å æ»¡ä¸€è¡Œï¼Œè€Œæ˜¯æ”¶ç´§ä¸ºå†…éƒ¨å…ƒç´ çš„å®½åº¦ï¼Œè¿™å°±æ˜¯æµ®åŠ¨ç¬¬å››ä¸ªç‰¹å¾çš„å«ä¹‰ã€‚\n\n## æµ®åŠ¨çš„ç¼ºç‚¹\n\nå…ˆçœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š\n\n```html\n<head>\n  <style>\n    .parent {\n      border: solid 5px;\n      width: 300px;\n    }\n    .child:nth-child(1) {\n      height: 100px;\n      width: 100px;\n      background-color: yellow;\n      float: left;\n    }\n    .child:nth-child(2) {\n      height: 100px;\n      width: 100px;\n      background-color: red;\n      float: left;\n    }\n    .child:nth-child(3) {\n      height: 100px;\n      width: 100px;\n      background-color: greenyellow;\n      float: left;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"parent\">\n    <div class=\"child\"></div>\n    <div class=\"child\"></div>\n    <div class=\"child\"></div>\n  </div>\n</body>\n```\n\næˆ‘ä»¬æƒ³è®©çˆ¶å®¹å™¨åŒ…è£¹ç€ä¸‰ä¸ªæµ®åŠ¨å…ƒç´ ï¼Œç„¶è€Œäº‹ä¸æ„¿è¿ï¼Œå¾—åˆ°å´æ˜¯è¿™æ ·çš„ç»“æœï¼š\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6tcc3apdwj30920393yb.jpg)\n**è¿™å°±æ˜¯æµ®åŠ¨å¸¦æ¥å‰¯ä½œç”¨----çˆ¶å®¹å™¨é«˜åº¦å¡Œé™·ï¼Œäºæ˜¯æ¸…ç†æµ®åŠ¨å°±æ˜¾ç€è‡³å…³é‡è¦ã€‚**\n\n## æ¸…ç†æµ®åŠ¨\n\n**æ¸…é™¤æµ®åŠ¨ä¸æ˜¯ä¸ç”¨æµ®åŠ¨ï¼Œæ˜¯æ¸…é™¤æµ®åŠ¨äº§ç”Ÿçš„çˆ¶å®¹å™¨é«˜åº¦å¡Œé™·**ã€‚\n\n### å¥—è·¯ 1ï¼šç»™æµ®åŠ¨å…ƒç´ çš„çˆ¶å…ƒç´ æ·»åŠ é«˜åº¦ï¼ˆæ‰©å±•æ€§ä¸å¥½ï¼‰\n\nå¦‚æœä¸€ä¸ªå…ƒç´ è¦æµ®åŠ¨ï¼Œé‚£ä¹ˆå®ƒçš„çˆ¶å…ƒç´ ä¸€å®šè¦æœ‰é«˜åº¦ã€‚é«˜åº¦çš„ç›’å­ï¼Œæ‰èƒ½å…³ä½æµ®åŠ¨ã€‚å¯ä»¥é€šè¿‡ç›´æ¥ç»™çˆ¶å…ƒç´ è®¾ç½® heightï¼Œå®é™…åº”ç”¨ä¸­æˆ‘ä»¬ä¸å¤§å¯èƒ½ç»™æ‰€æœ‰çš„ç›’å­åŠ é«˜åº¦ï¼Œä¸ä»…éº»çƒ¦ï¼Œå¹¶ä¸”ä¸èƒ½é€‚åº”é¡µé¢çš„å¿«é€Ÿå˜åŒ–ï¼›å¦å¤–ä¸€ç§ï¼Œçˆ¶å®¹å™¨çš„é«˜åº¦å¯ä»¥é€šè¿‡å†…å®¹æ’‘å¼€ï¼ˆæ¯”å¦‚ img å›¾ç‰‡ï¼‰ï¼Œå®é™…å½“ä¸­æ­¤æ–¹æ³•ç”¨çš„æ¯”è¾ƒå¤šã€‚\n\n### å¥—è·¯ 2ï¼šclear:both;\n\nåœ¨æœ€åä¸€ä¸ªå­å…ƒç´ åæ–°æ·»åŠ ä¸€ä¸ªå†—ä½™å…ƒç´ ï¼Œç„¶åå°†å…¶è®¾ç½® clear:both,è¿™æ ·å°±å¯ä»¥æ¸…é™¤æµ®åŠ¨ã€‚è¿™é‡Œå¼ºè°ƒä¸€ç‚¹ï¼Œå³**åœ¨çˆ¶çº§å…ƒç´ æœ«å°¾æ·»åŠ çš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå—çº§å…ƒç´ ï¼Œå¦åˆ™æ— æ³•æ’‘èµ·çˆ¶çº§å…ƒç´ é«˜åº¦**ã€‚\n\n```html\n<div id=\"wrap\">\n  <div id=\"inner\"></div>\n  <div style=\"clear: both;\"></div>\n</div>\n```\n\n```css\n#wrap {\n  border: 1px solid;\n}\n#inner {\n  float: left;\n  width: 200px;\n  height: 200px;\n  background: pink;\n}\n```\n\n### å¥—è·¯ 3ï¼šä¼ªå…ƒç´ æ¸…é™¤æµ®åŠ¨\n\nä¸Šé¢é‚£ç§åŠæ³•å›ºç„¶å¯ä»¥æ¸…é™¤æµ®åŠ¨ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸æƒ³åœ¨é¡µé¢ä¸­æ·»åŠ è¿™äº›æ²¡æœ‰æ„ä¹‰çš„å†—ä½™å…ƒç´ ï¼Œæ­¤æ—¶å¦‚ä½•æ¸…é™¤æµ®åŠ¨å—ï¼Ÿ\n**ç»“åˆ :after ä¼ªå…ƒç´ å’Œ IEhack ï¼Œå¯ä»¥å®Œç¾å…¼å®¹å½“å‰ä¸»æµçš„å„å¤§æµè§ˆå™¨ï¼Œè¿™é‡Œçš„ IEhack æŒ‡çš„æ˜¯è§¦å‘ hasLayout**ã€‚\n\n```html\n<div id=\"wrap\" class=\"clearfix\">\n  <div id=\"inner\"></div>\n</div>\n```\n\n```css\n#wrap {\n  border: 1px solid;\n}\n#inner {\n  float: left;\n  width: 200px;\n  height: 200px;\n  background: pink;\n}\n/*å¼€å¯haslayout*/\n.clearfix {\n  *zoom: 1;\n}\n/*ie6 7ä¸æ”¯æŒä¼ªå…ƒç´ */\n.clearfix:after {\n  content: \"\";\n  display: block;\n  clear: both;\n  height: 0;\n  line-height: 0;\n  visibility: hidden; //å…è®¸æµè§ˆå™¨æ¸²æŸ“å®ƒï¼Œä½†æ˜¯ä¸æ˜¾ç¤ºå‡ºæ¥\n}\n```\n\nç»™æµ®åŠ¨å…ƒç´ çš„çˆ¶å®¹å™¨æ·»åŠ ä¸€ä¸ª clearfix çš„ classï¼Œç„¶åç»™è¿™ä¸ª class æ·»åŠ ä¸€ä¸ª:after ä¼ªå…ƒç´ ï¼Œå®ç°å…ƒç´ æœ«å°¾æ·»åŠ ä¸€ä¸ªçœ‹ä¸è§çš„å—å…ƒç´ æ¥æ¸…ç†æµ®åŠ¨ã€‚è¿™æ˜¯é€šç”¨çš„æ¸…ç†æµ®åŠ¨æ–¹æ¡ˆï¼Œæ¨èä½¿ç”¨\n\n### å¥—è·¯ 4ï¼šç»™çˆ¶å…ƒç´ ä½¿ç”¨ overflow:hidden;\n\nè¿™ç§æ–¹æ¡ˆè®©çˆ¶å®¹å™¨å½¢æˆäº† BFCï¼ˆå—çº§æ ¼å¼ä¸Šä¸‹æ–‡ï¼‰ï¼Œè€Œ BFC å¯ä»¥åŒ…å«æµ®åŠ¨ï¼Œé€šå¸¸ç”¨æ¥è§£å†³æµ®åŠ¨çˆ¶å…ƒç´ é«˜åº¦åå¡Œçš„é—®é¢˜ã€‚\n\n**BFC çš„è§¦å‘æ–¹å¼**\n\næˆ‘ä»¬å¯ä»¥ç»™çˆ¶å…ƒç´ æ·»åŠ ä»¥ä¸‹å±æ€§æ¥è§¦å‘ BFCï¼š\n\n- float ä¸º left | right\n- overflow ä¸º hidden | auto | scorll\n- display ä¸º table-cell | table-caption | inline-block\n- position ä¸º absolute | fixed\n\nè¿™é‡Œå¯ä»¥ç»™çˆ¶å…ƒç´ è®¾ç½® overflow:autoï¼Œä½†æ˜¯ä¸ºäº†å…¼å®¹ IE æœ€å¥½ä½¿ç”¨ overflow:hiddenã€‚\n\n**ä½†è¿™ç§åŠæ³•æœ‰ä¸ªç¼ºé™·ï¼šå¦‚æœæœ‰å†…å®¹å‡ºäº†ç›’å­ï¼Œç”¨è¿™ç§æ–¹æ³•å°±ä¼šæŠŠå¤šçš„éƒ¨åˆ†è£åˆ‡æ‰ï¼Œæ‰€ä»¥è¿™æ—¶å€™ä¸èƒ½ä½¿ç”¨ã€‚**\n\n**BFC çš„ä¸»è¦ç‰¹å¾:**\n\n- BFC å®¹å™¨æ˜¯ä¸€ä¸ªéš”ç¦»çš„å®¹å™¨ï¼Œå’Œå…¶ä»–å…ƒç´ äº’ä¸å¹²æ‰°ï¼›æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨è§¦å‘ä¸¤ä¸ªå…ƒç´ çš„ BFC æ¥è§£å†³å‚ç›´è¾¹è·æŠ˜å é—®é¢˜ã€‚\n- BFC ä¸ä¼šé‡å æµ®åŠ¨å…ƒç´ \n- BFC å¯ä»¥åŒ…å«æµ®åŠ¨,è¿™å¯ä»¥æ¸…é™¤æµ®åŠ¨ã€‚\n\n### å¥—è·¯ 5ï¼šbr æ ‡ç­¾æ¸…æµ®åŠ¨\n\n**br æ ‡ç­¾å­˜åœ¨ä¸€ä¸ªå±æ€§ï¼šclearã€‚è¿™ä¸ªå±æ€§å°±æ˜¯èƒ½å¤Ÿæ¸…é™¤æµ®åŠ¨çš„åˆ©å™¨ï¼Œåœ¨ br æ ‡ç­¾ä¸­è®¾ç½®å±æ€§ clearï¼Œå¹¶èµ‹å€¼ allã€‚å³èƒ½æ¸…é™¤æ‰æµ®åŠ¨**ã€‚\n\n```html\n<div id=\"wrap\">\n  <div id=\"inner\"></div>\n  <br clear=\"all\" />\n</div>\n```\n\n```css\n#wrap {\n  border: 1px solid;\n}\n#inner {\n  float: left;\n  width: 200px;\n  height: 200px;\n  background: pink;\n}\n```\n","tags":["CSS","æ¸…é™¤æµ®åŠ¨"],"categories":["CSS"]},{"title":"git mergeå’Œgit rebaseçš„åŒºåˆ«","url":"/2019/09/21/git mergeå’Œgit rebaseçš„åŒºåˆ«/","content":"\n# git mergeå’Œgit rebaseçš„åŒºåˆ«\n\ngit rebase å’Œ git merge ä¸€æ ·éƒ½æ˜¯ç”¨äºä»ä¸€ä¸ªåˆ†æ”¯è·å–å¹¶ä¸”åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ï¼Œä½†æ˜¯ä»–ä»¬é‡‡å–ä¸åŒçš„å·¥ä½œæ–¹å¼ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6wkw4uh2dj30xc0qtjsl.jpg)\n\nä¸ºäº†å°†master ä¸Šæ–°çš„æäº¤åˆå¹¶åˆ°ä½ çš„featureåˆ†æ”¯ä¸Šï¼Œä½ æœ‰ä¸¤ç§é€‰æ‹©ï¼š`merging` or `rebase`\n\n## merge\n\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\n```shell\ngit checkout feature\ngit merge master\n```\n\næˆ–\n\n```shell\ngit merge master feature\n```\n\né‚£ä¹ˆæ­¤æ—¶åœ¨featureä¸Šgit è‡ªåŠ¨ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„commit(merge commit)\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6wky69tunj30w90850te.jpg)\n\n### `git merge` æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š\n\n- åªå¤„ç†ä¸€æ¬¡å†²çªï¼Œå¦‚æœåˆå¹¶çš„æ—¶å€™é‡åˆ°å†²çªï¼Œä»…éœ€è¦ä¿®æ”¹åé‡æ–°commit\n- å¼•å…¥äº†ä¸€æ¬¡åˆå¹¶çš„å†å²è®°å½•ï¼Œåˆå¹¶åçš„æ‰€æœ‰ `commit` ä¼šæŒ‰ç…§æäº¤æ—¶é—´ä»æ—§åˆ°æ–°æ’åˆ—\n- æ‰€æœ‰çš„è¿‡ç¨‹ä¿¡æ¯æ›´å¤šï¼Œå¯èƒ½ä¼šæé«˜ä¹‹åæŸ¥æ‰¾é—®é¢˜çš„éš¾åº¦\n\n### ä¼˜ç‚¹ï¼š\n\nè®°å½•äº†çœŸå®çš„commitæƒ…å†µï¼ŒåŒ…æ‹¬æ¯ä¸ªåˆ†æ”¯çš„è¯¦æƒ…\n\n### ç¼ºç‚¹ï¼š\n\nå› ä¸ºæ¯æ¬¡mergeä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªmerge commitï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä¸€äº›git çš„GUI toolsï¼Œç‰¹åˆ«æ˜¯commitæ¯”è¾ƒé¢‘ç¹æ—¶ï¼Œçœ‹åˆ°åˆ†æ”¯å¾ˆæ‚ä¹±ã€‚\n\n## rebase\n\nä¸ `git merge` ä¸€è‡´ï¼Œ`git rebase` çš„ç›®çš„ä¹Ÿæ˜¯å°†ä¸€ä¸ªåˆ†æ”¯çš„æ›´æ”¹å¹¶å…¥åˆ°å¦å¤–ä¸€ä¸ªåˆ†æ”¯ä¸­å»ã€‚\n\n```shell\ngit checkout feature\ngit rebase master\n```\n\næœ¬è´¨æ˜¯**å˜åŸº å˜åŸº å˜åŸº**\n\nå˜åŸºæ˜¯ä»€ä¹ˆ? `æ‰¾å…¬å…±ç¥–å…ˆ`\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6wl0azimrj30wx0823zd.jpg)\n\n### rebase ç‰¹ç‚¹ï¼š\n\n- æ”¹å˜å½“å‰åˆ†æ”¯ä» `master`ä¸Šæ‹‰å‡ºåˆ†æ”¯çš„ä½ç½®\n- æ²¡æœ‰å¤šä½™çš„åˆå¹¶å†å²çš„è®°å½•ï¼Œä¼šåˆå¹¶ä¹‹å‰çš„commitå†å²ï¼Œä¸”åˆå¹¶åçš„ `commit`é¡ºåºä¸ä¸€å®šæŒ‰ç…§ `commit`çš„æäº¤æ—¶é—´æ’åˆ—\n- å¯èƒ½ä¼šå¤šæ¬¡è§£å†³åŒä¸€ä¸ªåœ°æ–¹çš„å†²çªï¼ˆæœ‰ `squash`æ¥è§£å†³ï¼‰\n- æ›´æ¸…çˆ½ä¸€äº›ï¼Œ`master`åˆ†æ”¯ä¸Šæ¯ä¸ª `commit`ç‚¹éƒ½æ˜¯ç›¸å¯¹ç‹¬ç«‹å®Œæ•´çš„åŠŸèƒ½å•å…ƒ\n\n### ä¼˜ç‚¹ï¼š\n\nå¾—åˆ°æ›´ç®€æ´çš„é¡¹ç›®å†å²ï¼Œå»æ‰äº†merge commit\n\n### ç¼ºç‚¹ï¼š\n\nå¦‚æœåˆå¹¶å‡ºç°ä»£ç é—®é¢˜ä¸å®¹æ˜“å®šä½ï¼Œå› ä¸ºrewriteäº†history\n\n### åˆå¹¶æ—¶é‡åˆ°å†²çªï¼š\n\nåˆå¹¶æ—¶å¦‚æœå‡ºç°å†²çªéœ€è¦æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤è§£å†³\n\n- ä¿®æ”¹å†²çªéƒ¨åˆ†\n- git add\n- `git rebase --continue`\n- ï¼ˆå¦‚æœç¬¬ä¸‰æ­¥æ— æ•ˆå¯ä»¥æ‰§è¡Œ `git rebase --skip`ï¼‰\n\nä¸è¦åœ¨git add ä¹‹åä¹ æƒ¯æ€§çš„æ‰§è¡Œ git commitå‘½ä»¤\n\n### git rebase çš„äº¤äº’æ¨¡å¼\n\næ‰“å¼€å˜åŸºçš„äº¤äº’æ¨¡å¼åªéœ€è¦ä¼ å…¥ä¸€ä¸ªå‚æ•° `-i` å³å¯ï¼ŒåŒæ—¶è¿˜éœ€è¦æŒ‡å®šå¯¹å“ªäº›æäº¤è¿›è¡Œå¤„ç†\n\n```shell\ngit rebase -i HEAD~4\n```\n\nä¸Šè¿°å‘½ä»¤æŒ‡å®šäº†å¯¹å½“å‰åˆ†æ”¯çš„æœ€è¿‘å››æ¬¡æäº¤è¿›è¡Œæ“ä½œã€‚ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ä¸Šé¢è¿™è¡Œå‘½ä»¤å°† `feature` åˆ†æ”¯çš„æäº¤åˆå¹¶ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6wl7ji36xj30wi0gpq67.jpg)\n\nä¸­é—´çº¢æ¡†å†…æœ‰ä¸€äº›å‘½ä»¤ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†æŸæ¬¡æäº¤çš„\n\n## æ€»ç»“\n\n- å¦‚æœä½ æƒ³è¦ä¸€ä¸ªå¹²å‡€çš„ï¼Œæ²¡æœ‰merge commitçš„çº¿æ€§å†å²æ ‘ï¼Œæˆ–è€…å½“å‘ç°è‡ªå·±ä¿®æ”¹æŸä¸ªåŠŸèƒ½æ—¶ï¼Œé¢‘ç¹è¿›è¡Œäº†`git commit`æäº¤æ—¶ï¼Œå‘ç°å…¶å®è¿‡å¤šçš„æäº¤ä¿¡æ¯æ²¡æœ‰å¿…è¦æ—¶ï¼Œé‚£ä¹ˆä½ åº”è¯¥é€‰æ‹©git rebase\n- å½“éœ€è¦ä¿ç•™è¯¦ç»†çš„åˆå¹¶ä¿¡æ¯çš„æ—¶å€™å»ºè®®ä½¿ç”¨`git merge`ï¼Œç‰¹åˆ«æ˜¯éœ€è¦å°†åˆ†æ”¯åˆå¹¶è¿›å…¥`master`åˆ†æ”¯æ—¶ï¼Œå¹¶ä¸”æƒ³è¦é¿å…é‡å†™commit historyçš„é£é™©ï¼Œä½ åº”è¯¥é€‰æ‹©ä½¿ç”¨git merge","tags":["git"],"categories":["git"]},{"title":"æµè§ˆå™¨åŒåŸŸåè¯·æ±‚çš„æœ€å¤§å¹¶å‘æ•°é™åˆ¶","url":"/2019/09/14/æµè§ˆå™¨åŒåŸŸåè¯·æ±‚çš„æœ€å¤§å¹¶å‘æ•°é™åˆ¶/","content":"\n# æµè§ˆå™¨åŒåŸŸåè¯·æ±‚çš„æœ€å¤§å¹¶å‘æ•°é™åˆ¶\n\nå½“æˆ‘ä»¬åœ¨æµè§ˆç½‘é¡µçš„æ—¶å€™ï¼Œå¯¹æµè§ˆé€Ÿåº¦æœ‰ä¸€ä¸ªé‡è¦çš„å½±å“å› ç´ ï¼Œå°±æ˜¯æµè§ˆå™¨çš„å¹¶å‘æ•°é‡ã€‚å¹¶å‘æ•°é‡ç®€å•é€šä¿—çš„è®²å°±æ˜¯ï¼Œå½“æµè§ˆå™¨ç½‘é¡µçš„æ—¶å€™åŒæ—¶å·¥ä½œçš„è¿›è¡Œæ•°é‡ã€‚\n\nå¦‚æœåŒæ—¶åªæœ‰ 2 ä¸ªå¹¶å‘è¿æ¥æ•°æ•°é‡ï¼Œé‚£ç½‘é¡µæ‰“å¼€çš„æ—¶å€™åªèƒ½ä¾èµ–äºè¿™ 2 æ¡çº¿ç¨‹ï¼Œå‰é¢å¦‚æœæœ‰æ‰“å¼€æ…¢çš„å†…å®¹ï¼Œå°±ä¼šç›´æ¥å½±å“åˆ°åé¢çš„å†…å®¹æ‰“å¼€ã€‚ä½†æ˜¯å¦‚æœåŒæ—¶æœ‰æ›´å¤šçš„å¹¶å‘è¿æ¥æ•°ï¼Œè¿™æ ·å°±ä¼šå¤§å¤§çš„æé«˜ç½‘é¡µåŠ è½½é€Ÿåº¦ã€‚ä½†æ˜¯æµè§ˆå™¨çš„å¹¶å‘è¿æ¥æ•°ä¹Ÿå¹¶éè¶Šå¤§è¶Šå¥½ã€‚\n\nHTTP å®¢æˆ·ç«¯ä¸€èˆ¬å¯¹åŒä¸€ä¸ªæœåŠ¡å™¨çš„å¹¶å‘è¿æ¥ä¸ªæ•°éƒ½æ˜¯æœ‰é™åˆ¶çš„ã€‚å®é™…ä¸Šï¼Œæµè§ˆå™¨ç¡®å®ä½¿ç”¨å¹¶è¡Œè¿æ¥ï¼Œä½†å®ƒä»¬å°†å¹¶è¡Œè¿æ¥çš„æ€»æ•°é™åˆ¶ä¸ºå°‘é‡ï¼ˆ**é€šå¸¸ä¸ºå››ä¸ª**ï¼‰ã€‚æœåŠ¡å™¨å¯ä»¥è‡ªç”±åœ°å…³é—­æ¥è‡ªç‰¹å®šå®¢æˆ·ç«¯çš„è¿‡å¤šè¿æ¥ã€‚\n\n## ä¸»æµæµè§ˆå™¨æœ€å¤§å¹¶å‘è¿æ¥æ•°\n\nä¸€äº›ä¸»æµæµè§ˆå™¨å¯¹ HTTP 1.1 å’Œ HTTP 1.0 çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ç›®ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹è¡¨æ ¼ï¼š\n\n| æµè§ˆå™¨               | HTTP / 1.1 | HTTP / 1.0 |\n| -------------------- | ---------- | ---------- |\n| IE 11                | 6          | 6          |\n| IE 10                | 6          | 6          |\n| IE 9                 | 10         | 10         |\n| IE 8                 | 6          | 6          |\n| IE 6,7               | 2          | 4          |\n| ç«ç‹                 | 6          | 6          |\n| Safari 3,4           | 4          | 4          |\n| Chrome 4+            | 6          | 6          |\n| æ­Œå‰§ 9.63,10.00alpha | 4          | 4          |\n| Opera 10.51+         | 8          | ï¼Ÿ         |\n| iPhone 2             | 4          | ï¼Ÿ         |\n| iPhone 3             | 6          | ï¼Ÿ         |\n| iPhone 4             | 4          | ï¼Ÿ         |\n| iphone 5             | 6          | ï¼Ÿ         |\n| Android2-4           | 4          | ï¼Ÿ         |\n\n### Firefox æµè§ˆå™¨çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°\n\nåœ¨ Firefox ä¸­çš„åœ°å€æ è¾“å…¥â€œaboutï¼šconfig ä¸­â€ï¼Œç„¶åæœç´¢å¹¶ä¿®æ”¹å¦‚ä¸‹ä¸¤ä¸ªé…ç½®é¡¹ç›®å³å¯ï¼š\n\n- `network.http.max-persistent-connections-per-server:6`è¿æ¥åŒä¸€ä¸ªæœåŠ¡å™¨å…è®¸çš„æœ€å¤§æŒä¹…è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º 6ï¼Œå¯ä»¥ä¸ç”¨æ›´æ”¹ã€‚\n- `network.http.max-persistent-connections-per-proxy:8`æ¯ä¸ªä»£ç†æœåŠ¡å™¨å…è®¸çš„æœ€å¤§æŒä¹…è¿æ¥æ•°,å…¬å¸ç”¨æˆ·ä½¿ç”¨ä»£ç†æœåŠ¡å™¨ï¼Œä½†æ˜¯å¤–é¢çš„å®¢æˆ·ä¸€èˆ¬ä¸ä½¿ç”¨ä»£ç†ï¼Œç«ç‹æ¨èçš„æ¯å°ä»£ç†æœåŠ¡å™¨è®¾ç½®ä¸ºï¼š<= 10ã€‚\n\n#### Firefox3.6\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6jbxx2j6tj30fq06faa1.jpg)\n\nå’Œ IE8 çš„å‡ ä¹å®Œå…¨ä¸€æ ·ï¼š\n\n- æœ€å¤§å¹¶å‘ HTTP è¿æ¥æ•°ä¸º 6 ä¸ªï¼ˆå¯åœ¨ about:config ä¸­ä¿®æ”¹ï¼‰ã€‚\n- javascript æ–‡ä»¶ä¸ä¼šé˜»å¡å…¶ä»–èµ„æºçš„åŠ è½½ï¼Œå¤šä¸ª javascript æ–‡ä»¶å¯ä»¥ä¸€èµ·åŠ è½½ã€‚\n- ä¼šåˆ†æ HTML ç»“æ„ï¼Œä¼˜å…ˆä¸‹è½½ script å’Œ link æ ‡ç­¾å®šä¹‰çš„å¤–éƒ¨èµ„æºã€‚\n\n#### Firefox4 beta12\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6jby0whawj30fv07n3yj.jpg)\n\nä¸çŸ¥æ˜¯å› ä¸ºè®¾è®¡ç†å¿µä¸Šçš„ä¸åŒï¼Œè¿˜æ˜¯å› ä¸º beta ç‰ˆæœªç…§é¡¾åˆ°è¿™ä¸€å—ï¼ŒFirefox4 åè€Œé€€åŒ–äº†ï¼Œå’Œ Firefox3.6 çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨å¯¹èµ„æºç±»å‹çš„å¤„ç†ä¸Šï¼ŒFirefox4 ä¸å†ä¸¥æ ¼åœ°ä¼˜å…ˆä¸‹è½½ script å’Œ link æ ‡ç­¾å®šä¹‰çš„å¤–éƒ¨èµ„æºï¼Œè€Œæ˜¯æŒ‰ç…§ HTML ç»“æ„ä¸­å‡ºç°çš„é¡ºåºæ¥è¿›è¡ŒåŠ è½½ã€‚\n\n### IE æµè§ˆå™¨çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°\n\nç”¨â€œæ³¨å†Œè¡¨ç¼–è¾‘å™¨â€å‘½ä»¤æ‰“å¼€æ³¨å†Œè¡¨ç¼–è¾‘å™¨ï¼Œæ‰¾åˆ°ï¼š\n\n[HKEY_CURRRENT_USER \\ Software \\ Microsoft \\ Windows \\ CurrentVersion \\ Internet Settings]ï¼Œå¯ä»¥çœ‹åˆ°**MaxConnectionsPerServer**å’Œ**MaxConnectionsPer1_0Server**è¿™ä¸¤ä¸ªé”®ï¼ˆåˆ†åˆ«æ˜¯é’ˆå¯¹ HTTP 1.1 å’Œ HTTP 1.0 çš„è®¾ç½®ï¼‰\n\n**å¯¹äº IE 9**\n\n[HKEY_CURRRENT_USER \\ Software \\ Policies \\ Microsoft \\ Internet Exploer \\ Main \\ FeatureControlï¼Œå¯ä»¥çœ‹åˆ°**FEATURE_MAXCONNECTIONSPER1_0SERVER**å’Œ**FEATURE_MAXCONNECTIONSPERSERVER**è¿™ä¸¤ä¸ªé”®ï¼ˆåˆ†åˆ«æ˜¯é’ˆå¯¹ HTTP 1.1 å’Œ HTTP 1.0 çš„è®¾ç½®ï¼‰\n\n#### IE8\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6jbx8rdwaj30g407pweh.jpg)\n\nå’Œ IE6 å®Œå…¨ä¸åŒçš„ç€‘å¸ƒå›¾ï¼Œå…¶ç‰¹ç‚¹æœ‰ï¼š\n\n- æœ€å¤§å¹¶å‘ HTTP è¿æ¥æ•°ä¸º 6 ä¸ªã€‚\n- javascript æ–‡ä»¶å·²ç»ä¸ä¼šé˜»å¡å…¶ä»–èµ„æºçš„åŠ è½½ï¼Œç”šè‡³å¤šä¸ª javascript æ–‡ä»¶å¯ä»¥ä¸€èµ·åŠ è½½ï¼Œå¹¶ä¸”ä¼šä¿è¯æ‰§è¡Œçš„é¡ºåºã€‚\n- ä¼šåˆ†æ HTML ç»“æ„ï¼Œä¼˜å…ˆä¸‹è½½ script å’Œ link æ ‡ç­¾å®šä¹‰çš„å¤–éƒ¨èµ„æºã€‚\n\n### chrome æµè§ˆå™¨çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°\n\n#### Chrome8\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6jbzcty9xj30fw07zwef.jpg)\n\nChrome è‡ªå¸¦çš„å·¥å…·ä¸èƒ½å¾ˆæ¸…æ¥šåœ°è¡¨ç¤ºå„è¯·æ±‚çš„å¼€å§‹æ—¶é—´ï¼Œæ‰€ä»¥ä½¿ç”¨äº† Fiddler çš„ç€‘å¸ƒå›¾ï¼Œä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼ŒChrome ä¹Ÿæ˜¯æ¯”è¾ƒç‰¹ç«‹ç‹¬è¡Œçš„ä¸€ä½ï¼Œå…¶ç‰¹ç‚¹æœ‰ï¼š\n\n- æœ€å¤§å¹¶å‘ HTTP è¿æ¥æ•°ä¸º 6ã€‚\n- head éƒ¨åˆ†çš„èµ„æºä¼šå•ç‹¬ä¸‹è½½ï¼Œä¸”é˜»å¡ body ä¸­çš„å…¶ä»–èµ„æºçš„åŠ è½½ã€‚\n- ä¼šä¼˜å…ˆåŠ è½½ script å’Œ link æ ‡ç­¾å®šä¹‰çš„èµ„æºã€‚\n\n### opera æµè§ˆå™¨çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°\n\n#### Opera11\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6jbzixw3tj30fj0813yh.jpg)\n\nå…ˆæŠ¥æ€¨ä¸€ä¸‹ï¼ŒDragonfly ä¸æ€ä¹ˆå¥½ç”¨æ¥ç€â€¦â€¦Opera çš„èµ„æºåŠ è½½ä¹Ÿæ¯”è¾ƒæœ‰ç‰¹è‰²ï¼Œè€Œä¸”å¾ˆéš¾çœ‹å‡ºè§„å¾‹ï¼Œåªèƒ½å¤§è‡´æ€»ç»“ä¸€ä¸‹ï¼š\n\n- Opera çš„æœ€å¤§å¹¶å‘ HTTP è¿æ¥æ•°é»˜è®¤ä¸º 16ï¼Œå¯åœ¨ opera:config - Performance - Max Connections Server æŸ¥çœ‹å’Œä¿®æ”¹ã€‚\n- javascript æ–‡ä»¶çš„åŠ è½½ä¼šé˜»å¡å…¶ä»– script å’Œ link æ ‡ç­¾å®šä¹‰çš„å¤–éƒ¨èµ„æºçš„åŠ è½½ï¼Œå¦‚å›¾ä¸­çš„ 2.jsã€‚ä½†ä¸ä¼šé˜»å¡å›¾ç‰‡ç­‰å…¶ä»–èµ„æºçš„åŠ è½½ï¼Œå¦‚å›¾ä¸­çš„ 3.jsã€‚\n- ä¼šä¸€å®šç¨‹åº¦ä¸Šå¯¹èµ„æºçš„ä¼˜å…ˆçº§è¿›è¡Œä¼˜åŒ–ï¼Œä½†ç”±äº javascript æ–‡ä»¶è¦é˜»æ­¢åç»­éƒ¨åˆ†èµ„æºçš„åŠ è½½ï¼Œåˆä¸ºäº†å……åˆ†åˆ©ç”¨æœ€å¤§ HTTP è¿æ¥æ•°ï¼Œå› æ­¤ä¸èƒ½ä¸¥æ ¼å…ˆåŠ è½½æ‰€æœ‰çš„ script å’Œ link æ ‡ç­¾å®šä¹‰çš„èµ„æºï¼Œå¯¼è‡´ç€‘å¸ƒå›¾ä¸Šå„ç±»å‹èµ„æºæœ‰ç›¸äº’ç©¿æ’ï¼Œéš¾å¯»è§„å¾‹ã€‚\n\n## HTTP è¿æ¥è¯·æ±‚ä¸çº¿ç¨‹\n\nHTTP è¿æ¥æ˜¯å¤æ‚ï¼Œæœ‰çŠ¶æ€çš„å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒå¿…é¡»è¢«å¦¥å–„ç®¡ç†ã€‚**ä¸€ä¸ª HTTP è¿æ¥è¯·æ±‚åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚**\n\nHttpClient ä½¿ç”¨ä¸€ä¸ªå«åšçš„ Http è¿æ¥ç®¡ç†å™¨çš„ç‰¹æ®Šå®ä½“ç±»æ¥ç®¡ç†çš„ Http è¿æ¥ã€‚Http è¿æ¥ç®¡ç†å™¨åœ¨æ–°å»ºçš„ HTTP è¿æ¥æ—¶ï¼Œä½œä¸ºå·¥å‚ç±»ï¼›ç®¡ç†æŒä¹…çš„ http è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸï¼›åŒæ­¥æŒä¹…è¿æ¥ï¼ˆç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œå³ä¸€ä¸ª HTTP è¿æ¥åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼‰ã€‚\n\nå¦‚æœä¸€ä¸ªçš„ Http è¿æ¥è¢«é‡Šæ”¾æˆ–è€…è¢«å®ƒçš„æ¶ˆè´¹è€…æ˜ç¡®è¡¨ç¤ºè¦å…³é—­ï¼Œé‚£ä¹ˆåº•å±‚çš„è¿æ¥å°±ä¼šå’Œå®ƒçš„ä»£ç†è¿›è¡Œåˆ†ç¦»ï¼Œå¹¶ä¸”è¯¥è¿æ¥ä¼šè¢«äº¤è¿˜ç»™è¿æ¥ç®¡ç†å™¨ã€‚è¿™æ˜¯ï¼Œå³ä½¿æœåŠ¡æ¶ˆè´¹è€…ä»ç„¶æŒæœ‰ä»£ç†çš„å¼•ç”¨ï¼Œå®ƒä¹Ÿä¸èƒ½å†æ‰§è¡Œ I / O æ“ä½œï¼Œæˆ–è€…æ›´æ”¹çš„ Http è¿æ¥çš„çŠ¶æ€ã€‚\n\n### è¿æ¥æ± ç®¡ç†å™¨\n\nè¿æ¥æ± ç®¡ç†å™¨æ˜¯ä¸ªå¤æ‚çš„ç±»ï¼Œå®ƒç®¡ç†ç€è¿æ¥æ± ï¼Œå¯ä»¥åŒæ—¶ä¸ºå¾ˆå¤šçº¿ç¨‹æä¾› HTTP è¿æ¥è¯·æ±‚ã€‚å½“è¯·æ±‚ä¸€ä¸ªæ–°çš„è¿æ¥æ—¶ï¼Œå¦‚æœè¿æ¥æ± æœ‰æœ‰å¯ç”¨çš„æŒä¹…è¿æ¥ï¼Œè¿æ¥ç®¡ç†å™¨å°±ä¼šä½¿ç”¨å…¶ä¸­çš„ä¸€ä¸ªï¼Œè€Œä¸æ˜¯å†åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ã€‚\n\nå½“ä½¿ç”¨äº†è¯·æ±‚è¿æ¥æ± ç®¡ç†å™¨åï¼ŒHttpClient çš„å°±å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªçº¿ç¨‹çš„è¯·æ±‚äº†ã€‚\n\nè¿æ¥æ± ç®¡ç†å™¨ä¼šæ ¹æ®å®ƒçš„é…ç½®æ¥åˆ†é…è¯·æ±‚è¿æ¥ã€‚å¦‚æœè¿æ¥æ± ä¸­çš„æ‰€æœ‰è¿æ¥éƒ½è¢«å ç”¨äº†ï¼Œé‚£ä¹ˆåç»­çš„è¯·æ±‚å°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æœ‰è¿æ¥è¢«é‡Šæ”¾å›è¿æ¥æ± ä¸­ã€‚\n\n### çº¿ç¨‹æ± çš„åŸç†\n\nçº¿ç¨‹æ± çš„åŸç†å¾ˆç®€å•ï¼Œç±»ä¼¼äºæ“ä½œç³»ç»Ÿä¸­çš„ç¼“å†²åŒºçš„æ¦‚å¿µï¼Œå®ƒçš„æµç¨‹å¦‚ä¸‹ï¼š\n\nçº¿ç¨‹æ± åœ¨è¿˜æ²¡æœ‰ä»»åŠ¡åˆ°æ¥ä¹‹å‰ï¼Œåˆ›å»ºä¸€å®šæ•°é‡çš„çº¿ç¨‹ï¼Œæ”¾å…¥ç©ºé—²é˜Ÿåˆ—ä¸­ã€‚è¿™äº›çº¿ç¨‹éƒ½æ˜¯å¤„äºç¡çœ çŠ¶æ€ï¼Œå³å‡ä¸ºå¯åŠ¨ï¼Œä¸æ¶ˆè€— CPUï¼Œè€Œåªæ˜¯å ç”¨è¾ƒå°çš„å†…å­˜ç©ºé—´ã€‚å½“å®¢æˆ·ç«¯æœ‰ä¸€ä¸ªæ–°è¯·æ±‚æ—¶ï¼Œå°±ä¼šå”¤é†’çº¿ç¨‹æ± ä¸­çš„æŸä¸€ä¸ªç¡çœ çº¿ç¨‹ï¼Œè®©å®ƒæ¥å¤„ç†å®¢æˆ·ç«¯çš„è¿™ä¸ªè¯·æ±‚ï¼Œå½“å¤„ç†å®Œè¿™ä¸ªè¯·æ±‚åï¼Œçº¿ç¨‹åˆå¤„äºç¡çœ çŠ¶æ€ã€‚\n\nçº¿ç¨‹æ± èƒ½èŠ‚çº¦å¤§é‡çš„çš„ç³»ç»Ÿèµ„æºï¼Œä½¿å¾—æ›´å¤šçš„ CPU æ—¶é—´å’Œå†…å­˜ç”¨æ¥å¤„ç†å®é™…çš„å•†ä¸šåº”ç”¨ï¼Œè€Œä¸æ˜¯é¢‘ç¹çš„çº¿ç¨‹åˆ›å»ºä¸é”€æ¯\n\næ¯ä¸ªçº¿ç¨‹éœ€è¦å¤§çº¦ 1MB å†…å­˜ï¼Œçº¿ç¨‹å¼€çš„è¶Šå¤šï¼Œæ¶ˆè€—çš„å†…å­˜ä¹Ÿå°±è¶Šå¤§ã€‚\n\nåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨çº¿ç¨‹æ± ï¼š\n\n1. å•ä¸ªä»»åŠ¡å¤„ç†çš„æ—¶é—´æ¯”è¾ƒçŸ­\n2. å°†éœ€å¤„ç†çš„ä»»åŠ¡çš„æ•°é‡å¤§\n\n### æ•°æ®åº“è¿æ¥æ± \n\næ•°æ®åº“è¿æ¥æ± çš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶å»ºç«‹è¶³å¤Ÿçš„æ•°æ®åº“è¿æ¥ï¼Œå¹¶è®²è¿™äº›è¿æ¥ç»„æˆä¸€ä¸ªè¿æ¥æ± ï¼ˆç®€å•è¯´ï¼šåœ¨ä¸€ä¸ªâ€œæ± â€é‡Œæ”¾äº†å¥½å¤šåŠæˆå“çš„æ•°æ®åº“è”æ¥å¯¹è±¡ï¼‰ï¼Œç”±åº”ç”¨ç¨‹åºåŠ¨æ€åœ°å¯¹æ± ä¸­çš„è¿æ¥è¿›è¡Œç”³è¯·ï¼Œä½¿ç”¨å’Œé‡Šæ”¾ã€‚å¯¹äºå¤šäºè¿æ¥æ± ä¸­è¿æ¥æ•°çš„å¹¶å‘è¯·æ±‚ï¼Œåº”è¯¥åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…ã€‚å¹¶ä¸”åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®æ± ä¸­è¿æ¥çš„ä½¿ç”¨ç‡ï¼ŒåŠ¨æ€å¢åŠ æˆ–å‡å°‘æ± ä¸­çš„è¿æ¥æ•°ã€‚\nè¿æ¥æ± æŠ€æœ¯å°½å¯èƒ½å¤šåœ°é‡ç”¨äº†æ¶ˆè€—å†…å­˜åœ°èµ„æºï¼Œå¤§å¤§èŠ‚çœäº†å†…å­˜ï¼Œæé«˜äº†æœåŠ¡å™¨åœ°æœåŠ¡æ•ˆç‡ï¼Œèƒ½å¤Ÿæ”¯æŒæ›´å¤šçš„å®¢æˆ·æœåŠ¡ã€‚é€šè¿‡ä½¿ç”¨è¿æ¥æ± ï¼Œå°†å¤§å¤§æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å…¶è‡ªèº«çš„ç®¡ç†æœºåˆ¶æ¥ç›‘è§†æ•°æ®åº“è¿æ¥çš„æ•°é‡ï¼Œä½¿ç”¨æƒ…å†µç­‰ã€‚\n\n1ï¼‰æœ€å°è¿æ¥æ•°æ˜¯è¿æ¥æ± ä¸€ç›´ä¿æŒçš„æ•°æ®åº“è¿æ¥ï¼Œæ‰€ä»¥å¦‚æœåº”ç”¨ç¨‹åºå¯¹æ•°æ®åº“è¿æ¥çš„ä½¿ç”¨é‡ä¸å¤§ï¼Œå°†ä¼šæœ‰å¤§é‡çš„æ•°æ®åº“è¿æ¥èµ„æºè¢«æµªè´¹;\n2ï¼‰æœ€å¤§è¿æ¥æ•°æ˜¯è¿æ¥æ± èƒ½ç”³è¯·çš„æœ€å¤§è¿æ¥æ•°ï¼Œå¦‚æœæ•°æ®åº“è¿æ¥è¯·æ±‚è¶…è¿‡æ­¤æ•°ï¼Œåé¢çš„æ•°æ®åº“è¿æ¥è¯·æ±‚å°†è¢«åŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œè¿™ä¼šå½±å“ä¹‹åçš„æ•°æ®åº“æ“ä½œã€‚\n\n**æ•°æ®åº“è¿æ¥æ˜¯ä¸€ç§å…³é”®çš„æœ‰é™çš„æ˜‚è´µçš„èµ„æºï¼Œè¿™ä¸€ç‚¹åœ¨å¤šç”¨æˆ·çš„ç½‘é¡µåº”ç”¨ç¨‹åºä¸­ä½“ç°å¾—å°¤ä¸ºçªå‡ºã€‚**ä¸€ä¸ªæ•°æ®åº“è¿æ¥å¯¹è±¡å‡å¯¹åº”ä¸€ä¸ªç‰©ç†æ•°æ®åº“è¿æ¥ï¼Œæ¯æ¬¡æ“ä½œéƒ½æ‰“å¼€ä¸€ä¸ªç‰©ç†è¿æ¥ï¼Œä½¿ç”¨å®Œéƒ½å…³é—­è¿æ¥ï¼Œè¿™æ ·é€ æˆç³»ç»Ÿçš„æ€§èƒ½ä½ä¸‹ã€‚\n\n### WebSphere Application Server æ€§èƒ½\n\nhttp://websphere.sys-con.com/node/46514/print\n\næ„å»ºæœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªè¿‡äºç®€å•çš„æ¨¡å‹æ˜¯ï¼šæ¯å½“ä¸€ä¸ªè¯·æ±‚åˆ°è¾¾å°±åˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡å¯¹è±¡ï¼Œç„¶ååœ¨æ–°çš„æœåŠ¡å¯¹è±¡ä¸­ä¸ºæœåŠ¡è¯·æ±‚ï¼Œä½†å½“æœ‰å¤§é‡è¯·æ±‚å¹¶å‘è®¿é—®æ—¶ï¼ŒæœåŠ¡å™¨ä¸æ–­çš„åˆ›å»ºå’Œé”€æ¯å¯¹è±¡çš„å¼€é”€å¾ˆå¤§ã€‚\n\nåœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ä¸­ï¼Œåˆ›å»ºå’Œé”€æ¯å¯¹è±¡æ˜¯å¾ˆæµªè´¹èµ„æºçš„ï¼Œå› ä¸ºåˆ›å»ºä¸€ä¸ªå¯¹è±¡è¦è·å–å†…å­˜èµ„æºæˆ–è€…å…¶å®ƒæ›´å¤šèµ„æºã€‚åœ¨ Java çš„ä¸­æ›´æ˜¯å¦‚æ­¤ï¼Œè™šæ‹Ÿæœºè¯•å›¾è·Ÿè¸ªæ¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨å¯¹è±¡é”€æ¯åè¿›è¡Œåƒåœ¾å›æ”¶ã€‚æ‰€ä»¥ï¼Œæé«˜ç¨‹åºæ•ˆç‡çš„ä¸€ä¸ªæ‰‹æ®µå°±æ˜¯å°½å¯èƒ½å‡å°‘åˆ›å»ºå’Œé”€æ¯å¯¹è±¡çš„æ¬¡æ•°ã€‚åˆ©ç”¨å·²æœ‰çš„å¯¹è±¡æ¥æœåŠ¡å°±æ˜¯â€œæ± åŒ–èµ„æºâ€æŠ€æœ¯äº§ç”Ÿçš„åŸå› ã€‚\n\n**HTTP ä¾¦å¬å™¨**\nHTTP ä¾¦å¬å™¨è´Ÿè´£åœ¨ HTTP æœåŠ¡å™¨çº§åˆ«åˆ›å»ºçº¿ç¨‹ã€‚è¿™é‡Œå‘ç”Ÿçš„å¤§å¤šæ•°å¤„ç†æ˜¯é™æ€é¡µé¢æœåŠ¡ï¼Œæˆ– HTTP post / GET ä¼ é€’å‘½ä»¤åˆ°åç«¯ã€‚è¿™æ˜¯å¿…é¡»è€ƒè™‘çš„ç¬¬ä¸€çº§çº¿ç¨‹é…ç½®ã€‚\n\n**Web å®¹å™¨**\nWeb å®¹å™¨è´Ÿè´£åœ¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨çº§åˆ«åˆ›å»ºçº¿ç¨‹æ± ã€‚æ­¤çº§åˆ«çš„å¤§å¤šæ•°å¤„ç†åŒ…æ‹¬ servletï¼ŒJSPï¼ŒEJBï¼ŒåŠ¨æ€é¡µé¢åˆ›å»ºå’Œåç«¯ä¼ é€’å¤„ç†ã€‚Web å®¹å™¨æ˜¯å¿…é¡»é…ç½®çš„ç¬¬äºŒçº§çº¿ç¨‹æ± é…ç½®ã€‚\n\n**ORB å®¹å™¨** ORB å®¹å™¨è´Ÿè´£åœ¨å¯¹è±¡çº§åˆ›å»ºçº¿ç¨‹æ± ã€‚è¿™é‡Œå‘ç”Ÿçš„å¤§éƒ¨åˆ†å¤„ç†åŒ…æ‹¬å¤„ç†åŸºäºé Web çš„å®¢æˆ·ç«¯ã€‚ORB å®¹å™¨æ˜¯å¿…é¡»é…ç½®çš„çº¿ç¨‹æ± é…ç½®çš„ç¬¬ä¸‰çº§ã€‚\n\n**æ•°æ®æº**\næ•°æ®æºçº§è´Ÿè´£åˆ›å»ºä»æ•°æ®åº“æˆ–â€œä¼ ç»Ÿâ€ç³»ç»Ÿè®¿é—®çš„è¿æ¥çº¿ç¨‹ã€‚è¿™äº›çº¿ç¨‹æ˜¯å¿…é¡»è§£å†³çš„ç¬¬å››çº§é…ç½®\n\n### WAS çº¿ç¨‹æ± æ•°ä¸ IHS server\n\nå‡å®šä¸€ä¸ªæµè§ˆå™¨çš„å¹¶å‘è¿æ¥è¯·æ±‚æ•°ä¸º 10ï¼Œé€šå¸¸åŒä¸€æ—¶é—´å†…ä¼šæœ‰å¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®ç½‘ç«™ã€‚åˆè€ƒè™‘åˆ°ï¼Œä¸€ä¸ª Http è¿æ¥è¯·æ±‚åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚æ‰€ä»¥ï¼ŒIHS æœåŠ¡å™¨çš„ httpd.conf é‡Œçš„ maxclientsï¼ˆå…è®¸å»ºç«‹çš„æ€»çº¿ç¨‹æ•°ï¼‰è¦èƒ½å¤Ÿå¤„ç†å³°å€¼æ—¶åˆ»çš„æµè§ˆå™¨è¿æ¥è¯·æ±‚æ‰è¡Œã€‚åŒæ—¶ï¼Œè€ƒè™‘ä¸æ˜¯æ‰€æœ‰çš„è¿æ¥è¯·æ±‚éƒ½ä¼šåˆ° was serverï¼Œæœ‰çš„è¿æ¥åªæ˜¯ä¸ºäº†åœ¨ web æœåŠ¡å™¨ä¸Šå–é™æ€èµ„æºï¼Œæ‰€ä»¥ï¼Œwas ä¸Šçš„çº¿ç¨‹æ± æ•°ç›®ï¼ˆThread pools ï¼š50 ï¼‰ä¼šè¿œå°äº IHS server ä¸Šçš„ maxclients å€¼è­¬å¦‚ 400ï¼‰ã€‚\n","tags":["æµè§ˆå™¨"],"categories":["æµè§ˆå™¨"]},{"title":"å‰ç«¯ä¼˜åŒ–","url":"/2019/09/08/å‰ç«¯ä¼˜åŒ–/","content":"\n# å‰ç«¯ä¼˜åŒ–\n\n## å‰ç«¯æ€§èƒ½è¡¡é‡æŒ‡æ ‡\n\n- **ç™½å±æ—¶é—´** è¯¥æ—¶é—´ç‚¹è¡¨ç¤ºæµè§ˆå™¨å¼€å§‹ç»˜åˆ¶é¡µé¢ï¼Œåœ¨æ­¤ä¹‹å‰é¡µé¢éƒ½æ˜¯ç™½å±ï¼Œä¹Ÿç§°ä¸ºå¼€å§‹æ¸²æŸ“æ—¶é—´\n- **é¦–å±æ—¶é—´** è¯¥æ—¶é—´ç‚¹è¡¨ç¤ºç”¨æˆ·çœ‹åˆ°ç¬¬ä¸€å±é¡µé¢çš„æ—¶é—´\n- **ç”¨æˆ·å¯äº¤äº’æ—¶é—´** ä¹Ÿå« DOM Ready,è¯¥æ—¶é—´ç‚¹è¡¨ç¤º DOM è§£æå®Œæˆï¼Œèµ„æºè¿˜æ²¡æœ‰å®Œæˆï¼Œè¿™ä¸ªæ—¶å€™ç”¨æˆ·ä¸é¡µé¢å¯ä»¥äº¤äº’äº†\n- **å®Œå…¨åŠ è½½æ—¶é—´** è¯¥æ—¶é—´ç‚¹æ˜¯ window.onload æ—¶é—´è§¦å‘çš„æ—¶é—´ï¼Œè¡¨ç¤ºåŸå§‹æ–‡æ¡£å’Œæ‰€ç”¨å¼•ç”¨çš„å†…å®¹å·²ç»åŠ è½½å®Œæˆï¼Œç”¨æˆ·æœ€æ˜æ˜¾çš„æ„Ÿè§‰å°±æ˜¯æµè§ˆå™¨ tab ä¸Š loading çŠ¶æ€ç»“æŸ\n- **é¦–å­—èŠ‚æ—¶é—´ï¼ˆTTFBï¼‰** ç¬¬ä¸€å­—èŠ‚å“åº”æ—¶é—´ï¼ˆTTFBï¼‰=å‘é€è¯·æ±‚åˆ° WEB æœåŠ¡å™¨çš„æ—¶é—´+WEB æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶ç”Ÿæˆå“åº”èŠ±è´¹çš„æ—¶é—´+WEB æœåŠ¡å™¨ç”Ÿæˆå“åº”åˆ°æµè§ˆå™¨èŠ±è´¹çš„æ—¶é—´\n- **DNS è§£ææ—¶é—´**\n- **TCP è¿æ¥æ—¶é—´**\n- **HTTP è¯·æ±‚æ—¶é—´**\n- **HTTP å“åº”æ—¶é—´**\n\n## ä¼˜åŒ–åŸåˆ™\n\né›…è™ 14 æ¡ä¼˜åŒ–åŸåˆ™ï¼š\n\n1. å°½å¯èƒ½çš„å‡å°‘ HTTP çš„è¯·æ±‚æ•° content\n\n2. ä½¿ç”¨ CDNï¼ˆContent Delivery Networkï¼‰ server\n3. æ·»åŠ  Expires å¤´(æˆ–è€… Cache-control ) server\n4. Gzip ç»„ä»¶ server\n5. å°† CSS æ ·å¼æ”¾åœ¨é¡µé¢çš„ä¸Šæ–¹ css\n6. å°†è„šæœ¬ç§»åŠ¨åˆ°åº•éƒ¨ï¼ˆåŒ…æ‹¬å†…è”çš„ï¼‰ javascript\n7. é¿å…ä½¿ç”¨ CSS ä¸­çš„ Expressions css\n8. å°† JavaScript å’Œ CSS ç‹¬ç«‹æˆå¤–éƒ¨æ–‡ä»¶ javascript css\n9. å‡å°‘ DNS æŸ¥è¯¢ content\n10. å‹ç¼© JavaScript å’Œ CSS (åŒ…æ‹¬å†…è”çš„) javascript css\n11. é¿å…é‡å®šå‘ server\n12. ç§»é™¤é‡å¤çš„è„šæœ¬ javascript\n13. é…ç½®å®ä½“æ ‡ç­¾ï¼ˆETagsï¼‰ css\n14. ä½¿ AJAX ç¼“å­˜\n\n| ä¼˜åŒ–æ–¹å‘ | ä¼˜åŒ–æ‰‹æ®µ                                                                                        |\n| -------- | ----------------------------------------------------------------------------------------------- |\n| è¯·æ±‚æ•°é‡ | åˆå¹¶è„šæœ¬å’Œæ ·å¼è¡¨ï¼ŒCSS Spritesï¼Œæ‹†åˆ†åˆå§‹åŒ–è´Ÿè½½ï¼Œåˆ’åˆ†ä¸»åŸŸï¼Œå­—ä½“å›¾æ ‡ï¼Œé›ªç¢§å›¾ç‰‡ç­‰                   |\n| è¯·æ±‚å¸¦å®½ | å¼€å¯æœåŠ¡å™¨ GZipï¼Œç²¾ç®€ JavaScriptï¼Œç§»é™¤é‡å¤è„šæœ¬ï¼Œå›¾åƒä¼˜åŒ–ï¼ˆåŒ…æ‹¬å›¾ç‰‡å¤§å° kbï¼‰                     |\n| ç¼“å­˜åˆ©ç”¨ | ä½¿ç”¨ CDNï¼Œä½¿ç”¨å¤–éƒ¨ JavaScript å’Œ CSSï¼Œæ·»åŠ  Expires å¤´ï¼Œå‡å°‘ DNS æŸ¥æ‰¾ï¼Œé…ç½® ETagï¼Œä½¿ AjaX å¯ç¼“å­˜ |\n| é¡µé¢ç»“æ„ | å°†æ ·å¼è¡¨æ”¾åœ¨é¡¶éƒ¨ï¼Œå°†è„šæœ¬æ”¾åœ¨åº•éƒ¨ï¼Œå°½æ—©åˆ·æ–°æ–‡æ¡£çš„è¾“å‡º                                            |\n| ä»£ç æ ¡éªŒ | é¿å… CSS è¡¨è¾¾å¼ï¼Œé¿å…é‡å®šå‘                                                                     |\n\n## ç½‘ç»œç›¸å…³\n\n### DNS é¢„è§£æ\n\nDNS è§£æä¹Ÿæ˜¯éœ€è¦æ—¶é—´çš„ï¼Œå¯ä»¥é€šè¿‡é¢„è§£æçš„æ–¹å¼æ¥é¢„å…ˆè·å¾—åŸŸåæ‰€å¯¹åº”çš„ IPã€‚\n\n```html\n<link rel=\"dns-prefetch\" href=\"//yuchengkai.cn\" />\n```\n\n### åˆ©ç”¨ç¼“å­˜\n\nç¼“å­˜å¯¹äºå‰ç«¯æ€§èƒ½ä¼˜åŒ–æ¥è¯´æ˜¯ä¸ªå¾ˆé‡è¦çš„ç‚¹ï¼Œè‰¯å¥½çš„ç¼“å­˜ç­–ç•¥å¯ä»¥é™ä½èµ„æºçš„é‡å¤åŠ è½½æé«˜ç½‘é¡µçš„æ•´ä½“åŠ è½½é€Ÿåº¦ã€‚\n\né€šå¸¸æµè§ˆå™¨ç¼“å­˜ç­–ç•¥åˆ†ä¸ºä¸¤ç§ï¼šå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜\n\n#### é€‰æ‹©åˆé€‚çš„ç¼“å­˜ç­–ç•¥\n\nå¯¹äºå¤§éƒ¨åˆ†çš„åœºæ™¯éƒ½å¯ä»¥ä½¿ç”¨å¼ºç¼“å­˜é…åˆåå•†ç¼“å­˜è§£å†³ï¼Œä½†æ˜¯åœ¨ä¸€äº›ç‰¹æ®Šçš„åœ°æ–¹å¯èƒ½éœ€è¦é€‰æ‹©ç‰¹æ®Šçš„ç¼“å­˜ç­–ç•¥\n\n- å¯¹äºæŸäº›ä¸éœ€è¦ç¼“å­˜çš„èµ„æºï¼Œå¯ä»¥ä½¿ç”¨ `Cache-control: no-store` ï¼Œè¡¨ç¤ºè¯¥èµ„æºä¸éœ€è¦ç¼“å­˜\n- å¯¹äºé¢‘ç¹å˜åŠ¨çš„èµ„æºï¼Œå¯ä»¥ä½¿ç”¨ `Cache-Control: no-cache` å¹¶é…åˆ `ETag` ä½¿ç”¨ï¼Œè¡¨ç¤ºè¯¥èµ„æºå·²è¢«ç¼“å­˜ï¼Œä½†æ˜¯æ¯æ¬¡éƒ½ä¼šå‘é€è¯·æ±‚è¯¢é—®èµ„æºæ˜¯å¦æ›´æ–°ã€‚\n- å¯¹äºä»£ç æ–‡ä»¶æ¥è¯´ï¼Œé€šå¸¸ä½¿ç”¨ `Cache-Control: max-age=31536000` å¹¶é…åˆç­–ç•¥ç¼“å­˜ä½¿ç”¨ï¼Œç„¶åå¯¹æ–‡ä»¶è¿›è¡ŒæŒ‡çº¹å¤„ç†ï¼Œä¸€æ—¦æ–‡ä»¶åå˜åŠ¨å°±ä¼šç«‹åˆ»ä¸‹è½½æ–°çš„æ–‡ä»¶ã€‚\n\n### ä½¿ç”¨ HTTP / 2.0\n\nå› ä¸ºæµè§ˆå™¨ä¼šæœ‰å¹¶å‘è¯·æ±‚é™åˆ¶ï¼Œåœ¨ HTTP / 1.1 æ—¶ä»£ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦å»ºç«‹å’Œæ–­å¼€ï¼Œæ¶ˆè€—äº†å¥½å‡ ä¸ª RTT æ—¶é—´ï¼Œå¹¶ä¸”ç”±äº TCP æ…¢å¯åŠ¨çš„åŸå› ï¼ŒåŠ è½½ä½“ç§¯å¤§çš„æ–‡ä»¶ä¼šéœ€è¦æ›´å¤šçš„æ—¶é—´ã€‚\n\nåœ¨ HTTP / 2.0 ä¸­å¼•å…¥äº†å¤šè·¯å¤ç”¨ï¼Œèƒ½å¤Ÿè®©å¤šä¸ªè¯·æ±‚ä½¿ç”¨åŒä¸€ä¸ª TCP é“¾æ¥ï¼Œæå¤§çš„åŠ å¿«äº†ç½‘é¡µçš„åŠ è½½é€Ÿåº¦ã€‚å¹¶ä¸”è¿˜æ”¯æŒ Header å‹ç¼©ï¼Œè¿›ä¸€æ­¥çš„å‡å°‘äº†è¯·æ±‚çš„æ•°æ®å¤§å°ã€‚\n\n### é¢„åŠ è½½&æ‡’åŠ è½½\n\n#### é¢„åŠ è½½\n\nåœ¨å¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µã€‚æœ‰äº›èµ„æºä¸éœ€è¦é©¬ä¸Šç”¨åˆ°ï¼Œä½†æ˜¯å¸Œæœ›å°½æ—©è·å–ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨é¢„åŠ è½½ã€‚\n\né¢„åŠ è½½å…¶å®æ˜¯å£°æ˜å¼çš„ `fetch` ï¼Œå¼ºåˆ¶æµè§ˆå™¨è¯·æ±‚èµ„æºï¼Œå¹¶ä¸”ä¸ä¼šé˜»å¡ `onload` äº‹ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç å¼€å¯é¢„åŠ è½½\n\n```html\n<link rel=\"preload\" href=\"http://example.com\" />\n```\n\né¢„åŠ è½½å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé™ä½é¦–å±çš„åŠ è½½æ—¶é—´ï¼Œå› ä¸ºå¯ä»¥å°†ä¸€äº›ä¸å½±å“é¦–å±ä½†é‡è¦çš„æ–‡ä»¶å»¶ååŠ è½½ï¼Œå”¯ä¸€ç¼ºç‚¹å°±æ˜¯å…¼å®¹æ€§ä¸å¥½ã€‚\n\n#### é¢„æ¸²æŸ“\n\nå¯ä»¥é€šè¿‡é¢„æ¸²æŸ“å°†ä¸‹è½½çš„æ–‡ä»¶é¢„å…ˆåœ¨åå°æ¸²æŸ“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç å¼€å¯é¢„æ¸²æŸ“\n\n```html\n<link rel=\"prerender\" href=\"http://example.com\" />\n```\n\né¢„æ¸²æŸ“è™½ç„¶å¯ä»¥æé«˜é¡µé¢çš„åŠ è½½é€Ÿåº¦ï¼Œä½†æ˜¯è¦ç¡®ä¿è¯¥é¡µé¢ç™¾åˆ†ç™¾ä¼šè¢«ç”¨æˆ·åœ¨ä¹‹åæ‰“å¼€ï¼Œå¦åˆ™å°±ç™½ç™½æµªè´¹èµ„æºå»æ¸²æŸ“ã€‚\n\n#### æ‡’æ‰§è¡Œ\n\næ‡’æ‰§è¡Œå°±æ˜¯å°†æŸäº›é€»è¾‘å»¶è¿Ÿåˆ°ä½¿ç”¨æ—¶å†è®¡ç®—ã€‚è¯¥æŠ€æœ¯å¯ä»¥ç”¨äºé¦–å±ä¼˜åŒ–ï¼Œå¯¹äºæŸäº›è€—æ—¶é€»è¾‘å¹¶ä¸éœ€è¦åœ¨é¦–å±å°±ä½¿ç”¨çš„ï¼Œå°±å¯ä»¥ä½¿ç”¨æ‡’æ‰§è¡Œã€‚æ‡’æ‰§è¡Œéœ€è¦å”¤é†’ï¼Œä¸€èˆ¬å¯ä»¥é€šè¿‡å®šæ—¶å™¨æˆ–è€…äº‹ä»¶çš„è°ƒç”¨æ¥å”¤é†’ã€‚\n\n#### æ‡’åŠ è½½\n\næ‡’åŠ è½½å°±æ˜¯å°†ä¸å…³é”®çš„èµ„æºå»¶ååŠ è½½ã€‚\n\næ‡’åŠ è½½çš„åŸç†å°±æ˜¯åªåŠ è½½è‡ªå®šä¹‰åŒºåŸŸï¼ˆé€šå¸¸æ˜¯å¯è§†åŒºåŸŸï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯å³å°†è¿›å…¥å¯è§†åŒºåŸŸï¼‰å†…éœ€è¦åŠ è½½çš„ä¸œè¥¿ã€‚å¯¹äºå›¾ç‰‡æ¥è¯´ï¼Œå…ˆè®¾ç½®å›¾ç‰‡æ ‡ç­¾çš„ `src` å±æ€§ä¸ºä¸€å¼ å ä½å›¾ï¼Œå°†çœŸå®çš„å›¾ç‰‡èµ„æºæ”¾å…¥ä¸€ä¸ªè‡ªå®šä¹‰å±æ€§ä¸­ï¼Œå½“è¿›å…¥è‡ªå®šä¹‰åŒºåŸŸæ—¶ï¼Œå°±å°†è‡ªå®šä¹‰å±æ€§æ›¿æ¢ä¸º `src` å±æ€§ï¼Œè¿™æ ·å›¾ç‰‡å°±ä¼šå»ä¸‹è½½èµ„æºï¼Œå®ç°äº†å›¾ç‰‡æ‡’åŠ è½½ã€‚\n\næ‡’åŠ è½½ä¸ä»…å¯ä»¥ç”¨äºå›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨åˆ«çš„èµ„æºä¸Šã€‚æ¯”å¦‚è¿›å…¥å¯è§†åŒºåŸŸæ‰å¼€å§‹æ’­æ”¾è§†é¢‘ç­‰ç­‰ã€‚\n\n## æ–‡ä»¶ä¼˜åŒ–\n\n### å›¾ç‰‡ä¼˜åŒ–\n\n#### å›¾ç‰‡å¤§å°è®¡ç®—\n\nåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸€å¼ å›¾ç‰‡å¯èƒ½å¹¶ä¸éœ€è¦ä½¿ç”¨é‚£ä¹ˆå¤šé¢œè‰²å»æ˜¾ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‡å°‘æ¯ä¸ªåƒç´ çš„è°ƒè‰²æ¿æ¥ç›¸åº”ç¼©å°å›¾ç‰‡çš„å¤§å°ã€‚\n\näº†è§£äº†å¦‚ä½•è®¡ç®—å›¾ç‰‡å¤§å°çš„çŸ¥è¯†ï¼Œé‚£ä¹ˆå¯¹äºå¦‚ä½•ä¼˜åŒ–å›¾ç‰‡ï¼Œæƒ³å¿…å¤§å®¶å·²ç»æœ‰ 2 ä¸ªæ€è·¯äº†ï¼š\n\n- å‡å°‘åƒç´ ç‚¹\n- å‡å°‘æ¯ä¸ªåƒç´ ç‚¹èƒ½å¤Ÿæ˜¾ç¤ºçš„é¢œè‰²\n\n#### å›¾ç‰‡åŠ è½½ä¼˜åŒ–\n\n1. ä¸ç”¨å›¾ç‰‡ã€‚å¾ˆå¤šæ—¶å€™ä¼šä½¿ç”¨åˆ°å¾ˆå¤šä¿®é¥°ç±»å›¾ç‰‡ï¼Œå…¶å®è¿™ç±»ä¿®é¥°å›¾ç‰‡å®Œå…¨å¯ä»¥ç”¨ CSS å»ä»£æ›¿ã€‚\n2. å¯¹äºç§»åŠ¨ç«¯æ¥è¯´ï¼Œå±å¹•å®½åº¦å°±é‚£ä¹ˆç‚¹ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦å»åŠ è½½åŸå›¾æµªè´¹å¸¦å®½ã€‚ä¸€èˆ¬å›¾ç‰‡éƒ½ç”¨ CDN åŠ è½½ï¼Œå¯ä»¥è®¡ç®—å‡ºé€‚é…å±å¹•çš„å®½åº¦ï¼Œç„¶åå»è¯·æ±‚ç›¸åº”è£å‰ªå¥½çš„å›¾ç‰‡ã€‚\n3. å°å›¾ä½¿ç”¨ base64 æ ¼å¼\n4. å°†å¤šä¸ªå›¾æ ‡æ–‡ä»¶æ•´åˆåˆ°ä¸€å¼ å›¾ç‰‡ä¸­ï¼ˆé›ªç¢§å›¾ï¼‰\n5. é€‰æ‹©æ­£ç¡®çš„å›¾ç‰‡æ ¼å¼ï¼š\n   - å¯¹äºèƒ½å¤Ÿæ˜¾ç¤º WebP æ ¼å¼çš„æµè§ˆå™¨å°½é‡ä½¿ç”¨ WebP æ ¼å¼ã€‚å› ä¸º WebP æ ¼å¼å…·æœ‰æ›´å¥½çš„å›¾åƒæ•°æ®å‹ç¼©ç®—æ³•ï¼Œèƒ½å¸¦æ¥æ›´å°çš„å›¾ç‰‡ä½“ç§¯ï¼Œè€Œä¸”æ‹¥æœ‰è‚‰çœ¼è¯†åˆ«æ— å·®å¼‚çš„å›¾åƒè´¨é‡ï¼Œç¼ºç‚¹å°±æ˜¯å…¼å®¹æ€§å¹¶ä¸å¥½\n   - å°å›¾ä½¿ç”¨ PNGï¼Œå…¶å®å¯¹äºå¤§éƒ¨åˆ†å›¾æ ‡è¿™ç±»å›¾ç‰‡ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨ SVG ä»£æ›¿\n   - ç…§ç‰‡ä½¿ç”¨ JPEG\n\n### å…¶ä»–æ–‡ä»¶ä¼˜åŒ–\n\n- CSS æ–‡ä»¶æ”¾åœ¨ `head` ä¸­\n- æœåŠ¡ç«¯å¼€å¯æ–‡ä»¶å‹ç¼©åŠŸèƒ½\n- å°† `script` æ ‡ç­¾æ”¾åœ¨ `body` åº•éƒ¨ï¼Œå› ä¸º JS æ–‡ä»¶æ‰§è¡Œä¼šé˜»å¡æ¸²æŸ“ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æŠŠ `script` æ ‡ç­¾æ”¾åœ¨ä»»æ„ä½ç½®ç„¶ååŠ ä¸Š `defer` ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶ä¼šå¹¶è¡Œä¸‹è½½ï¼Œä½†æ˜¯ä¼šæ”¾åˆ° HTML è§£æå®Œæˆåé¡ºåºæ‰§è¡Œã€‚å¯¹äºæ²¡æœ‰ä»»ä½•ä¾èµ–çš„ JS æ–‡ä»¶å¯ä»¥åŠ ä¸Š `async` ï¼Œè¡¨ç¤ºåŠ è½½å’Œæ¸²æŸ“åç»­æ–‡æ¡£å…ƒç´ çš„è¿‡ç¨‹å°†å’Œ JS æ–‡ä»¶çš„åŠ è½½ä¸æ‰§è¡Œå¹¶è¡Œæ— åºè¿›è¡Œã€‚\n- æ‰§è¡Œ JS ä»£ç è¿‡é•¿ä¼šå¡ä½æ¸²æŸ“ï¼Œå¯¹äºéœ€è¦å¾ˆå¤šæ—¶é—´è®¡ç®—çš„ä»£ç å¯ä»¥è€ƒè™‘ä½¿ç”¨ `Webworker`ã€‚`Webworker` å¯ä»¥è®©æˆ‘ä»¬å¦å¼€ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè„šæœ¬è€Œä¸å½±å“æ¸²æŸ“ã€‚\n\n### CDN\n\n> CDN çš„å…¨ç§°æ˜¯ Content Delivery Networkï¼Œå³å†…å®¹åˆ†å‘ç½‘ç»œã€‚CDN æ˜¯æ„å»ºåœ¨ç½‘ç»œä¹‹ä¸Šçš„å†…å®¹åˆ†å‘ç½‘ç»œï¼Œä¾é éƒ¨ç½²åœ¨å„åœ°çš„è¾¹ç¼˜æœåŠ¡å™¨ï¼Œé€šè¿‡ä¸­å¿ƒå¹³å°çš„è´Ÿè½½å‡è¡¡ã€å†…å®¹åˆ†å‘ã€è°ƒåº¦ç­‰åŠŸèƒ½æ¨¡å—ï¼Œä½¿ç”¨æˆ·å°±è¿‘è·å–æ‰€éœ€å†…å®¹ï¼Œé™ä½ç½‘ç»œæ‹¥å¡ï¼Œæé«˜ç”¨æˆ·è®¿é—®å“åº”é€Ÿåº¦å’Œå‘½ä¸­ç‡ã€‚CDN çš„å…³é”®æŠ€æœ¯ä¸»è¦æœ‰å†…å®¹å­˜å‚¨å’Œåˆ†å‘æŠ€æœ¯ã€‚â€”â€” ç§‘å­¦ç™¾ç§‘\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6p436ax42j30ia09l74f.jpg)\n\n#### CDN å­˜åœ¨çš„æ„ä¹‰\n\nä¸ºäº†ä¸è®©ç½‘ç»œæ‹¥å¡æˆä¸ºäº’è”ç½‘å‘å±•çš„éšœç¢ã€‚\n\n#### CDN çš„ä¼˜åŠ¿\n\n1. CDN èŠ‚ç‚¹è§£å†³äº†è·¨è¿è¥å•†å’Œè·¨åœ°åŸŸè®¿é—®çš„é—®é¢˜ï¼Œè®¿é—®å»¶æ—¶å¤§å¤§é™ä½ï¼›\n2. å¤§éƒ¨åˆ†è¯·æ±‚åœ¨ CDN è¾¹ç¼˜èŠ‚ç‚¹å®Œæˆï¼ŒCDN èµ·åˆ°äº†åˆ†æµä½œç”¨ï¼Œå‡è½»äº†æºç«™çš„è´Ÿè½½ï¼›\n3. é™ä½â€œå¹¿æ’­é£æš´â€çš„å½±å“ï¼Œæé«˜ç½‘ç»œè®¿é—®çš„ç¨³å®šæ€§ï¼›èŠ‚çœéª¨å¹²ç½‘å¸¦å®½ï¼Œå‡å°‘å¸¦å®½éœ€æ±‚é‡ã€‚\n\n#### CDN çš„æ ¸å¿ƒç‚¹\n\n- ç¼“å­˜ï¼šå°†ä»æ ¹æœåŠ¡å™¨è¯·æ±‚æ¥çš„èµ„æºæŒ‰è¦æ±‚ç¼“å­˜ã€‚\n\n- å›æºï¼šå½“æœ‰ç”¨æˆ·è®¿é—®æŸä¸ªèµ„æºçš„æ—¶å€™ï¼Œå¦‚æœè¢«è§£æåˆ°çš„é‚£ä¸ª CDN èŠ‚ç‚¹æ²¡æœ‰ç¼“å­˜å“åº”çš„å†…å®¹ï¼Œæˆ–è€…æ˜¯ç¼“å­˜å·²ç»åˆ°æœŸï¼Œå°±ä¼šå›æºç«™å»è·å–ã€‚æ²¡æœ‰äººè®¿é—®ï¼ŒCDN èŠ‚ç‚¹ä¸ä¼šä¸»åŠ¨å»æºç«™è¯·æ±‚èµ„æºã€‚\n\n#### å…³é”®æŠ€æœ¯\n\n1. å†…å®¹å‘å¸ƒï¼šå®ƒå€ŸåŠ©äºå»ºç«‹ç´¢å¼•ã€ç¼“å­˜ã€æµåˆ†è£‚ã€ç»„æ’­ï¼ˆMulticastï¼‰ç­‰æŠ€æœ¯ï¼Œå°†å†…å®¹å‘å¸ƒæˆ–æŠ•é€’åˆ°è·ç¦»ç”¨æˆ·æœ€è¿‘çš„è¿œç¨‹æœåŠ¡ç‚¹ï¼ˆPOPï¼‰å¤„ï¼›\n2. å†…å®¹è·¯ç”±ï¼šå®ƒæ˜¯æ•´ä½“æ€§çš„ç½‘ç»œè´Ÿè½½å‡è¡¡æŠ€æœ¯ï¼Œé€šè¿‡å†…å®¹è·¯ç”±å™¨ä¸­çš„é‡å®šå‘ï¼ˆDNSï¼‰æœºåˆ¶ï¼Œåœ¨å¤šä¸ªè¿œç¨‹ POP ä¸Šå‡è¡¡ç”¨æˆ·çš„è¯·æ±‚ï¼Œä»¥ä½¿ç”¨æˆ·è¯·æ±‚å¾—åˆ°æœ€è¿‘å†…å®¹æºçš„å“åº”ï¼›\n3. å†…å®¹äº¤æ¢ï¼šå®ƒæ ¹æ®å†…å®¹çš„å¯ç”¨æ€§ã€æœåŠ¡å™¨çš„å¯ç”¨æ€§ä»¥åŠç”¨æˆ·çš„èƒŒæ™¯ï¼Œåœ¨ POP çš„ç¼“å­˜æœåŠ¡å™¨ä¸Šï¼Œåˆ©ç”¨åº”ç”¨å±‚äº¤æ¢ã€æµåˆ†è£‚ã€é‡å®šå‘ï¼ˆICPã€WCCPï¼‰ç­‰æŠ€æœ¯ï¼Œæ™ºèƒ½åœ°å¹³è¡¡è´Ÿè½½æµé‡ï¼›\n4. æ€§èƒ½ç®¡ç†ï¼šå®ƒé€šè¿‡å†…éƒ¨å’Œå¤–éƒ¨ç›‘æ§ç³»ç»Ÿï¼Œè·å–ç½‘ç»œéƒ¨ä»¶çš„çŠ¶å†µä¿¡æ¯ï¼Œæµ‹é‡å†…å®¹å‘å¸ƒçš„ç«¯åˆ°ç«¯æ€§èƒ½ï¼ˆå¦‚åŒ…ä¸¢å¤±ã€å»¶æ—¶ã€å¹³å‡å¸¦å®½ã€å¯åŠ¨æ—¶é—´ã€å¸§é€Ÿç‡ç­‰ï¼‰ï¼Œä¿è¯ç½‘ç»œå¤„äºæœ€ä½³çš„è¿è¡ŒçŠ¶æ€ã€‚\n\n#### CDN & é™æ€èµ„æº\n\né™æ€èµ„æºæœ¬èº«å…·æœ‰è®¿é—®é¢‘ç‡é«˜ã€æ‰¿æ¥æµé‡å¤§çš„ç‰¹ç‚¹ï¼Œå› æ­¤é™æ€èµ„æºåŠ è½½é€Ÿåº¦å§‹ç»ˆæ˜¯å‰ç«¯æ€§èƒ½çš„ä¸€ä¸ªéå¸¸å…³é”®çš„æŒ‡æ ‡ã€‚CDN æ˜¯é™æ€èµ„æºæé€Ÿçš„é‡è¦æ‰‹æ®µã€‚\n\né™æ€èµ„æºå°½é‡ä½¿ç”¨ CDN åŠ è½½ï¼Œç”±äºæµè§ˆå™¨å¯¹äºå•ä¸ªåŸŸåæœ‰å¹¶å‘è¯·æ±‚ä¸Šé™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¤šä¸ª CDN åŸŸåã€‚å¯¹äº CDN åŠ è½½é™æ€èµ„æºéœ€è¦æ³¨æ„ CDN åŸŸåè¦ä¸ä¸»ç«™ä¸åŒï¼Œå¦åˆ™æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¸¦ä¸Šä¸»ç«™çš„ Cookieã€‚\n\n## å…¶ä»–ä¼˜åŒ–\n\n### ä½¿ç”¨ Webpack ä¼˜åŒ–é¡¹ç›®\n\n- å¯¹äº Webpack4ï¼Œæ‰“åŒ…é¡¹ç›®ä½¿ç”¨ production æ¨¡å¼ï¼Œè¿™æ ·ä¼šè‡ªåŠ¨å¼€å¯ä»£ç å‹ç¼©\n- ä½¿ç”¨ ES6 æ¨¡å—æ¥å¼€å¯ tree shakingï¼Œè¿™ä¸ªæŠ€æœ¯å¯ä»¥ç§»é™¤æ²¡æœ‰ä½¿ç”¨çš„ä»£ç \n- ä¼˜åŒ–å›¾ç‰‡ï¼Œå¯¹äºå°å›¾å¯ä»¥ä½¿ç”¨ base64 çš„æ–¹å¼å†™å…¥æ–‡ä»¶ä¸­\n- æŒ‰ç…§è·¯ç”±æ‹†åˆ†ä»£ç ï¼Œå®ç°æŒ‰éœ€åŠ è½½\n- ç»™æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶åæ·»åŠ å“ˆå¸Œï¼Œå®ç°æµè§ˆå™¨ç¼“å­˜æ–‡ä»¶\n\n### ç›‘æ§\n\nå¯¹äºä»£ç è¿è¡Œé”™è¯¯ï¼Œé€šå¸¸çš„åŠæ³•æ˜¯ä½¿ç”¨ `window.onerror` æ‹¦æˆªæŠ¥é”™ã€‚è¯¥æ–¹æ³•èƒ½æ‹¦æˆªåˆ°å¤§éƒ¨åˆ†çš„è¯¦ç»†æŠ¥é”™ä¿¡æ¯ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–\n\n- å¯¹äºè·¨åŸŸçš„ä»£ç è¿è¡Œé”™è¯¯ä¼šæ˜¾ç¤º `Script error.` å¯¹äºè¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦ç»™ `script` æ ‡ç­¾æ·»åŠ  `crossorigin` å±æ€§\n- å¯¹äºæŸäº›æµè§ˆå™¨å¯èƒ½ä¸ä¼šæ˜¾ç¤ºè°ƒç”¨æ ˆä¿¡æ¯ï¼Œè¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡ `arguments.callee.caller` æ¥åšæ ˆé€’å½’\n\nå¯¹äºå¼‚æ­¥ä»£ç æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ `catch` çš„æ–¹å¼æ•è·é”™è¯¯ã€‚æ¯”å¦‚ `Promise` å¯ä»¥ç›´æ¥ä½¿ç”¨ `catch` å‡½æ•°ï¼Œ`async await` å¯ä»¥ä½¿ç”¨ `try catch`\n\nä½†æ˜¯è¦æ³¨æ„çº¿ä¸Šè¿è¡Œçš„ä»£ç éƒ½æ˜¯å‹ç¼©è¿‡çš„ï¼Œéœ€è¦åœ¨æ‰“åŒ…æ—¶ç”Ÿæˆ sourceMap æ–‡ä»¶ä¾¿äº debugã€‚\n\nå¯¹äºæ•è·çš„é”™è¯¯éœ€è¦ä¸Šä¼ ç»™æœåŠ¡å™¨ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡ `img` æ ‡ç­¾çš„ `src` å‘èµ·ä¸€ä¸ªè¯·æ±‚ã€‚\n\n## å¦‚ä½•ä¼˜åŒ–ç¬¬äºŒæ¬¡åŠ è½½é€Ÿåº¦ï¼Ÿï¼ˆå¢é‡åŠ è½½ï¼‰\n\n[å‰ç«¯æ€§èƒ½ä¼˜åŒ–ä¸‰éƒ¨æ›²(åŠ è½½ç¯‡)](https://juejin.im/post/5d00820b5188255ee806a1c7)\n\n[ç§»åŠ¨ H5 é¦–å±ç§’å¼€ä¼˜åŒ–æ–¹æ¡ˆæ¢è®¨](https://juejin.im/entry/599403656fb9a0247f4f2ee3)\n\n1. **é™ä½è¯·æ±‚é‡ï¼š**åˆå¹¶èµ„æºï¼Œå‡å°‘ HTTP è¯·æ±‚æ•°ï¼Œminify / gzip å‹ç¼©ï¼ŒwebPï¼ŒlazyLoadã€‚\n2. **åŠ å¿«è¯·æ±‚é€Ÿåº¦ï¼š**é¢„è§£æ DNSï¼Œå‡å°‘åŸŸåæ•°ï¼Œå¹¶è¡ŒåŠ è½½ï¼ŒCDN åˆ†å‘ã€‚\n3. **ç¼“å­˜ï¼š**HTTP åè®®ç¼“å­˜è¯·æ±‚ï¼Œç¦»çº¿ç¼“å­˜ manifestï¼Œç¦»çº¿æ•°æ®ç¼“å­˜ localStorageã€‚\n4. **æ¸²æŸ“ï¼š**JS/CSS ä¼˜åŒ–ï¼ŒåŠ è½½é¡ºåºï¼ŒæœåŠ¡ç«¯æ¸²æŸ“ï¼Œpipelineã€‚\n\nå…¶ä¸­å¯¹é¦–å±å¯åŠ¨é€Ÿåº¦å½±å“æœ€å¤§çš„å°±æ˜¯ç½‘ç»œè¯·æ±‚ï¼Œæ‰€ä»¥ä¼˜åŒ–çš„é‡ç‚¹å°±æ˜¯ç¼“å­˜\n\n**å¢é‡å¼æ›´æ–°â€**çš„è§£å†³æ–¹æ¡ˆï¼Œç®€å•åœ°è¯´å°±æ˜¯åœ¨ç‰ˆæœ¬æ›´æ–°çš„æ—¶å€™ä¸éœ€è¦é‡æ–°åŠ è½½èµ„æºï¼Œåªéœ€è¦åŠ è½½ä¸€æ®µå¾ˆå°çš„ diff ä¿¡æ¯ï¼Œç„¶ååˆå¹¶åˆ°å½“å‰èµ„æºä¸Šï¼Œç±»ä¼¼ git merge çš„æ•ˆæœã€‚\n\nå¢é‡åŠ è½½çš„ä¸€ç§æ€è·¯ï¼š\n\n1ã€ç”¨æˆ·ç«¯ä½¿ç”¨ LocalStorage æˆ–è€…å…¶å®ƒå‚¨å­˜æ–¹æ¡ˆï¼Œå­˜å‚¨ä¸€ä»½åŸå§‹ä»£ç +æ—¶é—´æˆ³ï¼š\n\n```text\n{\n    timeStamp: \"20161026xxxxxx\",\n    data: \"aaabbbccc\"\n}\n```\n\n2ã€æ¯æ¬¡åŠ è½½èµ„æºçš„æ—¶å€™å‘æœåŠ¡å™¨å‘é€è¿™ä¸ªæ—¶é—´æˆ³ï¼›\n\n3ã€æœåŠ¡å™¨ä»æ¥å—åˆ°æ—¶é—´æˆ³ä¸­è¯†åˆ«å‡ºå®¢æˆ·ç«¯çš„ç‰ˆæœ¬ï¼Œå’Œæœ€æ–°çš„ç‰ˆæœ¬åšä¸€æ¬¡ diffï¼Œè¿”å›ä¸¤è€…çš„ diff ä¿¡æ¯ï¼š\n\n```js\ndiff(\"aaabbbccc\", \"aaagggccc\");\n// å‡è®¾æˆ‘ä»¬çš„diffä¿¡æ¯è¿™æ ·è¡¨ç¤ºï¼š\n// [3, \"-3\", \"+ggg\", 3]\n```\n\n4ã€å®¢æˆ·ç«¯æ¥æ”¶åˆ°è¿™ä¸ª diff ä¿¡æ¯ä¹‹åï¼ŒæŠŠæœ¬åœ°èµ„æºå’Œæ—¶é—´æˆ³æ›´æ–°åˆ°æœ€æ–°ï¼Œå®ç°ä¸€æ¬¡å¢é‡æ›´æ–°ï¼š\n\n```js\nmergeDiff(\"aaabbbccc\", [3, \"-3\", \"+ggg\", 3]);\n//=> \"aaagggccc\"\n```\n\n## é¢è¯•é¢˜ï¼ˆå¦‚ä½•æ¸²æŸ“å‡ ä¸‡æ¡æ•°æ®å¹¶ä¸å¡ä½ç•Œï¼‰\n\nè¿™é“é¢˜è€ƒå¯Ÿäº†å¦‚ä½•åœ¨ä¸å¡ä½é¡µé¢çš„æƒ…å†µä¸‹æ¸²æŸ“æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ä¸€æ¬¡æ€§å°†å‡ ä¸‡æ¡éƒ½æ¸²æŸ“å‡ºæ¥ï¼Œè€Œåº”è¯¥ä¸€æ¬¡æ¸²æŸ“éƒ¨åˆ† DOMï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ `requestAnimationFrame` æ¥æ¯ 16 ms åˆ·æ–°ä¸€æ¬¡ã€‚\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" />\n    <title>Document</title>\n  </head>\n  <body>\n    <ul>\n      æ§ä»¶\n    </ul>\n    <script>\n      setTimeout(() => {\n        // æ’å…¥åä¸‡æ¡æ•°æ®\n        const total = 100000;\n        // ä¸€æ¬¡æ’å…¥ 20 æ¡ï¼Œå¦‚æœè§‰å¾—æ€§èƒ½ä¸å¥½å°±å‡å°‘\n        const once = 20;\n        // æ¸²æŸ“æ•°æ®æ€»å…±éœ€è¦å‡ æ¬¡\n        const loopCount = total / once;\n        let countOfRender = 0;\n        let ul = document.querySelector(\"ul\");\n        function add() {\n          // ä¼˜åŒ–æ€§èƒ½ï¼Œæ’å…¥ä¸ä¼šé€ æˆå›æµ\n          const fragment = document.createDocumentFragment();\n          for (let i = 0; i < once; i++) {\n            const li = document.createElement(\"li\");\n            li.innerText = Math.floor(Math.random() * total);\n            fragment.appendChild(li);\n          }\n          ul.appendChild(fragment);\n          countOfRender += 1;\n          loop();\n        }\n        function loop() {\n          if (countOfRender < loopCount) {\n            window.requestAnimationFrame(add);\n          }\n        }\n        loop();\n      }, 0);\n    </script>\n  </body>\n</html>\n```\n\n## æ‹“å±•çŸ¥è¯†ä¹‹ Gzip\n\n### åŸºæœ¬ä»‹ç»\n\ngzip æ˜¯ GNUzip çš„ç¼©å†™ï¼Œæœ€æ—©ç”¨äº UNIX ç³»ç»Ÿçš„æ–‡ä»¶å‹ç¼©ã€‚HTTP åè®®ä¸Šçš„ gzip ç¼–ç æ˜¯ä¸€ç§ç”¨æ¥æ”¹è¿› web åº”ç”¨ç¨‹åºæ€§èƒ½çš„æŠ€æœ¯ï¼Œweb æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å¿…é¡»å…±åŒæ”¯æŒ gzipã€‚ç›®å‰ä¸»æµçš„æµè§ˆå™¨ï¼ŒChrome,firefox,IE ç­‰éƒ½æ”¯æŒè¯¥åè®®ã€‚å¸¸è§çš„æœåŠ¡å™¨å¦‚ Apacheï¼ŒNginxï¼ŒIIS åŒæ ·æ”¯æŒ gzipã€‚\n\ngzip å‹ç¼©æ¯”ç‡åœ¨ 3 åˆ° 10 å€å·¦å³ï¼Œå¯ä»¥å¤§å¤§èŠ‚çœæœåŠ¡å™¨çš„ç½‘ç»œå¸¦å®½ã€‚è€Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¹¶ä¸æ˜¯å¯¹æ‰€æœ‰æ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œé€šå¸¸åªæ˜¯å‹ç¼©é™æ€æ–‡ä»¶ã€‚\n\n### gzip å·¥ä½œåŸç†ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6sjepqxiaj30go0bcaa9.jpg)\n\n1. æµè§ˆå™¨è¯·æ±‚ urlï¼Œå¹¶åœ¨ request header ä¸­è®¾ç½®å±æ€§ accept-encoding:gzipã€‚è¡¨æ˜æµè§ˆå™¨æ”¯æŒ gzipã€‚\n2. æœåŠ¡å™¨æ”¶åˆ°æµè§ˆå™¨å‘é€çš„è¯·æ±‚ä¹‹åï¼Œåˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒ gzipï¼Œå¦‚æœæ”¯æŒ gzipï¼Œåˆ™å‘æµè§ˆå™¨ä¼ é€å‹ç¼©è¿‡çš„å†…å®¹ï¼Œä¸æ”¯æŒåˆ™å‘æµè§ˆå™¨å‘é€æœªç»å‹ç¼©çš„å†…å®¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½æ”¯æŒ gzipï¼Œresponse headers è¿”å›åŒ…å« content-encoding:gzipã€‚\n3. æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”ä¹‹ååˆ¤æ–­å†…å®¹æ˜¯å¦è¢«å‹ç¼©ï¼Œå¦‚æœè¢«å‹ç¼©åˆ™è§£å‹ç¼©æ˜¾ç¤ºé¡µé¢å†…å®¹ã€‚\n\n### Nginx ä¸­å¼€å¯ gzip\n\nå¦‚æœæœåŠ¡ç«¯æ¥å£ä½¿ç”¨ nodejs å’Œ expressï¼Œé‚£ä¹ˆå¼€å¯ nginx éå¸¸ç®€å•ã€‚å¯ç”¨ compress() ä¸­é—´ä»¶å³å¯å¹¶åœ¨ nginx.conf ä¸­æ·»åŠ  gzip é…ç½®é¡¹å³å¯ï¼Œexpress.compress() gzip å‹ç¼©ä¸­é—´ä»¶ï¼Œé€šè¿‡ filter å‡½æ•°è®¾ç½®éœ€è¦å‹ç¼©çš„æ–‡ä»¶ç±»å‹ã€‚å‹ç¼©ç®—æ³•ä¸º gzip/deflateã€‚è¿™ä¸ªä¸­é—´ä»¶åº”è¯¥æ”¾ç½®åœ¨æ‰€æœ‰çš„ä¸­é—´ä»¶æœ€å‰é¢ä»¥ä¿è¯æ‰€æœ‰çš„è¿”å›éƒ½æ˜¯è¢«å‹ç¼©çš„ã€‚å¦‚æœä½¿ç”¨ java å¼€å‘ï¼Œéœ€è¦é…ç½® filterã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6sjg93f23j30go03eq2v.jpg)\n\næ·»åŠ å®Œå‚æ•°åï¼Œè¿è¡Œ nginx â€“t æ£€æŸ¥ä¸€ä¸‹è¯­æ³•ï¼Œè‹¥è¯­æ³•æ£€æµ‹é€šè¿‡ï¼Œåˆ™å¼€å§‹è®¿é—® url æ£€æµ‹ gzip æ˜¯å¦æ·»åŠ æˆåŠŸã€‚\n\n1. gzip onï¼šå¼€å¯ gzipã€‚\n2. gzip_comp_levelï¼šgzip å‹ç¼©æ¯”ã€‚\n3. gzip_min_lengthï¼šå…è®¸è¢«å‹ç¼©çš„é¡µé¢æœ€å°å­—èŠ‚æ•°ã€‚\n4. gzip_typesï¼šåŒ¹é… MIME ç±»å‹è¿›è¡Œå‹ç¼©ï¼Œtext/html é»˜è®¤è¢«å‹ç¼©ã€‚\n\n### æ£€æµ‹ gzip æ˜¯å¦å¼€å¯\n\nå¦‚æœæ²¡æœ‰ç°æˆçš„é¡¹ç›®ä»£ç ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æ£€æµ‹æ–¹å¼ã€‚é¦–å…ˆåœ¨æœ¬åœ°å®‰è£… nginxï¼Œåœ¨ nginx é»˜è®¤ç›®å½•ä¸‹é¢æ·»åŠ äº†ä¸¤ä¸ªé™æ€æ–‡ä»¶ bootstrap.cssã€bootstrap.jsã€‚\n\nOS X ç³»ç»Ÿçš„é»˜è®¤è·¯å¾„ä¸ºï¼š/usr/local/Cellar/nginx/1.10.2_1/htmlï¼ŒWindows ç³»ç»Ÿç›´æ¥å¤åˆ¶æ–‡ä»¶åˆ°æ–‡ä»¶å¤¹ä¸‹é¢ã€‚\n\næ‹·è´æ–‡ä»¶æŒ‡ä»¤å¯å‚è€ƒï¼šcp -r bootstrap.js /usr/local/Cellar/nginx/1.10.2_1/htmlï¼Œåœ¨ nginx çš„é»˜è®¤æˆåŠŸè·³è½¬é¡µé¢ index.html å¼•å…¥è¿™ä¸¤ä¸ªé™æ€æ–‡ä»¶ã€‚index.html é¡µé¢å†…å®¹å¦‚å›¾æ‰€ç¤ºã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6sjhnk9acj30go0c90tb.jpg)\n\nåšå¥½è¿™ä¸€åˆ‡çš„å‡†å¤‡å·¥ä½œä¹‹åï¼Œæµè§ˆå™¨è¾“å…¥[http://localhost:8080/](https://link.juejin.im/?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttp%3A%2F%2Flocalhost%3A8080%2F)ã€‚å‡ºç°å¦‚å›¾æ‰€ç¤ºé¡µé¢è¡¨æ˜ nginx å¯åŠ¨æˆåŠŸã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6sjii979gj30go048wei.jpg)\n\nnginx å¯åŠ¨æˆåŠŸç•Œé¢ã€‚\n\næ­¤æ—¶æ‰“å¼€ Chrome æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ° network ä¿¡æ¯ï¼Œresponse headers ä¸­è¿”å›äº† content-encoding:gzipï¼Œè¡¨æ˜ gzip å¼€å¯æˆåŠŸã€‚\n\ngzip æœªå¼€å¯å‰ network ä¿¡æ¯å¦‚å›¾æ‰€ç¤ºï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6sjjd5bavj30go02ogll.jpg)\n\nå¼€å¯åè¿”å› network ä¿¡æ¯å¦‚å›¾æ‰€ç¤ºï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6sjjxm19cj30go02m0sp.jpg)\n\nurl è¯·æ±‚çš„ headers æŠ¥æ–‡å¦‚å›¾æ‰€ç¤ºï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6sjk4yn88j30go0a4jrt.jpg)\n\nå¯¹æ¯”ä»¥ä¸Šä¸‰å›¾å¯ä»¥çœ‹å‡º gzip å‹ç¼©æ•ˆç‡éå¸¸é«˜ï¼Œä¸”ç»è¿‡å‹ç¼©åé™æ€æ–‡ä»¶å¤§å°ä¸åˆ°åŸæ¥çš„äº”åˆ†ä¹‹ä¸€ã€‚è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯é™æ€èµ„æºæ–‡ä»¶è¶Šå¤§ï¼Œgzip çš„å‹ç¼©æ•ˆç‡è¶Šé«˜ã€‚æ‰€ä»¥å¯¹äºé™æ€èµ„æºé‡éå¸¸å¤§çš„ç½‘ç«™ï¼Œå¼€å¯ gzip å¯èŠ‚çœå¤§é‡æµé‡ï¼Œè€ŒåŒæ—¶ gzip çš„åº”ç”¨è¿œä¸æ­¢æé«˜ web æ€§èƒ½,Androidï¼ŒIOS åº•å±‚ç½‘ç»œè¯·æ±‚åŒæ ·å¯ç”¨ã€‚\n","tags":["æ€§èƒ½ä¼˜åŒ–"],"categories":["å‰ç«¯"]},{"title":"CSSçš„positionå±æ€§","url":"/2019/08/31/CSSçš„positionå±æ€§/","content":"\n# CSS çš„ position å±æ€§\n\n## static\n\né»˜è®¤å€¼ã€‚è¯¥å…³é”®å­—æŒ‡å®šå…ƒç´ ä½¿ç”¨æ­£å¸¸çš„å¸ƒå±€è¡Œä¸ºï¼Œå³å…ƒç´ åœ¨æ–‡æ¡£å¸¸è§„æµä¸­å½“å‰çš„å¸ƒå±€ä½ç½®ã€‚æ­¤æ—¶ `top`, `right`, `bottom`, `left` å’Œ `z-index`å±æ€§æ— æ•ˆã€‚\n\n## relative\n\n### å®šä½ç±»å‹\n\nç›¸å¯¹å®šä½å…ƒç´ ï¼Œç›¸å¯¹å®šä½çš„å…ƒç´ æ˜¯åœ¨æ–‡æ¡£ä¸­çš„æ­£å¸¸ä½ç½®åç§»ç»™å®šçš„å€¼ï¼Œä½†æ˜¯ä¸å½±å“å…¶ä»–å…ƒç´ çš„åç§»ã€‚\n\n### å®šä½æ–¹å¼\n\nç”Ÿæˆç›¸å¯¹å®šä½çš„å…ƒç´ ï¼Œç›¸å¯¹äºå…¶æ­£å¸¸ä½ç½®è¿›è¡Œå®šä½ã€‚è¯¥å…³é”®å­—ä¸‹ï¼Œå…ƒç´ å…ˆæ”¾ç½®åœ¨æœªæ·»åŠ å®šä½æ—¶çš„ä½ç½®ï¼Œå†åœ¨ä¸æ”¹å˜é¡µé¢å¸ƒå±€çš„å‰æä¸‹è°ƒæ•´å…ƒç´ ä½ç½®ï¼ˆå› æ­¤ä¼šåœ¨æ­¤å…ƒç´ æœªæ·»åŠ å®šä½æ—¶æ‰€åœ¨ä½ç½®ç•™ä¸‹ç©ºç™½ï¼Œ\"left:20\" ä¼šå‘å…ƒç´ çš„ LEFT ä½ç½®æ·»åŠ  20 åƒç´ ã€‚ï¼‰ã€‚`position:relative` å¯¹ `table-group`, `table-row`,`table-column`,`table-cell`,`table-caption` å…ƒç´ æ— æ•ˆã€‚\n\n```html\n<div class=\"box\" id=\"one\">One</div>\n<div class=\"box\" id=\"two\">Two</div>\n<div class=\"box\" id=\"three\">Three</div>\n<div class=\"box\" id=\"four\">Four</div>\n```\n\n```css\n.box {\n  display: inline-block;\n  width: 100px;\n  height: 100px;\n  background: red;\n  color: white;\n}\n\n#two {\n  position: relative;\n  top: 20px;\n  left: 20px;\n  background: blue;\n}\n```\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iyqx5px1j312q0b40t2.jpg)\n\n## absolute\n\n### å®šä½ç±»å‹\n\nç»å¯¹å®šä½å…ƒç´ ï¼Œç›¸å¯¹å®šä½çš„å…ƒç´ å¹¶æœªè„±ç¦»æ–‡æ¡£æµï¼Œè€Œç»å¯¹å®šä½çš„å…ƒç´ åˆ™è„±ç¦»äº†æ–‡æ¡£æµã€‚åœ¨å¸ƒç½®æ–‡æ¡£æµä¸­å…¶å®ƒå…ƒç´ æ—¶ï¼Œç»å¯¹å®šä½å…ƒç´ ä¸å æ®ç©ºé—´ã€‚ç»å¯¹å®šä½å…ƒç´ ç›¸å¯¹äº*æœ€è¿‘çš„é static ç¥–å…ˆå…ƒç´ *å®šä½ã€‚å½“è¿™æ ·çš„ç¥–å…ˆå…ƒç´ ä¸å­˜åœ¨æ—¶ï¼Œåˆ™ç›¸å¯¹äº ICBï¼ˆinital container block, åˆå§‹åŒ…å«å—ï¼‰ã€‚\n\n### å®šä½æ–¹å¼\n\nç”Ÿæˆç»å¯¹å®šä½çš„å…ƒç´ ï¼Œä¸ä¸ºå…ƒç´ é¢„ç•™ç©ºé—´ï¼Œç›¸å¯¹äº static å®šä½ä»¥å¤–çš„ç¬¬ä¸€ä¸ªçˆ¶å…ƒç´ è¿›è¡Œå®šä½ã€‚å…ƒç´ çš„ä½ç½®é€šè¿‡ \"left\", \"top\", \"right\" ä»¥åŠ \"bottom\" å±æ€§è¿›è¡Œè§„å®šã€‚ç»å¯¹å®šä½çš„å…ƒç´ å¯ä»¥è®¾ç½®å¤–è¾¹è·ï¼ˆmarginsï¼‰ï¼Œä¸”ä¸ä¼šä¸å…¶ä»–è¾¹è·åˆå¹¶ã€‚\n\n```html\n<div class=\"box\" id=\"one\">One</div>\n<div class=\"box\" id=\"two\">Two</div>\n<div class=\"box\" id=\"three\">Three</div>\n<div class=\"box\" id=\"four\">Four</div>\n```\n\n```css\n.box {\n  display: inline-block;\n  background: red;\n  width: 100px;\n  height: 100px;\n  float: left;\n  margin: 20px;\n  color: white;\n}\n\n#three {\n  position: absolute;\n  top: 20px;\n  left: 20px;\n}\n```\n\n![image-20190823001646550](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iyrszydtj310809e0sz.jpg)\n\n## fixed\n\n### å®šä½ç±»å‹\n\nç»å¯¹å®šä½å…ƒç´ ï¼Œå›ºå®šå®šä½ä¸ç»å¯¹å®šä½ç›¸ä¼¼ï¼Œä½†å…ƒç´ çš„åŒ…å«å—ä¸º viewport è§†å£ã€‚è¯¥å®šä½æ–¹å¼å¸¸ç”¨äºåˆ›å»ºåœ¨æ»šåŠ¨å±å¹•æ—¶ä»å›ºå®šåœ¨ç›¸åŒä½ç½®çš„å…ƒç´ ã€‚\n\n### å®šä½æ–¹å¼\n\nç”Ÿæˆç»å¯¹å®šä½çš„å…ƒç´ ï¼Œä¸ä¸ºå…ƒç´ é¢„ç•™ç©ºé—´ï¼Œç›¸å¯¹äºæµè§ˆå™¨çª—å£è¿›è¡Œå®šä½ã€‚å…ƒç´ çš„ä½ç½®é€šè¿‡ \"left\", \"top\", \"right\" ä»¥åŠ \"bottom\" å±æ€§è¿›è¡Œè§„å®šã€‚å…ƒç´ çš„ä½ç½®åœ¨å±å¹•æ»šåŠ¨æ—¶ä¸ä¼šæ”¹å˜ã€‚æ‰“å°æ—¶ï¼Œå…ƒç´ ä¼šå‡ºç°åœ¨çš„æ¯é¡µçš„å›ºå®šä½ç½®ã€‚`fixed` å±æ€§ä¼šåˆ›å»ºæ–°çš„å±‚å ä¸Šä¸‹æ–‡ã€‚\n\n**å½“å…ƒç´ ç¥–å…ˆçš„ `transform` å±æ€§é `none` æ—¶ï¼Œå®¹å™¨ç”±è§†å£æ”¹ä¸ºè¯¥ç¥–å…ˆã€‚**\n\n## sticky\n\n### å®šä½ç±»å‹\n\nç²˜æ€§å®šä½å…ƒç´ ï¼Œç²˜æ€§å®šä½å¯ä»¥è¢«è®¤ä¸ºæ˜¯ç›¸å¯¹å®šä½å’Œå›ºå®šå®šä½çš„æ··åˆã€‚å…ƒç´ åœ¨è·¨è¶Šç‰¹å®šé˜ˆå€¼å‰ä¸ºç›¸å¯¹å®šä½ï¼Œä¹‹åä¸ºå›ºå®šå®šä½ã€‚\n\n### å®šä½æ–¹å¼\n\nç›’ä½ç½®æ ¹æ®æ­£å¸¸æµè®¡ç®—(è¿™ç§°ä¸ºæ­£å¸¸æµåŠ¨ä¸­çš„ä½ç½®)ï¼Œç„¶åç›¸å¯¹äºè¯¥å…ƒç´ åœ¨æµä¸­çš„ flow rootï¼ˆBFCï¼‰å’Œ containing blockï¼ˆæœ€è¿‘çš„å—çº§ç¥–å…ˆå…ƒç´ ï¼‰å®šä½ã€‚åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼ˆå³ä¾¿è¢«å®šä½å…ƒç´ ä¸º `table æ—¶`ï¼‰ï¼Œè¯¥å…ƒç´ å®šä½å‡ä¸å¯¹åç»­å…ƒç´ é€ æˆå½±å“ã€‚å½“å…ƒç´  B è¢«ç²˜æ€§å®šä½æ—¶ï¼Œåç»­å…ƒç´ çš„ä½ç½®ä»æŒ‰ç…§ B æœªå®šä½æ—¶çš„ä½ç½®æ¥ç¡®å®šã€‚`position: sticky`å¯¹ `table` å…ƒç´ çš„æ•ˆæœä¸ `position: relative`ç›¸åŒã€‚\n\n```css\n#one {\n  position: sticky;\n  top: 10px;\n}\n```\n\nåœ¨ viewport è§†å£æ»šåŠ¨åˆ°å…ƒç´  top è·ç¦»å°äº 10px ä¹‹å‰ï¼Œå…ƒç´ ä¸ºç›¸å¯¹å®šä½ã€‚ä¹‹åï¼Œå…ƒç´ å°†å›ºå®šåœ¨ä¸é¡¶éƒ¨è·ç¦» 10px çš„ä½ç½®ï¼Œç›´åˆ° viewport è§†å£å›æ»šåˆ°é˜ˆå€¼ä»¥ä¸‹ã€‚\n\nç²˜æ€§å®šä½å¸¸ç”¨äºå®šä½å­—æ¯åˆ—è¡¨çš„å¤´éƒ¨å…ƒç´ ã€‚æ ‡ç¤º B éƒ¨åˆ†å¼€å§‹çš„å¤´éƒ¨å…ƒç´ åœ¨æ»šåŠ¨ A éƒ¨åˆ†æ—¶ï¼Œå§‹ç»ˆå¤„äº A çš„ä¸‹æ–¹ã€‚è€Œåœ¨å¼€å§‹æ»šåŠ¨ B éƒ¨åˆ†æ—¶ï¼ŒB çš„å¤´éƒ¨ä¼šå›ºå®šåœ¨å±å¹•é¡¶éƒ¨ï¼Œç›´åˆ°æ‰€æœ‰ B çš„é¡¹å‡å®Œæˆæ»šåŠ¨åï¼Œæ‰è¢« C çš„å¤´éƒ¨æ›¿ä»£ã€‚\n\n### ä¾‹å­\n\n```html\n<div>\n  <dl>\n    <dt>A</dt>\n    <dd>Andrew W.K.</dd>\n    <dd>Apparat</dd>\n    <dd>Arcade Fire</dd>\n    <dd>At The Drive-In</dd>\n    <dd>Aziz Ansari</dd>\n  </dl>\n  <dl>\n    <dt>C</dt>\n    <dd>Chromeo</dd>\n    <dd>Common</dd>\n    <dd>Converge</dd>\n    <dd>Crystal Castles</dd>\n    <dd>Cursive</dd>\n  </dl>\n  <dl>\n    <dt>E</dt>\n    <dd>Explosions In The Sky</dd>\n  </dl>\n  <dl>\n    <dt>T</dt>\n    <dd>Ted Leo & The Pharmacists</dd>\n    <dd>T-Pain</dd>\n    <dd>Thrice</dd>\n    <dd>TV On The Radio</dd>\n    <dd>Two Gallants</dd>\n  </dl>\n</div>\n```\n\n```css\n* {\n  box-sizing: border-box;\n}\n\ndl {\n  margin: 0;\n  padding: 24px 0 0 0;\n}\n\ndt {\n  background: #b8c1c8;\n  border-bottom: 1px solid #989ea4;\n  border-top: 1px solid #717d85;\n  color: #fff;\n  font: bold 18px/21px Helvetica, Arial, sans-serif;\n  margin: 0;\n  padding: 2px 0 0 12px;\n  position: -webkit-sticky;\n  position: sticky;\n  top: -1px;\n}\n\ndd {\n  font: bold 20px/45px Helvetica, Arial, sans-serif;\n  margin: 0;\n  padding: 0 0 0 12px;\n  white-space: nowrap;\n}\n\ndd + dd {\n  border-top: 1px solid #ccc;\n}\n```\n\n### ç”Ÿæ•ˆè§„åˆ™\n\n`position:sticky` çš„ç”Ÿæ•ˆæ˜¯æœ‰ä¸€å®šçš„é™åˆ¶çš„ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š\n\n1. é¡»æŒ‡å®š top, right, bottom æˆ– left å››ä¸ªé˜ˆå€¼å…¶ä¸­ä¹‹ä¸€ï¼Œæ‰å¯ä½¿ç²˜æ€§å®šä½ç”Ÿæ•ˆã€‚å¦åˆ™å…¶è¡Œä¸ºä¸ç›¸å¯¹å®šä½ç›¸åŒã€‚\n   - å¹¶ä¸” `top` å’Œ `bottom` åŒæ—¶è®¾ç½®æ—¶ï¼Œ`top` ç”Ÿæ•ˆçš„ä¼˜å…ˆçº§é«˜ï¼Œ`left` å’Œ `right` åŒæ—¶è®¾ç½®æ—¶ï¼Œ`left` çš„ä¼˜å…ˆçº§é«˜ã€‚\n2. è®¾å®šä¸º `position:sticky` å…ƒç´ çš„ä»»æ„çˆ¶èŠ‚ç‚¹çš„ overflow å±æ€§å¿…é¡»æ˜¯ visibleï¼Œå¦åˆ™ `position:sticky` ä¸ä¼šç”Ÿæ•ˆã€‚è¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹ï¼š\n   - å¦‚æœ `position:sticky` å…ƒç´ çš„ä»»æ„çˆ¶èŠ‚ç‚¹å®šä½è®¾ç½®ä¸º `overflow:hidden`ï¼Œåˆ™çˆ¶å®¹å™¨æ— æ³•è¿›è¡Œæ»šåŠ¨ï¼Œæ‰€ä»¥ `position:sticky` å…ƒç´ ä¹Ÿä¸ä¼šæœ‰æ»šåŠ¨ç„¶åå›ºå®šçš„æƒ…å†µã€‚\n   - å¦‚æœ `position:sticky` å…ƒç´ çš„ä»»æ„çˆ¶èŠ‚ç‚¹å®šä½è®¾ç½®ä¸º `position:relative | absolute | fixed`ï¼Œåˆ™å…ƒç´ ç›¸å¯¹çˆ¶å…ƒç´ è¿›è¡Œå®šä½ï¼Œè€Œä¸ä¼šç›¸å¯¹ viewprot å®šä½ã€‚\n3. è¾¾åˆ°è®¾å®šçš„é˜€å€¼ã€‚è¿™ä¸ªè¿˜ç®—å¥½ç†è§£ï¼Œä¹Ÿå°±æ˜¯è®¾å®šäº† `position:sticky` çš„å…ƒç´ è¡¨ç°ä¸º `relative` è¿˜æ˜¯ `fixed` æ˜¯æ ¹æ®å…ƒç´ æ˜¯å¦è¾¾åˆ°è®¾å®šäº†çš„é˜ˆå€¼å†³å®šçš„ã€‚\n\n### ç‰¹æ€§\n\n1. åŒä¸€ä¸ªçˆ¶å®¹å™¨ä¸­çš„ sticky å…ƒç´ ï¼Œå¦‚æœå®šä½å€¼ç›¸ç­‰ï¼Œåˆ™ä¼šé‡å ï¼›å¦‚æœå±äºä¸åŒçˆ¶å…ƒç´ ï¼Œåˆ™ä¼šé¸ å é¹Šå·¢ï¼ŒæŒ¤å¼€åŸæ¥çš„å…ƒç´ ï¼Œå½¢æˆä¾æ¬¡å ä½çš„æ•ˆæœã€‚\n\n## initial\n\n`initial` å…³é”®å­—ç”¨äºè®¾ç½® CSS å±æ€§ä¸ºå®ƒçš„é»˜è®¤å€¼ï¼Œå¯ä½œç”¨äºä»»ä½• CSS æ ·å¼ã€‚ï¼ˆIE ä¸æ”¯æŒè¯¥å…³é”®å­—ï¼‰\n\n## inheritï¼š\n\nè§„å®šåº”è¯¥ä»çˆ¶å…ƒç´ ç»§æ‰¿ position å±æ€§çš„å€¼ã€‚\n\næ¯ä¸€ä¸ª CSS å±æ€§éƒ½æœ‰ä¸€ä¸ªç‰¹æ€§å°±æ˜¯ï¼Œè¿™ä¸ªå±æ€§å¿…ç„¶æ˜¯é»˜è®¤ç»§æ‰¿çš„ (`inherited: Yes`) æˆ–è€…æ˜¯é»˜è®¤ä¸ç»§æ‰¿çš„ (`inherited: no`)å…¶ä¸­ä¹‹ä¸€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ [MDN](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Reference) ä¸Šé€šè¿‡è¿™ä¸ªç´¢å¼•æŸ¥æ‰¾ï¼Œåˆ¤æ–­ä¸€ä¸ªå±æ€§çš„æ˜¯å¦ç»§æ‰¿ç‰¹æ€§ã€‚\n\n### å¯ç»§æ‰¿å±æ€§\n\n- æ‰€æœ‰å…ƒç´ å¯ç»§æ‰¿ï¼švisibility å’Œ cursor\n- å†…è”å…ƒç´ å¯ç»§æ‰¿ï¼šletter-spacingã€word-spacingã€white-spaceã€line-heightã€colorã€fontã€ font-familyã€font-sizeã€font-styleã€font-variantã€font-weightã€text- decorationã€text-transformã€direction\n- å—çŠ¶å…ƒç´ å¯ç»§æ‰¿ï¼štext-indent å’Œ text-align\n- åˆ—è¡¨å…ƒç´ å¯ç»§æ‰¿ï¼šlist-styleã€list-style-typeã€list-style-positionã€list-style-image\n- è¡¨æ ¼å…ƒç´ å¯ç»§æ‰¿ï¼šborder-collapse\n\n## unset\n\n`unset` å…³é”®å­—æˆ‘ä»¬å¯ä»¥ç®€å•ç†è§£ä¸ºä¸è®¾ç½®ã€‚å…¶å®ï¼Œå®ƒæ˜¯å…³é”®å­— `initial` å’Œ `inherit` çš„ç»„åˆã€‚\n\nä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬ç»™ä¸€ä¸ª CSS å±æ€§è®¾ç½®äº† `unset` çš„è¯ï¼š\n\n1. å¦‚æœè¯¥å±æ€§æ˜¯é»˜è®¤ç»§æ‰¿å±æ€§ï¼Œè¯¥å€¼ç­‰åŒäº `inherit`\n2. å¦‚æœè¯¥å±æ€§æ˜¯éç»§æ‰¿å±æ€§ï¼Œè¯¥å€¼ç­‰åŒäº `initial`\n\n### ä¾‹å­\n\n```html\n<div class=\"father\">\n  <div class=\"children\">å­çº§å…ƒç´ ä¸€</div>\n  <div class=\"children unset\">å­çº§å…ƒç´ äºŒ</div>\n</div>\n\n.father { color: red; border: 1px solid black; } .children { color: green;\nborder: 1px solid blue; } .unset { color: unset; border: unset; }\n```\n\n1. ç”±äº `color` æ˜¯å¯ç»§æ‰¿æ ·å¼ï¼Œè®¾ç½®äº† `color: unset` çš„å…ƒç´ ï¼Œæœ€ç»ˆè¡¨ç°ä¸ºäº†çˆ¶çº§çš„é¢œè‰² `red`ã€‚\n2. ç”±äº `border` æ˜¯ä¸å¯ç»§æ‰¿æ ·å¼ï¼Œè®¾ç½®äº† `border: unset` çš„å…ƒç´ ï¼Œæœ€ç»ˆè¡¨ç°ä¸º `border: initial` ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤ border æ ·å¼ï¼Œæ— è¾¹æ¡†ã€‚\n\n## revert\n\nrevert æœªåˆ—å…¥è§„èŒƒ\n","tags":["CSS","position"],"categories":["CSS"]},{"title":"ES6 è£…é¥°å™¨","url":"/2019/08/18/ES6 è£…é¥°å™¨/","content":"\n# ES6 è£…é¥°å™¨\n\nè£…é¥°å™¨ï¼ˆDecoratorï¼‰æ˜¯ä¸€ç§ä¸ç±»ï¼ˆclassï¼‰ç›¸å…³çš„è¯­æ³•ï¼Œ**ç”¨æ¥æ³¨é‡Šæˆ–ä¿®æ”¹ç±»å’Œç±»æ–¹æ³•**ã€‚è£…é¥°å™¨æ˜¯ä¸€ç§å‡½æ•°ï¼Œå†™æˆ`@ + å‡½æ•°å`ã€‚å®ƒå¯ä»¥æ”¾åœ¨ç±»å’Œç±»æ–¹æ³•çš„å®šä¹‰å‰é¢ã€‚\n\n  <!-- more -->\n\n```javascript\n@frozen\nclass Foo {\n  @configurable(false)\n  @enumerable(true)\n  method() {}\n\n  @throttle(500)\n  expensiveMethod() {}\n}\n```\n\nä¸Šé¢ä»£ç ä¸€å…±ä½¿ç”¨äº†å››ä¸ªè£…é¥°å™¨ï¼Œä¸€ä¸ªç”¨åœ¨ç±»æœ¬èº«ï¼Œå¦å¤–ä¸‰ä¸ªç”¨åœ¨ç±»æ–¹æ³•ã€‚å®ƒä»¬ä¸ä»…å¢åŠ äº†ä»£ç çš„å¯è¯»æ€§ï¼Œæ¸…æ™°åœ°è¡¨è¾¾äº†æ„å›¾ï¼Œè€Œä¸”æä¾›ä¸€ç§æ–¹ä¾¿çš„æ‰‹æ®µï¼Œå¢åŠ æˆ–ä¿®æ”¹ç±»çš„åŠŸèƒ½ã€‚\n\n**Proxy çš„æ ¸å¿ƒä½œç”¨æ˜¯æ§åˆ¶å¤–ç•Œå¯¹è¢«ä»£ç†è€…å†…éƒ¨çš„è®¿é—®ï¼ŒDecorator çš„æ ¸å¿ƒä½œç”¨æ˜¯å¢å¼ºè¢«è£…é¥°è€…çš„åŠŸèƒ½ã€‚è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚**\n\n## ç±»çš„è£…é¥°\n\nè£…é¥°å™¨å¯ä»¥ç”¨æ¥è£…é¥°æ•´ä¸ªç±»ã€‚\n\n### ä¸ºç±»æ·»åŠ é™æ€å±æ€§\n\n```javascript\n@testable\nclass MyTestableClass {\n  // ...\n}\n\nfunction testable(target) {\n  target.isTestable = true;\n}\n\nMyTestableClass.isTestable; // true\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œ`@testable`å°±æ˜¯ä¸€ä¸ªè£…é¥°å™¨ã€‚å®ƒä¿®æ”¹äº†`MyTestableClass`è¿™ä¸ªç±»çš„è¡Œä¸ºï¼Œä¸ºå®ƒåŠ ä¸Šäº†é™æ€å±æ€§`isTestable`ã€‚`testable`å‡½æ•°çš„å‚æ•°`target`æ˜¯`MyTestableClass`ç±»æœ¬èº«ã€‚\n\nåŸºæœ¬ä¸Šï¼Œè£…é¥°å™¨çš„è¡Œä¸ºå°±æ˜¯ä¸‹é¢è¿™æ ·ã€‚\n\n```javascript\n@decorator\nclass A {}\n\n// ç­‰åŒäº\n\nclass A {}\nA = decorator(A) || A;\n```\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œ**è£…é¥°å™¨æ˜¯ä¸€ä¸ªå¯¹ç±»è¿›è¡Œå¤„ç†çš„å‡½æ•°ã€‚è£…é¥°å™¨å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯æ‰€è¦è£…é¥°çš„ç›®æ ‡ç±»ã€‚**\n\nå¦‚æœè§‰å¾—ä¸€ä¸ªå‚æ•°ä¸å¤Ÿç”¨ï¼Œå¯ä»¥åœ¨è£…é¥°å™¨å¤–é¢å†å°è£…ä¸€å±‚å‡½æ•°ã€‚\n\n```javascript\nfunction testable(isTestable) {\n  return function(target) {\n    target.isTestable = isTestable;\n  };\n}\n\n@testable(true)\nclass MyTestableClass {}\nMyTestableClass.isTestable; // true\n\n@testable(false)\nclass MyClass {}\nMyClass.isTestable; // false\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œè£…é¥°å™¨`testable`å¯ä»¥æ¥å—å‚æ•°ï¼Œè¿™å°±ç­‰äºå¯ä»¥ä¿®æ”¹è£…é¥°å™¨çš„è¡Œä¸ºã€‚\n\n**æ³¨æ„ï¼Œè£…é¥°å™¨å¯¹ç±»çš„è¡Œä¸ºçš„æ”¹å˜ï¼Œæ˜¯ä»£ç ç¼–è¯‘æ—¶å‘ç”Ÿçš„ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ã€‚è¿™æ„å‘³ç€ï¼Œè£…é¥°å™¨èƒ½åœ¨ç¼–è¯‘é˜¶æ®µè¿è¡Œä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè£…é¥°å™¨æœ¬è´¨å°±æ˜¯ç¼–è¯‘æ—¶æ‰§è¡Œçš„å‡½æ•°ã€‚**\n\n### ä¸ºç±»æ·»åŠ å®ä¾‹å±æ€§\n\nå¦‚æœæƒ³æ·»åŠ å®ä¾‹å±æ€§ï¼Œå¯ä»¥é€šè¿‡ç›®æ ‡ç±»çš„`prototype`å¯¹è±¡æ“ä½œã€‚\n\n```javascript\nfunction testable(target) {\n  target.prototype.isTestable = true;\n}\n\n@testable\nclass MyTestableClass {}\n\nlet obj = new MyTestableClass();\nobj.isTestable; // true\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œè£…é¥°å™¨å‡½æ•°`testable`æ˜¯åœ¨ç›®æ ‡ç±»çš„`prototype`å¯¹è±¡ä¸Šæ·»åŠ å±æ€§ï¼Œå› æ­¤å°±å¯ä»¥åœ¨å®ä¾‹ä¸Šè°ƒç”¨ã€‚\n\nä¸‹é¢æ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ã€‚\n\n```javascript\n// mixins.js\nexport function mixins(...list) {\n  return function(target) {\n    Object.assign(target.prototype, ...list);\n  };\n}\n\n// main.js\nimport { mixins } from \"./mixins\";\n\nconst Foo = {\n  foo() {\n    console.log(\"foo\");\n  }\n};\n\n@mixins(Foo)\nclass MyClass {}\n\nlet obj = new MyClass();\nobj.foo(); // 'foo'\n```\n\nä¸Šé¢ä»£ç é€šè¿‡è£…é¥°å™¨`mixins`ï¼ŒæŠŠ`Foo`å¯¹è±¡çš„æ–¹æ³•æ·»åŠ åˆ°äº†`MyClass`çš„å®ä¾‹ä¸Šé¢ã€‚å¯ä»¥ç”¨`Object.assign()`æ¨¡æ‹Ÿè¿™ä¸ªåŠŸèƒ½ã€‚\n\n## æ–¹æ³•çš„è£…é¥°\n\n### è£…é¥°å™¨ä¿®æ”¹å±æ€§çš„æè¿°å¯¹è±¡\n\nè£…é¥°å™¨ä¸ä»…å¯ä»¥è£…é¥°ç±»ï¼Œè¿˜å¯ä»¥è£…é¥°ç±»çš„å±æ€§ã€‚\n\n```javascript\nclass Person {\n  @readonly\n  name() {\n    return `${this.first} ${this.last}`;\n  }\n}\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œè£…é¥°å™¨`readonly`ç”¨æ¥è£…é¥°â€œç±»â€çš„`name`æ–¹æ³•ã€‚\n\nè£…é¥°å™¨å‡½æ•°`readonly`ä¸€å…±å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ã€‚\n\n```javascript\nfunction readonly(target, name, descriptor) {\n  // descriptorå¯¹è±¡åŸæ¥çš„å€¼å¦‚ä¸‹\n  // {\n  //   value: specifiedFunction,\n  //   enumerable: false,\n  //   configurable: true,\n  //   writable: true\n  // };\n  descriptor.writable = false;\n  return descriptor;\n}\n\nreadonly(Person.prototype, \"name\", descriptor);\n// ç±»ä¼¼äº\nObject.defineProperty(Person.prototype, \"name\", descriptor);\n```\n\nè£…é¥°å™¨ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»çš„åŸå‹å¯¹è±¡ï¼Œä¸Šä¾‹æ˜¯`Person.prototype`ï¼Œè£…é¥°å™¨çš„æœ¬æ„æ˜¯è¦â€œè£…é¥°â€ç±»çš„å®ä¾‹ï¼Œä½†æ˜¯**è¿™ä¸ªæ—¶å€™å®ä¾‹è¿˜æ²¡ç”Ÿæˆï¼Œæ‰€ä»¥åªèƒ½å»è£…é¥°åŸå‹**ï¼ˆè¿™ä¸åŒäºç±»çš„è£…é¥°ï¼Œé‚£ç§æƒ…å†µæ—¶`target`å‚æ•°æŒ‡çš„æ˜¯ç±»æœ¬èº«ï¼‰ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰€è¦è£…é¥°çš„å±æ€§åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¯¥å±æ€§çš„æè¿°å¯¹è±¡ã€‚\n\nå¦å¤–ï¼Œä¸Šé¢ä»£ç è¯´æ˜ï¼Œ**è£…é¥°å™¨ï¼ˆreadonlyï¼‰ä¼šä¿®æ”¹å±æ€§çš„æè¿°å¯¹è±¡ï¼ˆdescriptorï¼‰ï¼Œç„¶åè¢«ä¿®æ”¹çš„æè¿°å¯¹è±¡å†ç”¨æ¥å®šä¹‰å±æ€§ã€‚**\n\nä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ï¼Œä¿®æ”¹å±æ€§æè¿°å¯¹è±¡çš„`enumerable`å±æ€§ï¼Œä½¿å¾—è¯¥å±æ€§ä¸å¯éå†ã€‚\n\n```javascript\nclass Person {\n  @nonenumerable\n  get kidCount() {\n    return this.children.length;\n  }\n}\n\nfunction nonenumerable(target, name, descriptor) {\n  descriptor.enumerable = false;\n  return descriptor;\n}\n```\n\nä¸‹é¢çš„`@log`è£…é¥°å™¨ï¼Œå¯ä»¥èµ·åˆ°è¾“å‡ºæ—¥å¿—çš„ä½œç”¨ã€‚\n\n```javascript\nclass Math {\n  @log\n  add(a, b) {\n    return a + b;\n  }\n}\n\nfunction log(target, name, descriptor) {\n  var oldValue = descriptor.value;\n\n  descriptor.value = function() {\n    console.log(`Calling ${name} with`, arguments);\n    return oldValue.apply(this, arguments);\n  };\n\n  return descriptor;\n}\n\nconst math = new Math();\n\n// passed parameters should get logged now\nmath.add(2, 4);\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œ`@log`è£…é¥°å™¨çš„ä½œç”¨å°±æ˜¯åœ¨æ‰§è¡ŒåŸå§‹çš„æ“ä½œä¹‹å‰ï¼Œæ‰§è¡Œä¸€æ¬¡`console.log`ï¼Œä»è€Œè¾¾åˆ°è¾“å‡ºæ—¥å¿—çš„ç›®çš„ã€‚\n\n### è£…é¥°å™¨çš„æ³¨é‡Šä½œç”¨\n\n```javascript\n@testable\nclass Person {\n  @readonly\n  @nonenumerable\n  name() {\n    return `${this.first} ${this.last}`;\n  }\n}\n```\n\nä»ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸€çœ¼å°±èƒ½çœ‹å‡ºï¼Œ`Person`ç±»æ˜¯å¯æµ‹è¯•çš„ï¼Œè€Œ`name`æ–¹æ³•æ˜¯åªè¯»å’Œä¸å¯æšä¸¾çš„ã€‚\n\nä¸‹é¢æ˜¯ä½¿ç”¨ Decorator å†™æ³•çš„[ç»„ä»¶](https://github.com/ionic-team/stencil)ï¼Œçœ‹ä¸Šå»ä¸€ç›®äº†ç„¶ã€‚\n\n```javascript\n@Component({\n  tag: \"my-component\",\n  styleUrl: \"my-component.scss\"\n})\nexport class MyComponent {\n  @Prop() first: string;\n  @Prop() last: string;\n  @State() isVisible: boolean = true;\n\n  render() {\n    return (\n      <p>\n        Hello, my name is {this.first} {this.last}\n      </p>\n    );\n  }\n}\n```\n\n### å¤šä¸ªè£…é¥°å™¨\n\nå¦‚æœåŒä¸€ä¸ªæ–¹æ³•æœ‰å¤šä¸ªè£…é¥°å™¨ï¼Œä¼šåƒå‰¥æ´‹è‘±ä¸€æ ·ï¼Œå…ˆä»å¤–åˆ°å†…è¿›å…¥ï¼Œç„¶åç”±å†…å‘å¤–æ‰§è¡Œã€‚\n\n```javascript\nfunction dec(id) {\n  console.log(\"evaluated\", id);\n  return (target, property, descriptor) => console.log(\"executed\", id);\n}\n\nclass Example {\n  @dec(1)\n  @dec(2)\n  method() {}\n}\n// evaluated 1\n// evaluated 2\n// executed 2\n// executed 1\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œå¤–å±‚è£…é¥°å™¨`@dec(1)`å…ˆè¿›å…¥ï¼Œä½†æ˜¯å†…å±‚è£…é¥°å™¨`@dec(2)`å…ˆæ‰§è¡Œã€‚\n\n### è£…é¥°å™¨å¯ç”¨ä½œç±»å‹æ£€æŸ¥\n\né™¤äº†æ³¨é‡Šï¼Œè£…é¥°å™¨è¿˜èƒ½ç”¨æ¥ç±»å‹æ£€æŸ¥ã€‚æ‰€ä»¥ï¼Œå¯¹äºç±»æ¥è¯´ï¼Œè¿™é¡¹åŠŸèƒ½ç›¸å½“æœ‰ç”¨ã€‚ä»é•¿æœŸæ¥çœ‹ï¼Œå®ƒå°†æ˜¯ JavaScript ä»£ç é™æ€åˆ†æçš„é‡è¦å·¥å…·ã€‚\n\n## ä¸ºä»€ä¹ˆè£…é¥°å™¨ä¸èƒ½ç”¨äºå‡½æ•°\n\n### å‡½æ•°æå‡ï¼Œç±»æ²¡æœ‰æå‡\n\nè£…é¥°å™¨åªèƒ½ç”¨äºç±»å’Œç±»çš„æ–¹æ³•ï¼Œä¸èƒ½ç”¨äºå‡½æ•°ï¼Œ**å› ä¸ºå­˜åœ¨å‡½æ•°æå‡**ã€‚\n\n```javascript\nvar counter = 0;\n\nvar add = function () {\n  counter++;\n};\n\n@add\nfunction foo() {\n}\n```\n\nä¸Šé¢çš„ä»£ç ï¼Œæ„å›¾æ˜¯æ‰§è¡Œå`counter`ç­‰äº 1ï¼Œä½†æ˜¯å®é™…ä¸Šç»“æœæ˜¯`counter`ç­‰äº 0ã€‚å› ä¸ºå‡½æ•°æå‡ï¼Œä½¿å¾—å®é™…æ‰§è¡Œçš„ä»£ç æ˜¯ä¸‹é¢è¿™æ ·ã€‚\n\n```javascript\n@add\nfunction foo() {\n}\n\nvar counter;\nvar add;\n\ncounter = 0;\n\nadd = function () {\n  counter++;\n};\n```\n\nä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚\n\n```javascript\nvar readOnly = require(\"some-decorator\");\n\n@readOnly\nfunction foo() {\n}\n```\n\nä¸Šé¢ä»£ç ä¹Ÿæœ‰é—®é¢˜ï¼Œå› ä¸ºå®é™…æ‰§è¡Œæ˜¯ä¸‹é¢è¿™æ ·ã€‚\n\n```javascript\nvar readOnly;\n\n@readOnly\nfunction foo() {\n}\n\nreadOnly = require(\"some-decorator\");\n\n```\n\næ€»ä¹‹ï¼Œç”±äºå­˜åœ¨å‡½æ•°æå‡ï¼Œä½¿å¾—è£…é¥°å™¨ä¸èƒ½ç”¨äºå‡½æ•°ã€‚ç±»æ˜¯ä¸ä¼šæå‡çš„ï¼Œæ‰€ä»¥å°±æ²¡æœ‰è¿™æ–¹é¢çš„é—®é¢˜ã€‚\n\n### å‡½æ•°ä¸€å®šè¦ç”¨è£…é¥°å™¨\n\nå¦ä¸€æ–¹é¢ï¼Œå¦‚æœä¸€å®šè¦è£…é¥°å‡½æ•°ï¼Œå¯ä»¥é‡‡ç”¨é«˜é˜¶å‡½æ•°çš„å½¢å¼ç›´æ¥æ‰§è¡Œã€‚\n\n```javascript\nfunction doSomething(name) {\n  console.log(\"Hello, \" + name);\n}\n\nfunction loggingDecorator(wrapped) {\n  return function() {\n    console.log(\"Starting\");\n    const result = wrapped.apply(this, arguments);\n    console.log(\"Finished\");\n    return result;\n  };\n}\n\nconst wrapped = loggingDecorator(doSomething);\n```\n\n## å¸¸è§è£…é¥°å™¨\n\n[core-decorators.js](https://github.com/jayphelps/core-decorators.js)æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œæä¾›äº†å‡ ä¸ªå¸¸è§çš„è£…é¥°å™¨ï¼Œé€šè¿‡å®ƒå¯ä»¥æ›´å¥½åœ°ç†è§£è£…é¥°å™¨ã€‚\n\n### 1. @autobind\n\n`autobind`è£…é¥°å™¨ä½¿å¾—æ–¹æ³•ä¸­çš„`this`å¯¹è±¡ï¼Œç»‘å®šåŸå§‹å¯¹è±¡ã€‚\n\n```javascript\nimport { autobind } from \"core-decorators\";\n\nclass Person {\n  @autobind\n  getPerson() {\n    return this;\n  }\n}\n\nlet person = new Person();\nlet getPerson = person.getPerson;\n\ngetPerson() === person;\n// true\n```\n\n### 2. @readonly\n\n`readonly`è£…é¥°å™¨ä½¿å¾—å±æ€§æˆ–æ–¹æ³•ä¸å¯å†™ã€‚\n\n```javascript\nimport { readonly } from \"core-decorators\";\n\nclass Meal {\n  @readonly\n  entree = \"steak\";\n}\n\nvar dinner = new Meal();\ndinner.entree = \"salmon\";\n// Cannot assign to read only property 'entree' of [object Object]\n```\n\n### 3. @override\n\n`override`è£…é¥°å™¨æ£€æŸ¥å­ç±»çš„æ–¹æ³•ï¼Œæ˜¯å¦æ­£ç¡®è¦†ç›–äº†çˆ¶ç±»çš„åŒåæ–¹æ³•ï¼Œå¦‚æœä¸æ­£ç¡®ä¼šæŠ¥é”™ã€‚\n\n```javascript\nimport { override } from \"core-decorators\";\n\nclass Parent {\n  speak(first, second) {}\n}\n\nclass Child extends Parent {\n  @override\n  speak() {}\n  // SyntaxError: Child#speak() does not properly override Parent#speak(first, second)\n}\n\n// or\n\nclass Child extends Parent {\n  @override\n  speaks() {}\n  // SyntaxError: No descriptor matching Child#speaks() was found on the prototype chain.\n  //\n  //   Did you mean \"speak\"?\n}\n```\n\n### 4. @deprecate (åˆ«å@deprecated)\n\n`deprecate`æˆ–`deprecated`è£…é¥°å™¨åœ¨æ§åˆ¶å°æ˜¾ç¤ºä¸€æ¡è­¦å‘Šï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•å°†åºŸé™¤ã€‚\n\n```javascript\nimport { deprecate } from \"core-decorators\";\n\nclass Person {\n  @deprecate\n  facepalm() {}\n\n  @deprecate(\"We stopped facepalming\")\n  facepalmHard() {}\n\n  @deprecate(\"We stopped facepalming\", {\n    url: \"http://knowyourmeme.com/memes/facepalm\"\n  })\n  facepalmHarder() {}\n}\n\nlet person = new Person();\n\nperson.facepalm();\n// DEPRECATION Person#facepalm: This function will be removed in future versions.\n\nperson.facepalmHard();\n// DEPRECATION Person#facepalmHard: We stopped facepalming\n\nperson.facepalmHarder();\n// DEPRECATION Person#facepalmHarder: We stopped facepalming\n//\n//     See http://knowyourmeme.com/memes/facepalm for more details.\n//\n```\n\n### 5. @suppressWarnings\n\n`suppressWarnings`è£…é¥°å™¨æŠ‘åˆ¶`deprecated`è£…é¥°å™¨å¯¼è‡´çš„`console.warn()`è°ƒç”¨ã€‚ä½†æ˜¯ï¼Œå¼‚æ­¥ä»£ç å‘å‡ºçš„è°ƒç”¨é™¤å¤–ã€‚\n\n```javascript\nimport { suppressWarnings } from \"core-decorators\";\n\nclass Person {\n  @deprecated\n  facepalm() {}\n\n  @suppressWarnings\n  facepalmWithoutWarning() {\n    this.facepalm();\n  }\n}\n\nlet person = new Person();\n\nperson.facepalmWithoutWarning();\n// no warning is logged\n```\n\n## ä½¿ç”¨è£…é¥°å™¨å®ç°è‡ªåŠ¨å‘å¸ƒäº‹ä»¶\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨è£…é¥°å™¨ï¼Œä½¿å¾—å¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œè‡ªåŠ¨å‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚\n\n```javascript\nconst postal = require(\"postal/lib/postal.lodash\");\n\nexport default function publish(topic, channel) {\n  const channelName = channel || \"/\";\n  const msgChannel = postal.channel(channelName);\n  msgChannel.subscribe(topic, v => {\n    console.log(\"é¢‘é“: \", channelName);\n    console.log(\"äº‹ä»¶: \", topic);\n    console.log(\"æ•°æ®: \", v);\n  });\n\n  return function(target, name, descriptor) {\n    const fn = descriptor.value;\n\n    descriptor.value = function() {\n      let value = fn.apply(this, arguments);\n      msgChannel.publish(topic, value);\n    };\n  };\n}\n```\n\nä¸Šé¢ä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸º`publish`çš„è£…é¥°å™¨ï¼Œå®ƒé€šè¿‡æ”¹å†™`descriptor.value`ï¼Œä½¿å¾—åŸæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨å‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚å®ƒä½¿ç”¨çš„äº‹ä»¶â€œå‘å¸ƒ/è®¢é˜…â€åº“æ˜¯[Postal.js](https://github.com/postaljs/postal.js)ã€‚\n\nå®ƒçš„ç”¨æ³•å¦‚ä¸‹ã€‚\n\n```javascript\n// index.js\nimport publish from \"./publish\";\n\nclass FooComponent {\n  @publish(\"foo.some.message\", \"component\")\n  someMethod() {\n    return { my: \"data\" };\n  }\n  @publish(\"foo.some.other\")\n  anotherMethod() {\n    // ...\n  }\n}\n\nlet foo = new FooComponent();\n\nfoo.someMethod();\nfoo.anotherMethod();\n```\n\nä»¥åï¼Œåªè¦è°ƒç”¨`someMethod`æˆ–è€…`anotherMethod`ï¼Œå°±ä¼šè‡ªåŠ¨å‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚\n\n```bash\n$ bash-node index.js\né¢‘é“:  component\näº‹ä»¶:  foo.some.message\næ•°æ®:  { my: 'data' }\n\né¢‘é“:  /\näº‹ä»¶:  foo.some.other\næ•°æ®:  undefined\n\n```\n\n## Mixin\n\nåœ¨è£…é¥°å™¨çš„åŸºç¡€ä¸Šï¼Œå¯ä»¥å®ç°`Mixin`æ¨¡å¼ã€‚æ‰€è°“`Mixin`æ¨¡å¼ï¼Œå°±æ˜¯**å¯¹è±¡ç»§æ‰¿çš„ä¸€ç§æ›¿ä»£æ–¹æ¡ˆ**ï¼Œä¸­æ–‡è¯‘ä¸ºâ€œæ··å…¥â€ï¼ˆmix inï¼‰ï¼Œæ„ä¸ºåœ¨ä¸€ä¸ªå¯¹è±¡ä¹‹ä¸­æ··å…¥å¦å¤–ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚\n\nè¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚\n\n```javascript\nconst Foo = {\n  foo() {\n    console.log(\"foo\");\n  }\n};\n\nclass MyClass {}\n\nObject.assign(MyClass.prototype, Foo);\n\nlet obj = new MyClass();\nobj.foo(); // 'foo'\n```\n\nä¸Šé¢ä»£ç ä¹‹ä¸­ï¼Œå¯¹è±¡`Foo`æœ‰ä¸€ä¸ª`foo`æ–¹æ³•ï¼Œé€šè¿‡`Object.assign`æ–¹æ³•ï¼Œå¯ä»¥å°†`foo`æ–¹æ³•â€œæ··å…¥â€`MyClass`ç±»ï¼Œå¯¼è‡´`MyClass`çš„å®ä¾‹`obj`å¯¹è±¡éƒ½å…·æœ‰`foo`æ–¹æ³•ã€‚è¿™å°±æ˜¯â€œæ··å…¥â€æ¨¡å¼çš„ä¸€ä¸ªç®€å•å®ç°ã€‚\n\nä¸‹é¢ï¼Œæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªé€šç”¨è„šæœ¬`mixins.js`ï¼Œå°† Mixin å†™æˆä¸€ä¸ªè£…é¥°å™¨ã€‚\n\n```javascript\nexport function mixins(...list) {\n  return function(target) {\n    Object.assign(target.prototype, ...list);\n  };\n}\n```\n\nç„¶åï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸Šé¢è¿™ä¸ªè£…é¥°å™¨ï¼Œä¸ºç±»â€œæ··å…¥â€å„ç§æ–¹æ³•ã€‚\n\n```javascript\nimport { mixins } from \"./mixins\";\n\nconst Foo = {\n  foo() {\n    console.log(\"foo\");\n  }\n};\n\n@mixins(Foo)\nclass MyClass {}\n\nlet obj = new MyClass();\nobj.foo(); // \"foo\"\n```\n\né€šè¿‡`mixins`è¿™ä¸ªè£…é¥°å™¨ï¼Œå®ç°äº†åœ¨`MyClass`ç±»ä¸Šé¢â€œæ··å…¥â€`Foo`å¯¹è±¡çš„`foo`æ–¹æ³•ã€‚\n\nä¸è¿‡ï¼Œä¸Šé¢çš„æ–¹æ³•ä¼šæ”¹å†™`MyClass`ç±»çš„`prototype`å¯¹è±¡ï¼Œå¦‚æœä¸å–œæ¬¢è¿™ä¸€ç‚¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç±»çš„ç»§æ‰¿å®ç° Mixinã€‚\n\n```javascript\nclass MyClass extends MyBaseClass {\n  /* ... */\n}\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œ`MyClass`ç»§æ‰¿äº†`MyBaseClass`ã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨`MyClass`é‡Œé¢â€œæ··å…¥â€ä¸€ä¸ª`foo`æ–¹æ³•ï¼Œä¸€ä¸ªåŠæ³•æ˜¯åœ¨`MyClass`å’Œ`MyBaseClass`ä¹‹é—´æ’å…¥ä¸€ä¸ªæ··å…¥ç±»ï¼Œè¿™ä¸ªç±»å…·æœ‰`foo`æ–¹æ³•ï¼Œå¹¶ä¸”ç»§æ‰¿äº†`MyBaseClass`çš„æ‰€æœ‰æ–¹æ³•ï¼Œç„¶å`MyClass`å†ç»§æ‰¿è¿™ä¸ªç±»ã€‚\n\n```javascript\nlet MyMixin = superclass =>\n  class extends superclass {\n    foo() {\n      console.log(\"foo from MyMixin\");\n    }\n  };\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œ`MyMixin`æ˜¯ä¸€ä¸ªæ··å…¥ç±»ç”Ÿæˆå™¨ï¼Œæ¥å—`superclass`ä½œä¸ºå‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªç»§æ‰¿`superclass`çš„å­ç±»ï¼Œè¯¥å­ç±»åŒ…å«ä¸€ä¸ª`foo`æ–¹æ³•ã€‚\n\næ¥ç€ï¼Œç›®æ ‡ç±»å†å»ç»§æ‰¿è¿™ä¸ªæ··å…¥ç±»ï¼Œå°±è¾¾åˆ°äº†â€œæ··å…¥â€`foo`æ–¹æ³•çš„ç›®çš„ã€‚\n\n```javascript\nclass MyClass extends MyMixin(MyBaseClass) {\n  /* ... */\n}\n\nlet c = new MyClass();\nc.foo(); // \"foo from MyMixin\"\n```\n\nå¦‚æœéœ€è¦â€œæ··å…¥â€å¤šä¸ªæ–¹æ³•ï¼Œå°±ç”Ÿæˆå¤šä¸ªæ··å…¥ç±»ã€‚\n\n```javascript\nclass MyClass extends Mixin1(Mixin2(MyBaseClass)) {\n  /* ... */\n}\n```\n\nè¿™ç§å†™æ³•çš„ä¸€ä¸ªå¥½å¤„ï¼Œæ˜¯å¯ä»¥è°ƒç”¨`super`ï¼Œå› æ­¤å¯ä»¥é¿å…åœ¨â€œæ··å…¥â€è¿‡ç¨‹ä¸­è¦†ç›–çˆ¶ç±»çš„åŒåæ–¹æ³•ã€‚\n\n```javascript\nlet Mixin1 = superclass =>\n  class extends superclass {\n    foo() {\n      console.log(\"foo from Mixin1\");\n      if (super.foo) super.foo();\n    }\n  };\n\nlet Mixin2 = superclass =>\n  class extends superclass {\n    foo() {\n      console.log(\"foo from Mixin2\");\n      if (super.foo) super.foo();\n    }\n  };\n\nclass S {\n  foo() {\n    console.log(\"foo from S\");\n  }\n}\n\nclass C extends Mixin1(Mixin2(S)) {\n  foo() {\n    console.log(\"foo from C\");\n    super.foo();\n  }\n}\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œæ¯ä¸€æ¬¡`æ··å…¥`å‘ç”Ÿæ—¶ï¼Œéƒ½è°ƒç”¨äº†çˆ¶ç±»çš„`super.foo`æ–¹æ³•ï¼Œå¯¼è‡´çˆ¶ç±»çš„åŒåæ–¹æ³•æ²¡æœ‰è¢«è¦†ç›–ï¼Œè¡Œä¸ºè¢«ä¿ç•™äº†ä¸‹æ¥ã€‚\n\n```javascript\nnew C().foo();\n// foo from C\n// foo from Mixin1\n// foo from Mixin2\n// foo from S\n```\n\n## Trait\n\nTrait ä¹Ÿæ˜¯ä¸€ç§è£…é¥°å™¨ï¼Œæ•ˆæœä¸ Mixin ç±»ä¼¼ï¼Œä½†æ˜¯æä¾›æ›´å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚é˜²æ­¢åŒåæ–¹æ³•çš„å†²çªã€æ’é™¤æ··å…¥æŸäº›æ–¹æ³•ã€ä¸ºæ··å…¥çš„æ–¹æ³•èµ·åˆ«åç­‰ç­‰ã€‚\n\nä¸‹é¢é‡‡ç”¨[traits-decorator](https://github.com/CocktailJS/traits-decorator)è¿™ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ä½œä¸ºä¾‹å­ã€‚è¿™ä¸ªæ¨¡å—æä¾›çš„`traits`è£…é¥°å™¨ï¼Œä¸ä»…å¯ä»¥æ¥å—å¯¹è±¡ï¼Œè¿˜å¯ä»¥æ¥å— ES6 ç±»ä½œä¸ºå‚æ•°ã€‚\n\n```javascript\nimport { traits } from \"traits-decorator\";\n\nclass TFoo {\n  foo() {\n    console.log(\"foo\");\n  }\n}\n\nconst TBar = {\n  bar() {\n    console.log(\"bar\");\n  }\n};\n\n@traits(TFoo, TBar)\nclass MyClass {}\n\nlet obj = new MyClass();\nobj.foo(); // foo\nobj.bar(); // bar\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œé€šè¿‡`traits`è£…é¥°å™¨ï¼Œåœ¨`MyClass`ç±»ä¸Šé¢â€œæ··å…¥â€äº†`TFoo`ç±»çš„`foo`æ–¹æ³•å’Œ`TBar`å¯¹è±¡çš„`bar`æ–¹æ³•ã€‚\n\nTrait ä¸å…è®¸â€œæ··å…¥â€åŒåæ–¹æ³•ã€‚\n\n```javascript\nimport { traits } from \"traits-decorator\";\n\nclass TFoo {\n  foo() {\n    console.log(\"foo\");\n  }\n}\n\nconst TBar = {\n  bar() {\n    console.log(\"bar\");\n  },\n  foo() {\n    console.log(\"foo\");\n  }\n};\n\n@traits(TFoo, TBar)\nclass MyClass {}\n// æŠ¥é”™\n// throw new Error('Method named: ' + methodName + ' is defined twice.');\n//        ^\n// Error: Method named: foo is defined twice.\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œ`TFoo`å’Œ`TBar`éƒ½æœ‰`foo`æ–¹æ³•ï¼Œç»“æœ`traits`è£…é¥°å™¨æŠ¥é”™ã€‚\n\nä¸€ç§è§£å†³æ–¹æ³•æ˜¯æ’é™¤`TBar`çš„`foo`æ–¹æ³•ã€‚\n\n```javascript\nimport { traits, excludes } from \"traits-decorator\";\n\nclass TFoo {\n  foo() {\n    console.log(\"foo\");\n  }\n}\n\nconst TBar = {\n  bar() {\n    console.log(\"bar\");\n  },\n  foo() {\n    console.log(\"foo\");\n  }\n};\n\n@traits(TFoo, TBar::excludes(\"foo\"))\nclass MyClass {}\n\nlet obj = new MyClass();\nobj.foo(); // foo\nobj.bar(); // bar\n```\n\nä¸Šé¢ä»£ç ä½¿ç”¨ç»‘å®šè¿ç®—ç¬¦ï¼ˆ::ï¼‰åœ¨`TBar`ä¸Šæ’é™¤`foo`æ–¹æ³•ï¼Œæ··å…¥æ—¶å°±ä¸ä¼šæŠ¥é”™äº†ã€‚\n\nå¦ä¸€ç§æ–¹æ³•æ˜¯ä¸º`TBar`çš„`foo`æ–¹æ³•èµ·ä¸€ä¸ªåˆ«åã€‚\n\n```javascript\nimport { traits, alias } from \"traits-decorator\";\n\nclass TFoo {\n  foo() {\n    console.log(\"foo\");\n  }\n}\n\nconst TBar = {\n  bar() {\n    console.log(\"bar\");\n  },\n  foo() {\n    console.log(\"foo\");\n  }\n};\n\n@traits(TFoo, TBar::alias({ foo: \"aliasFoo\" }))\nclass MyClass {}\n\nlet obj = new MyClass();\nobj.foo(); // foo\nobj.aliasFoo(); // foo\nobj.bar(); // bar\n```\n\nä¸Šé¢ä»£ç ä¸º`TBar`çš„`foo`æ–¹æ³•èµ·äº†åˆ«å`aliasFoo`ï¼Œäºæ˜¯`MyClass`ä¹Ÿå¯ä»¥æ··å…¥`TBar`çš„`foo`æ–¹æ³•äº†ã€‚\n\n`alias`å’Œ`excludes`æ–¹æ³•ï¼Œå¯ä»¥ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚\n\n```javascript\n@traits(TExample::excludes(\"foo\", \"bar\")::alias({ baz: \"exampleBaz\" }))\nclass MyClass {}\n```\n\nä¸Šé¢ä»£ç æ’é™¤äº†`TExample`çš„`foo`æ–¹æ³•å’Œ`bar`æ–¹æ³•ï¼Œä¸º`baz`æ–¹æ³•èµ·äº†åˆ«å`exampleBaz`ã€‚\n\n`as`æ–¹æ³•åˆ™ä¸ºä¸Šé¢çš„ä»£ç æä¾›äº†å¦ä¸€ç§å†™æ³•ã€‚\n\n```javascript\n@traits(\n  TExample::as({ excludes: [\"foo\", \"bar\"], alias: { baz: \"exampleBaz\" } })\n)\nclass MyClass {}\n```\n","tags":["JavaScript","ES6"],"categories":["ES6"]},{"title":"QUIC","url":"/2019/08/16/QUIC/","content":"\n# QUIC\n\n## QUIC æ¦‚è¿°\n\nQuic å…¨ç§° quick udp internet connection [1]ï¼Œâ€œå¿«é€Ÿ UDP äº’è”ç½‘è¿æ¥â€ï¼Œï¼ˆå’Œè‹±æ–‡ quick è°éŸ³ï¼Œç®€ç§°â€œå¿«â€ï¼‰æ˜¯ç”± google æå‡ºçš„ä½¿ç”¨ udp è¿›è¡Œå¤šè·¯å¹¶å‘ä¼ è¾“çš„åè®®ã€‚\n\nQUIC åè®®å†…ç½®äº† TLS æ ˆï¼Œå®ç°äº†è‡ªå·±çš„[ä¼ è¾“åŠ å¯†å±‚](https://docs.google.com/document/d/1g5nIXAIkN_Y-7XJW5K45IblHd_L2f5LTaDUDwvZ5L6g/edit)ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨ç°æœ‰çš„ TLS 1.2ã€‚åŒæ—¶ QUIC è¿˜åŒ…å«äº†éƒ¨åˆ† HTTP/2 çš„å®ç°ï¼Œå› æ­¤ QUIC çš„åœ°ä½çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š\n\n<!-- more -->\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izr9eluaj315w0k0aaa.jpg)\n\nä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼ŒQUIC åº•å±‚é€šè¿‡ UDP åè®®æ›¿ä»£äº† TCPï¼Œä¸Šå±‚åªéœ€è¦ä¸€å±‚ç”¨äºå’Œè¿œç¨‹æœåŠ¡å™¨äº¤äº’çš„ HTTP/2 APIã€‚è¿™æ˜¯å› ä¸º QUIC åè®®å·²ç»åŒ…å«äº†å¤šè·¯å¤ç”¨å’Œè¿æ¥ç®¡ç†ï¼ŒHTTP API åªéœ€è¦å®Œæˆ HTTP åè®®çš„è§£æå³å¯ã€‚\n\n## QUIC ä¼˜åŠ¿\n\n1. å‡å°‘äº† TCP ä¸‰æ¬¡æ¡æ‰‹åŠ TLS æ¡æ‰‹æ—¶é—´ã€‚\n2. æ”¹è¿›çš„æ‹¥å¡æ§åˆ¶ã€‚\n3. é¿å…é˜Ÿå¤´é˜»å¡çš„å¤šè·¯å¤ç”¨ã€‚\n4. è¿æ¥è¿ç§»ã€‚\n5. å‰å‘å†—ä½™çº é”™ã€‚ï¼ˆç›®å‰é»˜è®¤çš„å†—ä½™é‡æ˜¯ 10%ï¼Œæ—¢æ¯å‘é€ 10 ä¸ªæ•°æ®åŒ…ï¼Œå…¶å†—ä½™æ•°æ®å°±å¯ä»¥é‡æ–°æ„å»ºä¸€ä¸ªä¸¢å¤±çš„æ•°æ®åŒ…ï¼‰\n\n## ä¸ºä»€ä¹ˆéœ€è¦ QUIC\n\n1. åè®®å†å²æ‚ ä¹…å¯¼è‡´ä¸­é—´è®¾å¤‡åƒµåŒ–ã€‚\n\n   TCP åè®®æœ¬æ¥æ˜¯æ”¯æŒç«¯å£ã€é€‰é¡¹åŠç‰¹æ€§çš„å¢åŠ å’Œä¿®æ”¹ã€‚ä½†æ˜¯ç”±äº TCP åè®®å’ŒçŸ¥åç«¯å£ï¼ˆ80ã€443ï¼‰åŠé€‰é¡¹ä½¿ç”¨çš„å†å²å¤ªæ‚ ä¹…ï¼Œä¸­é—´è®¾å¤‡å·²ç»ä¾èµ–äºè¿™äº›æ½œè§„åˆ™ï¼Œæ‰€ä»¥å¯¹è¿™äº›å†…å®¹çš„ä¿®æ”¹å¾ˆå®¹æ˜“é­åˆ°ä¸­é—´ç¯èŠ‚çš„å¹²æ‰°è€Œå¤±è´¥ã€‚\n\n2. ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„å®ç°å¯¼è‡´åè®®æœ¬èº«åƒµåŒ–ã€‚\n\n   TCP æ˜¯ç”±æ“ä½œç³»ç»Ÿåœ¨å†…æ ¸è¥¿æ–¹æ ˆå±‚é¢å®ç°çš„ï¼Œåº”ç”¨ç¨‹åºåªèƒ½ä½¿ç”¨ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹ã€‚è™½ç„¶åº”ç”¨ç¨‹åºçš„æ›´æ–°è¿­ä»£éå¸¸å¿«é€Ÿå’Œç®€å•ã€‚ä½†æ˜¯ TCP çš„è¿­ä»£å´éå¸¸ç¼“æ…¢ï¼ŒåŸå› å°±æ˜¯æ“ä½œç³»ç»Ÿå‡çº§å¾ˆéº»çƒ¦ã€‚æœåŠ¡ç«¯ç³»ç»Ÿä¸ä¾èµ–ç”¨æˆ·å‡çº§ï¼Œä½†æ˜¯ç”±äºæ“ä½œç³»ç»Ÿå‡çº§æ¶‰åŠåˆ°åº•å±‚è½¯ä»¶å’Œè¿è¡Œåº“çš„æ›´æ–°ï¼Œæ‰€ä»¥ä¹Ÿæ¯”è¾ƒä¿å®ˆå’Œç¼“æ…¢ã€‚\n\n3. å»ºç«‹è¿æ¥çš„æ¡æ‰‹å»¶è¿Ÿå¤§ã€‚\n\n   ä¸ç®¡æ˜¯ HTTP1.0/1.1 è¿˜æ˜¯ HTTPSï¼ŒHTTP2ï¼Œéƒ½ä½¿ç”¨äº† TCP è¿›è¡Œä¼ è¾“ã€‚HTTPS å’Œ HTTP2 è¿˜éœ€è¦ä½¿ç”¨ TLS åè®®æ¥è¿›è¡Œå®‰å…¨ä¼ è¾“ã€‚è¿™å°±å‡ºç°äº†ä¸¤ä¸ªæ¡æ‰‹å»¶è¿Ÿï¼š\n\n   - TCP ä¸‰æ¬¡æ¡æ‰‹å¯¼è‡´çš„ TCP è¿æ¥å»ºç«‹çš„å»¶è¿Ÿã€‚\n   - TLS å®Œå…¨æ¡æ‰‹éœ€è¦è‡³å°‘ 2 ä¸ª RTT æ‰èƒ½å»ºç«‹ï¼Œç®€åŒ–æ¡æ‰‹éœ€è¦ 1 ä¸ª RTT çš„æ¡æ‰‹å»¶è¿Ÿã€‚\n\n   å¯¹äºå¾ˆå¤šçŸ­è¿æ¥åœºæ™¯ï¼Œè¿™æ ·çš„æ¡æ‰‹å»¶è¿Ÿå½±å“å¾ˆå¤§ï¼Œä¸”æ— æ³•æ¶ˆé™¤ã€‚\n\n4. é˜Ÿå¤´é˜»å¡ã€‚\n\n   é˜Ÿå¤´é˜»å¡ä¸»è¦æ˜¯ TCP åè®®çš„å¯é æ€§æœºåˆ¶å¼•å…¥çš„ã€‚TCP ä½¿ç”¨åºåˆ—å·æ¥æ ‡è¯†æ•°æ®çš„é¡ºåºï¼Œæ•°æ®å¿…é¡»æŒ‰ç…§é¡ºåºå¤„ç†ï¼Œå¦‚æœå‰é¢çš„æ•°æ®ä¸¢å¤±ï¼Œåé¢çš„æ•°æ®å°±ç®—åˆ°è¾¾äº†ä¹Ÿä¸ä¼šé€šçŸ¥åº”ç”¨å±‚æ¥å¤„ç†ã€‚\n\n   å¦å¤– TLS åè®®å±‚é¢ä¹Ÿæœ‰ä¸€ä¸ªé˜Ÿå¤´é˜»å¡ï¼Œå› ä¸º TLS åè®®éƒ½æ˜¯æŒ‰ç…§ record æ¥å¤„ç†æ•°æ®çš„ï¼Œå¦‚æœä¸€ä¸ª record ä¸­ä¸¢å¤±äº†æ•°æ®ï¼Œä¹Ÿä¼šå¯¼è‡´æ•´ä¸ª record æ— æ³•æ­£ç¡®å¤„ç†ã€‚\n\n**QUIC åè®®é€‰æ‹©äº† UDPï¼Œå› ä¸º UDP æœ¬èº«æ²¡æœ‰è¿æ¥çš„æ¦‚å¿µï¼Œä¸éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¼˜åŒ–äº†è¿æ¥å»ºç«‹çš„æ¡æ‰‹å»¶è¿Ÿï¼ŒåŒæ—¶åœ¨åº”ç”¨ç¨‹åºå±‚é¢å®ç°äº† TCP çš„å¯é æ€§ï¼ŒTLS çš„å®‰å…¨æ€§å’Œ HTTP2 çš„å¹¶å‘æ€§ï¼Œåªéœ€è¦ç”¨æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åº”ç”¨ç¨‹åºæ”¯æŒ QUIC åè®®ï¼Œå®Œå…¨é¿å¼€äº†æ“ä½œç³»ç»Ÿå’Œä¸­é—´è®¾å¤‡çš„é™åˆ¶ã€‚**\n\n## QUIC è¯¦è§£\n\n### 1. QUIC æ ¸å¿ƒç‰¹æ€§è¿æ¥å»ºç«‹å»¶æ—¶ä½\n\n**0RTT å»ºè¿**å¯ä»¥è¯´æ˜¯ QUIC ç›¸æ¯” HTTP2 æœ€å¤§çš„æ€§èƒ½ä¼˜åŠ¿ã€‚é‚£ä»€ä¹ˆæ˜¯ 0RTT å»ºè¿å‘¢ï¼Ÿè¿™é‡Œé¢æœ‰ä¸¤å±‚å«ä¹‰ã€‚\n\n1. ä¼ è¾“å±‚ 0RTT å°±èƒ½å»ºç«‹è¿æ¥ã€‚\n2. åŠ å¯†å±‚ 0RTT å°±èƒ½å»ºç«‹åŠ å¯†è¿æ¥ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izr8c4vjj314a0n0gpa.jpg)\n\næ¯”å¦‚ä¸Šå›¾å·¦è¾¹æ˜¯ HTTPS çš„ä¸€æ¬¡å®Œå…¨æ¡æ‰‹çš„å»ºè¿è¿‡ç¨‹ï¼Œéœ€è¦ 3 ä¸ª RTTã€‚å°±ç®—æ˜¯ Session Resumption[14]ï¼Œä¹Ÿéœ€è¦è‡³å°‘ 2 ä¸ª RTTã€‚\n\nè€Œ QUIC å‘¢ï¼Ÿç”±äºå»ºç«‹åœ¨ UDP çš„åŸºç¡€ä¸Šï¼ŒåŒæ—¶åˆå®ç°äº† 0RTT çš„å®‰å…¨æ¡æ‰‹ï¼Œæ‰€ä»¥åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œåªéœ€è¦ 0 ä¸ª RTT å°±èƒ½å®ç°æ•°æ®å‘é€ï¼Œåœ¨å®ç°å‰å‘åŠ å¯†çš„åŸºç¡€ä¸Šï¼Œå¹¶ä¸” 0RTT çš„æˆåŠŸç‡ç›¸æ¯” TLS çš„ Sesison Ticket[13] è¦é«˜å¾ˆå¤šã€‚\n\n### 2. æ”¹è¿›çš„æ‹¥å¡æ§åˆ¶\n\nTCP çš„æ‹¥å¡æ§åˆ¶å®é™…ä¸ŠåŒ…å«äº†å››ä¸ªç®—æ³•ï¼šæ…¢å¯åŠ¨ï¼Œæ‹¥å¡é¿å…ï¼Œå¿«é€Ÿé‡ä¼ ï¼Œå¿«é€Ÿæ¢å¤ã€‚\n\nQUIC åè®®å½“å‰é»˜è®¤ä½¿ç”¨äº† TCP åè®®çš„ Cubic æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ CubicBytes, Reno, RenoBytes, BBR, PCC ç­‰æ‹¥å¡æ§åˆ¶ç®—æ³•ã€‚\n\nä»æ‹¥å¡ç®—æ³•æœ¬èº«æ¥çœ‹ï¼ŒQUIC åªæ˜¯æŒ‰ç…§ TCP åè®®é‡æ–°å®ç°äº†ä¸€éï¼Œé‚£ä¹ˆ QUIC åè®®åˆ°åº•æ”¹è¿›åœ¨å“ªäº›æ–¹é¢å‘¢ï¼Ÿä¸»è¦æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š\n\n- **å¯æ’æ‹”**\n\nä»€ä¹ˆå«å¯æ’æ‹”å‘¢ï¼Ÿå°±æ˜¯èƒ½å¤Ÿéå¸¸çµæ´»åœ°ç”Ÿæ•ˆï¼Œå˜æ›´å’Œåœæ­¢ã€‚ä½“ç°åœ¨å¦‚ä¸‹æ–¹é¢ï¼š\n\n1. åº”ç”¨ç¨‹åºå±‚é¢å°±èƒ½å®ç°ä¸åŒçš„æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œä¸éœ€è¦æ“ä½œç³»ç»Ÿï¼Œä¸éœ€è¦å†…æ ¸æ”¯æŒã€‚è¿™æ˜¯ä¸€ä¸ªé£è·ƒï¼Œå› ä¸ºä¼ ç»Ÿçš„ TCP æ‹¥å¡æ§åˆ¶ï¼Œå¿…é¡»è¦ç«¯åˆ°ç«¯çš„ç½‘ç»œåè®®æ ˆæ”¯æŒï¼Œæ‰èƒ½å®ç°æ§åˆ¶æ•ˆæœã€‚è€Œå†…æ ¸å’Œæ“ä½œç³»ç»Ÿçš„éƒ¨ç½²æˆæœ¬éå¸¸é«˜ï¼Œå‡çº§å‘¨æœŸå¾ˆé•¿ï¼Œè¿™åœ¨äº§å“å¿«é€Ÿè¿­ä»£ï¼Œç½‘ç»œçˆ†ç‚¸å¼å¢é•¿çš„ä»Šå¤©ï¼Œæ˜¾ç„¶æœ‰ç‚¹æ»¡è¶³ä¸äº†éœ€æ±‚ã€‚\n2. å³ä½¿æ˜¯å•ä¸ªåº”ç”¨ç¨‹åºçš„ä¸åŒè¿æ¥ä¹Ÿèƒ½æ”¯æŒé…ç½®ä¸åŒçš„æ‹¥å¡æ§åˆ¶ã€‚å°±ç®—æ˜¯ä¸€å°æœåŠ¡å™¨ï¼Œæ¥å…¥çš„ç”¨æˆ·ç½‘ç»œç¯å¢ƒä¹Ÿåƒå·®ä¸‡åˆ«ï¼Œç»“åˆå¤§æ•°æ®åŠäººå·¥æ™ºèƒ½å¤„ç†ï¼Œæˆ‘ä»¬èƒ½ä¸ºå„ä¸ªç”¨æˆ·æä¾›ä¸åŒçš„ä½†åˆæ›´åŠ ç²¾å‡†æ›´åŠ æœ‰æ•ˆçš„æ‹¥å¡æ§åˆ¶ã€‚æ¯”å¦‚ BBR é€‚åˆï¼ŒCubic é€‚åˆã€‚\n3. åº”ç”¨ç¨‹åºä¸éœ€è¦åœæœºå’Œå‡çº§å°±èƒ½å®ç°æ‹¥å¡æ§åˆ¶çš„å˜æ›´ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡ç«¯åªéœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®ï¼Œreload ä¸€ä¸‹ï¼Œå®Œå…¨ä¸éœ€è¦åœæ­¢æœåŠ¡å°±èƒ½å®ç°æ‹¥å¡æ§åˆ¶çš„åˆ‡æ¢ã€‚\n\nSTGW åœ¨é…ç½®å±‚é¢è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥é’ˆå¯¹ä¸åŒä¸šåŠ¡ï¼Œä¸åŒç½‘ç»œåˆ¶å¼ï¼Œç”šè‡³ä¸åŒçš„ RTTï¼Œä½¿ç”¨ä¸åŒçš„æ‹¥å¡æ§åˆ¶ç®—æ³•ã€‚\n\n- **å•è°ƒé€’å¢çš„ Packet Number**\n\nTCP ä¸ºäº†ä¿è¯å¯é æ€§ï¼Œä½¿ç”¨äº†åŸºäºå­—èŠ‚åºå·çš„ Sequence Number åŠ Ack æ¥ç¡®è®¤æ¶ˆæ¯çš„æœ‰åºåˆ°è¾¾ã€‚\n\nQUIC åŒæ ·æ˜¯ä¸€ä¸ªå¯é çš„åè®®ï¼Œå®ƒä½¿ç”¨ Packet Number ä»£æ›¿äº† TCP çš„ sequence numberï¼Œå¹¶ä¸”æ¯ä¸ª Packet Number éƒ½ä¸¥æ ¼é€’å¢ï¼Œä¹Ÿå°±æ˜¯è¯´å°±ç®— Packet N ä¸¢å¤±äº†ï¼Œé‡ä¼ çš„ Packet N çš„ Packet Number å·²ç»ä¸æ˜¯ Nï¼Œè€Œæ˜¯ä¸€ä¸ªæ¯” N å¤§çš„å€¼ã€‚è€Œ TCP å‘¢ï¼Œé‡ä¼  segment çš„ sequence number å’ŒåŸå§‹çš„ segment çš„ Sequence Number ä¿æŒä¸å˜ï¼Œä¹Ÿæ­£æ˜¯ç”±äºè¿™ä¸ªç‰¹æ€§ï¼Œå¼•å…¥äº† Tcp é‡ä¼ çš„æ­§ä¹‰é—®é¢˜ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izrp5123j30k008rjro.jpg)\n\nâ€‹ å›¾ 2 Tcp é‡ä¼ æ­§ä¹‰æ€§\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¶…æ—¶äº‹ä»¶ RTO å‘ç”Ÿåï¼Œå®¢æˆ·ç«¯å‘èµ·é‡ä¼ ï¼Œç„¶åæ¥æ”¶åˆ°äº† Ack æ•°æ®ã€‚ç”±äºåºåˆ—å·ä¸€æ ·ï¼Œè¿™ä¸ª Ack æ•°æ®åˆ°åº•æ˜¯åŸå§‹è¯·æ±‚çš„å“åº”è¿˜æ˜¯é‡ä¼ è¯·æ±‚çš„å“åº”å‘¢ï¼Ÿä¸å¥½åˆ¤æ–­ã€‚\n\nå¦‚æœç®—æˆåŸå§‹è¯·æ±‚çš„å“åº”ï¼Œä½†å®é™…ä¸Šæ˜¯é‡ä¼ è¯·æ±‚çš„å“åº”ï¼ˆä¸Šå›¾å·¦ï¼‰ï¼Œä¼šå¯¼è‡´é‡‡æ · RTT å˜å¤§ã€‚å¦‚æœç®—æˆé‡ä¼ è¯·æ±‚çš„å“åº”ï¼Œä½†å®é™…ä¸Šæ˜¯åŸå§‹è¯·æ±‚çš„å“åº”ï¼Œåˆå¾ˆå®¹æ˜“å¯¼è‡´é‡‡æ · RTT è¿‡å°ã€‚\n\nç”±äº Quic é‡ä¼ çš„ Packet å’ŒåŸå§‹ Packet çš„ Pakcet Number æ˜¯ä¸¥æ ¼é€’å¢çš„ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å°±è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izrs95mpj30k007xjrn.jpg)\n\nâ€‹ å›¾ 3 Quic é‡ä¼ æ²¡æœ‰æ­§ä¹‰æ€§\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒRTO å‘ç”Ÿåï¼Œæ ¹æ®é‡ä¼ çš„ Packet Number å°±èƒ½ç¡®å®šç²¾ç¡®çš„ RTT è®¡ç®—ã€‚å¦‚æœ Ack çš„ Packet Number æ˜¯ N+Mï¼Œå°±æ ¹æ®é‡ä¼ è¯·æ±‚è®¡ç®—é‡‡æ · RTTã€‚å¦‚æœ Ack çš„ Pakcet Number æ˜¯ Nï¼Œå°±æ ¹æ®åŸå§‹è¯·æ±‚çš„æ—¶é—´è®¡ç®—é‡‡æ · RTTï¼Œæ²¡æœ‰æ­§ä¹‰æ€§ã€‚\n\nä½†æ˜¯å•çº¯ä¾é ä¸¥æ ¼é€’å¢çš„ Packet Number è‚¯å®šæ˜¯æ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºæ€§å’Œå¯é æ€§ã€‚QUIC åˆå¼•å…¥äº†ä¸€ä¸ª Stream Offset çš„æ¦‚å¿µã€‚\n\nå³ä¸€ä¸ª Stream å¯ä»¥ç»è¿‡å¤šä¸ª Packet ä¼ è¾“ï¼ŒPacket Number ä¸¥æ ¼é€’å¢ï¼Œæ²¡æœ‰ä¾èµ–ã€‚ä½†æ˜¯ Packet é‡Œçš„ Payload å¦‚æœæ˜¯ Stream çš„è¯ï¼Œå°±éœ€è¦ä¾é  Stream çš„ Offset æ¥ä¿è¯åº”ç”¨æ•°æ®çš„é¡ºåºã€‚å¦‚é”™è¯¯! æœªæ‰¾åˆ°å¼•ç”¨æºã€‚æ‰€ç¤ºï¼Œå‘é€ç«¯å…ˆåå‘é€äº† Pakcet N å’Œ Pakcet N+1ï¼ŒStream çš„ Offset åˆ†åˆ«æ˜¯ x å’Œ x+yã€‚\n\nå‡è®¾ Packet N ä¸¢å¤±äº†ï¼Œå‘èµ·é‡ä¼ ï¼Œé‡ä¼ çš„ Packet Number æ˜¯ N+2ï¼Œä½†æ˜¯å®ƒçš„ Stream çš„ Offset ä¾ç„¶æ˜¯ xï¼Œè¿™æ ·å°±ç®— Packet N + 2 æ˜¯ååˆ°çš„ï¼Œä¾ç„¶å¯ä»¥å°† Stream x å’Œ Stream x+y æŒ‰ç…§é¡ºåºç»„ç»‡èµ·æ¥ï¼Œäº¤ç»™åº”ç”¨ç¨‹åºå¤„ç†ã€‚\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izrw4o31j30k005smxc.jpg)\n\nâ€‹ å›¾ 4 Stream Offset ä¿è¯æœ‰åºæ€§\n\n- **ä¸å…è®¸ Reneging**\n\nä»€ä¹ˆå« Reneging å‘¢ï¼Ÿå°±æ˜¯æ¥æ”¶æ–¹ä¸¢å¼ƒå·²ç»æ¥æ”¶å¹¶ä¸”ä¸ŠæŠ¥ç»™ SACK é€‰é¡¹çš„å†…å®¹ã€‚TCP åè®®ä¸é¼“åŠ±è¿™ç§è¡Œä¸ºï¼Œä½†æ˜¯åè®®å±‚é¢å…è®¸è¿™æ ·çš„è¡Œä¸ºã€‚ä¸»è¦æ˜¯è€ƒè™‘åˆ°æœåŠ¡å™¨èµ„æºæœ‰é™ï¼Œæ¯”å¦‚ Buffer æº¢å‡ºï¼Œå†…å­˜ä¸å¤Ÿç­‰æƒ…å†µã€‚\n\nReneging å¯¹æ•°æ®é‡ä¼ ä¼šäº§ç”Ÿå¾ˆå¤§çš„å¹²æ‰°ã€‚å› ä¸º Sack éƒ½å·²ç»è¡¨æ˜æ¥æ”¶åˆ°äº†ï¼Œä½†æ˜¯æ¥æ”¶ç«¯äº‹å®ä¸Šä¸¢å¼ƒäº†è¯¥æ•°æ®ã€‚\n\nQUIC åœ¨åè®®å±‚é¢ç¦æ­¢ Renegingï¼Œä¸€ä¸ª Packet åªè¦è¢« Ackï¼Œå°±è®¤ä¸ºå®ƒä¸€å®šè¢«æ­£ç¡®æ¥æ”¶ï¼Œå‡å°‘äº†è¿™ç§å¹²æ‰°ã€‚\n\n- **æ›´å¤šçš„ Ack å—**\n\nTCP çš„ Sack é€‰é¡¹èƒ½å¤Ÿå‘Šè¯‰å‘é€æ–¹å·²ç»æ¥æ”¶åˆ°çš„è¿ç»­ Segment çš„èŒƒå›´ï¼Œæ–¹ä¾¿å‘é€æ–¹è¿›è¡Œé€‰æ‹©æ€§é‡ä¼ ã€‚\n\nç”±äº TCP å¤´éƒ¨æœ€å¤§åªæœ‰ 60 ä¸ªå­—èŠ‚ï¼Œæ ‡å‡†å¤´éƒ¨å ç”¨äº† 20 å­—èŠ‚ï¼Œæ‰€ä»¥ Tcp Option æœ€å¤§é•¿åº¦åªæœ‰ 40 å­—èŠ‚ï¼Œå†åŠ ä¸Š Tcp Timestamp option å ç”¨äº† 10 ä¸ªå­—èŠ‚ [25]ï¼Œæ‰€ä»¥ç•™ç»™ Sack é€‰é¡¹çš„åªæœ‰ 30 ä¸ªå­—èŠ‚ã€‚\n\næ¯ä¸€ä¸ª Sack Block çš„é•¿åº¦æ˜¯ 8 ä¸ªï¼ŒåŠ ä¸Š Sack Option å¤´éƒ¨ 2 ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ„å‘³ç€ Tcp Sack Option æœ€å¤§åªèƒ½æä¾› 3 ä¸ª Blockã€‚\n\nä½†æ˜¯ Quic Ack Frame å¯ä»¥åŒæ—¶æä¾› 256 ä¸ª Ack Blockï¼Œåœ¨ä¸¢åŒ…ç‡æ¯”è¾ƒé«˜çš„ç½‘ç»œä¸‹ï¼Œæ›´å¤šçš„ Sack Block å¯ä»¥æå‡ç½‘ç»œçš„æ¢å¤é€Ÿåº¦ï¼Œå‡å°‘é‡ä¼ é‡ã€‚\n\n- **Ack Delay æ—¶é—´**\n\nTcp çš„ Timestamp é€‰é¡¹å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒåªæ˜¯å›æ˜¾äº†å‘é€æ–¹çš„æ—¶é—´æˆ³ï¼Œä½†æ˜¯æ²¡æœ‰è®¡ç®—æ¥æ”¶ç«¯æ¥æ”¶åˆ° segment åˆ°å‘é€ Ack è¯¥ segment çš„æ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´å¯ä»¥ç®€ç§°ä¸º Ack Delayã€‚\n\nè¿™æ ·å°±ä¼šå¯¼è‡´ RTT è®¡ç®—è¯¯å·®ã€‚å¦‚ä¸‹å›¾ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izrzqtwlj30k00f4wf5.jpg)\n\nå¯ä»¥è®¤ä¸º TCP çš„ RTT è®¡ç®—ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izs42dncj308d015743.jpg)\n\nè€Œ Quic è®¡ç®—å¦‚ä¸‹ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izs6x1lbj30a70153yc.jpg)\n\nå½“ç„¶ RTT çš„å…·ä½“è®¡ç®—æ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œéœ€è¦é‡‡æ ·ï¼Œå‚è€ƒå†å²æ•°å€¼è¿›è¡Œå¹³æ»‘è®¡ç®—ï¼Œå‚è€ƒå¦‚ä¸‹å…¬å¼ [9]ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izs9tffbj308d01vwed.jpg)\n\n### 3.åŸºäº stream å’Œ connecton çº§åˆ«çš„æµé‡æ§åˆ¶\n\nQUIC çš„æµé‡æ§åˆ¶ç±»ä¼¼ HTTP2ï¼Œå³åœ¨ Connection å’Œ Stream çº§åˆ«æä¾›äº†ä¸¤ç§æµé‡æ§åˆ¶ã€‚ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ç±»æµé‡æ§åˆ¶å‘¢ï¼Ÿä¸»è¦æ˜¯å› ä¸º QUIC æ”¯æŒå¤šè·¯å¤ç”¨ã€‚\n\n1. Stream å¯ä»¥è®¤ä¸ºå°±æ˜¯ä¸€æ¡ HTTP è¯·æ±‚ã€‚\n2. Connection å¯ä»¥ç±»æ¯”ä¸€æ¡ TCP è¿æ¥ã€‚å¤šè·¯å¤ç”¨æ„å‘³ç€åœ¨ä¸€æ¡ Connetion ä¸Šä¼šåŒæ—¶å­˜åœ¨å¤šæ¡ Streamã€‚æ—¢éœ€è¦å¯¹å•ä¸ª Stream è¿›è¡Œæ§åˆ¶ï¼Œåˆéœ€è¦é’ˆå¯¹æ‰€æœ‰ Stream è¿›è¡Œæ€»ä½“æ§åˆ¶ã€‚\n\nQUIC å®ç°æµé‡æ§åˆ¶çš„åŸç†æ¯”è¾ƒç®€å•ï¼š\n\né€šè¿‡ window_update å¸§å‘Šè¯‰å¯¹ç«¯è‡ªå·±å¯ä»¥æ¥æ”¶çš„å­—èŠ‚æ•°ï¼Œè¿™æ ·å‘é€æ–¹å°±ä¸ä¼šå‘é€è¶…è¿‡è¿™ä¸ªæ•°é‡çš„æ•°æ®ã€‚\n\né€šè¿‡ BlockFrame å‘Šè¯‰å¯¹ç«¯ç”±äºæµé‡æ§åˆ¶è¢«é˜»å¡äº†ï¼Œæ— æ³•å‘é€æ•°æ®ã€‚\n\nQUIC çš„æµé‡æ§åˆ¶å’Œ TCP æœ‰ç‚¹åŒºåˆ«ï¼ŒTCP ä¸ºäº†ä¿è¯å¯é æ€§ï¼Œçª—å£å·¦è¾¹æ²¿å‘å³æ»‘åŠ¨æ—¶çš„é•¿åº¦å–å†³äºå·²ç»ç¡®è®¤çš„å­—èŠ‚æ•°ã€‚å¦‚æœä¸­é—´å‡ºç°ä¸¢åŒ…ï¼Œå°±ç®—æ¥æ”¶åˆ°äº†æ›´å¤§åºå·çš„ Segmentï¼Œçª—å£ä¹Ÿæ— æ³•è¶…è¿‡è¿™ä¸ªåºåˆ—å·ã€‚\n\nä½† QUIC ä¸åŒï¼Œå°±ç®—æ­¤å‰æœ‰äº› packet æ²¡æœ‰æ¥æ”¶åˆ°ï¼Œå®ƒçš„æ»‘åŠ¨åªå–å†³äºæ¥æ”¶åˆ°çš„æœ€å¤§åç§»å­—èŠ‚æ•°ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izsddv9lj30k0087q3a.jpg)\n\nâ€‹ å›¾ 5 Quic Flow Control\n\né’ˆå¯¹ Streamï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izsh7d39j30bz011glh.jpg)\n\né’ˆå¯¹ Connectionï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izsk0cpyj30gy011a9z.jpg)\n\nåŒæ ·åœ°ï¼ŒSTGW ä¹Ÿåœ¨è¿æ¥å’Œ Stream çº§åˆ«è®¾ç½®äº†ä¸åŒçš„çª—å£æ•°ã€‚\n\næœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…å­˜ä¸è¶³æˆ–è€…ä¸Šæ¸¸å¤„ç†æ€§èƒ½å‡ºç°é—®é¢˜æ—¶ï¼Œé€šè¿‡æµé‡æ§åˆ¶æ¥é™åˆ¶ä¼ è¾“é€Ÿç‡ï¼Œä¿éšœæœåŠ¡å¯ç”¨æ€§ã€‚\n\n### 4.æ²¡æœ‰é˜Ÿå¤´é˜»å¡çš„å¤šè·¯å¤ç”¨\n\nQUIC çš„å¤šè·¯å¤ç”¨å’Œ HTTP2 ç±»ä¼¼ã€‚åœ¨ä¸€æ¡ QUIC è¿æ¥ä¸Šå¯ä»¥å¹¶å‘å‘é€å¤šä¸ª HTTP è¯·æ±‚ (stream)ã€‚ä½†æ˜¯ QUIC çš„å¤šè·¯å¤ç”¨ç›¸æ¯” HTTP2 æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜åŠ¿ã€‚\n\nQUIC ä¸€ä¸ªè¿æ¥ä¸Šçš„å¤šä¸ª stream ä¹‹é—´æ²¡æœ‰ä¾èµ–ã€‚è¿™æ ·å‡å¦‚ stream2 ä¸¢äº†ä¸€ä¸ª udp packetï¼Œä¹Ÿåªä¼šå½±å“ stream2 çš„å¤„ç†ã€‚ä¸ä¼šå½±å“ stream2 ä¹‹å‰åŠä¹‹åçš„ stream çš„å¤„ç†ã€‚\n\nè¿™ä¹Ÿå°±åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šç¼“è§£ç”šè‡³æ¶ˆé™¤äº†é˜Ÿå¤´é˜»å¡çš„å½±å“ã€‚\n\nå¤šè·¯å¤ç”¨æ˜¯ HTTP2 æœ€å¼ºå¤§çš„ç‰¹æ€§ï¼Œèƒ½å¤Ÿå°†å¤šæ¡è¯·æ±‚åœ¨ä¸€æ¡ TCP è¿æ¥ä¸ŠåŒæ—¶å‘å‡ºå»ã€‚ä½†ä¹Ÿæ¶åŒ–äº† TCP çš„ä¸€ä¸ªé—®é¢˜ï¼Œé˜Ÿå¤´é˜»å¡ï¼Œå¦‚ä¸‹å›¾ç¤ºï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izsn9t0ej30k007gq3a.jpg)\n\nâ€‹ å›¾ 6 HTTP2 é˜Ÿå¤´é˜»å¡\n\nHTTP2 åœ¨ä¸€ä¸ª TCP è¿æ¥ä¸ŠåŒæ—¶å‘é€ 4 ä¸ª Streamã€‚å…¶ä¸­ Stream1 å·²ç»æ­£ç¡®åˆ°è¾¾ï¼Œå¹¶è¢«åº”ç”¨å±‚è¯»å–ã€‚ä½†æ˜¯ Stream2 çš„ç¬¬ä¸‰ä¸ª tcp segment ä¸¢å¤±äº†ï¼ŒTCP ä¸ºäº†ä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œéœ€è¦å‘é€ç«¯é‡ä¼ ç¬¬ 3 ä¸ª segment æ‰èƒ½é€šçŸ¥åº”ç”¨å±‚è¯»å–æ¥ä¸‹å»çš„æ•°æ®ï¼Œè™½ç„¶è¿™ä¸ªæ—¶å€™ Stream3 å’Œ Stream4 çš„å…¨éƒ¨æ•°æ®å·²ç»åˆ°è¾¾äº†æ¥æ”¶ç«¯ï¼Œä½†éƒ½è¢«é˜»å¡ä½äº†ã€‚\n\nä¸ä»…å¦‚æ­¤ï¼Œç”±äº HTTP2 å¼ºåˆ¶ä½¿ç”¨ TLSï¼Œè¿˜å­˜åœ¨ä¸€ä¸ª TLS åè®®å±‚é¢çš„é˜Ÿå¤´é˜»å¡ [12]ã€‚\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izsr1djhj30k00ctaac.jpg)\n\nâ€‹ å›¾ 7 TLS é˜Ÿå¤´é˜»å¡\n\nRecord æ˜¯ TLS åè®®å¤„ç†çš„æœ€å°å•ä½ï¼Œæœ€å¤§ä¸èƒ½è¶…è¿‡ 16Kï¼Œä¸€äº›æœåŠ¡å™¨æ¯”å¦‚ Nginx é»˜è®¤çš„å¤§å°å°±æ˜¯ 16Kã€‚ç”±äºä¸€ä¸ª record å¿…é¡»ç»è¿‡æ•°æ®ä¸€è‡´æ€§æ ¡éªŒæ‰èƒ½è¿›è¡ŒåŠ è§£å¯†ï¼Œæ‰€ä»¥ä¸€ä¸ª 16K çš„ recordï¼Œå°±ç®—ä¸¢äº†ä¸€ä¸ªå­—èŠ‚ï¼Œä¹Ÿä¼šå¯¼è‡´å·²ç»æ¥æ”¶åˆ°çš„ 15.99K æ•°æ®æ— æ³•å¤„ç†ï¼Œå› ä¸ºå®ƒä¸å®Œæ•´ã€‚\n\né‚£ QUIC å¤šè·¯å¤ç”¨ä¸ºä»€ä¹ˆèƒ½é¿å…ä¸Šè¿°é—®é¢˜å‘¢ï¼Ÿ\n\n1. QUIC æœ€åŸºæœ¬çš„ä¼ è¾“å•å…ƒæ˜¯ Packetï¼Œä¸ä¼šè¶…è¿‡ MTU çš„å¤§å°ï¼Œæ•´ä¸ªåŠ å¯†å’Œè®¤è¯è¿‡ç¨‹éƒ½æ˜¯åŸºäº Packet çš„ï¼Œä¸ä¼šè·¨è¶Šå¤šä¸ª Packetã€‚è¿™æ ·å°±èƒ½é¿å… TLS åè®®å­˜åœ¨çš„é˜Ÿå¤´é˜»å¡ã€‚\n2. Stream ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œæ¯”å¦‚ Stream2 ä¸¢äº†ä¸€ä¸ª Pakcetï¼Œä¸ä¼šå½±å“ Stream3 å’Œ Stream4ã€‚ä¸å­˜åœ¨ TCP é˜Ÿå¤´é˜»å¡ã€‚ï¼ˆQUIC åè®®ç›´æ¥é€šè¿‡åº•å±‚ä½¿ç”¨ UDP åè®®å¤©ç„¶çš„é¿å…äº†è¯¥é—®é¢˜ã€‚ç”±äº UDP åè®®æ²¡æœ‰ä¸¥æ ¼çš„é¡ºåºï¼Œå½“ä¸€ä¸ªæ•°æ®åŒ…é‡åˆ°é—®é¢˜éœ€è¦é‡ä¼ æ—¶ï¼Œåªä¼šå½±å“è¯¥æ•°æ®åŒ…å¯¹åº”çš„èµ„æºï¼Œå…¶ä»–ç‹¬ç«‹çš„èµ„æºï¼ˆå¦‚å…¶ä»– cssã€js æ–‡ä»¶ï¼‰ä¸ä¼šå—åˆ°å½±å“ï¼‰\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izsvoeyqj30k007gdg7.jpg)\n\nâ€‹ å›¾ 8 QUIC å¤šè·¯å¤ç”¨æ—¶æ²¡æœ‰é˜Ÿå¤´é˜»å¡çš„é—®é¢˜\n\nå½“ç„¶ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ QUIC æ•°æ®éƒ½ä¸ä¼šå—åˆ°é˜Ÿå¤´é˜»å¡çš„å½±å“ï¼Œæ¯”å¦‚ QUIC å½“å‰ä¹Ÿæ˜¯ä½¿ç”¨ Hpack å‹ç¼©ç®—æ³• [10]ï¼Œç”±äºç®—æ³•çš„é™åˆ¶ï¼Œä¸¢å¤±ä¸€ä¸ªå¤´éƒ¨æ•°æ®æ—¶ï¼Œå¯èƒ½é‡åˆ°é˜Ÿå¤´é˜»å¡ã€‚\n\næ€»ä½“æ¥è¯´ï¼ŒQUIC åœ¨ä¼ è¾“å¤§é‡æ•°æ®æ—¶ï¼Œæ¯”å¦‚è§†é¢‘ï¼Œå—åˆ°é˜Ÿå¤´é˜»å¡çš„å½±å“å¾ˆå°ã€‚\n\n### 5.åŠ å¯†è®¤è¯çš„æŠ¥æ–‡\n\nTCP åè®®å¤´éƒ¨æ²¡æœ‰ç»è¿‡ä»»ä½•åŠ å¯†å’Œè®¤è¯ï¼Œæ‰€ä»¥åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“è¢«ä¸­é—´ç½‘ç»œè®¾å¤‡ç¯¡æ”¹ï¼Œæ³¨å…¥å’Œçªƒå¬ã€‚æ¯”å¦‚ä¿®æ”¹åºåˆ—å·ã€æ»‘åŠ¨çª—å£ã€‚è¿™äº›è¡Œä¸ºæœ‰å¯èƒ½æ˜¯å‡ºäºæ€§èƒ½ä¼˜åŒ–ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸»åŠ¨æ”»å‡»ã€‚\n\nä½†æ˜¯ QUIC çš„ packet å¯ä»¥è¯´æ˜¯æ­¦è£…åˆ°äº†ç‰™é½¿ã€‚é™¤äº†ä¸ªåˆ«æŠ¥æ–‡æ¯”å¦‚ PUBLIC_RESET å’Œ CHLOï¼Œæ‰€æœ‰æŠ¥æ–‡å¤´éƒ¨éƒ½æ˜¯ç»è¿‡è®¤è¯çš„ï¼ŒæŠ¥æ–‡ Body éƒ½æ˜¯ç»è¿‡åŠ å¯†çš„ã€‚\n\nè¿™æ ·åªè¦å¯¹ QUIC æŠ¥æ–‡ä»»ä½•ä¿®æ”¹ï¼Œæ¥æ”¶ç«¯éƒ½èƒ½å¤ŸåŠæ—¶å‘ç°ï¼Œæœ‰æ•ˆåœ°é™ä½äº†å®‰å…¨é£é™©ã€‚\n\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¢è‰²éƒ¨åˆ†æ˜¯ Stream Frame çš„æŠ¥æ–‡å¤´éƒ¨ï¼Œæœ‰è®¤è¯ã€‚ç»¿è‰²éƒ¨åˆ†æ˜¯æŠ¥æ–‡å†…å®¹ï¼Œå…¨éƒ¨ç»è¿‡åŠ å¯†ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izsyv3ovj30i3091dgf.jpg)\n\n### 6.è¿æ¥è¿ç§»\n\nä¸€æ¡ TCP è¿æ¥æ˜¯ç”±å››å…ƒç»„æ ‡è¯†çš„ï¼ˆæº IPï¼Œæºç«¯å£ï¼Œç›®çš„ IPï¼Œç›®çš„ç«¯å£ï¼‰ã€‚ä»€ä¹ˆå«è¿æ¥è¿ç§»å‘¢ï¼Ÿå°±æ˜¯å½“å…¶ä¸­ä»»ä½•ä¸€ä¸ªå…ƒç´ å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™æ¡è¿æ¥ä¾ç„¶ç»´æŒç€ï¼Œèƒ½å¤Ÿä¿æŒä¸šåŠ¡é€»è¾‘ä¸ä¸­æ–­ã€‚å½“ç„¶è¿™é‡Œé¢ä¸»è¦å…³æ³¨çš„æ˜¯å®¢æˆ·ç«¯çš„å˜åŒ–ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸å¯æ§å¹¶ä¸”ç½‘ç»œç¯å¢ƒç»å¸¸å‘ç”Ÿå˜åŒ–ï¼Œè€ŒæœåŠ¡ç«¯çš„ IP å’Œç«¯å£ä¸€èˆ¬éƒ½æ˜¯å›ºå®šçš„ã€‚\n\næ¯”å¦‚å¤§å®¶ä½¿ç”¨æ‰‹æœºåœ¨ WIFI å’Œ 4G ç§»åŠ¨ç½‘ç»œåˆ‡æ¢æ—¶ï¼Œå®¢æˆ·ç«¯çš„ IP è‚¯å®šä¼šå‘ç”Ÿå˜åŒ–ï¼Œéœ€è¦é‡æ–°å»ºç«‹å’ŒæœåŠ¡ç«¯çš„ TCP è¿æ¥ã€‚\n\nåˆæ¯”å¦‚å¤§å®¶ä½¿ç”¨å…¬å…± NAT å‡ºå£æ—¶ï¼Œæœ‰äº›è¿æ¥ç«äº‰æ—¶éœ€è¦é‡æ–°ç»‘å®šç«¯å£ï¼Œå¯¼è‡´å®¢æˆ·ç«¯çš„ç«¯å£å‘ç”Ÿå˜åŒ–ï¼ŒåŒæ ·éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥ã€‚\n\né’ˆå¯¹ TCP çš„è¿æ¥å˜åŒ–ï¼ŒMPTCP å…¶å®å·²ç»æœ‰äº†è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ç”±äº MPTCP éœ€è¦æ“ä½œç³»ç»ŸåŠç½‘ç»œåè®®æ ˆæ”¯æŒï¼Œéƒ¨ç½²é˜»åŠ›éå¸¸å¤§ï¼Œç›®å‰å¹¶ä¸é€‚ç”¨ã€‚\n\næ‰€ä»¥ä» TCP è¿æ¥çš„è§’åº¦æ¥è®²ï¼Œè¿™ä¸ªé—®é¢˜æ˜¯æ— è§£çš„ã€‚\n\né‚£ QUIC æ˜¯å¦‚ä½•åšåˆ°è¿æ¥è¿ç§»å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œä»»ä½•ä¸€æ¡ QUIC è¿æ¥ä¸å†ä»¥ IP åŠç«¯å£å››å…ƒç»„æ ‡è¯†ï¼Œè€Œæ˜¯ä»¥ä¸€ä¸ª 64 ä½çš„éšæœºæ•°ä½œä¸º ID æ¥æ ‡è¯†ï¼Œè¿™æ ·å°±ç®— IP æˆ–è€…ç«¯å£å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªè¦ ID ä¸å˜ï¼Œè¿™æ¡è¿æ¥ä¾ç„¶ç»´æŒç€ï¼Œä¸Šå±‚ä¸šåŠ¡é€»è¾‘æ„ŸçŸ¥ä¸åˆ°å˜åŒ–ï¼Œä¸ä¼šä¸­æ–­ï¼Œä¹Ÿå°±ä¸éœ€è¦é‡è¿ã€‚\n\nç”±äºè¿™ä¸ª ID æ˜¯å®¢æˆ·ç«¯éšæœºäº§ç”Ÿçš„ï¼Œå¹¶ä¸”é•¿åº¦æœ‰ 64 ä½ï¼Œæ‰€ä»¥å†²çªæ¦‚ç‡éå¸¸ä½ã€‚\n\n### 7.å…¶ä»–äº®ç‚¹\n\næ­¤å¤–ï¼ŒQUIC è¿˜èƒ½å®ç°å‰å‘å†—ä½™çº é”™ï¼Œåœ¨é‡è¦çš„åŒ…æ¯”å¦‚æ¡æ‰‹æ¶ˆæ¯å‘ç”Ÿä¸¢å¤±æ—¶ï¼Œèƒ½å¤Ÿæ ¹æ®å†—ä½™ä¿¡æ¯è¿˜åŸå‡ºæ¡æ‰‹æ¶ˆæ¯ã€‚\n\nQUIC è¿˜èƒ½å®ç°è¯ä¹¦å‹ç¼©ï¼Œå‡å°‘è¯ä¹¦ä¼ è¾“é‡ï¼Œé’ˆå¯¹åŒ…å¤´è¿›è¡ŒéªŒè¯ç­‰ã€‚\n\n## QUIC åè®®å®è·µ\n\nChrome æµè§ˆå™¨ä» 2014 å¹´å¼€å§‹å·²ç»å®éªŒæ€§çš„æ”¯æŒäº† QUIC åè®®ã€‚å¯ä»¥é€šè¿‡åœ¨ Chrome æµè§ˆå™¨ä¸­è¾“å…¥`chrome://net-internals/#quic`æŸ¥çœ‹æ˜¯å¦å·²ç»æ”¯æŒ QUIC åè®®ã€‚å¦‚æœè¿˜æœªæ”¯æŒï¼Œå¯ä»¥åœ¨`chrome://flags/#enable-quic`ä¸­è¿›è¡Œå¼€å¯ã€‚\n\nå¼€å§‹ Chrome æµè§ˆå™¨å¯¹ QUIC åè®®çš„æ”¯æŒä¹‹åï¼Œå¯ä»¥åœ¨`chrome://net-internals/#quic`ä¸­æŸ¥çœ‹åˆ°å½“å‰æµè§ˆå™¨çš„ QUIC ä¸€äº›è¿æ¥ã€‚å½“ç„¶ç›®å‰åªæœ‰ Google æœåŠ¡æ‰æ”¯æŒ QUIC åè®®ï¼ˆå¦‚ YouTubeã€ Google.comï¼‰ã€‚\n\n### 1. å…³äºé˜²ç«å¢™\n\né€šå¸¸ç³»ç»Ÿç®¡ç†å‘˜ä¼šå…³æ³¨é˜²ç«å¢™çš„ TCP è§„åˆ™ï¼Œè€Œå¿½ç•¥ UDP è§„åˆ™ã€‚å¦‚æœè¦åœ¨é˜²ç«å¢™ä¹‹åä½¿ç”¨ QUIC åè®®ï¼Œé™¤äº†ä¼ ç»Ÿ web æœåŠ¡éœ€è¦å¼€æ”¾çš„`80/TCP`ã€`443/TCP`ä¹‹å¤–ï¼Œé’ˆå¯¹ QUIC è¿˜éœ€è¦å¼€æ”¾`443/UDP`çš„è®¿é—®ã€‚\n\n### 2.æœåŠ¡ç«¯ä½¿ç”¨ QUIC åè®®\n\nç›®å‰æ”¯æŒ QUIC åè®®çš„ web æœåŠ¡åªæœ‰ 0.9 ç‰ˆæœ¬ä»¥åçš„[Caddy](https://github.com/mholt/caddy/wiki/QUIC)ã€‚å…¶ä»–å¸¸ç”¨ web æœåŠ¡å¦‚ nginxã€apache ç­‰éƒ½æœªå¼€å§‹æ”¯æŒã€‚curl è¡¨è¾¾äº†å¯¹ QUIC åè®®[æ”¯æŒçš„å…´è¶£](https://daniel.haxx.se/blog/2016/07/20/curl-wants-to-quic/)ã€‚\n","tags":["æµè§ˆå™¨","TCP/IP"],"categories":["æµè§ˆå™¨"]},{"title":"TCP","url":"/2019/08/11/TCP/","content":"\n# TCP\n\n- TCP åœ¨ç½‘ç»œ OSI çš„ä¸ƒå±‚æ¨¡å‹ä¸­çš„ç¬¬å››å±‚â€”â€”Transport å±‚ï¼ˆç¬¬å››å±‚çš„æ•°æ®å« Segmentï¼‰\n- IP åœ¨ç¬¬ä¸‰å±‚â€”â€”Network å±‚ï¼ˆåœ¨ç¬¬ä¸‰å±‚ä¸Šçš„æ•°æ®å« Packetï¼‰\n- ARP åœ¨ç¬¬äºŒå±‚â€”â€”Data Link å±‚ï¼ˆåœ¨ç¬¬äºŒå±‚ä¸Šçš„æ•°æ®å« Frameï¼‰\n\næˆ‘ä»¬ç¨‹åºçš„æ•°æ®é¦–å…ˆä¼šæ‰“åˆ° TCP çš„ Segment ä¸­ï¼Œç„¶å TCP çš„ Segment ä¼šæ‰“åˆ° IP çš„ Packet ä¸­ï¼Œç„¶åå†æ‰“åˆ°ä»¥å¤ªç½‘ Ethernet çš„ Frame ä¸­ï¼Œä¼ åˆ°å¯¹ç«¯åï¼Œå„ä¸ªå±‚è§£æè‡ªå·±çš„åè®®ï¼Œç„¶åæŠŠæ•°æ®äº¤ç»™æ›´é«˜å±‚çš„åè®®å¤„ç†ã€‚\n\n<!-- more -->\n\n## TCP å¤´æ ¼å¼\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izttyfinj30m8090jsz.jpg)\n\nä½ éœ€è¦æ³¨æ„è¿™ä¹ˆå‡ ç‚¹ï¼š\n\n- TCP çš„åŒ…æ˜¯æ²¡æœ‰ IP åœ°å€çš„ï¼Œé‚£æ˜¯ IP å±‚ä¸Šçš„äº‹ã€‚ä½†æ˜¯æœ‰æºç«¯å£å’Œç›®æ ‡ç«¯å£ã€‚\n- ä¸€ä¸ª TCP è¿æ¥éœ€è¦å››ä¸ªå…ƒç»„æ¥è¡¨ç¤ºæ˜¯åŒä¸€ä¸ªè¿æ¥ï¼ˆsrc_ip, src_port, dst_ip, dst_portï¼‰å‡†ç¡®è¯´æ˜¯äº”å…ƒç»„ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯åè®®ã€‚ä½†å› ä¸ºè¿™é‡Œåªæ˜¯è¯´ TCP åè®®ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘åªè¯´å››å…ƒç»„ã€‚\n- æ³¨æ„ä¸Šå›¾ä¸­çš„å››ä¸ªéå¸¸é‡è¦çš„ä¸œè¥¿ï¼š\n  - **Sequence Number**æ˜¯åŒ…çš„åºå·ï¼Œ**ç”¨æ¥è§£å†³ç½‘ç»œåŒ…ä¹±åºï¼ˆreorderingï¼‰é—®é¢˜ã€‚**\n  - **Acknowledgement Number**å°±æ˜¯ ACKâ€”â€”ç”¨äºç¡®è®¤æ”¶åˆ°ï¼Œ**ç”¨æ¥è§£å†³ä¸ä¸¢åŒ…çš„é—®é¢˜**ã€‚\n  - **Window åˆå« Advertised-Window**ï¼Œä¹Ÿå°±æ˜¯è‘—åçš„æ»‘åŠ¨çª—å£ï¼ˆSliding Windowï¼‰ï¼Œ**ç”¨äºè§£å†³æµæ§çš„**ã€‚\n  - **TCP Flag** ï¼Œä¹Ÿå°±æ˜¯åŒ…çš„ç±»å‹ï¼Œ**ä¸»è¦æ˜¯ç”¨äºæ“æ§ TCP çš„çŠ¶æ€æœºçš„**ã€‚\n\n## TCP çŠ¶æ€æœº\n\nå…¶å®ï¼Œ**ç½‘ç»œä¸Šçš„ä¼ è¾“æ˜¯æ²¡æœ‰è¿æ¥çš„ï¼ŒåŒ…æ‹¬ TCP ä¹Ÿæ˜¯ä¸€æ ·çš„**ã€‚è€Œ TCP æ‰€è°“çš„â€œè¿æ¥â€ï¼Œå…¶å®åªä¸è¿‡æ˜¯åœ¨é€šè®¯çš„åŒæ–¹ç»´æŠ¤ä¸€ä¸ªâ€œè¿æ¥çŠ¶æ€â€ï¼Œè®©å®ƒçœ‹ä¸Šå»å¥½åƒæœ‰è¿æ¥ä¸€æ ·ã€‚æ‰€ä»¥ï¼ŒTCP çš„çŠ¶æ€å˜æ¢æ˜¯éå¸¸é‡è¦çš„ã€‚\n\nâ€œ**TCP åè®®çš„çŠ¶æ€æœº**â€å’Œ â€œ**TCP å»ºé“¾æ¥**â€ã€â€œ**TCP æ–­é“¾æ¥**â€ã€â€œ**ä¼ æ•°æ®**â€ çš„å¯¹ç…§å›¾\n\n<img src=\"https://coolshell.cn/wp-content/uploads/2014/05/tcpfsm.png\" style=\"zoom:70%;display:inline\" /><img src=\"https://coolshell.cn/wp-content/uploads/2014/05/tcp_open_close.jpg\" style=\"zoom:40%;display:inline\" />\n\nå¾ˆå¤šäººä¼šé—®ï¼Œä¸ºä»€ä¹ˆå»ºé“¾æ¥è¦ 3 æ¬¡æ¡æ‰‹ï¼Œæ–­é“¾æ¥éœ€è¦ 4 æ¬¡æŒ¥æ‰‹ï¼Ÿ\n\n- **å¯¹äºå»ºé“¾æ¥çš„ 3 æ¬¡æ¡æ‰‹ï¼Œ**ä¸»è¦æ˜¯è¦åˆå§‹åŒ– Sequence Number çš„åˆå§‹å€¼ã€‚é€šä¿¡çš„åŒæ–¹è¦äº’ç›¸é€šçŸ¥å¯¹æ–¹è‡ªå·±çš„åˆå§‹åŒ–çš„ Sequence Numberï¼ˆç¼©å†™ä¸º ISNï¼šInital Sequence Numberï¼‰â€”â€”æ‰€ä»¥å« SYNï¼Œå…¨ç§° Synchronize Sequence Numbersã€‚ä¹Ÿå°±ä¸Šå›¾ä¸­çš„ x å’Œ yã€‚è¿™ä¸ªå·è¦ä½œä¸ºä»¥åçš„æ•°æ®é€šä¿¡çš„åºå·ï¼Œä»¥ä¿è¯åº”ç”¨å±‚æ¥æ”¶åˆ°çš„æ•°æ®ä¸ä¼šå› ä¸ºç½‘ç»œä¸Šçš„ä¼ è¾“çš„é—®é¢˜è€Œä¹±åºï¼ˆTCP ä¼šç”¨è¿™ä¸ªåºå·æ¥æ‹¼æ¥æ•°æ®ï¼‰ã€‚\n- **å¯¹äº 4 æ¬¡æŒ¥æ‰‹ï¼Œ**å…¶å®ä½ ä»”ç»†çœ‹æ˜¯ 2 æ¬¡ï¼Œå› ä¸º TCP æ˜¯å…¨åŒå·¥çš„ï¼Œæ‰€ä»¥ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹éƒ½éœ€è¦ Fin å’Œ Ackã€‚åªä¸è¿‡ï¼Œæœ‰ä¸€æ–¹æ˜¯è¢«åŠ¨çš„ï¼Œæ‰€ä»¥çœ‹ä¸Šå»å°±æˆäº†æ‰€è°“çš„ 4 æ¬¡æŒ¥æ‰‹ã€‚å¦‚æœä¸¤è¾¹åŒæ—¶æ–­è¿æ¥ï¼Œé‚£å°±ä¼šå°±è¿›å…¥åˆ° CLOSING çŠ¶æ€ï¼Œç„¶ååˆ°è¾¾ TIME_WAIT çŠ¶æ€ã€‚ä¸‹å›¾æ˜¯åŒæ–¹åŒæ—¶æ–­è¿æ¥çš„ç¤ºæ„å›¾ï¼ˆä½ åŒæ ·å¯ä»¥å¯¹ç…§ç€ TCP çŠ¶æ€æœºçœ‹ï¼‰ï¼š\n\n## æ•°æ®ä¼ è¾“ä¸­çš„ Sequence Number\n\nä¸‹å›¾æ˜¯ä» Wireshark ä¸­æˆªäº†ä¸ªæˆ‘åœ¨è®¿é—® coolshell.cn æ—¶çš„æœ‰æ•°æ®ä¼ è¾“çš„å›¾ç»™ä½ çœ‹ä¸€ä¸‹ï¼ŒSeqNum æ˜¯æ€ä¹ˆå˜çš„ã€‚ï¼ˆä½¿ç”¨ Wireshark èœå•ä¸­çš„ Statistics ->Flow Graphâ€¦ ï¼‰\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5nx0rq0j30al0a1jsq.jpg)\n\nä½ å¯ä»¥çœ‹åˆ°ï¼Œ**SeqNum çš„å¢åŠ æ˜¯å’Œä¼ è¾“çš„å­—èŠ‚æ•°ç›¸å…³çš„**ã€‚ä¸Šå›¾ä¸­ï¼Œä¸‰æ¬¡æ¡æ‰‹åï¼Œæ¥äº†ä¸¤ä¸ª Len:1440 çš„åŒ…ï¼Œè€Œç¬¬äºŒä¸ªåŒ…çš„ SeqNum å°±æˆäº† 1441ã€‚ç„¶åç¬¬ä¸€ä¸ª ACK å›çš„æ˜¯ 1441ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ª 1440 æ”¶åˆ°äº†ã€‚\n\n**æ³¨æ„**ï¼šå¦‚æœä½ ç”¨ Wireshark æŠ“åŒ…ç¨‹åºçœ‹ 3 æ¬¡æ¡æ‰‹ï¼Œä½ ä¼šå‘ç° SeqNum æ€»æ˜¯ä¸º 0ï¼Œä¸æ˜¯è¿™æ ·çš„ï¼ŒWireshark ä¸ºäº†æ˜¾ç¤ºæ›´å‹å¥½ï¼Œä½¿ç”¨äº† Relative SeqNumâ€”â€”ç›¸å¯¹åºå·ï¼Œä½ åªè¦åœ¨å³é”®èœå•ä¸­çš„ protocol preference ä¸­å–æ¶ˆæ‰å°±å¯ä»¥çœ‹åˆ°â€œAbsolute SeqNumâ€äº†\n\n## TCP é‡ä¼ æœºåˆ¶\n\nTCP è¦ä¿è¯æ‰€æœ‰çš„æ•°æ®åŒ…éƒ½å¯ä»¥åˆ°è¾¾ï¼Œæ‰€ä»¥ï¼Œå¿…éœ€è¦æœ‰é‡ä¼ æœºåˆ¶ã€‚\n\næ³¨æ„ï¼Œæ¥æ”¶ç«¯ç»™å‘é€ç«¯çš„ Ack ç¡®è®¤åªä¼šç¡®è®¤æœ€åä¸€ä¸ªè¿ç»­çš„åŒ…ï¼Œæ¯”å¦‚ï¼Œå‘é€ç«¯å‘äº† 1,2,3,4,5 ä¸€å…±äº”ä»½æ•°æ®ï¼Œæ¥æ”¶ç«¯æ”¶åˆ°äº† 1ï¼Œ2ï¼Œäºæ˜¯å› ack 3ï¼Œç„¶åæ”¶åˆ°äº† 4ï¼ˆæ³¨æ„æ­¤æ—¶ 3 æ²¡æ”¶åˆ°ï¼‰ï¼Œæ­¤æ—¶çš„ TCP ä¼šæ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬è¦çŸ¥é“ï¼Œå› ä¸ºæ­£å¦‚å‰é¢æ‰€è¯´çš„ï¼Œ**SeqNum å’Œ Ack æ˜¯ä»¥å­—èŠ‚æ•°ä¸ºå•ä½ï¼Œæ‰€ä»¥ ack çš„æ—¶å€™ï¼Œä¸èƒ½è·³ç€ç¡®è®¤ï¼Œåªèƒ½ç¡®è®¤æœ€å¤§çš„è¿ç»­æ”¶åˆ°çš„åŒ…**ï¼Œä¸ç„¶ï¼Œå‘é€ç«¯å°±ä»¥ä¸ºä¹‹å‰çš„éƒ½æ”¶åˆ°äº†ã€‚\n\n### è¶…æ—¶é‡ä¼ æœºåˆ¶\n\nä¸€ç§æ˜¯ä¸å› ackï¼Œæ­»ç­‰ 3ï¼Œå½“å‘é€æ–¹å‘ç°æ”¶ä¸åˆ° 3 çš„ ack è¶…æ—¶åï¼Œä¼šé‡ä¼  3ã€‚ä¸€æ—¦æ¥æ”¶æ–¹æ”¶åˆ° 3 åï¼Œä¼š ack å› 4â€”â€”æ„å‘³ç€ 3 å’Œ 4 éƒ½æ”¶åˆ°äº†ã€‚\n\nä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼ä¼šæœ‰æ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å› ä¸ºè¦æ­»ç­‰ 3ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ 4 å’Œ 5 å³ä¾¿å·²ç»æ”¶åˆ°äº†ï¼Œè€Œå‘é€æ–¹ä¹Ÿå®Œå…¨ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼Œå› ä¸ºæ²¡æœ‰æ”¶åˆ° Ackï¼Œæ‰€ä»¥ï¼Œå‘é€æ–¹å¯èƒ½ä¼šæ‚²è§‚åœ°è®¤ä¸ºä¹Ÿä¸¢äº†ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¹Ÿä¼šå¯¼è‡´ 4 å’Œ 5 çš„é‡ä¼ ã€‚\n\nå¯¹æ­¤æœ‰ä¸¤ç§é€‰æ‹©ï¼š\n\n- ä¸€ç§æ˜¯ä»…é‡ä¼  timeout çš„åŒ…ã€‚ä¹Ÿå°±æ˜¯ç¬¬ 3 ä»½æ•°æ®ã€‚\n- å¦ä¸€ç§æ˜¯é‡ä¼  timeout åæ‰€æœ‰çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ç¬¬ 3ï¼Œ4ï¼Œ5 è¿™ä¸‰ä»½æ•°æ®ã€‚\n\nè¿™ä¸¤ç§æ–¹å¼æœ‰å¥½ä¹Ÿæœ‰ä¸å¥½ã€‚ç¬¬ä¸€ç§ä¼šèŠ‚çœå¸¦å®½ï¼Œä½†æ˜¯æ…¢ï¼Œç¬¬äºŒç§ä¼šå¿«ä¸€ç‚¹ï¼Œä½†æ˜¯ä¼šæµªè´¹å¸¦å®½ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰æ— ç”¨åŠŸã€‚ä½†æ€»ä½“æ¥è¯´éƒ½ä¸å¥½ã€‚å› ä¸ºéƒ½åœ¨ç­‰ timeoutï¼Œtimeout å¯èƒ½ä¼šå¾ˆé•¿ï¼ˆåœ¨ä¸‹ç¯‡ä¼šè¯´ TCP æ˜¯æ€ä¹ˆåŠ¨æ€åœ°è®¡ç®—å‡º timeout çš„ï¼‰\n\n### å¿«é€Ÿé‡ä¼ æœºåˆ¶\n\näºæ˜¯ï¼ŒTCP å¼•å…¥äº†ä¸€ç§å«**Fast Retransmit** çš„ç®—æ³•ï¼Œ**ä¸ä»¥æ—¶é—´é©±åŠ¨ï¼Œè€Œä»¥æ•°æ®é©±åŠ¨é‡ä¼ **ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœï¼ŒåŒ…æ²¡æœ‰è¿ç»­åˆ°è¾¾ï¼Œå°± ack æœ€åé‚£ä¸ªå¯èƒ½è¢«ä¸¢äº†çš„åŒ…ï¼Œå¦‚æœå‘é€æ–¹è¿ç»­æ”¶åˆ° 3 æ¬¡ç›¸åŒçš„ ackï¼Œå°±é‡ä¼ ã€‚Fast Retransmit çš„å¥½å¤„æ˜¯ä¸ç”¨ç­‰ timeout äº†å†é‡ä¼ ã€‚\n\næ¯”å¦‚ï¼šå¦‚æœå‘é€æ–¹å‘å‡ºäº† 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5 ä»½æ•°æ®ï¼Œç¬¬ä¸€ä»½å…ˆåˆ°é€äº†ï¼Œäºæ˜¯å°± ack å› 2ï¼Œç»“æœ 2 å› ä¸ºæŸäº›åŸå› æ²¡æ”¶åˆ°ï¼Œ3 åˆ°è¾¾äº†ï¼Œäºæ˜¯è¿˜æ˜¯ ack å› 2ï¼Œåé¢çš„ 4 å’Œ 5 éƒ½åˆ°äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ ack å› 2ï¼Œå› ä¸º 2 è¿˜æ˜¯æ²¡æœ‰æ”¶åˆ°ï¼Œäºæ˜¯å‘é€ç«¯æ”¶åˆ°äº†ä¸‰ä¸ª ack=2 çš„ç¡®è®¤ï¼ŒçŸ¥é“äº† 2 è¿˜æ²¡æœ‰åˆ°ï¼Œäºæ˜¯å°±é©¬ä¸Šé‡è½¬ 2ã€‚ç„¶åï¼Œæ¥æ”¶ç«¯æ”¶åˆ°äº† 2ï¼Œæ­¤æ—¶å› ä¸º 3ï¼Œ4ï¼Œ5 éƒ½æ”¶åˆ°äº†ï¼Œäºæ˜¯ ack å› 6ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5o1shzuj30ci0833yx.jpg)\n\nFast Retransmit åªè§£å†³äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ timeout çš„é—®é¢˜ï¼Œå®ƒä¾ç„¶é¢ä¸´ä¸€ä¸ªè‰°éš¾çš„é€‰æ‹©ï¼Œå°±æ˜¯ï¼Œæ˜¯é‡ä¼ ä¹‹å‰çš„ä¸€ä¸ªè¿˜æ˜¯é‡ä¼ æ‰€æœ‰çš„é—®é¢˜ã€‚å¯¹äºä¸Šé¢çš„ç¤ºä¾‹æ¥è¯´ï¼Œæ˜¯é‡ä¼ #2 å‘¢è¿˜æ˜¯é‡ä¼ #2ï¼Œ#3ï¼Œ#4ï¼Œ#5 å‘¢ï¼Ÿå› ä¸ºå‘é€ç«¯å¹¶ä¸æ¸…æ¥šè¿™è¿ç»­çš„ 3 ä¸ª ack(2)æ˜¯è°ä¼ å›æ¥çš„ï¼Ÿä¹Ÿè®¸å‘é€ç«¯å‘äº† 20 ä»½æ•°æ®ï¼Œæ˜¯#6ï¼Œ#10ï¼Œ#20 ä¼ æ¥çš„å‘¢ã€‚è¿™æ ·ï¼Œå‘é€ç«¯å¾ˆæœ‰å¯èƒ½è¦é‡ä¼ ä» 2 åˆ° 20 çš„è¿™å †æ•°æ®ï¼ˆè¿™å°±æ˜¯æŸäº› TCP çš„å®é™…çš„å®ç°ï¼‰ã€‚å¯è§ï¼Œè¿™æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ã€‚\n\n### SACK æ–¹æ³•\n\nå¦å¤–ä¸€ç§æ›´å¥½çš„æ–¹å¼å«ï¼š**Selective Acknowledgment (SACK)**ï¼ˆå‚çœ‹[RFC 2018](http://tools.ietf.org/html/rfc2018)ï¼‰ï¼Œè¿™ç§æ–¹å¼éœ€è¦åœ¨ TCP å¤´é‡ŒåŠ ä¸€ä¸ª SACK çš„ä¸œè¥¿ï¼ŒACK è¿˜æ˜¯ Fast Retransmit çš„ ACKï¼ŒSACK åˆ™æ˜¯æ±‡æŠ¥æ”¶åˆ°çš„æ•°æ®ç¢ç‰ˆã€‚å‚çœ‹ä¸‹å›¾ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5o7gj8sj30sg0g1ta5.jpg)\n\nè¿™æ ·ï¼Œåœ¨å‘é€ç«¯å°±å¯ä»¥æ ¹æ®å›ä¼ çš„ SACK æ¥çŸ¥é“å“ªäº›æ•°æ®åˆ°äº†ï¼Œå“ªäº›æ²¡æœ‰åˆ°ã€‚äºæ˜¯å°±ä¼˜åŒ–äº† Fast Retransmit çš„ç®—æ³•ã€‚å½“ç„¶ï¼Œè¿™ä¸ªåè®®éœ€è¦ä¸¤è¾¹éƒ½æ”¯æŒã€‚åœ¨ Linux ä¸‹ï¼Œå¯ä»¥é€šè¿‡**tcp_sack**å‚æ•°æ‰“å¼€è¿™ä¸ªåŠŸèƒ½ï¼ˆLinux 2.4 åé»˜è®¤æ‰“å¼€ï¼‰ã€‚\n\nè¿™é‡Œè¿˜éœ€è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜â€”â€”**æ¥æ”¶æ–¹ Renegingï¼Œæ‰€è°“ Reneging çš„æ„æ€å°±æ˜¯æ¥æ”¶æ–¹æœ‰æƒæŠŠå·²ç»æŠ¥ç»™å‘é€ç«¯ SACK é‡Œçš„æ•°æ®ç»™ä¸¢äº†**ã€‚è¿™æ ·å¹²æ˜¯ä¸è¢«é¼“åŠ±çš„ï¼Œå› ä¸ºè¿™ä¸ªäº‹ä¼šæŠŠé—®é¢˜å¤æ‚åŒ–äº†ï¼Œä½†æ˜¯ï¼Œæ¥æ”¶æ–¹è¿™ä¹ˆåšå¯èƒ½ä¼šæœ‰äº›æç«¯æƒ…å†µï¼Œæ¯”å¦‚è¦æŠŠå†…å­˜ç»™åˆ«çš„æ›´é‡è¦çš„ä¸œè¥¿ã€‚**æ‰€ä»¥ï¼Œå‘é€æ–¹ä¹Ÿä¸èƒ½å®Œå…¨ä¾èµ– SACKï¼Œè¿˜æ˜¯è¦ä¾èµ– ACKï¼Œå¹¶ç»´æŠ¤ Time-Outï¼Œå¦‚æœåç»­çš„ ACK æ²¡æœ‰å¢é•¿ï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦æŠŠ SACK çš„ä¸œè¥¿é‡ä¼ ï¼Œå¦å¤–ï¼Œæ¥æ”¶ç«¯è¿™è¾¹æ°¸è¿œä¸èƒ½æŠŠ SACK çš„åŒ…æ ‡è®°ä¸º Ackã€‚**\n\næ³¨æ„ï¼šSACK ä¼šæ¶ˆè´¹å‘é€æ–¹çš„èµ„æºï¼Œè¯•æƒ³ï¼Œå¦‚æœä¸€ä¸ªæ”»å‡»è€…ç»™æ•°æ®å‘é€æ–¹å‘ä¸€å † SACK çš„é€‰é¡¹ï¼Œè¿™ä¼šå¯¼è‡´å‘é€æ–¹å¼€å§‹è¦é‡ä¼ ç”šè‡³éå†å·²ç»å‘å‡ºçš„æ•°æ®ï¼Œè¿™ä¼šæ¶ˆè€—å¾ˆå¤šå‘é€ç«¯çš„èµ„æºã€‚\n\n### Duplicate SACK â€“ é‡å¤æ”¶åˆ°æ•°æ®çš„é—®é¢˜\n\nDuplicate SACK åˆç§° D-SACKï¼Œ**å…¶ä¸»è¦ä½¿ç”¨äº† SACK æ¥å‘Šè¯‰å‘é€æ–¹æœ‰å“ªäº›æ•°æ®è¢«é‡å¤æ¥æ”¶äº†**ã€‚[RFC-2883 ](http://www.ietf.org/rfc/rfc2883.txt)é‡Œæœ‰è¯¦ç»†æè¿°å’Œç¤ºä¾‹ã€‚ä¸‹é¢ä¸¾å‡ ä¸ªä¾‹å­ï¼ˆæ¥æºäº[RFC-2883](http://www.ietf.org/rfc/rfc2883.txt)ï¼‰\n\nD-SACK ä½¿ç”¨äº† SACK çš„ç¬¬ä¸€ä¸ªæ®µæ¥åšæ ‡å¿—ï¼Œ\n\n- å¦‚æœ SACK çš„ç¬¬ä¸€ä¸ªæ®µçš„èŒƒå›´è¢« ACK æ‰€è¦†ç›–ï¼Œé‚£ä¹ˆå°±æ˜¯ D-SACK\n- å¦‚æœ SACK çš„ç¬¬ä¸€ä¸ªæ®µçš„èŒƒå›´è¢« SACK çš„ç¬¬äºŒä¸ªæ®µè¦†ç›–ï¼Œé‚£ä¹ˆå°±æ˜¯ D-SACK\n\n#### ç¤ºä¾‹ä¸€ï¼šACK ä¸¢åŒ…\n\nä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä¸¢äº†ä¸¤ä¸ª ACKï¼Œæ‰€ä»¥ï¼Œå‘é€ç«¯é‡ä¼ äº†ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ï¼ˆ3000-3499ï¼‰ï¼Œäºæ˜¯æ¥æ”¶ç«¯å‘ç°é‡å¤æ”¶åˆ°ï¼Œäºæ˜¯å›äº†ä¸€ä¸ª SACK=3000-3500ï¼Œå› ä¸º ACK éƒ½åˆ°äº† 4000 æ„å‘³ç€æ”¶åˆ°äº† 4000 ä¹‹å‰çš„æ‰€æœ‰æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ª SACK å°±æ˜¯ D-SACKâ€”â€”æ—¨åœ¨å‘Šè¯‰å‘é€ç«¯æˆ‘æ”¶åˆ°äº†é‡å¤çš„æ•°æ®ï¼Œè€Œä¸”æˆ‘ä»¬çš„å‘é€ç«¯è¿˜çŸ¥é“ï¼Œæ•°æ®åŒ…æ²¡æœ‰ä¸¢ï¼Œä¸¢çš„æ˜¯ ACK åŒ…ã€‚\n\n```json\nTransmitted  Received    ACK Sent\nSegment      Segment     (Including SACK Blocks)\n3000-3499    3000-3499   3500 (ACK dropped)\n3500-3999    3500-3999   4000 (ACK dropped)\n3000-3499    3000-3499   4000, SACK=3000-3500\n                                    ---------\n```\n\n#### ç¤ºä¾‹äºŒï¼Œç½‘ç»œå»¶è¯¯\n\nä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œç½‘ç»œåŒ…ï¼ˆ1000-1499ï¼‰è¢«ç½‘ç»œç»™å»¶è¯¯äº†ï¼Œå¯¼è‡´å‘é€æ–¹æ²¡æœ‰æ”¶åˆ° ACKï¼Œè€Œåé¢åˆ°è¾¾çš„ä¸‰ä¸ªåŒ…è§¦å‘äº†â€œFast Retransmit ç®—æ³•â€ï¼Œæ‰€ä»¥é‡ä¼ ï¼Œä½†é‡ä¼ æ—¶ï¼Œè¢«å»¶è¯¯çš„åŒ…åˆåˆ°äº†ï¼Œæ‰€ä»¥ï¼Œå›äº†ä¸€ä¸ª SACK=1000-1500ï¼Œå› ä¸º ACK å·²åˆ°äº† 3000ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ª SACK æ˜¯ D-SACKâ€”â€”æ ‡è¯†æ”¶åˆ°äº†é‡å¤çš„åŒ…ã€‚\n\nè¿™ä¸ªæ¡ˆä¾‹ä¸‹ï¼Œå‘é€ç«¯çŸ¥é“ä¹‹å‰å› ä¸ºâ€œFast Retransmit ç®—æ³•â€è§¦å‘çš„é‡ä¼ ä¸æ˜¯å› ä¸ºå‘å‡ºå»çš„åŒ…ä¸¢äº†ï¼Œä¹Ÿä¸æ˜¯å› ä¸ºå›åº”çš„ ACK åŒ…ä¸¢äº†ï¼Œè€Œæ˜¯å› ä¸ºç½‘ç»œå»¶æ—¶äº†ã€‚\n\n```json\nTransmitted    Received    ACK Sent\nSegment        Segment     (Including SACK Blocks)\n500-999        500-999     1000\n1000-1499      (delayed)\n1500-1999      1500-1999   1000, SACK=1500-2000\n2000-2499      2000-2499   1000, SACK=1500-2500\n2500-2999      2500-2999   1000, SACK=1500-3000\n1000-1499      1000-1499   3000\n               1000-1499   3000, SACK=1000-1500\n                                      ---------\n```\n\nå¯è§ï¼Œå¼•å…¥äº† D-SACKï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªå¥½å¤„ï¼š\n\n1ï¼‰å¯ä»¥è®©å‘é€æ–¹çŸ¥é“ï¼Œæ˜¯å‘å‡ºå»çš„åŒ…ä¸¢äº†ï¼Œè¿˜æ˜¯å›æ¥çš„ ACK åŒ…ä¸¢äº†ã€‚\n\n2ï¼‰æ˜¯ä¸æ˜¯è‡ªå·±çš„ timeout å¤ªå°äº†ï¼Œå¯¼è‡´é‡ä¼ ã€‚\n\n3ï¼‰ç½‘ç»œä¸Šå‡ºç°äº†å…ˆå‘çš„åŒ…ååˆ°çš„æƒ…å†µï¼ˆåˆç§° reorderingï¼‰\n\n4ï¼‰ç½‘ç»œä¸Šæ˜¯ä¸æ˜¯æŠŠæˆ‘çš„æ•°æ®åŒ…ç»™å¤åˆ¶äº†ã€‚\n\n**çŸ¥é“è¿™äº›ä¸œè¥¿å¯ä»¥å¾ˆå¥½å¾—å¸®åŠ© TCP äº†è§£ç½‘ç»œæƒ…å†µï¼Œä»è€Œå¯ä»¥æ›´å¥½çš„åšç½‘ç»œä¸Šçš„æµæ§**ã€‚\n\nLinux ä¸‹çš„ tcp_dsack å‚æ•°ç”¨äºå¼€å¯è¿™ä¸ªåŠŸèƒ½ï¼ˆLinux 2.4 åé»˜è®¤æ‰“å¼€ï¼‰\n\n## TCP çš„ RTT ç®—æ³•\n\nä»å‰é¢çš„ TCP é‡ä¼ æœºåˆ¶æˆ‘ä»¬çŸ¥é“ Timeout çš„è®¾ç½®å¯¹äºé‡ä¼ éå¸¸é‡è¦ã€‚\n\n- è®¾é•¿äº†ï¼Œé‡å‘å°±æ…¢ï¼Œä¸¢äº†è€åŠå¤©æ‰é‡å‘ï¼Œæ²¡æœ‰æ•ˆç‡ï¼Œæ€§èƒ½å·®ï¼›\n- è®¾çŸ­äº†ï¼Œä¼šå¯¼è‡´å¯èƒ½å¹¶æ²¡æœ‰ä¸¢å°±é‡å‘ã€‚äºæ˜¯é‡å‘çš„å°±å¿«ï¼Œä¼šå¢åŠ ç½‘ç»œæ‹¥å¡ï¼Œå¯¼è‡´æ›´å¤šçš„è¶…æ—¶ï¼Œæ›´å¤šçš„è¶…æ—¶å¯¼è‡´æ›´å¤šçš„é‡å‘ã€‚\n\nè€Œä¸”ï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´åœ¨ä¸åŒçš„ç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œæ ¹æœ¬æ²¡æœ‰åŠæ³•è®¾ç½®ä¸€ä¸ªæ­»çš„å€¼ã€‚åªèƒ½åŠ¨æ€åœ°è®¾ç½®ã€‚ ä¸ºäº†åŠ¨æ€åœ°è®¾ç½®ï¼ŒTCP å¼•å…¥äº† RTTâ€”â€”Round Trip Timeï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ•°æ®åŒ…ä»å‘å‡ºå»åˆ°å›æ¥çš„æ—¶é—´ã€‚è¿™æ ·å‘é€ç«¯å°±å¤§çº¦çŸ¥é“éœ€è¦å¤šå°‘çš„æ—¶é—´ï¼Œä»è€Œå¯ä»¥æ–¹ä¾¿åœ°è®¾ç½® Timeoutâ€”â€”RTOï¼ˆRetransmission TimeOutï¼‰ï¼Œä»¥è®©æˆ‘ä»¬çš„é‡ä¼ æœºåˆ¶æ›´é«˜æ•ˆã€‚ å¬èµ·æ¥ä¼¼ä¹å¾ˆç®€å•ï¼Œå¥½åƒå°±æ˜¯åœ¨å‘é€ç«¯å‘åŒ…æ—¶è®°ä¸‹ t0ï¼Œç„¶åæ¥æ”¶ç«¯å†æŠŠè¿™ä¸ª ack å›æ¥æ—¶å†è®°ä¸€ä¸ª t1ï¼Œäºæ˜¯ RTT = t1 â€“ t0ã€‚æ²¡é‚£ä¹ˆç®€å•ï¼Œè¿™åªæ˜¯ä¸€ä¸ªé‡‡æ ·ï¼Œä¸èƒ½ä»£è¡¨æ™®éæƒ…å†µã€‚\n\n### ç»å…¸ç®—æ³•\n\n[RFC793](http://tools.ietf.org/html/rfc793) ä¸­å®šä¹‰çš„ç»å…¸ç®—æ³•æ˜¯è¿™æ ·çš„ï¼š\n\n1ï¼‰é¦–å…ˆï¼Œå…ˆé‡‡æ · RTTï¼Œè®°ä¸‹æœ€è¿‘å¥½å‡ æ¬¡çš„ RTT å€¼ã€‚\n\n2ï¼‰ç„¶ååšå¹³æ»‘è®¡ç®— SRTTï¼ˆ Smoothed RTTï¼‰ã€‚å…¬å¼ä¸ºï¼šï¼ˆå…¶ä¸­çš„ Î± å–å€¼åœ¨ 0.8 åˆ° 0.9 ä¹‹é—´ï¼Œè¿™ä¸ªç®—æ³•è‹±æ–‡å« Exponential weighted moving averageï¼Œä¸­æ–‡å«ï¼šåŠ æƒç§»åŠ¨å¹³å‡ï¼‰\n\n**SRTT = ( Î± \\* SRTT ) + ((1- Î±) \\* RTT)**\n\n3ï¼‰å¼€å§‹è®¡ç®— RTOã€‚å…¬å¼å¦‚ä¸‹ï¼š\n\n**RTO = min [ UBOUND, max [ LBOUND, (Î² \\* SRTT) ] ]**\n\nå…¶ä¸­ï¼š\n\n- UBOUND æ˜¯æœ€å¤§çš„ timeout æ—¶é—´ï¼Œä¸Šé™å€¼\n- LBOUND æ˜¯æœ€å°çš„ timeout æ—¶é—´ï¼Œä¸‹é™å€¼\n- Î² å€¼ä¸€èˆ¬åœ¨ 1.3 åˆ° 2.0 ä¹‹é—´ã€‚\n\n### Karn / Partridge ç®—æ³•\n\nä½†æ˜¯ä¸Šé¢çš„è¿™ä¸ªç®—æ³•åœ¨é‡ä¼ çš„æ—¶å€™ä¼šå‡ºæœ‰ä¸€ä¸ªç»ˆæé—®é¢˜â€”â€”ä½ æ˜¯ç”¨ç¬¬ä¸€æ¬¡å‘æ•°æ®çš„æ—¶é—´å’Œ ack å›æ¥çš„æ—¶é—´åš RTT æ ·æœ¬å€¼ï¼Œè¿˜æ˜¯ç”¨é‡ä¼ çš„æ—¶é—´å’Œ ACK å›æ¥çš„æ—¶é—´åš RTT æ ·æœ¬å€¼ï¼Ÿ\n\nè¿™ä¸ªé—®é¢˜æ— è®ºä½ é€‰é‚£å¤´éƒ½æ˜¯æŒ‰ä¸‹è‘«èŠ¦èµ·äº†ç“¢ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n- æƒ…å†µï¼ˆaï¼‰æ˜¯ ack æ²¡å›æ¥ï¼Œæ‰€ä»¥é‡ä¼ ã€‚å¦‚æœä½ è®¡ç®—ç¬¬ä¸€æ¬¡å‘é€å’Œ ACK çš„æ—¶é—´ï¼Œé‚£ä¹ˆï¼Œæ˜æ˜¾ç®—å¤§äº†ã€‚\n- æƒ…å†µï¼ˆbï¼‰æ˜¯ ack å›æ¥æ…¢äº†ï¼Œä½†æ˜¯å¯¼è‡´äº†é‡ä¼ ï¼Œä½†åˆšé‡ä¼ ä¸ä¸€ä¼šå„¿ï¼Œä¹‹å‰ ACK å°±å›æ¥äº†ã€‚å¦‚æœä½ æ˜¯ç®—é‡ä¼ çš„æ—¶é—´å’Œ ACK å›æ¥çš„æ—¶é—´çš„å·®ï¼Œå°±ä¼šç®—çŸ­äº†ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5odttngj30kp098mxm.jpg)\n\næ‰€ä»¥ 1987 å¹´çš„æ—¶å€™ï¼Œæäº†ä¸€ä¸ªå«[Karn / Partridge Algorithm](http://en.wikipedia.org/wiki/Karn's_Algorithm)ï¼Œè¿™ä¸ªç®—æ³•çš„æœ€å¤§ç‰¹ç‚¹æ˜¯â€”â€”**å¿½ç•¥é‡ä¼ ï¼Œä¸æŠŠé‡ä¼ çš„ RTT åšé‡‡æ ·**ï¼ˆä½ çœ‹ï¼Œä½ ä¸éœ€è¦å»è§£å†³ä¸å­˜åœ¨çš„é—®é¢˜ï¼‰ã€‚\n\nä½†æ˜¯ï¼Œè¿™æ ·ä¸€æ¥ï¼Œåˆä¼šå¼•å‘ä¸€ä¸ªå¤§ BUGâ€”â€”**å¦‚æœåœ¨æŸä¸€æ—¶é—´ï¼Œç½‘ç»œé—ªåŠ¨ï¼Œçªç„¶å˜æ…¢äº†ï¼Œäº§ç”Ÿäº†æ¯”è¾ƒå¤§çš„å»¶æ—¶ï¼Œè¿™ä¸ªå»¶æ—¶å¯¼è‡´è¦é‡è½¬æ‰€æœ‰çš„åŒ…ï¼ˆå› ä¸ºä¹‹å‰çš„ RTO å¾ˆå°ï¼‰ï¼Œäºæ˜¯ï¼Œå› ä¸ºé‡è½¬çš„ä¸ç®—ï¼Œæ‰€ä»¥ï¼ŒRTO å°±ä¸ä¼šè¢«æ›´æ–°ï¼Œè¿™æ˜¯ä¸€ä¸ªç¾éš¾**ã€‚ äºæ˜¯ Karn ç®—æ³•ç”¨äº†ä¸€ä¸ªå–å·§çš„æ–¹å¼â€”â€”åªè¦ä¸€å‘ç”Ÿé‡ä¼ ï¼Œå°±å¯¹ç°æœ‰çš„ RTO å€¼ç¿»å€ï¼ˆè¿™å°±æ˜¯æ‰€è°“çš„ Exponential backoffï¼‰ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ­»è§„çŸ©å¯¹äºä¸€ä¸ªéœ€è¦ä¼°è®¡æ¯”è¾ƒå‡†ç¡®çš„ RTT ä¹Ÿä¸é è°±ã€‚\n\n### Jacobson / Karels ç®—æ³•\n\nå‰é¢ä¸¤ç§ç®—æ³•ç”¨çš„éƒ½æ˜¯â€œåŠ æƒç§»åŠ¨å¹³å‡â€ï¼Œè¿™ç§æ–¹æ³•æœ€å¤§çš„æ¯›ç—…å°±æ˜¯å¦‚æœ RTT æœ‰ä¸€ä¸ªå¤§çš„æ³¢åŠ¨çš„è¯ï¼Œå¾ˆéš¾è¢«å‘ç°ï¼Œå› ä¸ºè¢«å¹³æ»‘æ‰äº†ã€‚æ‰€ä»¥ï¼Œ1988 å¹´ï¼Œåˆæœ‰äººæ¨å‡ºæ¥äº†ä¸€ä¸ªæ–°çš„ç®—æ³•ï¼Œè¿™ä¸ªç®—æ³•å« Jacobson / Karels Algorithmï¼ˆå‚çœ‹[RFC6289](http://tools.ietf.org/html/rfc6298)ï¼‰ã€‚è¿™ä¸ªç®—æ³•å¼•å…¥äº†æœ€æ–°çš„ RTT çš„é‡‡æ ·å’Œå¹³æ»‘è¿‡çš„ SRTT çš„å·®è·åšå› å­æ¥è®¡ç®—ã€‚ å…¬å¼å¦‚ä¸‹ï¼šï¼ˆå…¶ä¸­çš„ DevRTT æ˜¯ Deviation RTT çš„æ„æ€ï¼‰\n\n**SRTT** **= S\\*\\***RTT\\*\\* **+ Î±** **(\\*\\***RTT\\*\\* **â€“ S\\*\\***RTT\\***\\*)** â€”â€” è®¡ç®—å¹³æ»‘ RTT\n\n**DevRTT** **= (1-Î²\\*\\***)\\*\\***\\*DevRTT** **+ Î²\\*\\*\\***(|\\***\\*RTT-SRTT\\*\\***|)\\*\\* â€”â€”è®¡ç®—å¹³æ»‘ RTT å’ŒçœŸå®çš„å·®è·ï¼ˆåŠ æƒç§»åŠ¨å¹³å‡ï¼‰\n\n**RTO= Âµ \\* SRTT + âˆ‚ \\*DevRTT** â€”â€” ç¥ä¸€æ ·çš„å…¬å¼\n\nï¼ˆå…¶ä¸­ï¼šåœ¨ Linux ä¸‹ï¼ŒÎ± = 0.125ï¼ŒÎ² = 0.25ï¼Œ Î¼ = 1ï¼Œâˆ‚ = 4 â€”â€”è¿™å°±æ˜¯ç®—æ³•ä¸­çš„â€œè°ƒå¾—ä¸€æ‰‹å¥½å‚æ•°â€ï¼Œnobody knows why, it just worksâ€¦ï¼‰ æœ€åçš„è¿™ä¸ªç®—æ³•åœ¨è¢«ç”¨åœ¨ä»Šå¤©çš„ TCP åè®®ä¸­ï¼ˆLinux çš„æºä»£ç åœ¨ï¼š[tcp_rtt_estimator](http://lxr.free-electrons.com/source/net/ipv4/tcp_input.c?v=2.6.32#L609)ï¼‰ã€‚\n\n## TCP æ»‘åŠ¨çª—å£\n\néœ€è¦è¯´æ˜ä¸€ä¸‹ï¼Œå¦‚æœä½ ä¸äº†è§£ TCP çš„æ»‘åŠ¨çª—å£è¿™ä¸ªäº‹ï¼Œä½ ç­‰äºä¸äº†è§£ TCP åè®®ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ**TCP å¿…éœ€è¦è§£å†³çš„å¯é ä¼ è¾“ä»¥åŠåŒ…ä¹±åºï¼ˆreorderingï¼‰çš„é—®é¢˜**ï¼Œæ‰€ä»¥ï¼ŒTCP å¿…éœ€è¦çŸ¥é“ç½‘ç»œå®é™…çš„æ•°æ®å¤„ç†å¸¦å®½æˆ–æ˜¯æ•°æ®å¤„ç†é€Ÿåº¦ï¼Œè¿™æ ·æ‰ä¸ä¼šå¼•èµ·ç½‘ç»œæ‹¥å¡ï¼Œå¯¼è‡´ä¸¢åŒ…ã€‚\n\næ‰€ä»¥ï¼ŒTCP å¼•å…¥äº†ä¸€äº›æŠ€æœ¯å’Œè®¾è®¡æ¥åšç½‘ç»œæµæ§ï¼ŒSliding Window æ˜¯å…¶ä¸­ä¸€ä¸ªæŠ€æœ¯ã€‚ å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œ**TCP å¤´é‡Œæœ‰ä¸€ä¸ªå­—æ®µå« Windowï¼Œåˆå« Advertised-Windowï¼Œè¿™ä¸ªå­—æ®µæ˜¯æ¥æ”¶ç«¯å‘Šè¯‰å‘é€ç«¯è‡ªå·±è¿˜æœ‰å¤šå°‘ç¼“å†²åŒºå¯ä»¥æ¥æ”¶æ•°æ®**ã€‚**äºæ˜¯å‘é€ç«¯å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥æ”¶ç«¯çš„å¤„ç†èƒ½åŠ›æ¥å‘é€æ•°æ®ï¼Œè€Œä¸ä¼šå¯¼è‡´æ¥æ”¶ç«¯å¤„ç†ä¸è¿‡æ¥**ã€‚ ä¸ºäº†è¯´æ˜æ»‘åŠ¨çª—å£ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçœ‹ä¸€ä¸‹ TCP ç¼“å†²åŒºçš„ä¸€äº›æ•°æ®ç»“æ„ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5oinwowj30p60a13z5.jpg)\n\nä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š\n\n- æ¥æ”¶ç«¯ LastByteRead æŒ‡å‘äº† TCP ç¼“å†²åŒºä¸­è¯»åˆ°çš„ä½ç½®ï¼ŒNextByteExpected æŒ‡å‘çš„åœ°æ–¹æ˜¯æ”¶åˆ°çš„è¿ç»­åŒ…çš„æœ€åä¸€ä¸ªä½ç½®ï¼ŒLastByteRcved æŒ‡å‘çš„æ˜¯æ”¶åˆ°çš„åŒ…çš„æœ€åä¸€ä¸ªä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸­é—´æœ‰äº›æ•°æ®è¿˜æ²¡æœ‰åˆ°è¾¾ï¼Œæ‰€ä»¥æœ‰æ•°æ®ç©ºç™½åŒºã€‚\n- å‘é€ç«¯çš„ LastByteAcked æŒ‡å‘äº†è¢«æ¥æ”¶ç«¯ Ack è¿‡çš„ä½ç½®ï¼ˆè¡¨ç¤ºæˆåŠŸå‘é€ç¡®è®¤ï¼‰ï¼ŒLastByteSent è¡¨ç¤ºå‘å‡ºå»äº†ï¼Œä½†è¿˜æ²¡æœ‰æ”¶åˆ°æˆåŠŸç¡®è®¤çš„ Ackï¼ŒLastByteWritten æŒ‡å‘çš„æ˜¯ä¸Šå±‚åº”ç”¨æ­£åœ¨å†™çš„åœ°æ–¹ã€‚\n\näºæ˜¯ï¼š\n\n- æ¥æ”¶ç«¯åœ¨ç»™å‘é€ç«¯å› ACK ä¸­ä¼šæ±‡æŠ¥è‡ªå·±çš„ AdvertisedWindow = MaxRcvBuffer â€“ LastByteRcvd â€“ 1;\n- è€Œå‘é€æ–¹ä¼šæ ¹æ®è¿™ä¸ªçª—å£æ¥æ§åˆ¶å‘é€æ•°æ®çš„å¤§å°ï¼Œä»¥ä¿è¯æ¥æ”¶æ–¹å¯ä»¥å¤„ç†ã€‚\n\nä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å‘é€æ–¹çš„æ»‘åŠ¨çª—å£ç¤ºæ„å›¾ï¼š\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5omcs7ej30ic07i750.jpg)\n\nä¸Šå›¾ä¸­åˆ†æˆäº†å››ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ï¼šï¼ˆå…¶ä¸­é‚£ä¸ªé»‘æ¨¡å‹å°±æ˜¯æ»‘åŠ¨çª—å£ï¼‰\n\n- \\#1 å·²æ”¶åˆ° ack ç¡®è®¤çš„æ•°æ®ã€‚\n- \\#2 å‘è¿˜æ²¡æ”¶åˆ° ack çš„ã€‚\n- \\#3 åœ¨çª—å£ä¸­è¿˜æ²¡æœ‰å‘å‡ºçš„ï¼ˆæ¥æ”¶æ–¹è¿˜æœ‰ç©ºé—´ï¼‰ã€‚\n- \\#4 çª—å£ä»¥å¤–çš„æ•°æ®ï¼ˆæ¥æ”¶æ–¹æ²¡ç©ºé—´ï¼‰\n\nä¸‹é¢æ˜¯ä¸ªæ»‘åŠ¨åçš„ç¤ºæ„å›¾ï¼ˆæ”¶åˆ° 36 çš„ ackï¼Œå¹¶å‘å‡ºäº† 46-51 çš„å­—èŠ‚ï¼‰ï¼š\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5oq49tuj30ic05uwev.jpg)\n\nä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ¥å—ç«¯æ§åˆ¶å‘é€ç«¯çš„å›¾ç¤ºï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5ot8lvsj30ii0n8wfy.jpg)\n\n### Zero Window\n\nä¸Šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå¤„ç†ç¼“æ…¢çš„ Serverï¼ˆæ¥æ”¶ç«¯ï¼‰æ˜¯æ€ä¹ˆæŠŠ Clientï¼ˆå‘é€ç«¯ï¼‰çš„ TCP Sliding Window ç»™é™æˆ 0 çš„ã€‚æ­¤æ—¶ï¼Œä½ ä¸€å®šä¼šé—®ï¼Œå¦‚æœ Window å˜æˆ 0 äº†ï¼ŒTCP ä¼šæ€ä¹ˆæ ·ï¼Ÿæ˜¯ä¸æ˜¯å‘é€ç«¯å°±ä¸å‘æ•°æ®äº†ï¼Ÿæ˜¯çš„ï¼Œå‘é€ç«¯å°±ä¸å‘æ•°æ®äº†ï¼Œä½ å¯ä»¥æƒ³åƒæˆâ€œWindow Closedâ€ï¼Œé‚£ä½ ä¸€å®šè¿˜ä¼šé—®ï¼Œå¦‚æœå‘é€ç«¯ä¸å‘æ•°æ®äº†ï¼Œæ¥æ”¶æ–¹ä¸€ä¼šå„¿ Window size å¯ç”¨äº†ï¼Œæ€ä¹ˆé€šçŸ¥å‘é€ç«¯å‘¢ï¼Ÿ\n\nè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTCP ä½¿ç”¨äº† Zero Window Probe æŠ€æœ¯ï¼Œç¼©å†™ä¸º ZWPï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‘é€ç«¯åœ¨çª—å£å˜æˆ 0 åï¼Œä¼šå‘ ZWP çš„åŒ…ç»™æ¥æ”¶æ–¹ï¼Œè®©æ¥æ”¶æ–¹æ¥ ack ä»–çš„ Window å°ºå¯¸ï¼Œä¸€èˆ¬è¿™ä¸ªå€¼ä¼šè®¾ç½®æˆ 3 æ¬¡ï¼Œç¬¬æ¬¡å¤§çº¦ 30-60 ç§’ï¼ˆä¸åŒçš„å®ç°å¯èƒ½ä¼šä¸ä¸€æ ·ï¼‰ã€‚å¦‚æœ 3 æ¬¡è¿‡åè¿˜æ˜¯ 0 çš„è¯ï¼Œæœ‰çš„ TCP å®ç°å°±ä¼šå‘ RST æŠŠé“¾æ¥æ–­äº†ã€‚\n\n**æ³¨æ„**ï¼šåªè¦æœ‰ç­‰å¾…çš„åœ°æ–¹éƒ½å¯èƒ½å‡ºç° DDoS æ”»å‡»ï¼ŒZero Window ä¹Ÿä¸ä¾‹å¤–ï¼Œä¸€äº›æ”»å‡»è€…ä¼šåœ¨å’Œ HTTP å»ºå¥½é“¾å‘å®Œ GET è¯·æ±‚åï¼Œå°±æŠŠ Window è®¾ç½®ä¸º 0ï¼Œç„¶åæœåŠ¡ç«¯å°±åªèƒ½ç­‰å¾…è¿›è¡Œ ZWPï¼Œäºæ˜¯æ”»å‡»è€…ä¼šå¹¶å‘å¤§é‡çš„è¿™æ ·çš„è¯·æ±‚ï¼ŒæŠŠæœåŠ¡å™¨ç«¯çš„èµ„æºè€—å°½ã€‚ï¼ˆå…³äºè¿™æ–¹é¢çš„æ”»å‡»ï¼Œå¤§å®¶å¯ä»¥ç§»æ­¥çœ‹ä¸€ä¸‹[Wikipedia çš„ SockStress è¯æ¡](http://en.wikipedia.org/wiki/Sockstress)ï¼‰\n\nå¦å¤–ï¼ŒWireshark ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ tcp.analysis.zero_window æ¥è¿‡æ»¤åŒ…ï¼Œç„¶åä½¿ç”¨å³é”®èœå•é‡Œçš„ follow TCP streamï¼Œä½ å¯ä»¥çœ‹åˆ° ZeroWindowProbe åŠ ZeroWindowProbeAck çš„åŒ…ã€‚\n\n### Silly Window Syndrome\n\nSilly Window Syndrome ç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯â€œç³Šæ¶‚çª—å£ç»¼åˆç—‡â€ã€‚æ­£å¦‚ä½ ä¸Šé¢çœ‹åˆ°çš„ä¸€æ ·ï¼Œå¦‚æœæˆ‘ä»¬çš„æ¥æ”¶æ–¹å¤ªå¿™äº†ï¼Œæ¥ä¸åŠå–èµ° Receive Windows é‡Œçš„æ•°æ®ï¼Œé‚£ä¹ˆï¼Œå°±ä¼šå¯¼è‡´å‘é€æ–¹è¶Šæ¥è¶Šå°ã€‚åˆ°æœ€åï¼Œå¦‚æœæ¥æ”¶æ–¹è…¾å‡ºå‡ ä¸ªå­—èŠ‚å¹¶å‘Šè¯‰å‘é€æ–¹ç°åœ¨æœ‰å‡ ä¸ªå­—èŠ‚çš„ windowï¼Œè€Œæˆ‘ä»¬çš„å‘é€æ–¹ä¼šä¹‰æ— åé¡¾åœ°å‘é€è¿™å‡ ä¸ªå­—èŠ‚ã€‚\n\nè¦çŸ¥é“ï¼Œæˆ‘ä»¬çš„ TCP+IP å¤´æœ‰ 40 ä¸ªå­—èŠ‚ï¼Œä¸ºäº†å‡ ä¸ªå­—èŠ‚ï¼Œè¦è¾¾ä¸Šè¿™ä¹ˆå¤§çš„å¼€é”€ï¼Œè¿™å¤ªä¸ç»æµäº†ã€‚\n\nå¦å¤–ï¼Œä½ éœ€è¦çŸ¥é“ç½‘ç»œä¸Šæœ‰ä¸ª MTUï¼Œå¯¹äºä»¥å¤ªç½‘æ¥è¯´ï¼ŒMTU æ˜¯ 1500 å­—èŠ‚ï¼Œé™¤å» TCP+IP å¤´çš„ 40 ä¸ªå­—èŠ‚ï¼ŒçœŸæ­£çš„æ•°æ®ä¼ è¾“å¯ä»¥æœ‰ 1460ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ MSSï¼ˆMax Segment Sizeï¼‰æ³¨æ„ï¼ŒTCP çš„ RFC å®šä¹‰è¿™ä¸ª MSS çš„é»˜è®¤å€¼æ˜¯ 536ï¼Œè¿™æ˜¯å› ä¸º [RFC 791](http://tools.ietf.org/html/rfc791)é‡Œè¯´äº†ä»»ä½•ä¸€ä¸ª IP è®¾å¤‡éƒ½å¾—æœ€å°‘æ¥æ”¶ 576 å°ºå¯¸çš„å¤§å°ï¼ˆå®é™…ä¸Šæ¥è¯´ 576 æ˜¯æ‹¨å·çš„ç½‘ç»œçš„ MTUï¼Œè€Œ 576 å‡å» IP å¤´çš„ 20 ä¸ªå­—èŠ‚å°±æ˜¯ 536ï¼‰ã€‚\n\n**å¦‚æœä½ çš„ç½‘ç»œåŒ…å¯ä»¥å¡æ»¡ MTUï¼Œé‚£ä¹ˆä½ å¯ä»¥ç”¨æ»¡æ•´ä¸ªå¸¦å®½ï¼Œå¦‚æœä¸èƒ½ï¼Œé‚£ä¹ˆä½ å°±ä¼šæµªè´¹å¸¦å®½**ã€‚ï¼ˆå¤§äº MTU çš„åŒ…æœ‰ä¸¤ç§ç»“å±€ï¼Œä¸€ç§æ˜¯ç›´æ¥è¢«ä¸¢äº†ï¼Œå¦ä¸€ç§æ˜¯ä¼šè¢«é‡æ–°åˆ†å—æ‰“åŒ…å‘é€ï¼‰ ä½ å¯ä»¥æƒ³åƒæˆä¸€ä¸ª MTU å°±ç›¸å½“äºä¸€ä¸ªé£æœºçš„æœ€å¤šå¯ä»¥è£…çš„äººï¼Œå¦‚æœè¿™é£æœºé‡Œæ»¡è½½çš„è¯ï¼Œå¸¦å®½æœ€é«˜ï¼Œå¦‚æœä¸€ä¸ªé£æœºåªè¿ä¸€ä¸ªäººçš„è¯ï¼Œæ— ç–‘æˆæœ¬å¢åŠ äº†ï¼Œä¹Ÿè€Œç›¸å½“äºŒã€‚\n\næ‰€ä»¥ï¼Œ**Silly Windows Syndrome è¿™ä¸ªç°åƒå°±åƒæ˜¯ä½ æœ¬æ¥å¯ä»¥å 200 äººçš„é£æœºé‡Œåªåšäº†ä¸€ä¸¤ä¸ªäºº**ã€‚ è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿä¸éš¾ï¼Œå°±æ˜¯é¿å…å¯¹å°çš„ window size åšå‡ºå“åº”ï¼Œç›´åˆ°æœ‰è¶³å¤Ÿå¤§çš„ window size å†å“åº”ï¼Œè¿™ä¸ªæ€è·¯å¯ä»¥åŒæ—¶å®ç°åœ¨ sender å’Œ receiver ä¸¤ç«¯ã€‚\n\n- å¦‚æœè¿™ä¸ªé—®é¢˜æ˜¯ç”± Receiver ç«¯å¼•èµ·çš„ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨ David D Clarkâ€™s æ–¹æ¡ˆã€‚åœ¨ receiver ç«¯ï¼Œå¦‚æœæ”¶åˆ°çš„æ•°æ®å¯¼è‡´ window size å°äºæŸä¸ªå€¼ï¼Œå¯ä»¥ç›´æ¥ ack(0)å› senderï¼Œè¿™æ ·å°±æŠŠ window ç»™å…³é—­äº†ï¼Œä¹Ÿé˜»æ­¢äº† sender å†å‘æ•°æ®è¿‡æ¥ï¼Œç­‰åˆ° receiver ç«¯å¤„ç†äº†ä¸€äº›æ•°æ®å windows size å¤§äºç­‰äºäº† MSSï¼Œæˆ–è€…ï¼Œreceiver buffer æœ‰ä¸€åŠä¸ºç©ºï¼Œå°±å¯ä»¥æŠŠ window æ‰“å¼€è®© send å‘é€æ•°æ®è¿‡æ¥ã€‚\n- å¦‚æœè¿™ä¸ªé—®é¢˜æ˜¯ç”± Sender ç«¯å¼•èµ·çš„ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨è‘—åçš„ [Nagleâ€™s algorithm](http://en.wikipedia.org/wiki/Nagle's_algorithm)ã€‚è¿™ä¸ªç®—æ³•çš„æ€è·¯ä¹Ÿæ˜¯å»¶æ—¶å¤„ç†ï¼Œä»–æœ‰ä¸¤ä¸ªä¸»è¦çš„æ¡ä»¶ï¼š1ï¼‰è¦ç­‰åˆ° Window Size>=MSS æˆ–æ˜¯ Data Size >=MSSï¼Œ2ï¼‰æ”¶åˆ°ä¹‹å‰å‘é€æ•°æ®çš„ ack å›åŒ…ï¼Œä»–æ‰ä¼šå‘æ•°æ®ï¼Œå¦åˆ™å°±æ˜¯åœ¨æ”’æ•°æ®ã€‚\n\nå¦å¤–ï¼ŒNagle ç®—æ³•é»˜è®¤æ˜¯æ‰“å¼€çš„ï¼Œæ‰€ä»¥ï¼Œå¯¹äºä¸€äº›éœ€è¦å°åŒ…åœºæ™¯çš„ç¨‹åºâ€”â€”**æ¯”å¦‚åƒ telnet æˆ– ssh è¿™æ ·çš„äº¤äº’æ€§æ¯”è¾ƒå¼ºçš„ç¨‹åºï¼Œä½ éœ€è¦å…³é—­è¿™ä¸ªç®—æ³•**ã€‚ä½ å¯ä»¥åœ¨ Socket è®¾ç½® TCP_NODELAY é€‰é¡¹æ¥å…³é—­è¿™ä¸ªç®—æ³•ï¼ˆå…³é—­ Nagle ç®—æ³•æ²¡æœ‰å…¨å±€å‚æ•°ï¼Œéœ€è¦æ ¹æ®æ¯ä¸ªåº”ç”¨è‡ªå·±çš„ç‰¹ç‚¹æ¥å…³é—­ï¼‰\n\n```\nsetsockopt(sock_fd, IPPROTO_TCP, TCP_NODELAY, (char*)&value,sizeof(int));\n```\n\nå¦å¤–ï¼Œç½‘ä¸Šæœ‰äº›æ–‡ç« è¯´ TCP_CORK çš„ socket option æ˜¯ä¹Ÿå…³é—­ Nagle ç®—æ³•ï¼Œè¿™ä¸å¯¹ã€‚**TCP_CORK å…¶å®æ˜¯æ›´æ–°æ¿€è¿›çš„ Nagle ç®—æ±‰ï¼Œå®Œå…¨ç¦æ­¢å°åŒ…å‘é€ï¼Œè€Œ Nagle ç®—æ³•æ²¡æœ‰ç¦æ­¢å°åŒ…å‘é€ï¼Œåªæ˜¯ç¦æ­¢äº†å¤§é‡çš„å°åŒ…å‘é€**ã€‚æœ€å¥½ä¸è¦ä¸¤ä¸ªé€‰é¡¹éƒ½è®¾ç½®ã€‚\n\n## TCP çš„æ‹¥å¡å¤„ç† â€“ Congestion Handling\n\nä¸Šé¢æˆ‘ä»¬çŸ¥é“äº†ï¼ŒTCP é€šè¿‡ Sliding Window æ¥åšæµæ§ï¼ˆFlow Controlï¼‰ï¼Œä½†æ˜¯ TCP è§‰å¾—è¿™è¿˜ä¸å¤Ÿï¼Œå› ä¸º Sliding Window éœ€è¦ä¾èµ–äºè¿æ¥çš„å‘é€ç«¯å’Œæ¥æ”¶ç«¯ï¼Œå…¶å¹¶ä¸çŸ¥é“ç½‘ç»œä¸­é—´å‘ç”Ÿäº†ä»€ä¹ˆã€‚TCP çš„è®¾è®¡è€…è§‰å¾—ï¼Œä¸€ä¸ªä¼Ÿå¤§è€Œç‰›é€¼çš„åè®®ä»…ä»…åšåˆ°æµæ§å¹¶ä¸å¤Ÿï¼Œå› ä¸ºæµæ§åªæ˜¯ç½‘ç»œæ¨¡å‹ 4 å±‚ä»¥ä¸Šçš„äº‹ï¼ŒTCP çš„è¿˜åº”è¯¥æ›´èªæ˜åœ°çŸ¥é“æ•´ä¸ªç½‘ç»œä¸Šçš„äº‹ã€‚\n\nå…·ä½“ä¸€ç‚¹ï¼Œæˆ‘ä»¬çŸ¥é“ TCP é€šè¿‡ä¸€ä¸ª timer é‡‡æ ·äº† RTT å¹¶è®¡ç®— RTOï¼Œä½†æ˜¯ï¼Œ**å¦‚æœç½‘ç»œä¸Šçš„å»¶æ—¶çªç„¶å¢åŠ ï¼Œé‚£ä¹ˆï¼ŒTCP å¯¹è¿™ä¸ªäº‹åšå‡ºçš„åº”å¯¹åªæœ‰é‡ä¼ æ•°æ®ï¼Œä½†æ˜¯ï¼Œé‡ä¼ ä¼šå¯¼è‡´ç½‘ç»œçš„è´Ÿæ‹…æ›´é‡ï¼Œäºæ˜¯ä¼šå¯¼è‡´æ›´å¤§çš„å»¶è¿Ÿä»¥åŠæ›´å¤šçš„ä¸¢åŒ…ï¼Œäºæ˜¯ï¼Œè¿™ä¸ªæƒ…å†µå°±ä¼šè¿›å…¥æ¶æ€§å¾ªç¯è¢«ä¸æ–­åœ°æ”¾å¤§ã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸€ä¸ªç½‘ç»œå†…æœ‰æˆåƒä¸Šä¸‡çš„ TCP è¿æ¥éƒ½è¿™ä¹ˆè¡Œäº‹ï¼Œé‚£ä¹ˆé©¬ä¸Šå°±ä¼šå½¢æˆâ€œç½‘ç»œé£æš´â€ï¼ŒTCP è¿™ä¸ªåè®®å°±ä¼šæ‹–å®æ•´ä¸ªç½‘ç»œã€‚**è¿™æ˜¯ä¸€ä¸ªç¾éš¾ã€‚\n\næ‰€ä»¥ï¼ŒTCP ä¸èƒ½å¿½ç•¥ç½‘ç»œä¸Šå‘ç”Ÿçš„äº‹æƒ…ï¼Œè€Œæ— è„‘åœ°ä¸€ä¸ªåŠ²åœ°é‡å‘æ•°æ®ï¼Œå¯¹ç½‘ç»œé€ æˆæ›´å¤§çš„ä¼¤å®³ã€‚å¯¹æ­¤ TCP çš„è®¾è®¡ç†å¿µæ˜¯ï¼š**TCP ä¸æ˜¯ä¸€ä¸ªè‡ªç§çš„åè®®ï¼Œå½“æ‹¥å¡å‘ç”Ÿçš„æ—¶å€™ï¼Œè¦åšè‡ªæˆ‘ç‰ºç‰²ã€‚å°±åƒäº¤é€šé˜»å¡ä¸€æ ·ï¼Œæ¯ä¸ªè½¦éƒ½åº”è¯¥æŠŠè·¯è®©å‡ºæ¥ï¼Œè€Œä¸è¦å†å»æŠ¢è·¯äº†ã€‚**\n\næ‹¥å¡æ§åˆ¶ä¸»è¦æ˜¯å››ä¸ªç®—æ³•ï¼š**1ï¼‰æ…¢å¯åŠ¨**ï¼Œ**2ï¼‰æ‹¥å¡é¿å…**ï¼Œ**3ï¼‰æ‹¥å¡å‘ç”Ÿ**ï¼Œ**4ï¼‰å¿«é€Ÿæ¢å¤**ã€‚è¿™å››ä¸ªç®—æ³•ä¸æ˜¯ä¸€å¤©éƒ½æå‡ºæ¥çš„ï¼Œè¿™ä¸ªå››ç®—æ³•çš„å‘å±•ç»å†äº†å¾ˆå¤šæ—¶é—´ï¼Œåˆ°ä»Šå¤©éƒ½è¿˜åœ¨ä¼˜åŒ–ä¸­ã€‚ å¤‡æ³¨:\n\n- 1988 å¹´ï¼ŒTCP-Tahoe æå‡ºäº† 1ï¼‰æ…¢å¯åŠ¨ï¼Œ2ï¼‰æ‹¥å¡é¿å…ï¼Œ3ï¼‰æ‹¥å¡å‘ç”Ÿæ—¶çš„å¿«é€Ÿé‡ä¼ \n- 1990 å¹´ï¼ŒTCP Reno åœ¨ Tahoe çš„åŸºç¡€ä¸Šå¢åŠ äº† 4ï¼‰å¿«é€Ÿæ¢å¤\n\n### æ…¢çƒ­å¯åŠ¨ç®—æ³• â€“ Slow Start\n\né¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ TCP çš„æ…¢çƒ­å¯åŠ¨ã€‚æ…¢å¯åŠ¨çš„æ„æ€æ˜¯ï¼ŒåˆšåˆšåŠ å…¥ç½‘ç»œçš„è¿æ¥ï¼Œä¸€ç‚¹ä¸€ç‚¹åœ°æé€Ÿï¼Œä¸è¦ä¸€ä¸Šæ¥å°±åƒé‚£äº›ç‰¹æƒè½¦ä¸€æ ·éœ¸é“åœ°æŠŠè·¯å æ»¡ã€‚æ–°åŒå­¦ä¸Šé«˜é€Ÿè¿˜æ˜¯è¦æ…¢ä¸€ç‚¹ï¼Œä¸è¦æŠŠå·²ç»åœ¨é«˜é€Ÿä¸Šçš„ç§©åºç»™æä¹±äº†ã€‚\n\næ…¢å¯åŠ¨çš„ç®—æ³•å¦‚ä¸‹(cwnd å…¨ç§° Congestion Window)ï¼š\n\n1ï¼‰è¿æ¥å»ºå¥½çš„å¼€å§‹å…ˆåˆå§‹åŒ– cwnd = 1ï¼Œè¡¨æ˜å¯ä»¥ä¼ ä¸€ä¸ª MSS å¤§å°çš„æ•°æ®ã€‚\n\n2ï¼‰æ¯å½“æ”¶åˆ°ä¸€ä¸ª ACKï¼Œcwnd++; å‘ˆçº¿æ€§ä¸Šå‡\n\n3ï¼‰æ¯å½“è¿‡äº†ä¸€ä¸ª RTTï¼Œcwnd = cwnd\\*2; å‘ˆæŒ‡æ•°è®©å‡\n\n4ï¼‰è¿˜æœ‰ä¸€ä¸ª ssthreshï¼ˆslow start thresholdï¼‰ï¼Œæ˜¯ä¸€ä¸ªä¸Šé™ï¼Œå½“ cwnd >= ssthresh æ—¶ï¼Œå°±ä¼šè¿›å…¥â€œæ‹¥å¡é¿å…ç®—æ³•â€ï¼ˆåé¢ä¼šè¯´è¿™ä¸ªç®—æ³•ï¼‰\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœç½‘é€Ÿå¾ˆå¿«çš„è¯ï¼ŒACK ä¹Ÿä¼šè¿”å›å¾—å¿«ï¼ŒRTT ä¹Ÿä¼šçŸ­ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ…¢å¯åŠ¨å°±ä¸€ç‚¹ä¹Ÿä¸æ…¢ã€‚ä¸‹å›¾è¯´æ˜äº†è¿™ä¸ªè¿‡ç¨‹ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5oz81ffj30ie0asjsi.jpg)\n\nä¸€ç¯‡ Google çš„è®ºæ–‡ã€Š[An Argument for Increasing TCPâ€™s Initial Congestion Window](http://static.googleusercontent.com/media/research.google.com/zh-CN//pubs/archive/36640.pdf)ã€‹Linux 3.0 åé‡‡ç”¨äº†è¿™ç¯‡è®ºæ–‡çš„å»ºè®®â€”â€”æŠŠ cwnd åˆå§‹åŒ–æˆäº† 10 ä¸ª MSSã€‚è€Œ Linux 3.0 ä»¥å‰ï¼Œæ¯”å¦‚ 2.6ï¼ŒLinux é‡‡ç”¨äº†[RFC3390](http://www.rfc-editor.org/rfc/rfc3390.txt)ï¼Œcwnd æ˜¯è·Ÿ MSS çš„å€¼æ¥å˜çš„ï¼Œå¦‚æœ MSS< 1095ï¼Œåˆ™ cwnd = 4ï¼›å¦‚æœ MSS>2190ï¼Œåˆ™ cwnd=2ï¼›å…¶å®ƒæƒ…å†µä¸‹ï¼Œåˆ™æ˜¯ 3ã€‚\n\n### æ‹¥å¡é¿å…ç®—æ³• â€“ Congestion Avoidance\n\nå‰é¢è¯´è¿‡ï¼Œè¿˜æœ‰ä¸€ä¸ª ssthreshï¼ˆslow start thresholdï¼‰ï¼Œæ˜¯ä¸€ä¸ªä¸Šé™ï¼Œå½“ cwnd >= ssthresh æ—¶ï¼Œå°±ä¼šè¿›å…¥â€œæ‹¥å¡é¿å…ç®—æ³•â€ã€‚ä¸€èˆ¬æ¥è¯´ ssthresh çš„å€¼æ˜¯ 65535ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼Œå½“ cwnd è¾¾åˆ°è¿™ä¸ªå€¼æ—¶åï¼Œç®—æ³•å¦‚ä¸‹ï¼š\n\n1ï¼‰æ”¶åˆ°ä¸€ä¸ª ACK æ—¶ï¼Œcwnd = cwnd + 1/cwnd\n\n2ï¼‰å½“æ¯è¿‡ä¸€ä¸ª RTT æ—¶ï¼Œcwnd = cwnd + 1\n\nè¿™æ ·å°±å¯ä»¥é¿å…å¢é•¿è¿‡å¿«å¯¼è‡´ç½‘ç»œæ‹¥å¡ï¼Œæ…¢æ…¢çš„å¢åŠ è°ƒæ•´åˆ°ç½‘ç»œçš„æœ€ä½³å€¼ã€‚å¾ˆæ˜æ˜¾ï¼Œæ˜¯ä¸€ä¸ªçº¿æ€§ä¸Šå‡çš„ç®—æ³•ã€‚\n\n### æ‹¥å¡çŠ¶æ€æ—¶çš„ç®—æ³•\n\nå‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œå½“ä¸¢åŒ…çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸¤ç§æƒ…å†µï¼š\n\n1ï¼‰ç­‰åˆ° RTO è¶…æ—¶ï¼Œé‡ä¼ æ•°æ®åŒ…ã€‚TCP è®¤ä¸ºè¿™ç§æƒ…å†µå¤ªç³Ÿç³•ï¼Œååº”ä¹Ÿå¾ˆå¼ºçƒˆã€‚\n\n- - sshthresh = cwnd /2\n  - cwnd é‡ç½®ä¸º 1\n  - è¿›å…¥æ…¢å¯åŠ¨è¿‡ç¨‹\n\n2ï¼‰Fast Retransmit ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯åœ¨æ”¶åˆ° 3 ä¸ª duplicate ACK æ—¶å°±å¼€å¯é‡ä¼ ï¼Œè€Œä¸ç”¨ç­‰åˆ° RTO è¶…æ—¶ã€‚\n\n- - TCP Tahoe çš„å®ç°å’Œ RTO è¶…æ—¶ä¸€æ ·ã€‚\n- - TCP Reno çš„å®ç°æ˜¯ï¼š\n    - cwnd = cwnd /2\n    - sshthresh = cwnd\n    - è¿›å…¥å¿«é€Ÿæ¢å¤ç®—æ³•â€”â€”Fast Recovery\n\nä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ° RTO è¶…æ—¶åï¼Œsshthresh ä¼šå˜æˆ cwnd çš„ä¸€åŠï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœ cwnd<=sshthresh æ—¶å‡ºç°çš„ä¸¢åŒ…ï¼Œé‚£ä¹ˆ TCP çš„ sshthresh å°±ä¼šå‡äº†ä¸€åŠï¼Œç„¶åç­‰ cwnd åˆå¾ˆå¿«åœ°ä»¥æŒ‡æ•°çº§å¢æ¶¨çˆ¬åˆ°è¿™ä¸ªåœ°æ–¹æ—¶ï¼Œå°±ä¼šæˆæ…¢æ…¢çš„çº¿æ€§å¢æ¶¨ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒTCP æ˜¯æ€ä¹ˆé€šè¿‡è¿™ç§å¼ºçƒˆåœ°éœ‡è¡å¿«é€Ÿè€Œå°å¿ƒå¾—æ‰¾åˆ°ç½‘ç«™æµé‡çš„å¹³è¡¡ç‚¹çš„ã€‚\n\n### å¿«é€Ÿæ¢å¤ç®—æ³• â€“ Fast Recovery\n\n#### TCP Reno\n\nè¿™ä¸ªç®—æ³•å®šä¹‰åœ¨[RFC5681](http://tools.ietf.org/html/rfc5681)ã€‚å¿«é€Ÿé‡ä¼ å’Œå¿«é€Ÿæ¢å¤ç®—æ³•ä¸€èˆ¬åŒæ—¶ä½¿ç”¨ã€‚å¿«é€Ÿæ¢å¤ç®—æ³•æ˜¯è®¤ä¸ºï¼Œä½ è¿˜æœ‰ 3 ä¸ª Duplicated Acks è¯´æ˜ç½‘ç»œä¹Ÿä¸é‚£ä¹ˆç³Ÿç³•ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦åƒ RTO è¶…æ—¶é‚£ä¹ˆå¼ºçƒˆã€‚ æ³¨æ„ï¼Œæ­£å¦‚å‰é¢æ‰€è¯´ï¼Œè¿›å…¥ Fast Recovery ä¹‹å‰ï¼Œcwnd å’Œ sshthresh å·²è¢«æ›´æ–°ï¼š\n\n- cwnd = cwnd /2\n- sshthresh = cwnd\n\nç„¶åï¼ŒçœŸæ­£çš„ Fast Recovery ç®—æ³•å¦‚ä¸‹ï¼š\n\n- cwnd = sshthresh + 3 \\* MSS ï¼ˆ3 çš„æ„æ€æ˜¯ç¡®è®¤æœ‰ 3 ä¸ªæ•°æ®åŒ…è¢«æ”¶åˆ°äº†ï¼‰\n- é‡ä¼  Duplicated ACKs æŒ‡å®šçš„æ•°æ®åŒ…\n- å¦‚æœå†æ”¶åˆ° duplicated Acksï¼Œé‚£ä¹ˆ cwnd = cwnd +1\n- å¦‚æœæ”¶åˆ°äº†æ–°çš„ Ackï¼Œé‚£ä¹ˆï¼Œcwnd = sshthresh ï¼Œç„¶åå°±è¿›å…¥äº†æ‹¥å¡é¿å…çš„ç®—æ³•äº†ã€‚\n\nå¦‚æœä½ ä»”ç»†æ€è€ƒä¸€ä¸‹ä¸Šé¢çš„è¿™ä¸ªç®—æ³•ï¼Œä½ å°±ä¼šçŸ¥é“ï¼Œ**ä¸Šé¢è¿™ä¸ªç®—æ³•ä¹Ÿæœ‰é—®é¢˜ï¼Œé‚£å°±æ˜¯â€”â€”å®ƒä¾èµ–äº 3 ä¸ªé‡å¤çš„ Acks**ã€‚æ³¨æ„ï¼Œ3 ä¸ªé‡å¤çš„ Acks å¹¶ä¸ä»£è¡¨åªä¸¢äº†ä¸€ä¸ªæ•°æ®åŒ…ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯ä¸¢äº†å¥½å¤šåŒ…ã€‚ä½†è¿™ä¸ªç®—æ³•åªä¼šé‡ä¼ ä¸€ä¸ªï¼Œè€Œå‰©ä¸‹çš„é‚£äº›åŒ…åªèƒ½ç­‰åˆ° RTO è¶…æ—¶ï¼Œäºæ˜¯ï¼Œè¿›å…¥äº†æ¶æ¢¦æ¨¡å¼â€”â€”è¶…æ—¶ä¸€ä¸ªçª—å£å°±å‡åŠä¸€ä¸‹ï¼Œå¤šä¸ªè¶…æ—¶ä¼šè¶…æˆ TCP çš„ä¼ è¾“é€Ÿåº¦å‘ˆçº§æ•°ä¸‹é™ï¼Œè€Œä¸”ä¹Ÿä¸ä¼šè§¦å‘ Fast Recovery ç®—æ³•äº†ã€‚\n\né€šå¸¸æ¥è¯´ï¼Œæ­£å¦‚æˆ‘ä»¬å‰é¢æ‰€è¯´çš„ï¼ŒSACK æˆ– D-SACK çš„æ–¹æ³•å¯ä»¥è®© Fast Recovery æˆ– Sender åœ¨åšå†³å®šæ—¶æ›´èªæ˜ä¸€äº›ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„ TCP çš„å®ç°éƒ½æ”¯æŒ SACKï¼ˆSACK éœ€è¦ä¸¤ç«¯éƒ½æ”¯æŒï¼‰ï¼Œæ‰€ä»¥ï¼Œéœ€è¦ä¸€ä¸ªæ²¡æœ‰ SACK çš„è§£å†³æ–¹æ¡ˆã€‚è€Œé€šè¿‡ SACK è¿›è¡Œæ‹¥å¡æ§åˆ¶çš„ç®—æ³•æ˜¯ FACKï¼ˆåé¢ä¼šè®²ï¼‰\n\n#### TCP New Reno\n\näºæ˜¯ï¼Œ1995 å¹´ï¼ŒTCP New Renoï¼ˆå‚è§ [RFC 6582](http://tools.ietf.org/html/rfc6582) ï¼‰ç®—æ³•æå‡ºæ¥ï¼Œä¸»è¦å°±æ˜¯åœ¨æ²¡æœ‰ SACK çš„æ”¯æŒä¸‹æ”¹è¿› Fast Recovery ç®—æ³•çš„â€”â€”\n\n- å½“ sender è¿™è¾¹æ”¶åˆ°äº† 3 ä¸ª Duplicated Acksï¼Œè¿›å…¥ Fast Retransimit æ¨¡å¼ï¼Œå¼€å‘é‡ä¼ é‡å¤ Acks æŒ‡ç¤ºçš„é‚£ä¸ªåŒ…ã€‚å¦‚æœåªæœ‰è¿™ä¸€ä¸ªåŒ…ä¸¢äº†ï¼Œé‚£ä¹ˆï¼Œé‡ä¼ è¿™ä¸ªåŒ…åå›æ¥çš„ Ack ä¼šæŠŠæ•´ä¸ªå·²ç»è¢« sender ä¼ è¾“å‡ºå»çš„æ•°æ® ack å›æ¥ã€‚å¦‚æœæ²¡æœ‰çš„è¯ï¼Œè¯´æ˜æœ‰å¤šä¸ªåŒ…ä¸¢äº†ã€‚æˆ‘ä»¬å«è¿™ä¸ª ACK ä¸º Partial ACKã€‚\n- ä¸€æ—¦ Sender è¿™è¾¹å‘ç°äº† Partial ACK å‡ºç°ï¼Œé‚£ä¹ˆï¼Œsender å°±å¯ä»¥æ¨ç†å‡ºæ¥æœ‰å¤šä¸ªåŒ…è¢«ä¸¢äº†ï¼Œäºæ˜¯ä¹ç»§ç»­é‡ä¼  sliding window é‡Œæœªè¢« ack çš„ç¬¬ä¸€ä¸ªåŒ…ã€‚ç›´åˆ°å†ä¹Ÿæ”¶ä¸åˆ°äº† Partial Ackï¼Œæ‰çœŸæ­£ç»“æŸ Fast Recovery è¿™ä¸ªè¿‡ç¨‹\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªâ€œFast Recovery çš„å˜æ›´â€æ˜¯ä¸€ä¸ªéå¸¸æ¿€è¿›çš„ç©æ³•ï¼Œä»–åŒæ—¶å»¶é•¿äº† Fast Retransmit å’Œ Fast Recovery çš„è¿‡ç¨‹ã€‚\n\n##### ç®—æ³•ç¤ºæ„å›¾\n\nä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„å›¾ç¤ºä»¥åŒæ—¶çœ‹ä¸€ä¸‹ä¸Šé¢çš„å„ç§ç®—æ³•çš„æ ·å­ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5p47j65j30sg09zgmc.jpg)\n\n#### FACK ç®—æ³•\n\nFACK å…¨ç§° Forward Acknowledgment ç®—æ³•ï¼Œè®ºæ–‡åœ°å€åœ¨è¿™é‡Œï¼ˆPDFï¼‰[Forward Acknowledgement: Refining TCP Congestion Control](http://conferences.sigcomm.org/sigcomm/1996/papers/mathis.pdf) è¿™ä¸ªç®—æ³•æ˜¯å…¶äº SACK çš„ï¼Œå‰é¢æˆ‘ä»¬è¯´è¿‡ SACK æ˜¯ä½¿ç”¨äº† TCP æ‰©å±•å­—æ®µ Ack äº†æœ‰å“ªäº›æ•°æ®æ”¶åˆ°ï¼Œå“ªäº›æ•°æ®æ²¡æœ‰æ”¶åˆ°ï¼Œä»–æ¯” Fast Retransmit çš„ 3 ä¸ª duplicated acks å¥½å¤„åœ¨äºï¼Œå‰è€…åªçŸ¥é“æœ‰åŒ…ä¸¢äº†ï¼Œä¸çŸ¥é“æ˜¯ä¸€ä¸ªè¿˜æ˜¯å¤šä¸ªï¼Œè€Œ SACK å¯ä»¥å‡†ç¡®çš„çŸ¥é“æœ‰å“ªäº›åŒ…ä¸¢äº†ã€‚ æ‰€ä»¥ï¼ŒSACK å¯ä»¥è®©å‘é€ç«¯è¿™è¾¹åœ¨é‡ä¼ è¿‡ç¨‹ä¸­ï¼ŒæŠŠé‚£äº›ä¸¢æ‰çš„åŒ…é‡ä¼ ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„ä¼ ï¼Œä½†è¿™æ ·çš„ä¸€æ¥ï¼Œå¦‚æœé‡ä¼ çš„åŒ…æ•°æ®æ¯”è¾ƒå¤šçš„è¯ï¼Œåˆä¼šå¯¼è‡´æœ¬æ¥å°±å¾ˆå¿™çš„ç½‘ç»œå°±æ›´å¿™äº†ã€‚æ‰€ä»¥ï¼ŒFACK ç”¨æ¥åšé‡ä¼ è¿‡ç¨‹ä¸­çš„æ‹¥å¡æµæ§ã€‚\n\n- è¿™ä¸ªç®—æ³•ä¼šæŠŠ SACK ä¸­æœ€å¤§çš„ Sequence Number ä¿å­˜åœ¨**snd.fack**è¿™ä¸ªå˜é‡ä¸­ï¼Œsnd.fack çš„æ›´æ–°ç”± ack å¸¦ç§‹ï¼Œå¦‚æœç½‘ç»œä¸€åˆ‡å®‰å¥½åˆ™å’Œ snd.una ä¸€æ ·ï¼ˆsnd.una å°±æ˜¯è¿˜æ²¡æœ‰æ”¶åˆ° ack çš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯å‰é¢ sliding window é‡Œçš„ category #2 çš„ç¬¬ä¸€ä¸ªåœ°æ–¹ï¼‰\n- ç„¶åå®šä¹‰ä¸€ä¸ª**awnd = snd.nxt â€“ snd.fack**ï¼ˆsnd.nxt æŒ‡å‘å‘é€ç«¯ sliding window ä¸­æ­£åœ¨è¦è¢«å‘é€çš„åœ°æ–¹â€”â€”å‰é¢ sliding windows å›¾ç¤ºçš„ category#3 ç¬¬ä¸€ä¸ªä½ç½®ï¼‰ï¼Œè¿™æ · awnd çš„æ„æ€å°±æ˜¯åœ¨ç½‘ç»œä¸Šçš„æ•°æ®ã€‚ï¼ˆæ‰€è°“ awnd æ„ä¸ºï¼šactual quantity of data outstanding in the networkï¼‰\n- å¦‚æœéœ€è¦é‡ä¼ æ•°æ®ï¼Œé‚£ä¹ˆï¼Œ**awnd = snd.nxt â€“ snd.fack + retran_data**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œawnd æ˜¯ä¼ å‡ºå»çš„æ•°æ® + é‡ä¼ çš„æ•°æ®ã€‚\n- ç„¶åè§¦å‘ Fast Recovery çš„æ¡ä»¶æ˜¯ï¼š ( **( snd.fack â€“ snd.una ) > (3\\*MSS)** ) || (dupacks == 3) ) ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±ä¸éœ€è¦ç­‰åˆ° 3 ä¸ª duplicated acks æ‰é‡ä¼ ï¼Œè€Œæ˜¯åªè¦ sack ä¸­çš„æœ€å¤§çš„ä¸€ä¸ªæ•°æ®å’Œ ack çš„æ•°æ®æ¯”è¾ƒé•¿äº†ï¼ˆ3 ä¸ª MSSï¼‰ï¼Œé‚£å°±è§¦å‘é‡ä¼ ã€‚åœ¨æ•´ä¸ªé‡ä¼ è¿‡ç¨‹ä¸­ cwnd ä¸å˜ã€‚ç›´åˆ°å½“ç¬¬ä¸€æ¬¡ä¸¢åŒ…çš„ snd.nxt<=snd.unaï¼ˆä¹Ÿå°±æ˜¯é‡ä¼ çš„æ•°æ®éƒ½è¢«ç¡®è®¤äº†ï¼‰ï¼Œç„¶åè¿›æ¥æ‹¥å¡é¿å…æœºåˆ¶â€”â€”cwnd çº¿æ€§ä¸Šæ¶¨ã€‚\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœæ²¡æœ‰ FACK åœ¨ï¼Œé‚£ä¹ˆåœ¨ä¸¢åŒ…æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼ŒåŸæ¥ä¿å®ˆçš„ç®—æ³•ä¼šä½ä¼°äº†éœ€è¦ä½¿ç”¨çš„ window çš„å¤§å°ï¼Œè€Œéœ€è¦å‡ ä¸ª RTT çš„æ—¶é—´æ‰ä¼šå®Œæˆæ¢å¤ï¼Œè€Œ FACK ä¼šæ¯”è¾ƒæ¿€è¿›åœ°æ¥å¹²è¿™äº‹ã€‚ ä½†æ˜¯ï¼ŒFACK å¦‚æœåœ¨ä¸€ä¸ªç½‘ç»œåŒ…ä¼šè¢« reordering çš„ç½‘ç»œé‡Œä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ã€‚\n\n## å…¶å®ƒæ‹¥å¡æ§åˆ¶ç®—æ³•ç®€ä»‹\n\n### **TCP Vegas æ‹¥å¡æ§åˆ¶ç®—æ³•**\n\nè¿™ä¸ªç®—æ³• 1994 å¹´è¢«æå‡ºï¼Œå®ƒä¸»è¦å¯¹ TCP Reno åšäº†äº›ä¿®æ”¹ã€‚è¿™ä¸ªç®—æ³•é€šè¿‡å¯¹ RTT çš„éå¸¸é‡çš„ç›‘æ§æ¥è®¡ç®—ä¸€ä¸ªåŸºå‡† RTTã€‚ç„¶åé€šè¿‡è¿™ä¸ªåŸºå‡† RTT æ¥ä¼°è®¡å½“å‰çš„ç½‘ç»œå®é™…å¸¦å®½ï¼Œå¦‚æœå®é™…å¸¦å®½æ¯”æˆ‘ä»¬çš„æœŸæœ›çš„å¸¦å®½è¦å°æˆ–æ˜¯è¦å¤šçš„æ´»ï¼Œé‚£ä¹ˆå°±å¼€å§‹çº¿æ€§åœ°å‡å°‘æˆ–å¢åŠ  cwnd çš„å¤§å°ã€‚å¦‚æœè¿™ä¸ªè®¡ç®—å‡ºæ¥çš„ RTT å¤§äºäº† Timeout åï¼Œé‚£ä¹ˆï¼Œä¸ç­‰ ack è¶…æ—¶å°±ç›´æ¥é‡ä¼ ã€‚ï¼ˆVegas çš„æ ¸å¿ƒæ€æƒ³æ˜¯ç”¨ RTT çš„å€¼æ¥å½±å“æ‹¥å¡çª—å£ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¸¢åŒ…ï¼‰ è¿™ä¸ªç®—æ³•çš„è®ºæ–‡æ˜¯ã€Š[TCP Vegas: End to End Congestion Avoidance on a Global Internet](http://www.cs.cmu.edu/~srini/15-744/F02/readings/BP95.pdf)ã€‹è¿™ç¯‡è®ºæ–‡ç»™äº† Vegas å’Œ New Reno çš„å¯¹æ¯”ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5p96am2j30sg0fftd3.jpg)\n\nå…³äºè¿™ä¸ªç®—æ³•å®ç°ï¼Œä½ å¯ä»¥å‚çœ‹ Linux æºç ï¼š[/net/ipv4/tcp_vegas.h](http://lxr.free-electrons.com/source/net/ipv4/tcp_vegas.h)ï¼Œ [/net/ipv4/tcp_vegas.c](http://lxr.free-electrons.com/source/net/ipv4/tcp_vegas.c)\n\n### HSTCP(High Speed TCP) ç®—æ³•\n\nè¿™ä¸ªç®—æ³•æ¥è‡ª[RFC 3649](http://tools.ietf.org/html/rfc3649)ï¼ˆ[Wikipedia è¯æ¡](http://en.wikipedia.org/wiki/HSTCP)ï¼‰ã€‚å…¶å¯¹æœ€åŸºç¡€çš„ç®—æ³•è¿›è¡Œäº†æ›´æ”¹ï¼Œä»–ä½¿å¾— Congestion Window æ¶¨å¾—å¿«ï¼Œå‡å¾—æ…¢ã€‚å…¶ä¸­ï¼š\n\n- æ‹¥å¡é¿å…æ—¶çš„çª—å£å¢é•¿æ–¹å¼ï¼š cwnd = cwnd + Î±(cwnd) / cwnd\n- ä¸¢åŒ…åçª—å£ä¸‹é™æ–¹å¼ï¼šcwnd = (1- Î²(cwnd))\\*cwnd\n\næ³¨ï¼šÎ±(cwnd)å’Œ Î²(cwnd)éƒ½æ˜¯å‡½æ•°ï¼Œå¦‚æœä½ è¦è®©ä»–ä»¬å’Œæ ‡å‡†çš„ TCP ä¸€æ ·ï¼Œé‚£ä¹ˆè®© Î±(cwnd)=1ï¼ŒÎ²(cwnd)=0.5 å°±å¯ä»¥äº†ã€‚ å¯¹äº Î±(cwnd)å’Œ Î²(cwnd)çš„å€¼æ˜¯ä¸ªåŠ¨æ€çš„å˜æ¢çš„ä¸œè¥¿ã€‚ å…³äºè¿™ä¸ªç®—æ³•çš„å®ç°ï¼Œä½ å¯ä»¥å‚çœ‹ Linux æºç ï¼š[/net/ipv4/tcp_highspeed.c](http://lxr.free-electrons.com/source/net/ipv4/tcp_highspeed.c)\n\n### TCP BIC ç®—æ³•\n\n2004 å¹´ï¼Œäº§å†…å‡º BIC ç®—æ³•ã€‚ç°åœ¨ä½ è¿˜å¯ä»¥æŸ¥å¾—åˆ°ç›¸å…³çš„æ–°é—»ã€ŠGoogleï¼š[ç¾ç§‘å­¦å®¶ç ”å‘ BIC-TCP åè®® é€Ÿåº¦æ˜¯ DSL å…­åƒå€](https://www.google.com/search?lr=lang_zh-CN|lang_zh-TW&newwindow=1&biw=1366&bih=597&tbs=lr%3Alang_1zh-CN|lang_1zh-TW&q=ç¾ç§‘å­¦å®¶ç ”å‘BIC-TCPåè®®+é€Ÿåº¦æ˜¯DSLå…­åƒå€&oq=ç¾ç§‘å­¦å®¶ç ”å‘BIC-TCPåè®®+é€Ÿåº¦æ˜¯DSLå…­åƒå€)ã€‹ BIC å…¨ç§°[Binary Increase Congestion control](http://research.csc.ncsu.edu/netsrv/?q=content/bic-and-cubic)ï¼Œåœ¨ Linux 2.6.8 ä¸­æ˜¯é»˜è®¤æ‹¥å¡æ§åˆ¶ç®—æ³•ã€‚BIC çš„å‘æ˜è€…å‘è¿™ä¹ˆå¤šçš„æ‹¥å¡æ§åˆ¶ç®—æ³•éƒ½åœ¨åŠªåŠ›æ‰¾ä¸€ä¸ªåˆé€‚çš„ cwnd â€“ Congestion Windowï¼Œè€Œä¸” BIC-TCP çš„æå‡ºè€…ä»¬çœ‹ç©¿äº†äº‹æƒ…çš„æœ¬è´¨ï¼Œå…¶å®è¿™å°±æ˜¯ä¸€ä¸ªæœç´¢çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ BIC è¿™ä¸ªç®—æ³•ä¸»è¦ç”¨çš„æ˜¯ Binary Searchâ€”â€”äºŒåˆ†æŸ¥æ‰¾æ¥å¹²è¿™ä¸ªäº‹ã€‚ å…³äºè¿™ä¸ªç®—æ³•å®ç°ï¼Œä½ å¯ä»¥å‚çœ‹ Linux æºç ï¼š[/net/ipv4/tcp_bic.c](http://lxr.free-electrons.com/source/net/ipv4/tcp_bic.c)\n\n### TCP WestWood ç®—æ³•\n\nwestwood é‡‡ç”¨å’Œ Reno ç›¸åŒçš„æ…¢å¯åŠ¨ç®—æ³•ã€æ‹¥å¡é¿å…ç®—æ³•ã€‚westwood çš„ä¸»è¦æ”¹è¿›æ–¹é¢ï¼šåœ¨å‘é€ç«¯åšå¸¦å®½ä¼°è®¡ï¼Œå½“æ¢æµ‹åˆ°ä¸¢åŒ…æ—¶ï¼Œæ ¹æ®å¸¦å®½å€¼æ¥è®¾ç½®æ‹¥å¡çª—å£ã€æ…¢å¯åŠ¨é˜ˆå€¼ã€‚ é‚£ä¹ˆï¼Œè¿™ä¸ªç®—æ³•æ˜¯æ€ä¹ˆæµ‹é‡å¸¦å®½çš„ï¼Ÿæ¯ä¸ª RTT æ—¶é—´ï¼Œä¼šæµ‹é‡ä¸€æ¬¡å¸¦å®½ï¼Œæµ‹é‡å¸¦å®½çš„å…¬å¼å¾ˆç®€å•ï¼Œå°±æ˜¯è¿™æ®µ RTT å†…æˆåŠŸè¢« ack äº†å¤šå°‘å­—èŠ‚ã€‚å› ä¸ºï¼Œè¿™ä¸ªå¸¦å®½å’Œç”¨ RTT è®¡ç®— RTO ä¸€æ ·ï¼Œä¹Ÿæ˜¯éœ€è¦ä»æ¯ä¸ªæ ·æœ¬æ¥å¹³æ»‘åˆ°ä¸€ä¸ªå€¼çš„â€”â€”ä¹Ÿæ˜¯ç”¨ä¸€ä¸ªåŠ æƒç§»å¹³å‡çš„å…¬å¼ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœä¸€ä¸ªç½‘ç»œçš„å¸¦å®½æ˜¯æ¯ç§’å¯ä»¥å‘é€ X ä¸ªå­—èŠ‚ï¼Œè€Œ RTT æ˜¯ä¸€ä¸ªæ•°æ®å‘å‡ºå»åç¡®è®¤éœ€è¦çš„æ—¶å€™ï¼Œæ‰€ä»¥ï¼ŒX _ RTT åº”è¯¥æ˜¯æˆ‘ä»¬ç¼“å†²åŒºå¤§å°ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™ä¸ªç®—æ³•ä¸­ï¼Œssthresh çš„å€¼å°±æ˜¯ est_BD _ min-RTT(æœ€å°çš„ RTT å€¼)ï¼Œå¦‚æœä¸¢åŒ…æ˜¯ Duplicated ACKs å¼•èµ·çš„ï¼Œé‚£ä¹ˆå¦‚æœ cwnd > ssthreshï¼Œåˆ™ cwin = ssthreshã€‚å¦‚æœæ˜¯ RTO å¼•èµ·çš„ï¼Œcwnd = 1ï¼Œè¿›å…¥æ…¢å¯åŠ¨ã€‚ å…³äºè¿™ä¸ªç®—æ³•å®ç°ï¼Œä½ å¯ä»¥å‚çœ‹ Linux æºç ï¼š [/net/ipv4/tcp_westwood.c](http://lxr.free-electrons.com/source/net/ipv4/tcp_westwood.c)\n\n## å››æ¬¡æŒ¥æ‰‹ä¼˜åŒ–â€”â€”ä¸‰æ¬¡æŒ¥æ‰‹\n\n```json\n#ä¸‰æ¬¡æŒ¥æ‰‹ -- å®¢æˆ·ç«¯å‘èµ·æ–­å¼€è¿æ¥è¯·æ±‚    å®¢æˆ·ç«¯åºåˆ—å·ä¸º 3495051432\n#fin  seq = 3495051432\n00:05:30.157325 IP 221.122.42.100.58706 > VM_0_6_centos.webcache: Flags [F.], seq 3495051432, ack 485492629, win 115, options [nop,nop,TS val 1695781058 ecr 629900122], length 0\n#ä¸‰æ¬¡æŒ¥æ‰‹ -- æœåŠ¡å™¨ç«¯å‘èµ·æ–­å¼€è¿æ¥è¯·æ±‚\n#ack = 3495051432 + 1 = 3495051433  æ³¨æ„ å› ä¸ºæœåŠ¡å™¨ç«¯ä¹Ÿæ²¡æœ‰ä¸œè¥¿è¦å‘é€äº†ï¼Œæ‰€ä»¥ä¹Ÿè¦å…³é—­è¿æ¥ï¼Œå› æ­¤åŒæ—¶å‘é€äº†finä¿¡å·ï¼Œseq = 485492629\n00:05:30.157562 IP VM_0_6_centos.webcache > 221.122.42.100.58706: Flags [F.], seq 485492629, ack 3495051433, win 235, options [nop,nop,TS val 629900162 ecr 1695781058], length 0\n#ä¸‰æ¬¡æŒ¥æ‰‹ -- å®¢æˆ·ç«¯åº”ç­”\n#ack = 485492629 + 1 = 485492630\n00:05:30.196710 IP 221.122.42.100.58706 > VM_0_6_centos.webcache: Flags [.], ack 485492630, win 115, options [nop,nop,TS val 1695781097 ecr 629900162], length 0\n```\n\nè¿™æ˜¯å› ä¸ºå…³é—­è¿æ¥æœ‰ä¸¤ç§æ–¹å¼ï¼Œå½“ä¸€æ–¹å…³é—­è¿æ¥ï¼Œå¦å¤–ä¸€æ–¹æ²¡æœ‰æ•°æ®å‘é€æ—¶ï¼Œé©¬ä¸Šå…³é—­è¿æ¥ï¼Œä¹Ÿå°±å°†ç¬¬äºŒæ­¥çš„ ack ä¸ç¬¬ä¸‰æ­¥çš„ fin åˆå¹¶ä¸ºä¸€æ­¥äº†\n","tags":["æµè§ˆå™¨","TCP/IP"],"categories":["æµè§ˆå™¨"]},{"title":"Promise","url":"/2019/08/05/promise/","content":"\n# promise\n\n## åˆ›å»º XHR çš„ promise å¯¹è±¡ï¼ˆPromise åŒ…è£… XHR[ajax]å¤„ç†ï¼‰\n\næ–¹æ³•ä¸€ï¼š\n\nåˆ›å»ºä¸€ä¸ªç”¨ Promise æŠŠ XHR å¤„ç†åŒ…è£…èµ·æ¥çš„åä¸º `getURL` çš„å‡½æ•°ã€‚\n\n<!-- more -->\n\n```javascript\nfunction getURL(URL) {\n  return new Promise(function(resolve, reject) {\n    var req = new XMLHttpRequest();\n    req.open(\"GET\", URL, true);\n    req.onload = function() {\n      if (req.status === 200) {\n        resolve(req.responseText);\n      } else {\n        reject(new Error(req.statusText));\n      }\n    };\n    req.onerror = function() {\n      reject(new Error(req.statusText));\n    };\n    req.send();\n  });\n}\n// è¿è¡Œç¤ºä¾‹\nvar URL = \"http://httpbin.org/get\";\ngetURL(URL)\n  .then(function onFulfilled(value) {\n    console.log(value);\n  })\n  .catch(function onRejected(error) {\n    console.error(error);\n  });\n```\n\næ–¹æ³•äºŒï¼š\n\n```javascript\nfunction ajaxPromise(url, data, callback) {\n  return new Promise(function(resolve, reject) {\n    $.ajax({\n      url: url,\n      type: data == null ? \"GET\" : \"POST\",\n      dataType: \"json\",\n      data: data == null ? \"\" : JSON.stringify(data),\n      async: true,\n      contentType: \"application/json\",\n      success: function(res) {\n        callback(res);\n        resolve();\n      },\n      error: function(XMLHttpRequest, textStatus, errorThrown) {\n        if (XMLHttpRequest.status == \"401\") {\n          window.parent.location = \"/enterprise/enterprise_login.html\";\n          self.location = \"/enterprise/enterprise_login.html\";\n        } else {\n          alert(XMLHttpRequest.responseText);\n        }\n        reject();\n      }\n    });\n  });\n}\n```\n\nè°ƒç”¨\n\n```javascript\najaxPromise('/prefix/entity1/action1',null, function(res){\n     //do something on response\n}).then(\n     ajaxPromise('/prefix/entity2/action2', someData, function(res){\n          //do something on response\n     }\n).then(\n     initVue() ;\n).then(\n     //do  something else\n)\n```\n\n## promise çš„å®ç°å’ŒåŸç†ï¼ˆç”¨ jsï¼‰\n\n[promise å®ç°åŸç†](https://juejin.im/post/5b83cb5ae51d4538cc3ec354)\n\n```javascript\n// åˆ¤æ–­å˜é‡å¦ä¸ºfunction\nconst isFunction = variable => typeof variable === \"function\";\n// å®šä¹‰Promiseçš„ä¸‰ç§çŠ¶æ€å¸¸é‡\nconst PENDING = \"PENDING\";\nconst FULFILLED = \"FULFILLED\";\nconst REJECTED = \"REJECTED\";\n\nclass MyPromise {\n  constructor(handle) {\n    if (!isFunction(handle)) {\n      throw new Error(\"MyPromise must accept a function as a parameter\");\n    }\n    // æ·»åŠ çŠ¶æ€\n    this._status = PENDING;\n    // æ·»åŠ çŠ¶æ€\n    this._value = undefined;\n    // æ·»åŠ æˆåŠŸå›è°ƒå‡½æ•°é˜Ÿåˆ—\n    this._fulfilledQueues = [];\n    // æ·»åŠ å¤±è´¥å›è°ƒå‡½æ•°é˜Ÿåˆ—\n    this._rejectedQueues = [];\n    // æ‰§è¡Œhandle\n    try {\n      handle(this._resolve.bind(this), this._reject.bind(this));\n    } catch (err) {\n      this._reject(err);\n    }\n  }\n  // æ·»åŠ resovleæ—¶æ‰§è¡Œçš„å‡½æ•°\n  _resolve(val) {\n    const run = () => {\n      if (this._status !== PENDING) return;\n      // ä¾æ¬¡æ‰§è¡ŒæˆåŠŸé˜Ÿåˆ—ä¸­çš„å‡½æ•°ï¼Œå¹¶æ¸…ç©ºé˜Ÿåˆ—\n      const runFulfilled = value => {\n        let cb;\n        while ((cb = this._fulfilledQueues.shift())) {\n          cb(value);\n        }\n      };\n      // ä¾æ¬¡æ‰§è¡Œå¤±è´¥é˜Ÿåˆ—ä¸­çš„å‡½æ•°ï¼Œå¹¶æ¸…ç©ºé˜Ÿåˆ—\n      const runRejected = error => {\n        let cb;\n        while ((cb = this._rejectedQueues.shift())) {\n          cb(error);\n        }\n      };\n      /* å¦‚æœresolveçš„å‚æ•°ä¸ºPromiseå¯¹è±¡ï¼Œåˆ™å¿…é¡»ç­‰å¾…è¯¥Promiseå¯¹è±¡çŠ¶æ€æ”¹å˜å,\n          å½“å‰Promsieçš„çŠ¶æ€æ‰ä¼šæ”¹å˜ï¼Œä¸”çŠ¶æ€å–å†³äºå‚æ•°Promsieå¯¹è±¡çš„çŠ¶æ€ */\n      if (val instanceof MyPromise) {\n        val.then(\n          value => {\n            this._value = value;\n            this._status = FULFILLED;\n            runFulfilled(value);\n          },\n          err => {\n            this._value = err;\n            this._status = REJECTED;\n            runRejected(err);\n          }\n        );\n      } else {\n        this._value = val;\n        this._status = FULFILLED;\n        runFulfilled(val);\n      }\n    };\n    // ä¸ºäº†æ”¯æŒåŒæ­¥çš„Promiseï¼Œè¿™é‡Œé‡‡ç”¨å¼‚æ­¥è°ƒç”¨\n    setTimeout(run, 0);\n  }\n  // æ·»åŠ rejectæ—¶æ‰§è¡Œçš„å‡½æ•°\n  _reject(err) {\n    if (this._status !== PENDING) return;\n    // ä¾æ¬¡æ‰§è¡Œå¤±è´¥é˜Ÿåˆ—ä¸­çš„å‡½æ•°ï¼Œå¹¶æ¸…ç©ºé˜Ÿåˆ—\n    const run = () => {\n      this._status = REJECTED;\n      this._value = err;\n      let cb;\n      while ((cb = this._rejectedQueues.shift())) {\n        cb(err);\n      }\n    };\n    // ä¸ºäº†æ”¯æŒåŒæ­¥çš„Promiseï¼Œè¿™é‡Œé‡‡ç”¨å¼‚æ­¥è°ƒç”¨\n    setTimeout(run, 0);\n  }\n  // æ·»åŠ thenæ–¹æ³•\n  then(onFulfilled, onRejected) {\n    const { _value, _status } = this;\n    // è¿”å›ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡\n    return new MyPromise((onFulfilledNext, onRejectedNext) => {\n      // å°è£…ä¸€ä¸ªæˆåŠŸæ—¶æ‰§è¡Œçš„å‡½æ•°\n      let fulfilled = value => {\n        try {\n          if (!isFunction(onFulfilled)) {\n            onFulfilledNext(value);\n          } else {\n            let res = onFulfilled(value);\n            if (res instanceof MyPromise) {\n              // å¦‚æœå½“å‰å›è°ƒå‡½æ•°è¿”å›MyPromiseå¯¹è±¡ï¼Œå¿…é¡»ç­‰å¾…å…¶çŠ¶æ€æ”¹å˜ååœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªå›è°ƒ\n              res.then(onFulfilledNext, onRejectedNext);\n            } else {\n              //å¦åˆ™ä¼šå°†è¿”å›ç»“æœç›´æ¥ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥ä¸‹ä¸€ä¸ªthençš„å›è°ƒå‡½æ•°ï¼Œå¹¶ç«‹å³æ‰§è¡Œä¸‹ä¸€ä¸ªthençš„å›è°ƒå‡½æ•°\n              onFulfilledNext(res);\n            }\n          }\n        } catch (err) {\n          // å¦‚æœå‡½æ•°æ‰§è¡Œå‡ºé”™ï¼Œæ–°çš„Promiseå¯¹è±¡çš„çŠ¶æ€ä¸ºå¤±è´¥\n          onRejectedNext(err);\n        }\n      };\n      // å°è£…ä¸€ä¸ªå¤±è´¥æ—¶æ‰§è¡Œçš„å‡½æ•°\n      let rejected = error => {\n        try {\n          if (!isFunction(onRejected)) {\n            onRejectedNext(error);\n          } else {\n            let res = onRejected(error);\n            if (res instanceof MyPromise) {\n              // å¦‚æœå½“å‰å›è°ƒå‡½æ•°è¿”å›MyPromiseå¯¹è±¡ï¼Œå¿…é¡»ç­‰å¾…å…¶çŠ¶æ€æ”¹å˜ååœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªå›è°ƒ\n              res.then(onFulfilledNext, onRejectedNext);\n            } else {\n              //å¦åˆ™ä¼šå°†è¿”å›ç»“æœç›´æ¥ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥ä¸‹ä¸€ä¸ªthençš„å›è°ƒå‡½æ•°ï¼Œå¹¶ç«‹å³æ‰§è¡Œä¸‹ä¸€ä¸ªthençš„å›è°ƒå‡½æ•°\n              onFulfilledNext(res);\n            }\n          }\n        } catch (err) {\n          // å¦‚æœå‡½æ•°æ‰§è¡Œå‡ºé”™ï¼Œæ–°çš„Promiseå¯¹è±¡çš„çŠ¶æ€ä¸ºå¤±è´¥\n          onRejectedNext(err);\n        }\n      };\n      switch (_status) {\n        // å½“çŠ¶æ€ä¸ºpendingæ—¶ï¼Œå°†thenæ–¹æ³•å›è°ƒå‡½æ•°åŠ å…¥æ‰§è¡Œé˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œ\n        case PENDING:\n          this._fulfilledQueues.push(fulfilled);\n          this._rejectedQueues.push(rejected);\n          break;\n        // å½“çŠ¶æ€å·²ç»æ”¹å˜æ—¶ï¼Œç«‹å³æ‰§è¡Œå¯¹åº”çš„å›è°ƒå‡½æ•°\n        case FULFILLED:\n          fulfilled(_value);\n          break;\n        case REJECTED:\n          rejected(_value);\n          break;\n      }\n    });\n  }\n  // æ·»åŠ catchæ–¹æ³•\n  catch(onRejected) {\n    return this.then(undefined, onRejected);\n  }\n  // æ·»åŠ é™æ€resolveæ–¹æ³•\n  static resolve(value) {\n    // å¦‚æœå‚æ•°æ˜¯MyPromiseå®ä¾‹ï¼Œç›´æ¥è¿”å›è¿™ä¸ªå®ä¾‹\n    if (value instanceof MyPromise) return value;\n    return new MyPromise(resolve => resolve(value));\n  }\n  // æ·»åŠ é™æ€rejectæ–¹æ³•\n  static reject(value) {\n    return new MyPromise((resolve, reject) => reject(value));\n  }\n  // æ·»åŠ é™æ€allæ–¹æ³•\n  static all(list) {\n    return new MyPromise((resolve, reject) => {\n      /**\n       * è¿”å›å€¼çš„é›†åˆ\n       */\n      let values = [];\n      let count = 0;\n      for (let [i, p] of list.entries()) {\n        // æ•°ç»„å‚æ•°å¦‚æœä¸æ˜¯MyPromiseå®ä¾‹ï¼Œå…ˆè°ƒç”¨MyPromise.resolve\n        this.resolve(p).then(\n          res => {\n            values[i] = res;\n            count++;\n            // æ‰€æœ‰çŠ¶æ€éƒ½å˜æˆfulfilledæ—¶è¿”å›çš„MyPromiseçŠ¶æ€å°±å˜æˆfulfilled\n            if (count === list.length) resolve(values);\n          },\n          err => {\n            // æœ‰ä¸€ä¸ªè¢«rejectedæ—¶è¿”å›çš„MyPromiseçŠ¶æ€å°±å˜æˆrejected\n            reject(err);\n          }\n        );\n      }\n    });\n  }\n  // æ·»åŠ é™æ€raceæ–¹æ³•\n  static race(list) {\n    return new MyPromise((resolve, reject) => {\n      for (let p of list) {\n        // åªè¦æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œæ–°çš„MyPromiseçš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜\n        this.resolve(p).then(\n          res => {\n            resolve(res);\n          },\n          err => {\n            reject(err);\n          }\n        );\n      }\n    });\n  }\n  finally(cb) {\n    return this.then(\n      value => MyPromise.resolve(cb()).then(() => value),\n      reason =>\n        MyPromise.resolve(cb()).then(() => {\n          throw reason;\n        })\n    );\n  }\n}\n```\n\n## promise.race å’Œè¶…æ—¶å¤„ç†\n\nå‡½æ•° `timeoutPromise(æ¯”è¾ƒå¯¹è±¡promise, ms)` æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯éœ€è¦ä½¿ç”¨è¶…æ—¶æœºåˆ¶çš„ promise å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¶…æ—¶æ—¶é—´ï¼Œå®ƒè¿”å›ä¸€ä¸ªç”± `Promise.race` åˆ›å»ºçš„ç›¸äº’ç«äº‰çš„ promise å¯¹è±¡ã€‚\n\n```javascript\nfunction delayPromise(ms) {\n  return new Promise(function(resolve) {\n    setTimeout(resolve, ms);\n  });\n}\nfunction timeoutPromise(promise, ms) {\n  var timeout = delayPromise(ms).then(function() {\n    throw new Error(\"Operation timed out after \" + ms + \" ms\");\n  });\n  return Promise.race([promise, timeout]);\n}\n```\n\nä¾‹å­ï¼š\n\n```javascript\nfunction delayPromise(ms) {\n  return new Promise(function(resolve) {\n    setTimeout(resolve, ms);\n  });\n}\nfunction timeoutPromise(promise, ms) {\n  var timeout = delayPromise(ms).then(function() {\n    throw new Error(\"Operation timed out after \" + ms + \" ms\");\n  });\n  return Promise.race([promise, timeout]);\n}\n// è¿è¡Œç¤ºä¾‹\nvar taskPromise = new Promise(function(resolve) {\n  // éšä¾¿ä¸€äº›ä»€ä¹ˆå¤„ç†\n  var delay = Math.random() * 2000;\n  setTimeout(function() {\n    resolve(delay + \"ms\");\n  }, delay);\n});\ntimeoutPromise(taskPromise, 1000)\n  .then(function(value) {\n    console.log(\"taskPromiseåœ¨è§„å®šæ—¶é—´å†…ç»“æŸ : \" + value);\n  })\n  .catch(function(error) {\n    console.log(\"å‘ç”Ÿè¶…æ—¶\", error);\n  });\n```\n\nè™½ç„¶åœ¨å‘ç”Ÿè¶…æ—¶çš„æ—¶å€™æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä½†æ˜¯è¿™æ ·çš„è¯æˆ‘ä»¬å°±ä¸èƒ½åŒºåˆ†è¿™ä¸ªå¼‚å¸¸åˆ°åº•æ˜¯*æ™®é€šçš„é”™è¯¯*è¿˜æ˜¯*è¶…æ—¶é”™è¯¯*äº†ã€‚\n\nä¸ºäº†èƒ½åŒºåˆ†è¿™ä¸ª `Error` å¯¹è±¡çš„ç±»å‹ï¼Œæˆ‘ä»¬å†æ¥å®šä¹‰ä¸€ä¸ª`Error` å¯¹è±¡çš„å­ç±» `TimeoutError`ã€‚\n\n- #### å®šåˆ¶ Error å¯¹è±¡\n\n```javascript\n//TimeoutError.js\nfunction copyOwnFrom(target, source) {\n  Object.getOwnPropertyNames(source).forEach(function(propName) {\n    Object.defineProperty(\n      target,\n      propName,\n      Object.getOwnPropertyDescriptor(source, propName)\n    );\n  });\n  return target;\n}\nfunction TimeoutError() {\n  var superInstance = Error.apply(null, arguments);\n  copyOwnFrom(this, superInstance);\n}\nTimeoutError.prototype = Object.create(Error.prototype);\nTimeoutError.prototype.constructor = TimeoutError;\n```\n\næˆ‘ä»¬å®šä¹‰äº† `TimeoutError` ç±»å’Œæ„é€ å‡½æ•°ï¼Œè¿™ä¸ªç±»ç»§æ‰¿äº† Error çš„ prototypeã€‚\n\nå®ƒçš„ä½¿ç”¨æ–¹æ³•å’Œæ™®é€šçš„ `Error` å¯¹è±¡ä¸€æ ·ï¼Œä½¿ç”¨ `throw` è¯­å¥å³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\n\n```javascript\nvar promise = new Promise(function() {\n  throw TimeoutError(\"timeout\");\n});\n\npromise.catch(function(error) {\n  console.log(error instanceof TimeoutError); // true\n});\n```\n\n- #### åº”ç”¨\n\nå–æ¶ˆ XHR æ“ä½œæœ¬èº«çš„è¯å¹¶ä¸éš¾ï¼Œåªéœ€è¦è°ƒç”¨ `XMLHttpRequest` å¯¹è±¡çš„ `abort()` æ–¹æ³•å°±å¯ä»¥äº†ã€‚\n\nä¸ºäº†èƒ½åœ¨å¤–éƒ¨è°ƒç”¨ `abort()` æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆå¯¹ä¹‹å‰æœ¬èŠ‚å‡ºç°çš„ [`getURL`](http://liubin.org/promises-book/#xhr-promise.js) è¿›è¡Œç®€å•çš„æ‰©å±•ï¼Œ`cancelableXHR` æ–¹æ³•é™¤äº†è¿”å›ä¸€ä¸ªåŒ…è£…äº† XHR çš„ promise å¯¹è±¡ä¹‹å¤–ï¼Œè¿˜è¿”å›äº†ä¸€ä¸ªç”¨äºå–æ¶ˆè¯¥ XHR è¯·æ±‚çš„`abort`æ–¹æ³•ã€‚\n\nå¤§ä½“çš„æµç¨‹å°±åƒä¸‹é¢è¿™æ ·ã€‚\n\n1. é€šè¿‡ `cancelableXHR` æ–¹æ³•å–å¾—åŒ…è£…äº† XHR çš„ promise å¯¹è±¡å’Œå–æ¶ˆè¯¥ XHR è¯·æ±‚çš„æ–¹æ³•\n2. åœ¨ `timeoutPromise` æ–¹æ³•ä¸­é€šè¿‡ `Promise.race` è®© XHR çš„åŒ…è£… promise å’Œè¶…æ—¶ç”¨ promise è¿›è¡Œç«äº‰ã€‚\n   - XHR åœ¨è¶…æ—¶å‰è¿”å›ç»“æœçš„è¯\n     1. å’Œæ­£å¸¸çš„ promise ä¸€æ ·ï¼Œé€šè¿‡ `then` è¿”å›è¯·æ±‚ç»“æœ\n   - å‘ç”Ÿè¶…æ—¶çš„æ—¶å€™\n     1. æŠ›å‡º `throw TimeoutError` å¼‚å¸¸å¹¶è¢« `catch`\n     2. catch çš„é”™è¯¯å¯¹è±¡å¦‚æœæ˜¯ `TimeoutError` ç±»å‹çš„è¯ï¼Œåˆ™è°ƒç”¨ `abort` æ–¹æ³•å–æ¶ˆ XHR è¯·æ±‚\n\n```javascript\nfunction copyOwnFrom(target, source) {\n  Object.getOwnPropertyNames(source).forEach(function(propName) {\n    Object.defineProperty(\n      target,\n      propName,\n      Object.getOwnPropertyDescriptor(source, propName)\n    );\n  });\n  return target;\n}\nfunction TimeoutError() {\n  var superInstance = Error.apply(null, arguments);\n  copyOwnFrom(this, superInstance);\n}\nTimeoutError.prototype = Object.create(Error.prototype);\nTimeoutError.prototype.constructor = TimeoutError;\nfunction delayPromise(ms) {\n  return new Promise(function(resolve) {\n    setTimeout(resolve, ms);\n  });\n}\nfunction timeoutPromise(promise, ms) {\n  var timeout = delayPromise(ms).then(function() {\n    return Promise.reject(\n      new TimeoutError(\"Operation timed out after \" + ms + \" ms\")\n    );\n  });\n  return Promise.race([promise, timeout]);\n}\nfunction cancelableXHR(URL) {\n  var req = new XMLHttpRequest();\n  var promise = new Promise(function(resolve, reject) {\n    req.open(\"GET\", URL, true);\n    req.onload = function() {\n      if (req.status === 200) {\n        resolve(req.responseText);\n      } else {\n        reject(new Error(req.statusText));\n      }\n    };\n    req.onerror = function() {\n      reject(new Error(req.statusText));\n    };\n    req.onabort = function() {\n      reject(new Error(\"abort this request\"));\n    };\n    req.send();\n  });\n  var abort = function() {\n    // å¦‚æœrequestè¿˜æ²¡æœ‰ç»“æŸçš„è¯å°±æ‰§è¡Œabort\n    // https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest\n    if (req.readyState !== XMLHttpRequest.UNSENT) {\n      req.abort();\n    }\n  };\n  return {\n    promise: promise,\n    abort: abort\n  };\n}\nvar object = cancelableXHR(\"http://httpbin.org/get\");\n// main\ntimeoutPromise(object.promise, 1000)\n  .then(function(contents) {\n    console.log(\"Contents\", contents);\n  })\n  .catch(function(error) {\n    if (error instanceof TimeoutError) {\n      object.abort();\n      return console.log(error);\n    }\n    console.log(\"XHR Error :\", error);\n  });\n```\n\n## promise.all å’Œé¡ºåºå¤„ç†\n\n- åœ¨ [é‡å¤ä½¿ç”¨å¤šä¸ª then çš„æ–¹æ³•](http://liubin.org/promises-book/#multiple-xhr.js) ä¸­çš„å®ç°æ–¹æ³•å¦‚ä¸‹ã€‚\n\n```javascript\nfunction getURL(URL) {\n  return new Promise(function(resolve, reject) {\n    var req = new XMLHttpRequest();\n    req.open(\"GET\", URL, true);\n    req.onload = function() {\n      if (req.status === 200) {\n        resolve(req.responseText);\n      } else {\n        reject(new Error(req.statusText));\n      }\n    };\n    req.onerror = function() {\n      reject(new Error(req.statusText));\n    };\n    req.send();\n  });\n}\nvar request = {\n  comment: function getComment() {\n    return getURL(\"http://azu.github.io/promises-book/json/comment.json\").then(\n      JSON.parse\n    );\n  },\n  people: function getPeople() {\n    return getURL(\"http://azu.github.io/promises-book/json/people.json\").then(\n      JSON.parse\n    );\n  }\n};\nfunction main() {\n  function recordValue(results, value) {\n    results.push(value);\n    return results;\n  }\n  // [] ç”¨æ¥ä¿å­˜åˆå§‹åŒ–çš„å€¼\n  var pushValue = recordValue.bind(null, []);\n  return request\n    .comment()\n    .then(pushValue)\n    .then(request.people)\n    .then(pushValue);\n}\n// è¿è¡Œç¤ºä¾‹\nmain()\n  .then(function(value) {\n    console.log(value);\n  })\n  .catch(function(error) {\n    console.error(error);\n  });\n```\n\nä½¿ç”¨è¿™ç§å†™æ³•çš„è¯é‚£ä¹ˆéšç€ `request` ä¸­å…ƒç´ æ•°é‡çš„å¢åŠ ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¸æ–­å¢åŠ å¯¹ `then` æ–¹æ³•çš„è°ƒç”¨\n\n- å°†å¤„ç†å†…å®¹ç»Ÿä¸€æ”¾åˆ°æ•°ç»„é‡Œï¼Œå†é…åˆ for å¾ªç¯è¿›è¡Œå¤„ç†\n\n```javascript\nfunction getURL(URL) {\n  return new Promise(function(resolve, reject) {\n    var req = new XMLHttpRequest();\n    req.open(\"GET\", URL, true);\n    req.onload = function() {\n      if (req.status === 200) {\n        resolve(req.responseText);\n      } else {\n        reject(new Error(req.statusText));\n      }\n    };\n    req.onerror = function() {\n      reject(new Error(req.statusText));\n    };\n    req.send();\n  });\n}\nvar request = {\n  comment: function getComment() {\n    return getURL(\"http://azu.github.io/promises-book/json/comment.json\").then(\n      JSON.parse\n    );\n  },\n  people: function getPeople() {\n    return getURL(\"http://azu.github.io/promises-book/json/people.json\").then(\n      JSON.parse\n    );\n  }\n};\nfunction main() {\n  function recordValue(results, value) {\n    results.push(value);\n    return results;\n  }\n  // [] ç”¨æ¥ä¿å­˜åˆå§‹åŒ–å€¼\n  var pushValue = recordValue.bind(null, []);\n  // è¿”å›promiseå¯¹è±¡çš„å‡½æ•°çš„æ•°ç»„\n  var tasks = [request.comment, request.people];\n  var promise = Promise.resolve();\n  // å¼€å§‹çš„åœ°æ–¹\n  for (var i = 0; i < tasks.length; i++) {\n    var task = tasks[i];\n    promise = promise.then(task).then(pushValue);\n  }\n  return promise;\n}\n// è¿è¡Œç¤ºä¾‹\nmain()\n  .then(function(value) {\n    console.log(value);\n  })\n  .catch(function(error) {\n    console.error(error);\n  });\n```\n\n`promise = promise.then(task).then(pushValue);` çš„ä»£ç å°±æ˜¯é€šè¿‡ä¸æ–­å¯¹ promise è¿›è¡Œå¤„ç†ï¼Œä¸æ–­çš„è¦†ç›– `promise` å˜é‡çš„å€¼ï¼Œä»¥è¾¾åˆ°å¯¹ promise å¯¹è±¡çš„ç´¯ç§¯å¤„ç†æ•ˆæœã€‚\n\nä½†æ˜¯è¿™ç§æ–¹æ³•éœ€è¦ `promise` è¿™ä¸ªä¸´æ—¶å˜é‡ï¼Œä»ä»£ç è´¨é‡ä¸Šæ¥è¯´æ˜¾å¾—ä¸é‚£ä¹ˆç®€æ´ã€‚\n\n- Promise chain å’Œ reduce\n\n```javascript\nfunction getURL(URL) {\n  return new Promise(function(resolve, reject) {\n    var req = new XMLHttpRequest();\n    req.open(\"GET\", URL, true);\n    req.onload = function() {\n      if (req.status === 200) {\n        resolve(req.responseText);\n      } else {\n        reject(new Error(req.statusText));\n      }\n    };\n    req.onerror = function() {\n      reject(new Error(req.statusText));\n    };\n    req.send();\n  });\n}\nvar request = {\n  comment: function getComment() {\n    return getURL(\"http://azu.github.io/promises-book/json/comment.json\").then(\n      JSON.parse\n    );\n  },\n  people: function getPeople() {\n    return getURL(\"http://azu.github.io/promises-book/json/people.json\").then(\n      JSON.parse\n    );\n  }\n};\nfunction main() {\n  function recordValue(results, value) {\n    results.push(value);\n    return results;\n  }\n  var pushValue = recordValue.bind(null, []);\n  var tasks = [request.comment, request.people];\n  return tasks.reduce(function(promise, task) {\n    return promise.then(task).then(pushValue);\n  }, Promise.resolve());\n}\n// è¿è¡Œç¤ºä¾‹\nmain()\n  .then(function(value) {\n    console.log(value);\n  })\n  .catch(function(error) {\n    console.error(error);\n  });\n```\n\n`Array.prototype.reduce` çš„ç¬¬äºŒä¸ªå‚æ•°ç”¨æ¥è®¾ç½®ç››æ”¾è®¡ç®—ç»“æœçš„åˆå§‹å€¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ `Promise.resolve()` ä¼šèµ‹å€¼ç»™ `promise`ï¼Œæ­¤æ—¶çš„ `task` ä¸º `request.comment` ã€‚\n\nåœ¨ reduce ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸­è¢« `return` çš„å€¼ï¼Œåˆ™ä¼šè¢«èµ‹å€¼ä¸ºä¸‹æ¬¡å¾ªç¯æ—¶çš„ `promise` ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡è¿”å›ç”± `then` åˆ›å»ºçš„æ–°çš„ promise å¯¹è±¡ï¼Œå°±å®ç°äº†å’Œ for å¾ªç¯ç±»ä¼¼çš„ [Promise chain](http://liubin.org/promises-book/#promise-chain) äº†ã€‚\n\nä½¿ç”¨ reduce å’Œ for å¾ªç¯ä¸åŒçš„åœ°æ–¹æ˜¯ reduce ä¸å†éœ€è¦ä¸´æ—¶å˜é‡ `promise` äº†ï¼Œå› æ­¤ä¹Ÿä¸ç”¨ç¼–å†™ `promise = promise.then(task).then(pushValue);` è¿™æ ·å†—é•¿çš„ä»£ç äº†ï¼Œè¿™æ˜¯éå¸¸å¤§çš„è¿›æ­¥ã€‚\n\n- å®šä¹‰è¿›è¡Œé¡ºåºå¤„ç†çš„å‡½æ•°\n\n```javascript\nfunction sequenceTasks(tasks) {\n  function recordValue(results, value) {\n    results.push(value);\n    return results;\n  }\n  var pushValue = recordValue.bind(null, []);\n  return tasks.reduce(function(promise, task) {\n    return promise.then(task).then(pushValue);\n  }, Promise.resolve());\n}\n```\n\néœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå’Œ `Promise.all` ç­‰ä¸åŒï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°çš„æ•°ç»„ã€‚ä¸ºä»€ä¹ˆä¼ ç»™è¿™ä¸ªå‡½æ•°çš„ä¸æ˜¯ä¸€ä¸ª promise å¯¹è±¡çš„æ•°ç»„å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º promise å¯¹è±¡åˆ›å»ºçš„æ—¶å€™ï¼ŒXHR å·²ç»å¼€å§‹æ‰§è¡Œäº†ï¼Œå› æ­¤å†å¯¹è¿™äº› promise å¯¹è±¡è¿›è¡Œé¡ºåºå¤„ç†çš„è¯å°±ä¸èƒ½æ­£å¸¸å·¥ä½œäº†ã€‚\n\né‡å†™ä¸Šä¾‹ï¼š\n\n```javascript\nfunction sequenceTasks(tasks) {\n  function recordValue(results, value) {\n    results.push(value);\n    return results;\n  }\n  var pushValue = recordValue.bind(null, []);\n  return tasks.reduce(function(promise, task) {\n    return promise.then(task).then(pushValue);\n  }, Promise.resolve());\n}\nfunction getURL(URL) {\n  return new Promise(function(resolve, reject) {\n    var req = new XMLHttpRequest();\n    req.open(\"GET\", URL, true);\n    req.onload = function() {\n      if (req.status === 200) {\n        resolve(req.responseText);\n      } else {\n        reject(new Error(req.statusText));\n      }\n    };\n    req.onerror = function() {\n      reject(new Error(req.statusText));\n    };\n    req.send();\n  });\n}\nvar request = {\n  comment: function getComment() {\n    return getURL(\"http://azu.github.io/promises-book/json/comment.json\").then(\n      JSON.parse\n    );\n  },\n  people: function getPeople() {\n    return getURL(\"http://azu.github.io/promises-book/json/people.json\").then(\n      JSON.parse\n    );\n  }\n};\nfunction main() {\n  return sequenceTasks([request.comment, request.people]);\n}\n// è¿è¡Œç¤ºä¾‹\nmain()\n  .then(function(value) {\n    console.log(value);\n  })\n  .catch(function(error) {\n    console.error(error);\n  });\n```\n\n## å¦‚ä½•å®ç° Promise.all ?\n\n```javascript\nPromise.all = function(promises) {\n  return new Promise((resolve, reject) => {\n    let index = 0;\n    let result = [];\n    if (promises.length === 0) {\n      resolve(result);\n    } else {\n      function processValue(i, data) {\n        result[i] = data;\n        if (++index === promises.length) {\n          resolve(result);\n        }\n      }\n      for (let i = 0; i < promises.length; i++) {\n        //promises[i] å¯èƒ½æ˜¯æ™®é€šå€¼\n        Promise.resolve(promises[i]).then(\n          data => {\n            processValue(i, data);\n          },\n          err => {\n            reject(err);\n            return;\n          }\n        );\n      }\n    }\n  });\n};\n```\n\n## å¦‚ä½•å®ç° Promise.finally ?\n\nä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½ä¼šèµ°åˆ° finally ä¸­,å¹¶ä¸” finally ä¹‹åï¼Œè¿˜å¯ä»¥ç»§ç»­ thenã€‚å¹¶ä¸”ä¼šå°†å€¼åŸå°ä¸åŠ¨çš„ä¼ é€’ç»™åé¢çš„ then.\n\n```javascript\nPromise.prototype.finally = function(callback) {\n  return this.then(\n    value => {\n      return Promise.resolve(callback()).then(() => {\n        return value;\n      });\n    },\n    err => {\n      return Promise.resolve(callback()).then(() => {\n        throw err;\n      });\n    }\n  );\n};\n```\n\n## å¸¸è§é—®é¢˜\n\n1. è¾“å‡ºç»“æœï¼šsuccess\n\n   è§£é¢˜æ€è·¯ï¼šPromise çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼Œæ— æ³•åœ¨å‘ç”Ÿå˜æ›´ã€‚\n\n```javascript\nconst promise = new Promise((resolve, reject) => {\n  setTimeout(() => {\n    resolve(\"success\");\n    reject(\"error\");\n  }, 1000);\n});\npromise.then(\n  res => {\n    console.log(res);\n  },\n  err => {\n    console.log(err);\n  }\n);\n```\n\n2. è¾“å‡ºç»“æœï¼š1\n\n   è§£é¢˜æ€è·¯ï¼šPromise çš„ then æ–¹æ³•çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ å…¥éå‡½æ•°åˆ™ä¼šå‘ç”Ÿå€¼ç©¿é€ã€‚\n\n```javascript\nPromise.resolve(1)\n  .then(2)\n  .then(Promise.resolve(3))\n  .then(console.log);\n```\n\n3. ç»“æœæ˜¯ï¼š3 4 6 8 7 5 2 1\n\n   ä¼˜å…ˆçº§å…³ç³»å¦‚ä¸‹ï¼š`process.nextTick > promise.then > setTimeout > setImmediate`\n\n```javascript\nsetImmediate(function() {\n  console.log(1);\n}, 0);\nsetTimeout(function() {\n  console.log(2);\n}, 0);\nnew Promise(function(resolve) {\n  console.log(3);\n  resolve();\n  console.log(4);\n}).then(function() {\n  console.log(5);\n});\nconsole.log(6);\nprocess.nextTick(function() {\n  console.log(7);\n});\nconsole.log(8);\n```\n\nV8 å®ç°ä¸­ï¼Œä¸¤ä¸ªé˜Ÿåˆ—å„åŒ…å«ä¸åŒçš„ä»»åŠ¡ï¼š\n\n`macrotasks: script(æ•´ä½“ä»£ç ),setTimeout, setInterval, setImmediate, I/O, UI rendering`\n`microtasks: process.nextTick, Promises, Object.observe, MutationObserver`\n\n4. å®ç°ä¸€ä¸ªç®€å•çš„ Promise\n\n   ```javascript\n   function Promise(fn) {\n     var status = \"pending\";\n     function successNotify() {\n       status = \"fulfilled\"; //çŠ¶æ€å˜ä¸ºfulfilled\n       toDoThen.apply(undefined, arguments); //æ‰§è¡Œå›è°ƒ\n     }\n     function failNotify() {\n       status = \"rejected\"; //çŠ¶æ€å˜ä¸ºrejected\n       toDoThen.apply(undefined, arguments); //æ‰§è¡Œå›è°ƒ\n     }\n     function toDoThen() {\n       setTimeout(() => {\n         // ä¿è¯å›è°ƒæ˜¯å¼‚æ­¥æ‰§è¡Œçš„\n         if (status === \"fulfilled\") {\n           for (let i = 0; i < successArray.length; i++) {\n             successArray[i].apply(undefined, arguments); //æ‰§è¡Œthené‡Œé¢çš„å›æ‰å‡½æ•°\n           }\n         } else if (status === \"rejected\") {\n           for (let i = 0; i < failArray.length; i++) {\n             failArray[i].apply(undefined, arguments); //æ‰§è¡Œthené‡Œé¢çš„å›æ‰å‡½æ•°\n           }\n         }\n       });\n     }\n     var successArray = [];\n     var failArray = [];\n     fn.call(undefined, successNotify, failNotify);\n     return {\n       then: function(successFn, failFn) {\n         successArray.push(successFn);\n         failArray.push(failFn);\n         return undefined; // æ­¤å¤„åº”è¯¥è¿”å›ä¸€ä¸ªPromise\n       }\n     };\n   }\n   ```\n\nè§£é¢˜æ€è·¯ï¼šPromise ä¸­çš„ resolve å’Œ reject ç”¨äºæ”¹å˜ Promise çš„çŠ¶æ€å’Œä¼ å‚ï¼Œthen ä¸­çš„å‚æ•°å¿…é¡»æ˜¯ä½œä¸ºå›è°ƒæ‰§è¡Œçš„å‡½æ•°ã€‚å› æ­¤ï¼Œå½“ Promise æ”¹å˜çŠ¶æ€ä¹‹åä¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œæ ¹æ®çŠ¶æ€çš„ä¸åŒé€‰æ‹©éœ€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚\n","tags":["JavaScript","ES6"],"categories":["ES6"]},{"title":"JSå¼•æ“æ‰§è¡Œæœºåˆ¶","url":"/2019/07/30/JSå¼•æ“æ‰§è¡Œæœºåˆ¶/","content":"\n# JS å¼•æ“æ‰§è¡Œæœºåˆ¶\n\n**(1) JS æ˜¯å•çº¿ç¨‹è¯­è¨€**\n\n**(2) JS çš„ Event Loop æ˜¯ JS çš„æ‰§è¡Œæœºåˆ¶ã€‚æ·±å…¥äº†è§£ JS çš„æ‰§è¡Œ,å°±ç­‰äºæ·±å…¥äº†è§£ JS é‡Œçš„ event loop**\n\n<!-- more -->\n\n## JS ä¸ºä»€ä¹ˆæ˜¯å•çº¿ç¨‹çš„? ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥? å•çº¿ç¨‹åˆæ˜¯å¦‚ä½•å®ç°å¼‚æ­¥çš„å‘¢?\n\n- JS æœ€åˆè¢«è®¾è®¡ç”¨åœ¨æµè§ˆå™¨ä¸­,é‚£ä¹ˆæƒ³è±¡ä¸€ä¸‹,å¦‚æœæµè§ˆå™¨ä¸­çš„ JS æ˜¯å¤šçº¿ç¨‹çš„ã€‚\n\n  åœºæ™¯æè¿°:\n\n  é‚£ä¹ˆç°åœ¨æœ‰ 2 ä¸ªçº¿ç¨‹,process1 process2,ç”±äºæ˜¯å¤šçº¿ç¨‹çš„ JS,æ‰€ä»¥ä»–ä»¬å¯¹åŒä¸€ä¸ª dom,åŒæ—¶è¿›è¡Œæ“ä½œã€‚process1 åˆ é™¤äº†è¯¥ dom,è€Œ process2 ç¼–è¾‘äº†è¯¥ dom,åŒæ—¶ä¸‹è¾¾ 2 ä¸ªçŸ›ç›¾çš„å‘½ä»¤,æµè§ˆå™¨ç©¶ç«Ÿè¯¥å¦‚ä½•æ‰§è¡Œå‘¢?\n\n- JS ä¸ºä»€ä¹ˆéœ€è¦å¼‚æ­¥?\n\n  å¦‚æœ JS ä¸­ä¸å­˜åœ¨å¼‚æ­¥,åªèƒ½è‡ªä¸Šè€Œä¸‹æ‰§è¡Œ,å¦‚æœä¸Šä¸€è¡Œè§£ææ—¶é—´å¾ˆé•¿,é‚£ä¹ˆä¸‹é¢çš„ä»£ç å°±ä¼šè¢«é˜»å¡ã€‚\n  å¯¹äºç”¨æˆ·è€Œè¨€,é˜»å¡å°±æ„å‘³ç€\"å¡æ­»\",è¿™æ ·å°±å¯¼è‡´äº†å¾ˆå·®çš„ç”¨æˆ·ä½“éªŒ\n\n- JS å•çº¿ç¨‹åˆæ˜¯å¦‚ä½•å®ç°å¼‚æ­¥çš„å‘¢?\n\n  **æ˜¯é€šè¿‡çš„äº‹ä»¶å¾ªç¯(event loop),ç†è§£äº† event loop æœºåˆ¶,å°±ç†è§£äº† JS çš„æ‰§è¡Œæœºåˆ¶**\n\n## JS ä¸­çš„ event loop\n\n### event loopï¼ˆ1ï¼‰\n\nJS é‡Œçš„ä¸€ç§åˆ†ç±»æ–¹å¼,å°±æ˜¯å°†ä»»åŠ¡åˆ†ä¸º: åŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡\n\nJS çš„æ‰§è¡Œæœºåˆ¶æ˜¯ï¼š\n\n- é¦–å…ˆåˆ¤æ–­ JS æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥,åŒæ­¥å°±è¿›å…¥ä¸»çº¿ç¨‹,å¼‚æ­¥å°±è¿›å…¥ event table\n- å¼‚æ­¥ä»»åŠ¡åœ¨ event table ä¸­æ³¨å†Œå‡½æ•°,å½“æ»¡è¶³è§¦å‘æ¡ä»¶å,è¢«æ¨å…¥ event queue\n- åŒæ­¥ä»»åŠ¡è¿›å…¥ä¸»çº¿ç¨‹åä¸€ç›´æ‰§è¡Œ,ç›´åˆ°ä¸»çº¿ç¨‹ç©ºé—²æ—¶,æ‰ä¼šå» event queue ä¸­æŸ¥çœ‹æ˜¯å¦æœ‰å¯æ‰§è¡Œçš„å¼‚æ­¥ä»»åŠ¡,å¦‚æœæœ‰å°±æ¨å…¥ä¸»çº¿ç¨‹ä¸­\n\n### event loopï¼ˆ2ï¼‰\n\nå‡†ç¡®çš„åˆ’åˆ†æ–¹å¼æ˜¯:\n\n- macro-task(å®ä»»åŠ¡)ï¼šåŒ…æ‹¬æ•´ä½“ä»£ç  scriptï¼ŒsetTimeoutï¼ŒsetInterval\n- micro-task(å¾®ä»»åŠ¡)ï¼šPromise.thenï¼Œprocess.nextTick\n\nJS çš„æ‰§è¡Œæœºåˆ¶æ˜¯ï¼š\n\n- æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡,è¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°å¾®ä»»åŠ¡,å°±å°†å…¶æ”¾åˆ°å¾®ä»»åŠ¡çš„ã€äº‹ä»¶é˜Ÿåˆ—ã€‘é‡Œ\n- å½“å‰å®ä»»åŠ¡æ‰§è¡Œå®Œæˆå,ä¼šæŸ¥çœ‹å¾®ä»»åŠ¡çš„ã€äº‹ä»¶é˜Ÿåˆ—ã€‘,å¹¶å°†é‡Œé¢å…¨éƒ¨çš„å¾®ä»»åŠ¡ä¾æ¬¡æ‰§è¡Œå®Œ\n\n**é‡å¤ä»¥ä¸Š 2 æ­¥éª¤,ç»“åˆ event loop(1) event loop(2) ,å°±æ˜¯æ›´ä¸ºå‡†ç¡®çš„ JS æ‰§è¡Œæœºåˆ¶äº†ã€‚**\n\n## ç†è§£ JavaScript çš„ async/await\n\n### async å’Œ await åœ¨å¹²ä»€ä¹ˆ\n\nå…ˆä»å­—é¢æ„æ€æ¥ç†è§£ã€‚async æ˜¯â€œå¼‚æ­¥â€çš„ç®€å†™ï¼Œè€Œ await å¯ä»¥è®¤ä¸ºæ˜¯ async wait çš„ç®€å†™ã€‚æ‰€ä»¥åº”è¯¥å¾ˆå¥½ç†è§£ async ç”¨äºç”³æ˜ä¸€ä¸ª function æ˜¯å¼‚æ­¥çš„ï¼Œè€Œ await ç”¨äºç­‰å¾…ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚\n\n- async å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª **Promise** å¯¹è±¡ã€‚\n  - å¦‚æœåœ¨å‡½æ•°ä¸­ `return` ä¸€ä¸ªç›´æ¥é‡ï¼Œasync ä¼šæŠŠè¿™ä¸ªç›´æ¥é‡é€šè¿‡ `Promise.resolve()` å°è£…æˆ Promise å¯¹è±¡ã€‚\n  - å¦‚æœ async å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œåˆè¯¥å¦‚ä½•ï¼Ÿå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå®ƒä¼šè¿”å› `Promise.resolve(undefined)`ã€‚\n  - Promise çš„ç‰¹ç‚¹â€”â€”æ— ç­‰å¾…ï¼Œæ‰€ä»¥åœ¨æ²¡æœ‰ `await` çš„æƒ…å†µä¸‹æ‰§è¡Œ async å‡½æ•°ï¼Œå®ƒä¼šç«‹å³æ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¹¶ä¸”ï¼Œç»ä¸ä¼šé˜»å¡åé¢çš„è¯­å¥ã€‚è¿™å’Œæ™®é€šè¿”å› Promise å¯¹è±¡çš„å‡½æ•°å¹¶æ— äºŒè‡´ã€‚\n- await ç­‰å¾…çš„æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚\n  - è¿™ä¸ªè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœæ˜¯ Promise å¯¹è±¡æˆ–è€…å…¶å®ƒå€¼ï¼ˆæ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ²¡æœ‰ç‰¹æ®Šé™å®šï¼‰ã€‚\n  - await ä¸ä»…ä»…ç”¨äºç­‰ Promise å¯¹è±¡ï¼Œå®ƒå¯ä»¥ç­‰ä»»æ„è¡¨è¾¾å¼çš„ç»“æœï¼Œæ‰€ä»¥ï¼Œawait åé¢å®é™…æ˜¯å¯ä»¥æ¥æ™®é€šå‡½æ•°è°ƒç”¨æˆ–è€…ç›´æ¥é‡çš„ã€‚\n- await ç­‰åˆ°äº†è¦ç­‰çš„ï¼Œç„¶åå‘¢ï¼Ÿ\n  - `await` æ˜¯ä¸ªè¿ç®—ç¬¦ï¼Œç”¨äºç»„æˆè¡¨è¾¾å¼ï¼Œawait è¡¨è¾¾å¼çš„è¿ç®—ç»“æœå–å†³äºå®ƒç­‰çš„ä¸œè¥¿ã€‚\n  - å¦‚æœå®ƒç­‰åˆ°çš„ä¸æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œé‚£ await è¡¨è¾¾å¼çš„è¿ç®—ç»“æœå°±æ˜¯å®ƒç­‰åˆ°çš„ä¸œè¥¿ã€‚\n  - å¦‚æœå®ƒç­‰åˆ°çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œawait å°±å¿™èµ·æ¥äº†ï¼Œå®ƒä¼šé˜»å¡åé¢çš„ä»£ç ï¼Œç­‰ç€ Promise å¯¹è±¡ resolveï¼Œç„¶åå¾—åˆ° resolve çš„å€¼ï¼Œä½œä¸º await è¡¨è¾¾å¼çš„è¿ç®—ç»“æœã€‚\n\nè¿™å°±æ˜¯ await å¿…é¡»ç”¨åœ¨ async å‡½æ•°ä¸­çš„åŸå› ã€‚async å‡½æ•°è°ƒç”¨ä¸ä¼šé€ æˆé˜»å¡ï¼Œå®ƒå†…éƒ¨æ‰€æœ‰çš„é˜»å¡éƒ½è¢«å°è£…åœ¨ä¸€ä¸ª Promise å¯¹è±¡ä¸­å¼‚æ­¥æ‰§è¡Œã€‚\n\n### await ç­‰å¾…çš„è¡¨è¾¾å¼è¯¦è§£\n\n**await ç­‰çš„æ˜¯å³ä¾§ã€Œè¡¨è¾¾å¼ã€çš„ç»“æœ**\n\nawait æ˜¯ä»**å³å‘å·¦æ‰§è¡Œçš„**\n\n```javascript\nasync function async1() {\n  console.log(\"async1 start\");\n  await async2();\n  console.log(\"async1 end\");\n}\nasync function async2() {\n  console.log(\"async2\");\n}\nasync1();\nconsole.log(\"script start\");\n```\n\nå…ˆæ‰§è¡Œ async2 åï¼Œå‘ç°æœ‰ await å…³é”®å­—ï¼Œäºæ˜¯è®©å‡ºçº¿ç¨‹ï¼Œé˜»å¡ä»£ç \n\nå³ä¾§è¡¨è¾¾å¼çš„ç»“æœ:\n\n- å¦‚æœä¸æ˜¯ promise , await ä¼šé˜»å¡åé¢çš„ä»£ç ï¼Œå…ˆæ‰§è¡Œ async å¤–é¢çš„åŒæ­¥ä»£ç ï¼ŒåŒæ­¥ä»£ç æ‰§è¡Œå®Œï¼Œå†å›åˆ° async å†…éƒ¨ï¼ŒæŠŠè¿™ä¸ªé promise çš„ä¸œè¥¿ï¼Œä½œä¸º await è¡¨è¾¾å¼çš„ç»“æœ\n- å¦‚æœå®ƒç­‰åˆ°çš„æ˜¯ä¸€ä¸ª promise å¯¹è±¡ï¼Œawait ä¹Ÿä¼šæš‚åœ async åé¢çš„ä»£ç ï¼Œå…ˆæ‰§è¡Œ async å¤–é¢çš„åŒæ­¥ä»£ç ï¼Œç­‰ç€ Promise å¯¹è±¡ fulfilledï¼Œç„¶åæŠŠ resolve çš„å‚æ•°ä½œä¸º await è¡¨è¾¾å¼çš„è¿ç®—ç»“æœã€‚\n\n### async/await çš„ä¼˜åŠ¿åœ¨äºå¤„ç† then é“¾\n\nå•ä¸€çš„ Promise é“¾å¹¶ä¸èƒ½å‘ç° async/await çš„ä¼˜åŠ¿ï¼Œä½†æ˜¯ï¼Œå¦‚æœéœ€è¦å¤„ç†ç”±å¤šä¸ª Promise ç»„æˆçš„ then é“¾çš„æ—¶å€™ï¼Œä¼˜åŠ¿å°±èƒ½ä½“ç°å‡ºæ¥äº†ã€‚\n\n- Async/await ä»£ç æ¸…æ™°å¾ˆå¤šï¼Œå‡ ä¹è·ŸåŒæ­¥ä»£ç ä¸€æ ·ã€‚\n- Promise æ–¹æ¡ˆçš„æ­»ç©´â€”â€” é“¾å¼è°ƒç”¨å‚æ•°ä¼ é€’å¤ªéº»çƒ¦\n\n## async/await å’Œ promise çš„æ‰§è¡Œé¡ºåº\n\n### ä¾‹å­\n\n```javascript\nasync function async1() {\n  console.log(\"async1 start\");\n  await async2();\n  console.log(\"async1 end\");\n}\nasync function async2() {\n  console.log(\"async2\");\n}\nconsole.log(\"script start\");\nsetTimeout(function() {\n  console.log(\"setTimeout\");\n}, 0);\nasync1();\nnew Promise(function(resolve) {\n  console.log(\"promise1\");\n  resolve();\n}).then(function() {\n  console.log(\"promise2\");\n});\nconsole.log(\"script end\");\n```\n\n```javascript\nscript start\nasync1 start\nasync2\npromise1\nscript end\npromise2\nasync1 end\nsetTimeout\n```\n\nå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡çš„æ…¨å¿µï¼Œåœ¨æˆ‘è„‘æµ·ä¸­å®ä»»åŠ¡å’Œä¸ºå¾®ä»»åŠ¡å¦‚å›¾æ‰€ç¤º\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izm5nu3ij30f204qq2z.jpg)\n\nä¹Ÿå°±æ˜¯ã€Œå®ä»»åŠ¡ã€ã€ã€Œå¾®ä»»åŠ¡ã€éƒ½æ˜¯é˜Ÿåˆ—ã€‚\n\nä¸€æ®µä»£ç æ‰§è¡Œæ—¶ï¼Œä¼šå…ˆæ‰§è¡Œå®ä»»åŠ¡ä¸­çš„åŒæ­¥ä»£ç ï¼Œ\n\n- å¦‚æœæ‰§è¡Œä¸­é‡åˆ° setTimeout ä¹‹ç±»å®ä»»åŠ¡ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸ª setTimeout å†…éƒ¨çš„å‡½æ•°æ¨å…¥ã€Œå®ä»»åŠ¡çš„é˜Ÿåˆ—ã€ä¸­ï¼Œä¸‹ä¸€è½®å®ä»»åŠ¡æ‰§è¡Œæ—¶è°ƒç”¨ã€‚\n- å¦‚æœæ‰§è¡Œä¸­é‡åˆ° promise.then()ä¹‹ç±»çš„å¾®ä»»åŠ¡ï¼Œå°±ä¼šæ¨å…¥åˆ°ã€Œå½“å‰å®ä»»åŠ¡çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ã€ä¸­ï¼Œåœ¨æœ¬è½®å®ä»»åŠ¡çš„åŒæ­¥ä»£ç æ‰§è¡Œéƒ½å®Œæˆåï¼Œä¾æ¬¡æ‰§è¡Œæ‰€æœ‰çš„å¾®ä»»åŠ¡ 1ã€2ã€3\n\n### ä¾‹å­åˆ†ææ‰§è¡Œé¡ºåº\n\n#### ç›´æ¥æ‰“å°åŒæ­¥ä»£ç  console.log(â€˜script startâ€™)\n\n```javascript\n// é¦–å…ˆæ˜¯2ä¸ªå‡½æ•°å£°æ˜ï¼Œè™½ç„¶æœ‰asyncå…³é”®å­—ï¼Œä½†ä¸æ˜¯è°ƒç”¨æˆ‘ä»¬å°±ä¸çœ‹ã€‚ç„¶åé¦–å…ˆæ˜¯æ‰“å°åŒæ­¥ä»£ç \nconsole.log(\"script start\");\n```\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izmivm1ij30m801x745.jpg)\n\n#### å°† setTimeout æ”¾å…¥å®ä»»åŠ¡é˜Ÿåˆ—\n\né»˜è®¤æ‰€åŒ…è£¹çš„ä»£ç ï¼Œå…¶å®å¯ä»¥ç†è§£ä¸ºæ˜¯ç¬¬ä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯å®ä»»åŠ¡ 2\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izmvovzjj30m8034dft.jpg)\n\n#### è°ƒç”¨ async1ï¼Œæ‰“å° åŒæ­¥ä»£ç  console.log( â€˜async1 startâ€™ )\n\næˆ‘ä»¬è¯´è¿‡çœ‹åˆ°å¸¦æœ‰ async å…³é”®å­—çš„å‡½æ•°ï¼Œä¸ç”¨å®³æ€•ï¼Œå®ƒçš„ä»…ä»…æ˜¯æŠŠ return å€¼åŒ…è£…æˆäº† promiseï¼Œå…¶ä»–å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒçš„åœ°æ–¹ã€‚æ‰€ä»¥å°±å¾ˆæ™®é€šçš„æ‰“å° console.log( â€˜async1 startâ€™ )\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izn7f29dj30m803dt8o.jpg)\n\n#### åˆ†æä¸€ä¸‹ await async2()\n\nå‰æ–‡æè¿‡ awaitï¼Œ1.å®ƒå…ˆè®¡ç®—å‡ºå³ä¾§çš„ç»“æœï¼Œ2.ç„¶åçœ‹åˆ° await åï¼Œä¸­æ–­ async å‡½æ•°\n\n- å…ˆå¾—åˆ° await å³ä¾§è¡¨è¾¾å¼çš„ç»“æœã€‚æ‰§è¡Œ async2()ï¼Œæ‰“å°åŒæ­¥ä»£ç  console.log(â€˜async2â€™), å¹¶ä¸” return Promise.resolve(undefined)\n- await åï¼Œä¸­æ–­ async å‡½æ•°ï¼Œå…ˆæ‰§è¡Œ async å¤–çš„åŒæ­¥ä»£ç \n\nç›®å‰å°±ç›´æ¥æ‰“å° console.log(â€˜async2â€™)\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iznit5adj30m803edfu.jpg)\n\n#### è¢«é˜»å¡åï¼Œè¦æ‰§è¡Œ async ä¹‹å¤–çš„ä»£ç \n\næ‰§è¡Œ new Promise()ï¼ŒPromise æ„é€ å‡½æ•°æ˜¯ç›´æ¥è°ƒç”¨çš„åŒæ­¥ä»£ç ï¼Œæ‰€ä»¥ console.log( â€˜promise1â€™ )\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iznu7o6jj30m803l74a.jpg)\n\n#### ä»£ç è¿è¡Œåˆ° promise.then()\n\nä»£ç è¿è¡Œåˆ° promise.then()ï¼Œå‘ç°è¿™ä¸ªæ˜¯å¾®ä»»åŠ¡ï¼Œæ‰€ä»¥æš‚æ—¶ä¸æ‰“å°ï¼Œåªæ˜¯æ¨å…¥å½“å‰å®ä»»åŠ¡çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚\n\n**æ³¨æ„ï¼šè¿™é‡Œåªæ˜¯æŠŠ promise2 æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œã€‚å¾®ä»»åŠ¡ä¼šåœ¨å½“å‰å®ä»»åŠ¡çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œæ‰ä¼šä¾æ¬¡æ‰§è¡Œ**\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izo8rmlkj30m803c0sp.jpg)\n\n#### æ‰“å°åŒæ­¥ä»£ç  console.log(â€˜script endâ€™)\n\næ‰§è¡Œå®Œè¿™ä¸ªåŒæ­¥ä»£ç åï¼Œã€Œasync å¤–çš„ä»£ç ã€ç»ˆäºèµ°äº†ä¸€é\n\nä¸‹é¢è¯¥å›åˆ° await è¡¨è¾¾å¼é‚£é‡Œï¼Œæ‰§è¡Œ await Promise.resolve(undefined)äº†\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izoj1zjkj30m803c749.jpg)\n\n#### å›åˆ° async å†…éƒ¨ï¼Œæ‰§è¡Œ await Promise.resolve(undefined)\n\nè¿™éƒ¨åˆ†å¯èƒ½ä¸å¤ªå¥½ç†è§£ï¼Œæˆ‘å°½é‡è¡¨è¾¾æˆ‘çš„æƒ³æ³•ã€‚\n\nå¯¹äº await Promise.resolve(undefined) å¦‚ä½•ç†è§£å‘¢ï¼Ÿ\n\næ ¹æ® [MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/await) åŸè¯æˆ‘ä»¬çŸ¥é“\n\n**å¦‚æœä¸€ä¸ª Promise è¢«ä¼ é€’ç»™ä¸€ä¸ª await æ“ä½œç¬¦ï¼Œawait å°†ç­‰å¾… Promise æ­£å¸¸å¤„ç†å®Œæˆå¹¶è¿”å›å…¶å¤„ç†ç»“æœã€‚**\n\nåœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°±æ˜¯ Promise.resolve(undefined)æ­£å¸¸å¤„ç†å®Œæˆï¼Œå¹¶è¿”å›å…¶å¤„ç†ç»“æœã€‚é‚£ä¹ˆ await async2()å°±ç®—æ˜¯æ‰§è¡Œç»“æŸäº†ã€‚\n\nç›®å‰è¿™ä¸ª promise çš„çŠ¶æ€æ˜¯ fulfilledï¼Œç­‰å…¶å¤„ç†ç»“æœè¿”å›å°±å¯ä»¥æ‰§è¡Œ await ä¸‹é¢çš„ä»£ç äº†ã€‚\n\né‚£ä½•æ—¶èƒ½æ‹¿åˆ°å¤„ç†ç»“æœå‘¢ï¼Ÿ\n\nå›å¿†å¹³æ—¶æˆ‘ä»¬ç”¨ promiseï¼Œè°ƒç”¨ resolve åï¼Œä½•æ—¶èƒ½æ‹¿åˆ°å¤„ç†ç»“æœï¼Ÿæ˜¯ä¸æ˜¯éœ€è¦åœ¨ then çš„ç¬¬ä¸€ä¸ªå‚æ•°é‡Œï¼Œæ‰èƒ½æ‹¿åˆ°ç»“æœã€‚\n\nï¼ˆè°ƒç”¨ resolve æ—¶ï¼Œä¼šæŠŠ then çš„å‚æ•°æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œç­‰ä¸»çº¿ç¨‹ç©ºé—²æ—¶ï¼Œå†è°ƒç”¨å®ƒï¼‰\n\næ‰€ä»¥è¿™é‡Œçš„ await Promise.resolve() å°±ç±»ä¼¼äº\n\n```javascript\nPromise.resolve(undefined).then(undefined => {});\n```\n\næŠŠ then çš„ç¬¬ä¸€ä¸ªå›è°ƒå‚æ•° (undefined) => {} æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚\n\nthen æ‰§è¡Œå®Œï¼Œæ‰æ˜¯ await async2()æ‰§è¡Œç»“æŸã€‚\n\nawait async2()æ‰§è¡Œç»“æŸï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç \n\nå¦‚å›¾\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6izovbp1aj30m8037q2y.jpg)\n\n#### æ­¤æ—¶å½“å‰å®ä»»åŠ¡ 1 éƒ½æ‰§è¡Œå®Œäº†ï¼Œè¦å¤„ç†å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œçš„ä»£ç ã€‚\n\nå¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå…ˆè¿›é€‰å‡ºçš„åŸåˆ™ï¼Œ\n\n1. æ‰§è¡Œå¾®ä»»åŠ¡ 1ï¼Œæ‰“å° promise2\n2. æ‰§è¡Œå¾®ä»»åŠ¡ 2ï¼Œæ²¡ä»€ä¹ˆå†…å®¹..\n\nä½†æ˜¯å¾®ä»»åŠ¡ 2 æ‰§è¡Œåï¼Œawait async2()è¯­å¥ç»“æŸï¼Œåé¢çš„ä»£ç ä¸å†è¢«é˜»å¡ï¼Œæ‰€ä»¥æ‰“å°\n\nconsole.log(â€˜async1 endâ€™)\n\n#### å®ä»»åŠ¡ 1 æ‰§è¡Œå®Œæˆå,æ‰§è¡Œå®ä»»åŠ¡ 2\n\nå®ä»»åŠ¡ 2 çš„æ‰§è¡Œæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ‰“å°\n\nconsole.log(â€˜setTimeoutâ€™)\n","tags":["JavaScript"],"categories":["JavaScript"]},{"title":"JSäº‹ä»¶æœºåˆ¶","url":"/2019/07/24/JSäº‹ä»¶æœºåˆ¶/","content":"\n# JS äº‹ä»¶æœºåˆ¶\n\n## js é‡Œä¸€èˆ¬çš„é˜»æ­¢äº‹ä»¶é»˜è®¤è¡Œä¸ºæ€ä¹ˆåšï¼Ÿ\n\nevent.preventDefault()å¯ä»¥å–æ¶ˆé»˜è®¤äº‹ä»¶\n\nevent.stopPropagation()èµ·åˆ°é˜»æ­¢æ•è·å’Œå†’æ³¡é˜¶æ®µä¸­å½“å‰äº‹ä»¶çš„è¿›ä¸€æ­¥ä¼ æ’­ã€‚\n\n<!-- more -->\n\n```javascript\nfunction cancelHandler(event) {\n  var event = event || window.event; //å…¼å®¹IE\n  //å–æ¶ˆäº‹ä»¶ç›¸å…³çš„é»˜è®¤è¡Œä¸º\n  if (event.preventDefault)\n    //æ ‡å‡†æŠ€æœ¯\n    event.preventDefault();\n  if (event.returnValue)\n    //å…¼å®¹IE9ä¹‹å‰çš„IE\n    event.returnValue = false;\n  return false; //ç”¨äºå¤„ç†ä½¿ç”¨å¯¹è±¡å±æ€§æ³¨å†Œçš„å¤„ç†ç¨‹åº\n}\n```\n\n## å†’æ³¡çš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿä¸‹é¢ä»£ç è¾“å‡ºé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆ2->button->1ï¼‰\n\n- è§¦å‘é¡ºåºï¼šbutton->1->2\n\n```html\n<div><button>aaa</button></div>\n\n<script>\n  document.getElementById(\"div\").addEventListener(\n    \"click\",\n    function() {\n      console.log(\"1\");\n    },\n    false\n  );\n  document.getElementById(\"div\").addEventListener(\n    \"click\",\n    function() {\n      console.log(\"2\");\n    },\n    false\n  );\n  document.getElementById(\"button\").addEventListener(\n    \"click\",\n    function() {\n      console.log(\"button\");\n    },\n    false\n  );\n</script>\n```\n\n- è§¦å‘é¡ºåºï¼š2->button->1\n\n```html\n<div><button>aaa</button></div>\n\n<script>\n  document.getElementById(\"div\").addEventListener(\n    \"click\",\n    function() {\n      console.log(\"1\");\n    },\n    false\n  );\n  document.getElementById(\"div\").addEventListener(\n    \"click\",\n    function() {\n      console.log(\"2\");\n    },\n    true\n  );\n  document.getElementById(\"button\").addEventListener(\n    \"click\",\n    function() {\n      console.log(\"button\");\n    },\n    false\n  );\n</script>\n```\n\n- è§¦å‘é¡ºåºï¼š2->button->1\n\n```html\n<div><button>aaa</button></div>\n\n<script>\n  document.getElementById(\"div\").addEventListener(\n    \"click\",\n    function() {\n      console.log(\"1\");\n    },\n    false\n  );\n  document.getElementById(\"div\").addEventListener(\n    \"click\",\n    function() {\n      console.log(\"2\");\n    },\n    true\n  );\n  document.getElementById(\"button\").addEventListener(\n    \"click\",\n    function() {\n      console.log(\"button\");\n    },\n    true\n  );\n</script>\n```\n","tags":["JavaScript"],"categories":["JavaScript"]},{"title":"JSé™æ€ä½œç”¨åŸŸ","url":"/2019/07/11/JSé™æ€ä½œç”¨åŸŸ/","content":"\n# JS é™æ€ä½œç”¨åŸŸ\n\n## js çš„ä½œç”¨åŸŸå’Œåˆ«çš„ç¼–ç¨‹è¯­è¨€çš„ä½œç”¨åŸŸæœ‰ä»€ä¹ˆåŒºåˆ«\n\n### ä½œç”¨åŸŸ\n\nä½œç”¨åŸŸæ˜¯æŒ‡ç¨‹åºæºä»£ç ä¸­å®šä¹‰å˜é‡çš„åŒºåŸŸã€‚\n\nä½œç”¨åŸŸè§„å®šäº†å¦‚ä½•æŸ¥æ‰¾å˜é‡ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šå½“å‰æ‰§è¡Œä»£ç å¯¹å˜é‡çš„è®¿é—®æƒé™ã€‚\n\nJavaScript é‡‡ç”¨è¯æ³•ä½œç”¨åŸŸ(lexical scoping)ï¼Œä¹Ÿå°±æ˜¯é™æ€ä½œç”¨åŸŸã€‚\n\n<!-- more -->\n\n### é™æ€ä½œç”¨åŸŸä¸åŠ¨æ€ä½œç”¨åŸŸ\n\nå› ä¸º JavaScript é‡‡ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸï¼Œå‡½æ•°çš„ä½œç”¨åŸŸåœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™å°±å†³å®šäº†ã€‚\n\nè€Œä¸è¯æ³•ä½œç”¨åŸŸç›¸å¯¹çš„æ˜¯åŠ¨æ€ä½œç”¨åŸŸï¼Œå‡½æ•°çš„ä½œç”¨åŸŸæ˜¯åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™æ‰å†³å®šçš„ã€‚\n\nè®©æˆ‘ä»¬è®¤çœŸçœ‹ä¸ªä¾‹å­å°±èƒ½æ˜ç™½ä¹‹é—´çš„åŒºåˆ«ï¼š\n\n```javascript\nvar value = 1;\n\nfunction foo() {\n  console.log(value);\n}\n\nfunction bar() {\n  var value = 2;\n  foo();\n}\n\nbar();\n\n// ç»“æœæ˜¯ ???\n```\n\nå‡è®¾ JavaScript é‡‡ç”¨é™æ€ä½œç”¨åŸŸï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹æ‰§è¡Œè¿‡ç¨‹ï¼š\n\næ‰§è¡Œ foo å‡½æ•°ï¼Œå…ˆä» foo å‡½æ•°å†…éƒ¨æŸ¥æ‰¾æ˜¯å¦æœ‰å±€éƒ¨å˜é‡ valueï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±æ ¹æ®ä¹¦å†™çš„ä½ç½®ï¼ŒæŸ¥æ‰¾ä¸Šé¢ä¸€å±‚çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯ value ç­‰äº 1ï¼Œæ‰€ä»¥ç»“æœä¼šæ‰“å° 1ã€‚\n\nå‡è®¾ JavaScript é‡‡ç”¨åŠ¨æ€ä½œç”¨åŸŸï¼Œè®©æˆ‘ä»¬åˆ†æä¸‹æ‰§è¡Œè¿‡ç¨‹ï¼š\n\næ‰§è¡Œ foo å‡½æ•°ï¼Œä¾ç„¶æ˜¯ä» foo å‡½æ•°å†…éƒ¨æŸ¥æ‰¾æ˜¯å¦æœ‰å±€éƒ¨å˜é‡ valueã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±ä»è°ƒç”¨å‡½æ•°çš„ä½œç”¨åŸŸï¼Œä¹Ÿå°±æ˜¯ bar å‡½æ•°å†…éƒ¨æŸ¥æ‰¾ value å˜é‡ï¼Œæ‰€ä»¥ç»“æœä¼šæ‰“å° 2ã€‚\n\nå‰é¢æˆ‘ä»¬å·²ç»è¯´äº†ï¼ŒJavaScript é‡‡ç”¨çš„æ˜¯é™æ€ä½œç”¨åŸŸï¼Œæ‰€ä»¥è¿™ä¸ªä¾‹å­çš„ç»“æœæ˜¯ 1ã€‚\n\næœ€åï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªã€ŠJavaScript æƒå¨æŒ‡å—ã€‹ä¸­çš„ä¾‹å­ï¼š\n\n```javascript\nvar scope = \"global scope\";\nfunction checkscope() {\n  var scope = \"local scope\";\n  function f() {\n    return scope;\n  }\n  return f();\n}\ncheckscope();\nvar scope = \"global scope\";\nfunction checkscope() {\n  var scope = \"local scope\";\n  function f() {\n    return scope;\n  }\n  return f;\n}\ncheckscope()();\n```\n\nçŒœçŒœä¸¤æ®µä»£ç å„è‡ªçš„æ‰§è¡Œç»“æœæ˜¯å¤šå°‘ï¼Ÿ\n\nè¿™é‡Œç›´æ¥å‘Šè¯‰å¤§å®¶ç»“æœï¼Œä¸¤æ®µä»£ç éƒ½ä¼šæ‰“å°ï¼š`local scope`ã€‚\n\nåŸå› ä¹Ÿå¾ˆç®€å•ï¼Œå› ä¸º JavaScript é‡‡ç”¨çš„æ˜¯è¯æ³•ä½œç”¨åŸŸï¼Œå‡½æ•°çš„ä½œç”¨åŸŸåŸºäºå‡½æ•°åˆ›å»ºçš„ä½ç½®ã€‚\n\nè€Œå¼•ç”¨ã€ŠJavaScript æƒå¨æŒ‡å—ã€‹çš„å›ç­”å°±æ˜¯ï¼š\n\nJavaScript å‡½æ•°çš„æ‰§è¡Œç”¨åˆ°äº†ä½œç”¨åŸŸé“¾ï¼Œè¿™ä¸ªä½œç”¨åŸŸé“¾æ˜¯åœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™åˆ›å»ºçš„ã€‚åµŒå¥—çš„å‡½æ•° f() å®šä¹‰åœ¨è¿™ä¸ªä½œç”¨åŸŸé“¾é‡Œï¼Œå…¶ä¸­çš„å˜é‡ scope ä¸€å®šæ˜¯å±€éƒ¨å˜é‡ï¼Œä¸ç®¡ä½•æ—¶ä½•åœ°æ‰§è¡Œå‡½æ•° f()ï¼Œè¿™ç§ç»‘å®šåœ¨æ‰§è¡Œ f() æ—¶ä¾ç„¶æœ‰æ•ˆã€‚\n\n**bash å°±æ˜¯åŠ¨æ€ä½œç”¨åŸŸ**\n","tags":["JavaScript"],"categories":["JavaScript"]},{"title":"httpsä¸­é—´äººæ”»å‡»åŠé˜²å¾¡","url":"/2019/07/03/httpsä¸­é—´äººæ”»å‡»åŠé˜²å¾¡/","content":"\n# https ä¸­é—´äººæ”»å‡»åŠé˜²å¾¡\n\nHTTPS ä¹Ÿä¸æ˜¯ç»å¯¹å®‰å…¨çš„ï¼Œåœ¨ HTTPS æ¡æ‰‹çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå®æ–½ä¸å½“ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨æ¼æ´ï¼Œå¾ˆå®¹è¢«ä¸­é—´äººæ”»å‡»ï¼›\n\n## ä»€ä¹ˆæ˜¯ä¸­é—´äººæ”»å‡»\n\n**ä¸­é—´äººæ”»å‡»**ï¼ˆMan-in-the-middle attackï¼Œ[ç¼©å†™](https://zh.wikipedia.org/wiki/ç¼©å†™)ï¼šMITMï¼‰æ˜¯æŒ‡æ”»å‡»è€…ä¸é€šè®¯çš„ä¸¤ç«¯åˆ†åˆ«å»ºç«‹ç‹¬ç«‹çš„è”ç³»ï¼Œå¹¶äº¤æ¢å…¶æ‰€æ”¶åˆ°çš„æ•°æ®ï¼Œä½¿é€šè®¯çš„ä¸¤ç«¯è®¤ä¸ºä»–ä»¬æ­£åœ¨é€šè¿‡ä¸€ä¸ªç§å¯†çš„è¿æ¥ä¸å¯¹æ–¹ç›´æ¥å¯¹è¯ï¼Œä½†äº‹å®ä¸Šæ•´ä¸ªä¼šè¯éƒ½è¢«æ”»å‡»è€…å®Œå…¨æ§åˆ¶ã€‚åœ¨ä¸­é—´äººæ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥æ‹¦æˆªé€šè®¯åŒæ–¹çš„é€šè¯å¹¶æ’å…¥æ–°çš„å†…å®¹ã€‚\n\n<!-- more -->\n\n## å¦‚ä½•è¿›è¡Œä¸­é—´äººæ”»å‡»çš„å‘¢ï¼Ÿ\n\n### æ”»å‡»ä¸€ï¼šSSLSniff\n\næ”»å‡»è€…åœ¨ç½‘å…³æˆªè· SSL ä¼šè¯ï¼Œæ›¿æ¢æœåŠ¡å™¨å…¬é’¥è¯ä¹¦ï¼Œå°†å…¬é’¥`PKey`æ¢æˆè‡ªå·±çš„å…¬é’¥`PKey`ï¼Œæ¬ºéª—å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ä½¿ç”¨`PKey`åŠ å¯†ä¿¡æ¯å¹¶å‘é€ä¼šè¯ï¼Œä¸­é—´äººç”¨ç§é’¥`Skey`è§£å¯†å®¢æˆ·ç«¯è¿”å›ä¼šè¯ï¼Œä»è€ŒåŠ«æŒä¼šè¯ã€‚åŒæ—¶ï¼Œä¸­é—´äººç”¨`PKey`åŠ å¯†æ˜æ–‡ä¼šè¯å¹¶è¿”å›æœåŠ¡å™¨\n\n**è¿‡ç¨‹å¦‚ä¸‹ï¼š**\n\n1. `Attacker`æˆªè·äº†å®¢æˆ·ç«¯çš„`say hello`ï¼Œå¯ä»¥æŠŠ`publicKey_attacker`è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå–å¾—å®¢æˆ·ç«¯çš„ä¿¡ä»»ï¼Œè‡³æ­¤`Attacker`ä¸å®¢æˆ·ç«¯å»ºç«‹äº†å®‰å…¨è¿æ¥ã€‚\n2. `Attacker`å†’å……å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€`say hello`ï¼Œè‡³æ­¤`Attacker`ä¸æœåŠ¡å™¨å»ºç«‹äº†å®‰å…¨è¿æ¥ã€‚\n\nè¿™ç§æ”»å‡»ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ä¼šè¢«æ„ŸçŸ¥åˆ°ï¼Œå°±æ˜¯`Attacker`çš„è¯ä¹¦æ˜¯ä¼ªé€ çš„ä¸å—ä¿¡ä»»çš„è¯ä¹¦ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯å¯ä»¥ç¡®è®¤æ˜¯å¦éœ€è¦çœŸçš„è¿æ¥è¯¥æœåŠ¡å™¨ï¼Œä¸è¿‡å¦‚æœæœ‰å†…é¬¼çš„è¯ï¼Œä¼ªé€ çš„å—ä¿¡ä»»çš„è¯ä¹¦çš„è¯ï¼Œå°±å½“æˆ‘å•¥ä¹Ÿæ²¡è¯´ï¼›\n\n### æ”»å‡»äºŒï¼šSSLStrip\n\nè¿™ç§æ”»å‡»ç›¸å¯¹äºæ”»å‡»ä¸€å¤æ‚ä¸€ç‚¹ï¼Œä½†æ˜¯ä¹Ÿæ›´åŠ å‰å®³ï¼Œå‡ ä¹å¯ä»¥åœ¨å®¢æˆ·ç«¯æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹å®æ–½æ”»å‡»ï¼Œå¹¶ä¸”ä¸éœ€è¦ä¼ªé€ è¯ä¹¦ï¼›ç®€å•æ¥è¯´å°±æ˜¯è¿™æ ·ï¼š`Attacker`åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œåœ¨`Attacker`ä¸æœåŠ¡å™¨ä¹‹é—´å½¢æˆ HTTPS è¿æ¥ï¼Œè€Œåœ¨å®¢æˆ·ç«¯ä¸`Attacker`ä¹‹é—´å½¢æˆ`HTTP`è¿æ¥ï¼Œå³å°† SSL å±‚ä»åŸ HTTPS è¿æ¥ä¸­â€œå‰¥ç¦»â€ã€‚è¿™æ ·ï¼Œæ—¢é¿å…äº†åœ¨å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦æ—¶éš¾ä»¥é¿å…çš„å¼¹æ¡†é—®é¢˜ï¼Œåˆèƒ½å¤ŸåŠ«æŒ HTTP æ˜æ–‡æ•°æ®ï¼Œå¹¶åŒæ—¶ä¿è¯å®¢æˆ·ç«¯`HTTP`æ•°æ®çš„ä¼ è¾“ï¼Œè¾¾åˆ°æ¬ºéª—æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯çš„æ•ˆæœã€‚\n\n**è¿‡ç¨‹å¦‚ä¸‹ï¼š**\n\nç”¨æˆ·åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥ç½‘å€æ—¶ï¼Œå¤šæ•°ä¼šé‡‡ç”¨ç›´æ¥è¾“å…¥ç½‘å€çš„æ–¹å¼ï¼Œè€Œå¿½ç•¥äº†ä¼ è¾“æ‰€é‡‡ç”¨çš„åè®®ã€‚ä¾‹å¦‚ï¼Œåœ¨ç™»å½• gmail è¿‡ç¨‹ä¸­ï¼Œå¤§å¤šæ•°ç”¨æˆ·ä¼šç›´æ¥åœ¨åœ°å€æ ä¸­è¾“å…¥`www.gmail.com`ï¼Œå‘`Google`æœåŠ¡å™¨å‘é€ä¸€ä¸ª HTTP è¿æ¥è¯·æ±‚ï¼Œè€Œä¸æ˜¯è¾“å…¥`httpsï¼š//www.gmail.com`ï¼Œ å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª`HTTPS`è¿æ¥è¯·æ±‚ã€‚å› æ­¤ï¼Œç”¨æˆ·é€šå¸¸æ¥è§¦åˆ° HTTPS çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯ Web ä¸Šçš„è¿æ¥ï¼Œæ¯”å¦‚å½“ç”¨æˆ·åœ¨ gmail ä¸Šè¾“å…¥ç”¨æˆ·åå’Œå¯†ç åï¼Œç‚¹å‡»çš„ç™»å½•é”®ï¼Œå°†ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ä»¥`HTTPS`çš„å½¢å¼`POST`åˆ°æœåŠ¡å™¨ã€‚å¦ä¸€ç§æ˜¯é€šè¿‡ HTTP çš„ 302 çŠ¶æ€ã€‚ å½“å®¢æˆ·ç«¯å‘ gmail æå‡º HTTP è¿æ¥è¯·æ±‚æ—¶ï¼Œgmail æœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ª`REDIRECT`ç½‘å€ï¼Œ`httpsï¼š//www.google.com/accounts/ServiceLogin?service=mail...`ï¼Œç”¨æˆ·ç«¯åœ¨æ¥æ”¶åˆ°è¿™ä¸ª URL åï¼Œå°†é¡µé¢é‡å®šä½åˆ°è¯¥ç½‘é¡µï¼Œå¹¶è¯·æ±‚ HTTPS è¿æ¥ã€‚ ä»å¦å¤–ä¸€ä¸ªè§’åº¦è®²ï¼Œç”¨æˆ·é€šå¸¸æ˜¯é€šè¿‡`HTTP`å‘æœåŠ¡å™¨å‘èµ·`HTTPS`è¿æ¥çš„ã€‚è€Œ`HTTP`æœ¬èº«æ˜¯ä»¥æ˜æ–‡çš„å½¢å¼å¯¹å¤–ä¼ é€ï¼Œå¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å®‰å…¨ã€‚å› æ­¤ï¼Œå¯ä»¥è€ƒè™‘é€šè¿‡å¯¹ HTTP è¿›è¡ŒåŠ«æŒï¼Œæ¥å®ç°å¯¹ HTTPS åŠ«æŒçš„ç›®çš„ã€‚\n\n1. å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·`HTTP`è¿æ¥è¯·æ±‚ï¼›\n2. ä¸­é—´äºº MITM ç›‘å¬å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„`HTTP`æ•°æ®ï¼›\n3. æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„ HTTP æ•°æ®åŒ…è¢«åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ä¸­é—´äººæˆªè·ã€‚ä¸­é—´äººè§£æåŸ HTTP æ•°æ®åŒ…ï¼Œå°†å…¶ä¸­`<a href=â€httpsï¼š//...â€>`æ›¿æ¢æˆ`<a href=â€http//...â€>`ï¼Œå°† `Locationï¼š httpsï¼š//...` æ›¿æ¢æˆ`Locationï¼šhttp://..`ï¼ŒåŒæ—¶è®°å½•ä¸‹æ‰€ä¿®æ”¹çš„ URLï¼Œå¹¶ä¿å­˜ï¼›\n4. ä¸­é—´äººå°†ä¿®æ”¹åçš„`HTTP`æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ï¼›\n5. å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·`HTTP`è¿æ¥è¯·æ±‚ï¼›\n6. ä¸­é—´äººè®¡ç®—æœºè§£æå®¢æˆ·ç«¯çš„`HTTP`è¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸ä¿å­˜æ–‡ä»¶ç›¸æ¯”è¾ƒã€‚å½“å‘ç°å­˜åœ¨æœ‰å·²ä¿®æ”¹è¿‡çš„`HTTP URL`æ—¶ï¼Œå°†å…¶æ›¿æ¢æˆåŸ`HTTPS URL`ï¼Œå¹¶å‘é€ç»™æœåŠ¡å™¨ï¼›\n7. ä¸æœåŠ¡å™¨ä¿æŒ`HTTPS`è¿æ¥ï¼Œå›åˆ°æ­¥éª¤ 3ï¼›\n8. ä¸å®¢æˆ·ç«¯ä¿æŒ`HTTP`è¿æ¥ï¼Œå›åˆ°æ­¥éª¤ 4ã€‚\n\n**æ•ˆæœå°±æ˜¯ï¼š** æœåŠ¡å™¨è®¤ä¸º HTTPS æ˜¯å®‰å…¨çš„ã€‚å¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œç”±äºä¸­é—´äºº MITM ä¸å®¢æˆ·ç«¯ Client ä¹‹é—´æ˜¯ HTTP è¿æ¥ï¼Œå› æ­¤å¹¶ä¸ä¼šå¯¹è¯ä¹¦è¿›è¡Œè®¤è¯ï¼›\n\n**HSTS**:ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒIETFï¼ˆäº’è”ç½‘å·¥ç¨‹ä»»åŠ¡å°ç»„ï¼‰å¼•å…¥äº†ä¸€ä¸ªç­–ç•¥ï¼Œå«åš **HSTS** (HTTP Strict Transport Security, HTTP ä¸¥æ ¼ä¼ è¾“å®‰å…¨)ã€‚HSTS çš„ä½œç”¨æ˜¯å¼ºåˆ¶å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹å®‰å…¨çš„ HTTPS è¿æ¥ï¼Œè€Œéä¸å®‰å…¨çš„ HTTP è¿æ¥ã€‚å¦‚æœä¸€ä¸ªç«™ç‚¹å¯ç”¨äº† HSTS ç­–ç•¥ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯åœ¨ç¬¬ä¸€æ¬¡ä¸è¯¥ç«™ç‚¹å»ºç«‹è¿æ¥ä¹‹åï¼Œåœ¨æœªæ¥çš„ä¸€æ®µæ—¶é—´å†…ï¼ˆç”±ä¸€ä¸ª HTTP å¤´éƒ¨æ§åˆ¶ï¼Œè¿™ä¸ªå¤´éƒ¨ä¸ºï¼šStrict-Transport-Securityï¼‰ï¼Œå®¢æˆ·ç«¯ä¸è¯¥ç«™ç‚¹çš„æ‰€æœ‰è¿æ¥éƒ½ä¼šç›´æ¥ä½¿ç”¨ HTTPSï¼Œ_å³ä½¿å®¢æˆ·ç«¯è®¿é—®çš„æ˜¯ HTTPï¼Œä¹Ÿä¼šç›´æ¥åœ¨å®¢æˆ·ç«¯é‡å®šå‘åˆ° HTTPS è¿æ¥ã€‚_\n\nå‡è®¾ `https://example.com` çš„å“åº”å¤´éƒ¨å«æœ‰ `Strict-Transport-Security: max-age=31536000; includeSubDomains`ï¼Œè¿™æ„å‘³ç€ï¼š\n\n1. åœ¨æœªæ¥çš„ 1 å¹´æ—¶é—´é‡Œï¼ˆå³ 31536000 ç§’ä¸­ï¼‰ï¼Œåªè¦æµè§ˆå™¨å‘ `example.com` æˆ–è€…å…¶å­åŸŸåå‘é€è¯·æ±‚ï¼Œå¿…é¡»é‡‡ç”¨ HTTPS æ¥å‘èµ·è¿æ¥ã€‚å³ä½¿ç”¨æˆ·åœ¨åœ°å€æ é‡Œå†™çš„æ˜¯ `http://example.com`ï¼Œé‚£ä¹Ÿç›´æ¥é‡å†™ä¸º `https://example.com` å¹¶ç›´æ¥å‘èµ· HTTPS è¿æ¥ã€‚\n2. åœ¨æ¥ä¸‹å»çš„ä¸€å¹´ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨æä¾›çš„ HTTPS è¯ä¹¦æ— æ•ˆï¼ˆä¸è®ºæ˜¯åŸŸåå¯¹ä¸ä¸Šè¿˜æ˜¯è‡ªç­¾åè¿˜æ˜¯ä¸åœ¨æœ‰æ•ˆæœŸå†…ï¼‰ï¼Œç”¨æˆ·éƒ½æ— æ³•è®¿é—®è¯¥ç«™ç‚¹ã€‚\n\nå¦‚æœç«™ç‚¹æ²¡æœ‰å¯ç”¨ HSTSï¼Œç”¨æˆ·å¯ä»¥å¿½ç•¥è¯ä¹¦æ— æ•ˆçš„è­¦å‘Šï¼Œç»§ç»­å»ºç«‹è¿æ¥ï¼Œè€Œå¦‚æœç«™ç‚¹å¯ç”¨äº† HSTSï¼Œé‚£ä¹ˆç”¨æˆ·å³ä½¿æƒ³å†’é£é™©ï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šç»§ç»­è®¿é—®ã€‚\n\nHSTS å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šé˜²æ­¢ SSLTrip æ”»å‡»ï¼Œä¸è¿‡è¿™æ ·è¿˜æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯è¦å¯ç”¨ HSTSï¼Œæµè§ˆå™¨è‡³å°‘è¦å’ŒæœåŠ¡å™¨å»ºç«‹ä¸€æ¬¡ HTTPS è¿æ¥ï¼Œå¦‚æœä¸­é—´äººä¸€ç›´é˜»æ­¢æµè§ˆå™¨ä¸æœåŠ¡å™¨å»ºç«‹ HTTPS è¿æ¥ï¼Œé‚£ä¹ˆ HSTS å°±å¤±æ•ˆäº†ã€‚è§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸ªåŠæ³•ï¼Œé‚£å°±æ˜¯å°† HSTS ç«™ç‚¹åˆ—è¡¨å†…ç½®åˆ°æµè§ˆå™¨ä¸­ï¼Œè¿™æ ·åªè¦æµè§ˆå™¨**ç¦»çº¿**åˆ¤æ–­è¯¥ç«™ç‚¹å¯ç”¨äº† HSTSï¼Œå°±ä¼šè·³è¿‡åŸå…ˆçš„ HTTP é‡å®šå‘ï¼Œç›´æ¥å‘èµ· HTTPS è¯·æ±‚ã€‚\n\n## å¦‚ä½•é˜²å¾¡ä¸­é—´äººæ”»å‡»ï¼Ÿ\n\nä¸­é—´äººæ”»å‡»æ˜¯ä¸€ä¸ªï¼ˆç¼ºä¹ï¼‰ç›¸äº’è®¤è¯çš„æ”»å‡»ï¼›ç”±äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´åœ¨ SSL æ¡æ‰‹çš„è¿‡ç¨‹ä¸­ç¼ºä¹ç›¸äº’è®¤è¯è€Œé€ æˆçš„æ¼æ´\n\né˜²å¾¡ä¸­é—´äººæ”»å‡»çš„æ–¹æ¡ˆé€šå¸¸åŸºäºä»¥ä¸‹å‡ ç§æŠ€æœ¯\n\n- å…¬é’¥åŸºç¡€å»ºè®¾ PKIï¼Œæ›´å¼ºåŠ›çš„ç›¸äº’è®¤è¯\n\nä½¿ç”¨ PKI ç›¸äº’è®¤è¯æœºåˆ¶ï¼Œå®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨éªŒè¯å®¢æˆ·ç«¯ï¼›ä¸Šè¿°ä¸¤ä¸ªä¾‹å­ä¸­éƒ½æ˜¯åªéªŒè¯æœåŠ¡å™¨ï¼Œè¿™æ ·å°±é€ æˆäº† SSL æ¡æ‰‹ç¯èŠ‚çš„æ¼æ´ï¼Œè€Œå¦‚æœä½¿ç”¨ç›¸äº’è®¤è¯çš„çš„è¯ï¼ŒåŸºæœ¬å¯ä»¥ä¿è¯\n\n- å»¶è¿Ÿæµ‹è¯•\n\nä½¿ç”¨å¤æ‚åŠ å¯†å“ˆå¸Œå‡½æ•°è¿›è¡Œè®¡ç®—ä»¥é€ æˆæ•°åç§’çš„å»¶è¿Ÿï¼›å¦‚æœåŒæ–¹é€šå¸¸æƒ…å†µä¸‹éƒ½è¦èŠ±è´¹ 20 ç§’æ¥è®¡ç®—ï¼Œå¹¶ä¸”æ•´ä¸ªé€šè®¯èŠ±è´¹äº† 60 ç§’è®¡ç®—æ‰åˆ°è¾¾å¯¹æ–¹ï¼Œè¿™å°±èƒ½è¡¨æ˜å­˜åœ¨ç¬¬ä¸‰æ–¹ä¸­é—´äººã€‚\n\n## https é€šä¿¡å®‰å…¨æ€§çš„ä¿è¯\n\né€šä¿¡è¿‡ç¨‹çš„å®‰å…¨æ€§**è‡ªä¸‹è€Œä¸Š**å°±æ˜¯è¿™æ ·ä¿è¯çš„ï¼š\n\n1. åŒæ–¹é€šä¿¡å†…å®¹çš„å®‰å…¨æ€§æ˜¯é å…¬é’¥åŠ å¯†ã€ç§é’¥è§£å¯†æ¥ä¿è¯çš„ï¼Œè¿™ä¸€å®‰å…¨æ€§ç”±éå¯¹ç§°åŠ å¯†çš„ç‰¹æ€§ï¼Œå³ç”±å…¬é’¥åŠ å¯†çš„ä¿¡æ¯åªèƒ½ä½¿ç”¨å¯¹åº”çš„ç§é’¥æ‰èƒ½è§£å¼€æ¥ä¿è¯ã€‚ç”±äºç§é’¥ä¸ä¼šä¼ é€’ï¼Œåªæœ‰æ‹¥æœ‰è€…çŸ¥é“ï¼Œæ‰€ä»¥*å®‰å…¨æ€§å°±ç”±**å…¬é’¥**çš„æ­£ç¡®æ€§æ¥ä¿è¯ã€‚*\n2. å…¬é’¥ç”±å¯¹æ–¹åœ¨é€šä¿¡åˆå§‹æ‰€æä¾›ï¼Œä½†æ˜¯è¿™æ—¶å¾ˆå®¹æ˜“è¢«ä¸­é—´äººæ›¿æ¢æ‰ï¼Œä¸ºäº†ä¿è¯å…¬é’¥çš„æ­£ç¡®æ€§ï¼Œæ‰€ä»¥åœ¨å‘é€å…¬é’¥çš„æ—¶å€™ä¹Ÿä¼šæä¾›å¯¹åº”çš„æ•°å­—è¯ä¹¦ï¼Œç”¨äºéªŒè¯è¿™ä¸ªå…¬é’¥æ˜¯å¯¹æ–¹çš„è€Œä¸æ˜¯ä¸­é—´äººçš„ã€‚é‚£ä¹ˆ*å®‰å…¨æ€§å°±æ˜¯ç”±**æ•°å­—è¯ä¹¦**çš„æ­£ç¡®æ€§æ¥ä¿è¯äº†ã€‚*\n3. æ•°å­—è¯ä¹¦æ˜¯ç”±ä¸Šçº§ CA ç­¾å‘ç»™ä¸ªäºº / ç»„ç»‡çš„ï¼Œä¸Šçº§ CA ç”¨è‡ªå·±çš„ç§é’¥ç»™ä¸ªäººè¯ä¹¦è¿›è¡Œç­¾åï¼Œä¿è¯è¯ä¹¦ä¸­çš„å…¬é’¥ä¸è¢«ç¯¡æ”¹ï¼Œè€Œæ¥å—è€…éœ€è¦ç”¨ä¸Šçº§ CA è¯ä¹¦ä¸­çš„å…¬é’¥æ¥è§£å¯†ä¸ªäººæ•°å­—è¯ä¹¦ä¸­çš„**æ•°å­—ç­¾å**æ¥éªŒè¯è¯ä¹¦ä¸­çš„å…¬é’¥æ˜¯å¦æ˜¯æ­£ç¡®çš„ã€‚é‚£ä¹ˆ*å®‰å…¨æ€§å°±æ˜¯ç”±**ä¸Šçº§ CA è¯ä¹¦**çš„æ­£ç¡®æ€§ä¿è¯çš„äº†ã€‚*ï¼ˆ**æ•°å­—ç­¾åä¿è¯äº†æ•°å­—è¯ä¹¦æ²¡æœ‰è¢«ç¯¡æ”¹**ï¼‰\n4. ä½†æ˜¯ï¼Œä¸Šçº§ CA è¯ä¹¦ä¹Ÿæ˜¯ç”±å…¶ä¸Šçº§ CA ç­¾å‘çš„ï¼Œè¿™ç§ä¿¡ä»»å…³ç³»ä¸€ç›´åˆ°æ ¹è¯ä¹¦ã€‚æ ¹è¯ä¹¦æ²¡æœ‰ä¸Šçº§ CA ä¸ºå…¶ç­¾åï¼Œè€Œæ˜¯è‡ªç­¾åçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒè‡ªèº«ä¸ºè‡ªèº«ç­¾åï¼Œä¿è¯æ­£ç¡®æ€§ã€‚æ‰€ä»¥æ ¹è¯ä¹¦å°±æ˜¯è¿™ä¸ªä¿¡ä»»é“¾æœ€é‡è¦çš„éƒ¨åˆ†ã€‚å¦‚æœæ ¹è¯ä¹¦æ³„éœ²çš„è¯ï¼Œå…¶ç­¾åçš„æ‰€æœ‰è¯ä¹¦åŠä½¿ç”¨å…¶ç­¾åçš„è¯ä¹¦æ‰€ç­¾åçš„è¯ä¹¦çš„å®‰å…¨æ€§å°†ä¸å¤å­˜åœ¨ã€‚ç°åœ¨ï¼Œ_å®‰å…¨æ€§å°±æ˜¯é ç³»ç»Ÿ**æ ¹è¯ä¹¦**çš„ç§é’¥ä¸è¢«æ³„éœ²æˆ–è€…å…¶å…¬é’¥ä¸è¢«ç¯¡æ”¹æ¥ä¿è¯çš„äº†ã€‚_\n5. æ ¹è¯ä¹¦ä¸åº”è¯¥é€šè¿‡ç½‘ç»œåˆ†å‘ï¼Œå› ä¸ºé€šè¿‡ç½‘ç»œåˆ†å‘çš„è¯ï¼Œå¯èƒ½ä¼šè¢«ä¸­é—´äººæ”»å‡»ã€‚ä¸€èˆ¬æ ¹è¯ä¹¦éƒ½é€šè¿‡æ“ä½œç³»ç»Ÿæˆ–è€…æµè§ˆå™¨åˆ†å‘ï¼Œåœ¨æ“ä½œç³»ç»Ÿä¸­ä¼šå†…ç½®å¾ˆå¤šæ ¹è¯ä¹¦ï¼Œä½†æ˜¯æœ€åˆçš„æ“ä½œç³»ç»Ÿä¹Ÿä¸èƒ½é€šè¿‡ç½‘ç»œåˆ†å‘ï¼Œå› ä¸ºä¸­é—´äººå¯ä»¥ä¿®æ”¹æ“ä½œç³»ç»Ÿä¸­çš„æ ¹è¯ä¹¦ã€‚æ‰€ä»¥è¦ä¿è¯å®‰å…¨åªèƒ½é æœ€åŸå§‹çš„æ–¹æ³•ï¼Œå½“é¢äº¤æµã€‚ç¡¬ä»¶å‚å•†ä¼šå’Œè¯ä¹¦ç­¾å‘æœºæ„åˆä½œï¼Œåœ¨ç”µè„‘ã€æ‰‹æœºç­‰è®¾å¤‡å‡ºå‚çš„æ—¶å€™åœ¨å…¶æ“ä½œç³»ç»Ÿä¸­**å†…ç½®**ç­¾å‘æœºæ„çš„æ ¹è¯ä¹¦ï¼Œå†å°†è¿™äº›è®¾å¤‡åˆ†å‘å‡ºå»ï¼Œè¿™æ ·ï¼Œè¿™äº›è®¾å¤‡çš„ç”¨æˆ·å°±å¯ä»¥å®‰å…¨åœ°è¿›è¡Œä¿¡æ¯äº¤æ¢äº†ã€‚æ‰€ä»¥ï¼Œ_å®‰å…¨æ€§å°±ä¾èµ–äºè¿™äº›è®¾å¤‡åœ¨åˆ†å‘åˆ°æ¶ˆè´¹è€…æ‰‹ä¸­ä¹‹å‰ä¸ä¼šè¢«æ¶æ„ä¿®æ”¹æ¥ä¿è¯äº†ã€‚_\n\nè‡³æ­¤ï¼Œæ•´ä¸ªä¿¡ä»»é“¾å°±å»ºç«‹èµ·æ¥äº†ï¼Œåªéœ€è¦æœ‰ä¸€å°è®¾å¤‡ä¸Šå®‰è£…äº†å¯ä»¥ä¿¡ä»»çš„æ ¹è¯ä¹¦ï¼Œå°±å¯ä»¥ç”¨æ¥åˆ†å‘æ›´å¤šå®‰å…¨çš„æ“ä½œç³»ç»Ÿäº†ã€‚ä¹‹åçš„æ‰€æœ‰ä¿¡ä»»é“¾éƒ½æ˜¯å®‰å…¨çš„äº†ã€‚\n","tags":["å®‰å…¨","HTTP","æµè§ˆå™¨"],"categories":["æµè§ˆå™¨"]},{"title":"CSRFæ”»å‡»","url":"/2019/06/18/CSRFæ”»å‡»/","content":"\n# CSRF æ”»å‡»\n\n## 1.ä»€ä¹ˆæ˜¯ CSRF\n\nCSRFï¼ˆCross-site request forgeryï¼‰è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼šæ”»å‡»è€…è¯±å¯¼å—å®³è€…è¿›å…¥ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œåœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ä¸­ï¼Œå‘è¢«æ”»å‡»ç½‘ç«™å‘é€è·¨ç«™è¯·æ±‚ã€‚åˆ©ç”¨å—å®³è€…åœ¨è¢«æ”»å‡»ç½‘ç«™å·²ç»è·å–çš„æ³¨å†Œå‡­è¯ï¼Œç»•è¿‡åå°çš„ç”¨æˆ·éªŒè¯ï¼Œè¾¾åˆ°å†’å……ç”¨æˆ·å¯¹è¢«æ”»å‡»çš„ç½‘ç«™æ‰§è¡ŒæŸé¡¹æ“ä½œçš„ç›®çš„ã€‚\n\nä¸€ä¸ªå…¸å‹çš„ CSRF æ”»å‡»æœ‰ç€å¦‚ä¸‹çš„æµç¨‹ï¼š\n\n<!-- more -->\n\n- å—å®³è€…ç™»å½• a.comï¼Œå¹¶ä¿ç•™äº†ç™»å½•å‡­è¯ï¼ˆCookieï¼‰ã€‚\n- æ”»å‡»è€…å¼•è¯±å—å®³è€…è®¿é—®äº† b.comã€‚\n- b.com å‘ a.com å‘é€äº†ä¸€ä¸ªè¯·æ±‚ï¼ša.com/act=xxã€‚æµè§ˆå™¨ä¼šé»˜è®¤æºå¸¦ a.com çš„ Cookieã€‚\n- a.com æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¯¹è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼Œå¹¶ç¡®è®¤æ˜¯å—å®³è€…çš„å‡­è¯ï¼Œè¯¯ä»¥ä¸ºæ˜¯å—å®³è€…è‡ªå·±å‘é€çš„è¯·æ±‚ã€‚\n- a.com ä»¥å—å®³è€…çš„åä¹‰æ‰§è¡Œäº† act=xxã€‚\n- æ”»å‡»å®Œæˆï¼Œæ”»å‡»è€…åœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œå†’å……å—å®³è€…ï¼Œè®© a.com æ‰§è¡Œäº†è‡ªå·±å®šä¹‰çš„æ“ä½œã€‚\n\n## 2.å¸¸è§çš„æ”»å‡»ç±»å‹\n\n- **GET ç±»å‹çš„ CSRF**\n\nGET ç±»å‹çš„ CSRF åˆ©ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œä¸€èˆ¬ä¼šè¿™æ ·åˆ©ç”¨ï¼š\n\n```html\n<img src=\"http://bank.example/withdraw?amount=10000&for=hacker\" />\n```\n\nåœ¨å—å®³è€…è®¿é—®å«æœ‰è¿™ä¸ª img çš„é¡µé¢åï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å‘`http://bank.example/withdraw?account=xiaoming&amount=10000&for=hacker`å‘å‡ºä¸€æ¬¡ HTTP è¯·æ±‚ã€‚bank.example å°±ä¼šæ”¶åˆ°åŒ…å«å—å®³è€…ç™»å½•ä¿¡æ¯çš„ä¸€æ¬¡è·¨åŸŸè¯·æ±‚ã€‚\n\n- **POST ç±»å‹çš„ CSRF**\n\nè¿™ç§ç±»å‹çš„ CSRF åˆ©ç”¨èµ·æ¥é€šå¸¸ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªè‡ªåŠ¨æäº¤çš„è¡¨å•ï¼Œå¦‚ï¼š\n\n```html\n<form action=\"http://bank.example/withdraw\" method=\"POST\">\n  <input type=\"hidden\" name=\"account\" value=\"xiaoming\" />\n  <input type=\"hidden\" name=\"amount\" value=\"10000\" />\n  <input type=\"hidden\" name=\"for\" value=\"hacker\" />\n</form>\n<script>\n  document.forms[0].submit();\n</script>\n```\n\nè®¿é—®è¯¥é¡µé¢åï¼Œè¡¨å•ä¼šè‡ªåŠ¨æäº¤ï¼Œç›¸å½“äºæ¨¡æ‹Ÿç”¨æˆ·å®Œæˆäº†ä¸€æ¬¡ POST æ“ä½œã€‚\n\nPOST ç±»å‹çš„æ”»å‡»é€šå¸¸æ¯” GET è¦æ±‚æ›´åŠ ä¸¥æ ¼ä¸€ç‚¹ï¼Œä½†ä»å¹¶ä¸å¤æ‚ã€‚ä»»ä½•ä¸ªäººç½‘ç«™ã€åšå®¢ï¼Œè¢«é»‘å®¢ä¸Šä¼ é¡µé¢çš„ç½‘ç«™éƒ½æœ‰å¯èƒ½æ˜¯å‘èµ·æ”»å‡»çš„æ¥æºï¼Œåç«¯æ¥å£ä¸èƒ½å°†å®‰å…¨å¯„æ‰˜åœ¨ä»…å…è®¸ POST ä¸Šé¢ã€‚\n\n- **é“¾æ¥ç±»å‹çš„ CSRF**\n\né“¾æ¥ç±»å‹çš„ CSRF å¹¶ä¸å¸¸è§ï¼Œæ¯”èµ·å…¶ä»–ä¸¤ç§ç”¨æˆ·æ‰“å¼€é¡µé¢å°±ä¸­æ‹›çš„æƒ…å†µï¼Œè¿™ç§éœ€è¦ç”¨æˆ·ç‚¹å‡»é“¾æ¥æ‰ä¼šè§¦å‘ã€‚è¿™ç§ç±»å‹é€šå¸¸æ˜¯åœ¨è®ºå›ä¸­å‘å¸ƒçš„å›¾ç‰‡ä¸­åµŒå…¥æ¶æ„é“¾æ¥ï¼Œæˆ–è€…ä»¥å¹¿å‘Šçš„å½¢å¼è¯±å¯¼ç”¨æˆ·ä¸­æ‹›ï¼Œæ”»å‡»è€…é€šå¸¸ä¼šä»¥æ¯”è¾ƒå¤¸å¼ çš„è¯è¯­è¯±éª—ç”¨æˆ·ç‚¹å‡»ï¼Œä¾‹å¦‚ï¼š\n\n```html\n<a\n  href=\"http://test.com/csrf/withdraw.php?amount=1000&for=hacker\"\n  taget=\"_blank\"\n>\n  é‡ç£…æ¶ˆæ¯ï¼ï¼\n  <a\n/></a>\n```\n\nç”±äºä¹‹å‰ç”¨æˆ·ç™»å½•äº†ä¿¡ä»»çš„ç½‘ç«™ Aï¼Œå¹¶ä¸”ä¿å­˜ç™»å½•çŠ¶æ€ï¼Œåªè¦ç”¨æˆ·ä¸»åŠ¨è®¿é—®ä¸Šé¢çš„è¿™ä¸ª PHP é¡µé¢ï¼Œåˆ™è¡¨ç¤ºæ”»å‡»æˆåŠŸã€‚\n\n## 3.CSRF çš„ç‰¹ç‚¹\n\n- æ”»å‡»ä¸€èˆ¬å‘èµ·åœ¨ç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œè€Œä¸æ˜¯è¢«æ”»å‡»çš„ç½‘ç«™ã€‚è¢«æ”»å‡»çš„ç½‘ç«™æ— æ³•é˜²æ­¢æ”»å‡»å‘ç”Ÿã€‚\n- æ”»å‡»åˆ©ç”¨å—å®³è€…åœ¨è¢«æ”»å‡»ç½‘ç«™çš„ç™»å½•å‡­è¯ï¼Œå†’å……å—å®³è€…æäº¤æ“ä½œï¼›è€Œä¸æ˜¯ç›´æ¥çªƒå–æ•°æ®ã€‚\n- æ•´ä¸ªè¿‡ç¨‹æ”»å‡»è€…å¹¶ä¸èƒ½è·å–åˆ°å—å®³è€…çš„ç™»å½•å‡­è¯ï¼Œä»…ä»…æ˜¯â€œå†’ç”¨â€ã€‚\n- è·¨ç«™è¯·æ±‚å¯ä»¥ç”¨å„ç§æ–¹å¼ï¼šå›¾ç‰‡ URLã€è¶…é“¾æ¥ã€CORSã€Form æäº¤ç­‰ç­‰ã€‚éƒ¨åˆ†è¯·æ±‚æ–¹å¼å¯ä»¥ç›´æ¥åµŒå…¥åœ¨ç¬¬ä¸‰æ–¹è®ºå›ã€æ–‡ç« ä¸­ï¼Œéš¾ä»¥è¿›è¡Œè¿½è¸ªã€‚\n\nCSRF é€šå¸¸æ˜¯è·¨åŸŸçš„ï¼Œå› ä¸ºå¤–åŸŸé€šå¸¸æ›´å®¹æ˜“è¢«æ”»å‡»è€…æŒæ§ã€‚ä½†æ˜¯å¦‚æœæœ¬åŸŸä¸‹æœ‰å®¹æ˜“è¢«åˆ©ç”¨çš„åŠŸèƒ½ï¼Œæ¯”å¦‚å¯ä»¥å‘å›¾å’Œé“¾æ¥çš„è®ºå›å’Œè¯„è®ºåŒºï¼Œæ”»å‡»å¯ä»¥ç›´æ¥åœ¨æœ¬åŸŸä¸‹è¿›è¡Œï¼Œè€Œä¸”è¿™ç§æ”»å‡»æ›´åŠ å±é™©ã€‚\n\n## 4.é˜²æŠ¤ç­–ç•¥\n\nCSRF é€šå¸¸ä»ç¬¬ä¸‰æ–¹ç½‘ç«™å‘èµ·ï¼Œè¢«æ”»å‡»çš„ç½‘ç«™æ— æ³•é˜²æ­¢æ”»å‡»å‘ç”Ÿï¼Œåªèƒ½é€šè¿‡å¢å¼ºè‡ªå·±ç½‘ç«™é’ˆå¯¹ CSRF çš„é˜²æŠ¤èƒ½åŠ›æ¥æå‡å®‰å…¨æ€§ã€‚\n\nä¸Šæ–‡ä¸­è®²äº†**CSRF çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š**\n\n- CSRFï¼ˆé€šå¸¸ï¼‰å‘ç”Ÿåœ¨ç¬¬ä¸‰æ–¹åŸŸåã€‚\n- CSRF æ”»å‡»è€…ä¸èƒ½è·å–åˆ° Cookie ç­‰ä¿¡æ¯ï¼Œåªæ˜¯ä½¿ç”¨ã€‚\n\né’ˆå¯¹è¿™ä¸¤ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸“é—¨åˆ¶å®šé˜²æŠ¤ç­–ç•¥ï¼Œå¦‚ä¸‹ï¼š\n\n- é˜»æ­¢ä¸æ˜å¤–åŸŸçš„è®¿é—®\n  - åŒæºæ£€æµ‹\n  - Samesite Cookie\n- æäº¤æ—¶è¦æ±‚é™„åŠ æœ¬åŸŸæ‰èƒ½è·å–çš„ä¿¡æ¯\n  - CSRF Token\n  - åŒé‡ Cookie éªŒè¯\n\n### åŒæºæ£€æµ‹\n\næ—¢ç„¶ CSRF å¤§å¤šæ¥è‡ªç¬¬ä¸‰æ–¹ç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥ç¦æ­¢å¤–åŸŸï¼ˆæˆ–è€…ä¸å—ä¿¡ä»»çš„åŸŸåï¼‰å¯¹æˆ‘ä»¬å‘èµ·è¯·æ±‚ã€‚\n\næˆ‘ä»¬å¦‚ä½•åˆ¤æ–­è¯·æ±‚æ˜¯å¦æ¥è‡ªå¤–åŸŸå‘¢ï¼Ÿ\n\nåœ¨ HTTP åè®®ä¸­ï¼Œæ¯ä¸€ä¸ª*å¼‚æ­¥è¯·æ±‚*éƒ½ä¼šæºå¸¦ä¸¤ä¸ª Headerï¼Œç”¨äºæ ‡è®°æ¥æºåŸŸåï¼š\n\n- Origin Header\n- Referer Header\n\nè¿™ä¸¤ä¸ª Header åœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œå¤§å¤šæ•°æƒ…å†µä¼šè‡ªåŠ¨å¸¦ä¸Šï¼Œå¹¶ä¸”*ä¸èƒ½ç”±å‰ç«¯è‡ªå®šä¹‰å†…å®¹ã€‚*\næœåŠ¡å™¨å¯ä»¥é€šè¿‡è§£æè¿™ä¸¤ä¸ª Header ä¸­çš„åŸŸåï¼Œç¡®å®šè¯·æ±‚çš„æ¥æºåŸŸã€‚\n\n##### 1. ä½¿ç”¨ Origin Header ç¡®å®šæ¥æºåŸŸå\n\nåœ¨éƒ¨åˆ†ä¸ CSRF æœ‰å…³çš„è¯·æ±‚ä¸­ï¼Œè¯·æ±‚çš„ Header ä¸­ä¼šæºå¸¦ Origin å­—æ®µã€‚å­—æ®µå†…åŒ…å«è¯·æ±‚çš„åŸŸåï¼ˆä¸åŒ…å« path åŠ queryï¼‰ã€‚\n\nå¦‚æœ Origin å­˜åœ¨ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨ Origin ä¸­çš„å­—æ®µç¡®è®¤æ¥æºåŸŸåå°±å¯ä»¥ã€‚\n\nä½†æ˜¯ Origin åœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹å¹¶ä¸å­˜åœ¨ï¼š\n\n- **IE11 åŒæºç­–ç•¥ï¼š** IE 11 ä¸ä¼šåœ¨è·¨ç«™ CORS è¯·æ±‚ä¸Šæ·»åŠ  Origin æ ‡å¤´ï¼ŒReferer å¤´å°†ä»ç„¶æ˜¯å”¯ä¸€çš„æ ‡è¯†ã€‚æœ€æ ¹æœ¬åŸå› æ˜¯å› ä¸º IE 11 å¯¹åŒæºçš„å®šä¹‰å’Œå…¶ä»–æµè§ˆå™¨æœ‰ä¸åŒï¼Œæœ‰ä¸¤ä¸ªä¸»è¦çš„åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒ[MDN Same-origin_policy#IE_Exceptions](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy#IE_Exceptions)\n- **302 é‡å®šå‘ï¼š** åœ¨ 302 é‡å®šå‘ä¹‹å Origin ä¸åŒ…å«åœ¨é‡å®šå‘çš„è¯·æ±‚ä¸­ï¼Œå› ä¸º Origin å¯èƒ½ä¼šè¢«è®¤ä¸ºæ˜¯å…¶ä»–æ¥æºçš„æ•æ„Ÿä¿¡æ¯ã€‚å¯¹äº 302 é‡å®šå‘çš„æƒ…å†µæ¥è¯´éƒ½æ˜¯å®šå‘åˆ°æ–°çš„æœåŠ¡å™¨ä¸Šçš„ URLï¼Œå› æ­¤æµè§ˆå™¨ä¸æƒ³å°† Origin æ³„æ¼åˆ°æ–°çš„æœåŠ¡å™¨ä¸Šã€‚\n\n##### 2. ä½¿ç”¨ Referer Header ç¡®å®šæ¥æºåŸŸå\n\næ ¹æ® HTTP åè®®ï¼Œåœ¨ HTTP å¤´ä¸­æœ‰ä¸€ä¸ªå­—æ®µå« Refererï¼Œè®°å½•äº†è¯¥ HTTP è¯·æ±‚çš„æ¥æºåœ°å€ã€‚\nå¯¹äº Ajax è¯·æ±‚ï¼Œå›¾ç‰‡å’Œ script ç­‰èµ„æºè¯·æ±‚ï¼ŒReferer ä¸ºå‘èµ·è¯·æ±‚çš„é¡µé¢åœ°å€ã€‚å¯¹äºé¡µé¢è·³è½¬ï¼ŒReferer ä¸ºæ‰“å¼€é¡µé¢å†å²è®°å½•çš„å‰ä¸€ä¸ªé¡µé¢åœ°å€ã€‚å› æ­¤æˆ‘ä»¬ä½¿ç”¨ Referer ä¸­é“¾æ¥çš„ Origin éƒ¨åˆ†å¯ä»¥å¾—çŸ¥è¯·æ±‚çš„æ¥æºåŸŸåã€‚\n\nè¿™ç§æ–¹æ³•å¹¶éä¸‡æ— ä¸€å¤±ï¼ŒReferer çš„å€¼æ˜¯ç”±æµè§ˆå™¨æä¾›çš„ï¼Œè™½ç„¶ HTTP åè®®ä¸Šæœ‰æ˜ç¡®çš„è¦æ±‚ï¼Œä½†æ˜¯æ¯ä¸ªæµè§ˆå™¨å¯¹äº Referer çš„å…·ä½“å®ç°å¯èƒ½æœ‰å·®åˆ«ï¼Œå¹¶ä¸èƒ½ä¿è¯æµè§ˆå™¨è‡ªèº«æ²¡æœ‰å®‰å…¨æ¼æ´ã€‚ä½¿ç”¨éªŒè¯ Referer å€¼çš„æ–¹æ³•ï¼Œå°±æ˜¯æŠŠå®‰å…¨æ€§éƒ½ä¾èµ–äºç¬¬ä¸‰æ–¹ï¼ˆå³æµè§ˆå™¨ï¼‰æ¥ä¿éšœï¼Œä»ç†è®ºä¸Šæ¥è®²ï¼Œè¿™æ ·å¹¶ä¸æ˜¯å¾ˆå®‰å…¨ã€‚åœ¨éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥éšè—ï¼Œç”šè‡³ä¿®æ”¹è‡ªå·±è¯·æ±‚çš„ Refererã€‚\n\n2014 å¹´ï¼ŒW3C çš„ Web åº”ç”¨å®‰å…¨å·¥ä½œç»„å‘å¸ƒäº† Referrer Policy è‰æ¡ˆï¼Œå¯¹æµè§ˆå™¨è¯¥å¦‚ä½•å‘é€ Referer åšäº†è¯¦ç»†çš„è§„å®šã€‚æˆªæ­¢ç°åœ¨æ–°ç‰ˆæµè§ˆå™¨å¤§éƒ¨åˆ†å·²ç»æ”¯æŒäº†è¿™ä»½è‰æ¡ˆï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥çµæ´»åœ°æ§åˆ¶è‡ªå·±ç½‘ç«™çš„ Referer ç­–ç•¥äº†ã€‚æ–°ç‰ˆçš„ Referrer Policy è§„å®šäº†äº”ç§ Referer ç­–ç•¥ï¼šNo Referrerã€No Referrer When Downgradeã€Origin Onlyã€Origin When Cross-originã€å’Œ Unsafe URLã€‚ä¹‹å‰å°±å­˜åœ¨çš„ä¸‰ç§ç­–ç•¥ï¼šneverã€default å’Œ alwaysï¼Œåœ¨æ–°æ ‡å‡†é‡Œæ¢äº†ä¸ªåç§°ã€‚ä»–ä»¬çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iyglvo3mj31bo0e63yy.jpg)\n\næ ¹æ®ä¸Šé¢çš„è¡¨æ ¼å› æ­¤éœ€è¦æŠŠ Referrer Policy çš„ç­–ç•¥è®¾ç½®æˆ same-originï¼Œå¯¹äºåŒæºçš„é“¾æ¥å’Œå¼•ç”¨ï¼Œä¼šå‘é€ Refererï¼Œreferer å€¼ä¸º Host ä¸å¸¦ Pathï¼›è·¨åŸŸè®¿é—®åˆ™ä¸æºå¸¦ Refererã€‚ä¾‹å¦‚ï¼š`aaa.com`å¼•ç”¨`bbb.com`çš„èµ„æºï¼Œä¸ä¼šå‘é€ Refererã€‚\n\nè®¾ç½® Referrer Policy çš„æ–¹æ³•æœ‰ä¸‰ç§ï¼š\n\n1. åœ¨ CSP è®¾ç½®\n2. é¡µé¢å¤´éƒ¨å¢åŠ  meta æ ‡ç­¾\n3. a æ ‡ç­¾å¢åŠ  referrerpolicy å±æ€§\n\n**æ”»å‡»è€…å¯ä»¥åœ¨è‡ªå·±çš„è¯·æ±‚ä¸­éšè— Refererã€‚**\n\nå¦å¤–åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ Referer æ²¡æœ‰æˆ–è€…ä¸å¯ä¿¡ï¼š\n\n1. IE6ã€7 ä¸‹ä½¿ç”¨ window.location.href=url è¿›è¡Œç•Œé¢çš„è·³è½¬ï¼Œä¼šä¸¢å¤± Refererã€‚\n2. IE6ã€7 ä¸‹ä½¿ç”¨ window.openï¼Œä¹Ÿä¼šç¼ºå¤± Refererã€‚\n3. HTTPS é¡µé¢è·³è½¬åˆ° HTTP é¡µé¢ï¼Œæ‰€æœ‰æµè§ˆå™¨ Referer éƒ½ä¸¢å¤±ã€‚\n4. ç‚¹å‡» Flash ä¸Šåˆ°è¾¾å¦å¤–ä¸€ä¸ªç½‘ç«™çš„æ—¶å€™ï¼ŒReferer çš„æƒ…å†µå°±æ¯”è¾ƒæ‚ä¹±ï¼Œä¸å¤ªå¯ä¿¡ã€‚\n\n##### æ— æ³•ç¡®è®¤æ¥æºåŸŸåæƒ…å†µ\n\nå½“ Origin å’Œ Referer å¤´æ–‡ä»¶ä¸å­˜åœ¨æ—¶è¯¥æ€ä¹ˆåŠï¼Ÿå¦‚æœ Origin å’Œ Referer éƒ½ä¸å­˜åœ¨ï¼Œå»ºè®®ç›´æ¥è¿›è¡Œé˜»æ­¢ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæ‚¨æ²¡æœ‰ä½¿ç”¨éšæœº CSRF Tokenï¼ˆå‚è€ƒä¸‹æ–¹ï¼‰ä½œä¸ºç¬¬äºŒæ¬¡æ£€æŸ¥ã€‚\n\n##### å¦‚ä½•é˜»æ­¢å¤–åŸŸè¯·æ±‚\n\né€šè¿‡ Header çš„éªŒè¯ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å‘èµ·è¯·æ±‚çš„æ¥æºåŸŸåï¼Œè¿™äº›æ¥æºåŸŸåå¯èƒ½æ˜¯ç½‘ç«™æœ¬åŸŸï¼Œæˆ–è€…å­åŸŸåï¼Œæˆ–è€…æœ‰æˆæƒçš„ç¬¬ä¸‰æ–¹åŸŸåï¼Œåˆæˆ–è€…æ¥è‡ªä¸å¯ä¿¡çš„æœªçŸ¥åŸŸåã€‚\n\nCSRF å¤§å¤šæ•°æƒ…å†µä¸‹æ¥è‡ªç¬¬ä¸‰æ–¹åŸŸåï¼Œä½†å¹¶ä¸èƒ½æ’é™¤æœ¬åŸŸå‘èµ·ã€‚å¦‚æœæ”»å‡»è€…æœ‰æƒé™åœ¨æœ¬åŸŸå‘å¸ƒè¯„è®ºï¼ˆå«é“¾æ¥ã€å›¾ç‰‡ç­‰ï¼Œç»Ÿç§° UGCï¼‰ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥ç›´æ¥åœ¨æœ¬åŸŸå‘èµ·æ”»å‡»ï¼Œè¿™ç§æƒ…å†µä¸‹åŒæºç­–ç•¥æ— æ³•è¾¾åˆ°é˜²æŠ¤çš„ä½œç”¨ã€‚\n\nç»¼ä¸Šæ‰€è¿°ï¼šåŒæºéªŒè¯æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„é˜²èŒƒæ–¹æ³•ï¼Œèƒ½å¤Ÿé˜²èŒƒç»å¤§å¤šæ•°çš„ CSRF æ”»å‡»ã€‚ä½†è¿™å¹¶ä¸æ˜¯ä¸‡æ— ä¸€å¤±çš„ï¼Œå¯¹äºå®‰å…¨æ€§è¦æ±‚è¾ƒé«˜ï¼Œæˆ–è€…æœ‰è¾ƒå¤šç”¨æˆ·è¾“å…¥å†…å®¹çš„ç½‘ç«™ï¼Œæˆ‘ä»¬å°±è¦å¯¹å…³é”®çš„æ¥å£åšé¢å¤–çš„é˜²æŠ¤æªæ–½ã€‚\n\n### CSRF Token\n\næˆ‘ä»¬å¯ä»¥è¦æ±‚æ‰€æœ‰çš„ç”¨æˆ·è¯·æ±‚éƒ½æºå¸¦ä¸€ä¸ª CSRF æ”»å‡»è€…æ— æ³•è·å–åˆ°çš„ Tokenã€‚æœåŠ¡å™¨é€šè¿‡æ ¡éªŒè¯·æ±‚æ˜¯å¦æºå¸¦æ­£ç¡®çš„ Tokenï¼Œæ¥æŠŠæ­£å¸¸çš„è¯·æ±‚å’Œæ”»å‡»çš„è¯·æ±‚åŒºåˆ†å¼€ï¼Œä¹Ÿå¯ä»¥é˜²èŒƒ CSRF çš„æ”»å‡»ã€‚\n\nCSRF Token çš„é˜²æŠ¤ç­–ç•¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š\n\n1. å°† CSRF Token è¾“å‡ºåˆ°é¡µé¢ä¸­\n\n   é¦–å…ˆï¼Œç”¨æˆ·æ‰“å¼€é¡µé¢çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦ç»™è¿™ä¸ªç”¨æˆ·ç”Ÿæˆä¸€ä¸ª Tokenï¼Œè¯¥ Token é€šè¿‡åŠ å¯†ç®—æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä¸€èˆ¬ Token éƒ½åŒ…æ‹¬éšæœºå­—ç¬¦ä¸²å’Œæ—¶é—´æˆ³çš„ç»„åˆï¼Œæ˜¾ç„¶åœ¨**æäº¤æ—¶ Token ä¸èƒ½å†æ”¾åœ¨ Cookie ä¸­äº†ï¼Œå¦åˆ™åˆä¼šè¢«æ”»å‡»è€…å†’ç”¨ã€‚å› æ­¤ï¼Œä¸ºäº†å®‰å…¨èµ·è§ Token æœ€å¥½è¿˜æ˜¯å­˜åœ¨æœåŠ¡å™¨çš„ Session ä¸­**ï¼Œä¹‹ååœ¨æ¯æ¬¡é¡µé¢åŠ è½½æ—¶ï¼Œä½¿ç”¨ JS éå†æ•´ä¸ª DOM æ ‘ï¼Œå¯¹äº DOM ä¸­æ‰€æœ‰çš„ a å’Œ form æ ‡ç­¾ååŠ å…¥ Tokenã€‚è¿™æ ·å¯ä»¥è§£å†³å¤§éƒ¨åˆ†çš„è¯·æ±‚ï¼Œä½†æ˜¯å¯¹äºåœ¨é¡µé¢åŠ è½½ä¹‹ååŠ¨æ€ç”Ÿæˆçš„ HTML ä»£ç ï¼Œè¿™ç§æ–¹æ³•å°±æ²¡æœ‰ä½œç”¨ï¼Œè¿˜éœ€è¦ç¨‹åºå‘˜åœ¨ç¼–ç æ—¶æ‰‹åŠ¨æ·»åŠ  Tokenã€‚\n\n2. é¡µé¢æäº¤çš„è¯·æ±‚æºå¸¦è¿™ä¸ª Token\n\n   å¯¹äº GET è¯·æ±‚ï¼ŒToken å°†é™„åœ¨è¯·æ±‚åœ°å€ä¹‹åï¼Œè¿™æ · URL å°±å˜æˆ [http://url?csrftoken=tokenvalue](http://url/?csrftoken=tokenvalue)ã€‚ è€Œå¯¹äº POST è¯·æ±‚æ¥è¯´ï¼Œè¦åœ¨ form çš„æœ€ååŠ ä¸Šï¼š\n\n```html\n<input type=\"â€hiddenâ€\" name=\"â€csrftokenâ€\" value=\"â€tokenvalueâ€\" />\n```\n\nâ€‹ è¿™æ ·ï¼Œå°±æŠŠ Token ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥è¯·æ±‚äº†ã€‚\n\n3. æœåŠ¡å™¨éªŒè¯ Token æ˜¯å¦æ­£ç¡®\n\n   å½“ç”¨æˆ·ä»å®¢æˆ·ç«¯å¾—åˆ°äº† Tokenï¼Œå†æ¬¡æäº¤ç»™æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨éœ€è¦åˆ¤æ–­ Token çš„æœ‰æ•ˆæ€§ï¼ŒéªŒè¯è¿‡ç¨‹æ˜¯å…ˆè§£å¯† Tokenï¼Œå¯¹æ¯”åŠ å¯†å­—ç¬¦ä¸²ä»¥åŠæ—¶é—´æˆ³ï¼Œå¦‚æœåŠ å¯†å­—ç¬¦ä¸²ä¸€è‡´ä¸”æ—¶é—´æœªè¿‡æœŸï¼Œé‚£ä¹ˆè¿™ä¸ª Token å°±æ˜¯æœ‰æ•ˆçš„ã€‚\n\n   è¿™ç§æ–¹æ³•è¦æ¯”ä¹‹å‰æ£€æŸ¥ Referer æˆ–è€… Origin è¦å®‰å…¨ä¸€äº›ï¼ŒToken å¯ä»¥åœ¨äº§ç”Ÿå¹¶æ”¾äº Session ä¹‹ä¸­ï¼Œç„¶ååœ¨æ¯æ¬¡è¯·æ±‚æ—¶æŠŠ Token ä» Session ä¸­æ‹¿å‡ºï¼Œä¸è¯·æ±‚ä¸­çš„ Token è¿›è¡Œæ¯”å¯¹ï¼Œä½†è¿™ç§æ–¹æ³•çš„æ¯”è¾ƒéº»çƒ¦çš„åœ¨äºå¦‚ä½•æŠŠ Token ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥è¯·æ±‚ã€‚\n\n   ### åˆ†å¸ƒå¼æ ¡éªŒ\n\nåœ¨å¤§å‹ç½‘ç«™ä¸­ï¼Œä½¿ç”¨ Session å­˜å‚¨ CSRF Token ä¼šå¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ã€‚è®¿é—®å•å°æœåŠ¡å™¨ session æ˜¯åŒä¸€ä¸ªã€‚ä½†æ˜¯ç°åœ¨çš„å¤§å‹ç½‘ç«™ä¸­ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨é€šå¸¸ä¸æ­¢ä¸€å°ï¼Œå¯èƒ½æ˜¯å‡ åå°ç”šè‡³å‡ ç™¾å°ä¹‹å¤šï¼Œç”šè‡³å¤šä¸ªæœºæˆ¿éƒ½å¯èƒ½åœ¨ä¸åŒçš„çœä»½ï¼Œç”¨æˆ·å‘èµ·çš„ HTTP è¯·æ±‚é€šå¸¸è¦ç»è¿‡åƒ Ngnix ä¹‹ç±»çš„è´Ÿè½½å‡è¡¡å™¨ä¹‹åï¼Œå†è·¯ç”±åˆ°å…·ä½“çš„æœåŠ¡å™¨ä¸Šï¼Œç”±äº Session é»˜è®¤å­˜å‚¨åœ¨å•æœºæœåŠ¡å™¨å†…å­˜ä¸­ï¼Œå› æ­¤åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹åŒä¸€ä¸ªç”¨æˆ·å‘é€çš„å¤šæ¬¡ HTTP è¯·æ±‚å¯èƒ½ä¼šå…ˆåè½åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¯¼è‡´åé¢å‘èµ·çš„ HTTP è¯·æ±‚æ— æ³•æ‹¿åˆ°ä¹‹å‰çš„ HTTP è¯·æ±‚å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­çš„ Session æ•°æ®ï¼Œä»è€Œä½¿å¾— Session æœºåˆ¶åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¤±æ•ˆï¼Œå› æ­¤åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­ CSRF Token éœ€è¦å­˜å‚¨åœ¨ Redis ä¹‹ç±»çš„å…¬å…±å­˜å‚¨ç©ºé—´ã€‚\n\nç”±äºä½¿ç”¨ Session å­˜å‚¨ï¼Œè¯»å–å’ŒéªŒè¯ CSRF Token ä¼šå¼•èµ·æ¯”è¾ƒå¤§çš„å¤æ‚åº¦å’Œæ€§èƒ½é—®é¢˜ï¼Œç›®å‰å¾ˆå¤šç½‘ç«™é‡‡ç”¨ Encrypted Token Pattern æ–¹å¼ã€‚è¿™ç§æ–¹æ³•çš„ Token æ˜¯ä¸€ä¸ªè®¡ç®—å‡ºæ¥çš„ç»“æœï¼Œè€Œééšæœºç”Ÿæˆçš„å­—ç¬¦ä¸²ã€‚è¿™æ ·åœ¨æ ¡éªŒæ—¶æ— éœ€å†å»è¯»å–å­˜å‚¨çš„ Tokenï¼Œåªç”¨å†æ¬¡è®¡ç®—ä¸€æ¬¡å³å¯ã€‚\n\nè¿™ç§ Token çš„å€¼é€šå¸¸æ˜¯ä½¿ç”¨ UserIDã€æ—¶é—´æˆ³å’Œéšæœºæ•°ï¼Œé€šè¿‡åŠ å¯†çš„æ–¹æ³•ç”Ÿæˆã€‚è¿™æ ·æ—¢å¯ä»¥ä¿è¯åˆ†å¸ƒå¼æœåŠ¡çš„ Token ä¸€è‡´ï¼Œåˆèƒ½ä¿è¯ Token ä¸å®¹æ˜“è¢«ç ´è§£ã€‚\n\nåœ¨ token è§£å¯†æˆåŠŸä¹‹åï¼ŒæœåŠ¡å™¨å¯ä»¥è®¿é—®è§£æå€¼ï¼ŒToken ä¸­åŒ…å«çš„ UserID å’Œæ—¶é—´æˆ³å°†ä¼šè¢«æ‹¿æ¥è¢«éªŒè¯æœ‰æ•ˆæ€§ï¼Œå°† UserID ä¸å½“å‰ç™»å½•çš„ UserID è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶å°†æ—¶é—´æˆ³ä¸å½“å‰æ—¶é—´è¿›è¡Œæ¯”è¾ƒã€‚\n\n### åŒé‡ Cookie éªŒè¯\n\nä½¿ç”¨åŒé‡æäº¤ Cookieã€‚åˆ©ç”¨ CSRF æ”»å‡»ä¸èƒ½è·å–åˆ°ç”¨æˆ· Cookie çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚ Ajax å’Œè¡¨å•è¯·æ±‚æºå¸¦ä¸€ä¸ª Cookie ä¸­çš„å€¼ã€‚\n\nåŒé‡ Cookie é‡‡ç”¨ä»¥ä¸‹æµç¨‹ï¼š\n\n- åœ¨ç”¨æˆ·è®¿é—®ç½‘ç«™é¡µé¢æ—¶ï¼Œå‘è¯·æ±‚åŸŸåæ³¨å…¥ä¸€ä¸ª Cookieï¼Œå†…å®¹ä¸ºéšæœºå­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚`csrfcookie=v8g9e4ksfhw`ï¼‰ã€‚\n- åœ¨å‰ç«¯å‘åç«¯å‘èµ·è¯·æ±‚æ—¶ï¼Œå–å‡º Cookieï¼Œå¹¶æ·»åŠ åˆ° URL çš„å‚æ•°ä¸­ï¼ˆæ¥ä¸Šä¾‹`POST https://www.a.com/comment?csrfcookie=v8g9e4ksfhw`ï¼‰ã€‚\n- åç«¯æ¥å£éªŒè¯ Cookie ä¸­çš„å­—æ®µä¸ URL å‚æ•°ä¸­çš„å­—æ®µæ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´åˆ™æ‹’ç»ã€‚\n\næ­¤æ–¹æ³•ç›¸å¯¹äº CSRF Token å°±ç®€å•äº†è®¸å¤šã€‚å¯ä»¥ç›´æ¥é€šè¿‡å‰åç«¯æ‹¦æˆªçš„çš„æ–¹æ³•è‡ªåŠ¨åŒ–å®ç°ã€‚åç«¯æ ¡éªŒä¹Ÿæ›´åŠ æ–¹ä¾¿ï¼Œåªéœ€è¿›è¡Œè¯·æ±‚ä¸­å­—æ®µçš„å¯¹æ¯”ï¼Œè€Œä¸éœ€è¦å†è¿›è¡ŒæŸ¥è¯¢å’Œå­˜å‚¨ Tokenã€‚\n\nç”±äºä»»ä½•è·¨åŸŸéƒ½ä¼šå¯¼è‡´å‰ç«¯æ— æ³•è·å– Cookie ä¸­çš„å­—æ®µï¼ˆåŒ…æ‹¬å­åŸŸåä¹‹é—´ï¼‰ï¼Œäºæ˜¯å‘ç”Ÿäº†å¦‚ä¸‹æƒ…å†µï¼š\n\n- å¦‚æœç”¨æˆ·è®¿é—®çš„ç½‘ç«™ä¸º`www.a.com`ï¼Œè€Œåç«¯çš„ api åŸŸåä¸º`api.a.com`ã€‚é‚£ä¹ˆåœ¨`www.a.com`ä¸‹ï¼Œå‰ç«¯æ‹¿ä¸åˆ°`api.a.com`çš„ Cookieï¼Œä¹Ÿå°±æ— æ³•å®ŒæˆåŒé‡ Cookie è®¤è¯ã€‚\n- äºæ˜¯è¿™ä¸ªè®¤è¯ Cookie å¿…é¡»è¢«ç§åœ¨`a.com`ä¸‹ï¼Œè¿™æ ·æ¯ä¸ªå­åŸŸéƒ½å¯ä»¥è®¿é—®ã€‚\n- ä»»ä½•ä¸€ä¸ªå­åŸŸéƒ½å¯ä»¥ä¿®æ”¹`a.com`ä¸‹çš„ Cookieã€‚\n- æŸä¸ªå­åŸŸåå­˜åœ¨æ¼æ´è¢« XSS æ”»å‡»ï¼ˆä¾‹å¦‚`upload.a.com`ï¼‰ã€‚è™½ç„¶è¿™ä¸ªå­åŸŸä¸‹å¹¶æ²¡æœ‰ä»€ä¹ˆå€¼å¾—çªƒå–çš„ä¿¡æ¯ã€‚ä½†æ”»å‡»è€…ä¿®æ”¹äº†`a.com`ä¸‹çš„ Cookieã€‚\n- æ”»å‡»è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è‡ªå·±é…ç½®çš„ Cookieï¼Œå¯¹ XSS ä¸­æ‹›çš„ç”¨æˆ·å†å‘`www.a.com`ä¸‹ï¼Œå‘èµ· CSRF æ”»å‡»ã€‚\n\n**æ€»ç»“**\n\nç”¨åŒé‡ Cookie é˜²å¾¡ CSRF çš„ä¼˜ç‚¹ï¼š\n\n- æ— éœ€ä½¿ç”¨ Sessionï¼Œé€‚ç”¨é¢æ›´å¹¿ï¼Œæ˜“äºå®æ–½ã€‚\n- Token å‚¨å­˜äºå®¢æˆ·ç«¯ä¸­ï¼Œä¸ä¼šç»™æœåŠ¡å™¨å¸¦æ¥å‹åŠ›ã€‚\n- ç›¸å¯¹äº Tokenï¼Œå®æ–½æˆæœ¬æ›´ä½ï¼Œå¯ä»¥åœ¨å‰åç«¯ç»Ÿä¸€æ‹¦æˆªæ ¡éªŒï¼Œè€Œä¸éœ€è¦ä¸€ä¸ªä¸ªæ¥å£å’Œé¡µé¢æ·»åŠ ã€‚\n\nç¼ºç‚¹ï¼š\n\n- Cookie ä¸­å¢åŠ äº†é¢å¤–çš„å­—æ®µã€‚\n- å¦‚æœæœ‰å…¶ä»–æ¼æ´ï¼ˆä¾‹å¦‚ XSSï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥ Cookieï¼Œé‚£ä¹ˆè¯¥é˜²å¾¡æ–¹å¼å¤±æ•ˆã€‚\n- éš¾ä»¥åšåˆ°å­åŸŸåçš„éš”ç¦»ã€‚\n- ä¸ºäº†ç¡®ä¿ Cookie ä¼ è¾“å®‰å…¨ï¼Œé‡‡ç”¨è¿™ç§é˜²å¾¡æ–¹å¼æœ€å¥½ç¡®ä¿ç”¨æ•´ç«™ HTTPS çš„æ–¹å¼ï¼Œå¦‚æœè¿˜æ²¡åˆ‡ HTTPS çš„ä½¿ç”¨è¿™ç§æ–¹å¼ä¹Ÿä¼šæœ‰é£é™©ã€‚\n\n### Samesite Cookie å±æ€§\n\nSet-Cookie å“åº”å¤´æ–°å¢ Samesite å±æ€§ï¼Œå®ƒç”¨æ¥æ ‡æ˜è¿™ä¸ª Cookie æ˜¯ä¸ªâ€œåŒç«™ Cookieâ€ï¼ŒåŒç«™ Cookie åªèƒ½ä½œä¸ºç¬¬ä¸€æ–¹ Cookieï¼Œä¸èƒ½ä½œä¸ºç¬¬ä¸‰æ–¹ Cookieï¼ŒSamesite æœ‰ä¸¤ä¸ªå±æ€§å€¼ï¼Œåˆ†åˆ«æ˜¯ Strict å’Œ Lax\n\n1. ##### Samesite=Strict\n\n   è¿™ç§ç§°ä¸ºä¸¥æ ¼æ¨¡å¼ï¼Œè¡¨æ˜è¿™ä¸ª Cookie åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸å¯èƒ½ä½œä¸ºç¬¬ä¸‰æ–¹ Cookieï¼Œç»æ— ä¾‹å¤–ã€‚æ¯”å¦‚è¯´ b.com è®¾ç½®äº†å¦‚ä¸‹ Cookieï¼š\n\n   ```http\n   Set-Cookie: foo=1; Samesite=Strict\n   Set-Cookie: bar=2; Samesite=Lax\n   Set-Cookie: baz=3\n   ```\n\n   æˆ‘ä»¬åœ¨ a.com ä¸‹å‘èµ·å¯¹ b.com çš„ä»»æ„è¯·æ±‚ï¼Œfoo è¿™ä¸ª Cookie éƒ½ä¸ä¼šè¢«åŒ…å«åœ¨ Cookie è¯·æ±‚å¤´ä¸­ï¼Œä½† bar ä¼šã€‚ä¸¾ä¸ªå®é™…çš„ä¾‹å­å°±æ˜¯ï¼Œå‡å¦‚æ·˜å®ç½‘ç«™ç”¨æ¥è¯†åˆ«ç”¨æˆ·ç™»å½•ä¸å¦çš„ Cookie è¢«è®¾ç½®æˆäº† Samesite=Strictï¼Œé‚£ä¹ˆç”¨æˆ·ä»ç™¾åº¦æœç´¢é¡µé¢ç”šè‡³å¤©çŒ«é¡µé¢çš„é“¾æ¥ç‚¹å‡»è¿›å…¥æ·˜å®åï¼Œæ·˜å®éƒ½ä¸ä¼šæ˜¯ç™»å½•çŠ¶æ€ï¼Œå› ä¸ºæ·˜å®çš„æœåŠ¡å™¨ä¸ä¼šæ¥å—åˆ°é‚£ä¸ª Cookieï¼Œå…¶å®ƒç½‘ç«™å‘èµ·çš„å¯¹æ·˜å®çš„ä»»æ„è¯·æ±‚éƒ½ä¸ä¼šå¸¦ä¸Šé‚£ä¸ª Cookieã€‚\n\n2. ##### Samesite=Lax\n\n   è¿™ç§ç§°ä¸ºå®½æ¾æ¨¡å¼ï¼Œæ¯” Strict æ”¾å®½äº†ç‚¹é™åˆ¶ï¼šå‡å¦‚è¿™ä¸ªè¯·æ±‚æ˜¯è¿™ç§è¯·æ±‚ï¼ˆæ”¹å˜äº†å½“å‰é¡µé¢æˆ–è€…æ‰“å¼€äº†æ–°é¡µé¢ï¼‰ä¸”åŒæ—¶æ˜¯ä¸ª GET è¯·æ±‚ï¼Œåˆ™è¿™ä¸ª Cookie å¯ä»¥ä½œä¸ºç¬¬ä¸‰æ–¹ Cookieã€‚\n\n   å½“ç”¨æˆ·ä» a.com ç‚¹å‡»é“¾æ¥è¿›å…¥ b.com æ—¶ï¼Œfoo è¿™ä¸ª Cookie ä¸ä¼šè¢«åŒ…å«åœ¨ Cookie è¯·æ±‚å¤´ä¸­ï¼Œä½† bar å’Œ baz ä¼šï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·åœ¨ä¸åŒç½‘ç«™ä¹‹é—´é€šè¿‡é“¾æ¥è·³è½¬æ˜¯ä¸å—å½±å“äº†ã€‚ä½†å‡å¦‚è¿™ä¸ªè¯·æ±‚æ˜¯ä» a.com å‘èµ·çš„å¯¹ b.com çš„å¼‚æ­¥è¯·æ±‚ï¼Œæˆ–è€…é¡µé¢è·³è½¬æ˜¯é€šè¿‡è¡¨å•çš„ post æäº¤è§¦å‘çš„ï¼Œåˆ™ bar ä¹Ÿä¸ä¼šå‘é€ã€‚\n\nç”Ÿæˆ Token æ”¾åˆ° Cookie ä¸­å¹¶ä¸”è®¾ç½® Cookie çš„ Samesite\n\n##### æˆ‘ä»¬åº”è¯¥å¦‚ä½•ä½¿ç”¨ SamesiteCookie\n\nå¦‚æœ SamesiteCookie è¢«è®¾ç½®ä¸º Strictï¼Œæµè§ˆå™¨åœ¨ä»»ä½•è·¨åŸŸè¯·æ±‚ä¸­éƒ½ä¸ä¼šæºå¸¦ Cookieï¼Œæ–°æ ‡ç­¾é‡æ–°æ‰“å¼€ä¹Ÿä¸æºå¸¦ï¼Œæ‰€ä»¥è¯´ CSRF æ”»å‡»åŸºæœ¬æ²¡æœ‰æœºä¼šã€‚\n\nä½†æ˜¯è·³è½¬å­åŸŸåæˆ–è€…æ˜¯æ–°æ ‡ç­¾é‡æ–°æ‰“å¼€åˆšç™»é™†çš„ç½‘ç«™ï¼Œä¹‹å‰çš„ Cookie éƒ½ä¸ä¼šå­˜åœ¨ã€‚å°¤å…¶æ˜¯æœ‰ç™»å½•çš„ç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ–°æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾è¿›å…¥ï¼Œæˆ–è€…è·³è½¬åˆ°å­åŸŸåçš„ç½‘ç«™ï¼Œéƒ½éœ€è¦é‡æ–°ç™»å½•ã€‚å¯¹äºç”¨æˆ·æ¥è®²ï¼Œå¯èƒ½ä½“éªŒä¸ä¼šå¾ˆå¥½ã€‚\n\nå¦‚æœ SamesiteCookie è¢«è®¾ç½®ä¸º Laxï¼Œé‚£ä¹ˆå…¶ä»–ç½‘ç«™é€šè¿‡é¡µé¢è·³è½¬è¿‡æ¥çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ Cookieï¼Œå¯ä»¥ä¿éšœå¤–åŸŸè¿æ¥æ‰“å¼€é¡µé¢æ—¶ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€‚ä½†ç›¸åº”çš„ï¼Œå…¶å®‰å…¨æ€§ä¹Ÿæ¯”è¾ƒä½ã€‚\n\nå¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯ Samesite çš„å…¼å®¹æ€§ä¸æ˜¯å¾ˆå¥½ï¼Œç°é˜¶æ®µé™¤äº†ä»æ–°ç‰ˆ Chrome å’Œ Firefox æ”¯æŒä»¥å¤–ï¼ŒSafari ä»¥åŠ iOS Safari éƒ½è¿˜ä¸æ”¯æŒï¼Œç°é˜¶æ®µçœ‹æ¥æš‚æ—¶è¿˜ä¸èƒ½æ™®åŠã€‚\n\nè€Œä¸”ï¼ŒSamesiteCookie ç›®å‰æœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼šä¸æ”¯æŒå­åŸŸã€‚ä¾‹å¦‚ï¼Œç§åœ¨ topic.a.com ä¸‹çš„ Cookieï¼Œå¹¶ä¸èƒ½ä½¿ç”¨ a.com ä¸‹ç§æ¤çš„ SamesiteCookieã€‚è¿™å°±å¯¼è‡´äº†å½“æˆ‘ä»¬ç½‘ç«™æœ‰å¤šä¸ªå­åŸŸåæ—¶ï¼Œä¸èƒ½ä½¿ç”¨ SamesiteCookie åœ¨ä¸»åŸŸåå­˜å‚¨ç”¨æˆ·ç™»å½•ä¿¡æ¯ã€‚æ¯ä¸ªå­åŸŸåéƒ½éœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•ä¸€æ¬¡ã€‚\n\næ€»ä¹‹ï¼ŒSamesiteCookie æ˜¯ä¸€ä¸ªå¯èƒ½æ›¿ä»£åŒæºéªŒè¯çš„æ–¹æ¡ˆï¼Œä½†ç›®å‰è¿˜å¹¶ä¸æˆç†Ÿï¼Œå…¶åº”ç”¨åœºæ™¯æœ‰å¾…è§‚æœ›ã€‚\n\n## 5.é˜²æ­¢ç½‘ç«™è¢«åˆ©ç”¨ï¼ˆé˜²æ­¢æ”»å‡»çš„å‘ç”Ÿï¼‰\n\nCSRF çš„æ”»å‡»å¯ä»¥æ¥è‡ªï¼š\n\n- æ”»å‡»è€…è‡ªå·±çš„ç½‘ç«™ã€‚\n- æœ‰æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„ç½‘ç«™ã€‚\n- ç¬¬ä¸‰æ–¹è®ºå›ç­‰ç”¨æˆ·å†…å®¹ã€‚\n- è¢«æ”»å‡»ç½‘ç«™è‡ªå·±çš„è¯„è®ºåŠŸèƒ½ç­‰ã€‚\n\nå¦‚ä½•é˜²æ­¢è‡ªå·±çš„ç½‘ç«™è¢«åˆ©ç”¨æˆä¸ºæ”»å‡»çš„æºå¤´å‘¢ï¼Ÿ\n\n- ä¸¥æ ¼ç®¡ç†æ‰€æœ‰çš„ä¸Šä¼ æ¥å£ï¼Œé˜²æ­¢ä»»ä½•é¢„æœŸä¹‹å¤–çš„ä¸Šä¼ å†…å®¹ï¼ˆä¾‹å¦‚ HTMLï¼‰ã€‚\n- æ·»åŠ  Header `X-Content-Type-Options: nosniff` é˜²æ­¢é»‘å®¢ä¸Šä¼  HTML å†…å®¹çš„èµ„æºï¼ˆä¾‹å¦‚å›¾ç‰‡ï¼‰è¢«è§£æä¸ºç½‘é¡µã€‚\n- å¯¹äºç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ï¼Œè¿›è¡Œè½¬å­˜æˆ–è€…æ ¡éªŒã€‚ä¸è¦ç›´æ¥ä½¿ç”¨ç”¨æˆ·å¡«å†™çš„å›¾ç‰‡é“¾æ¥ã€‚\n- å½“å‰ç”¨æˆ·æ‰“å¼€å…¶ä»–ç”¨æˆ·å¡«å†™çš„é“¾æ¥æ—¶ï¼Œéœ€å‘ŠçŸ¥é£é™©ï¼ˆè¿™ä¹Ÿæ˜¯å¾ˆå¤šè®ºå›ä¸å…è®¸ç›´æ¥åœ¨å†…å®¹ä¸­å‘å¸ƒå¤–åŸŸé“¾æ¥çš„åŸå› ä¹‹ä¸€ï¼Œä¸ä»…ä»…æ˜¯ä¸ºäº†ç”¨æˆ·ç•™å­˜ï¼Œä¹Ÿæœ‰å®‰å…¨è€ƒè™‘ï¼‰ã€‚\n\n## 6.CSRF å…¶ä»–é˜²èŒƒæªæ–½\n\n#### CSRF æµ‹è¯•\n\nCSRFTester æ˜¯ä¸€æ¬¾ CSRF æ¼æ´çš„æµ‹è¯•å·¥å…·ï¼ŒCSRFTester å·¥å…·çš„æµ‹è¯•åŸç†å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼Œä½¿ç”¨ä»£ç†æŠ“å–æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¿‡çš„æ‰€æœ‰çš„è¿æ¥ä»¥åŠæ‰€æœ‰çš„è¡¨å•ç­‰ä¿¡æ¯ï¼Œé€šè¿‡åœ¨ CSRFTester ä¸­ä¿®æ”¹ç›¸åº”çš„è¡¨å•ç­‰ä¿¡æ¯ï¼Œé‡æ–°æäº¤ï¼Œç›¸å½“äºä¸€æ¬¡ä¼ªé€ å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¦‚æœä¿®æ”¹åçš„æµ‹è¯•è¯·æ±‚æˆåŠŸè¢«ç½‘ç«™æœåŠ¡å™¨æ¥å—ï¼Œåˆ™è¯´æ˜å­˜åœ¨ CSRF æ¼æ´ï¼Œå½“ç„¶æ­¤æ¬¾å·¥å…·ä¹Ÿå¯ä»¥è¢«ç”¨æ¥è¿›è¡Œ CSRF æ”»å‡»ã€‚\nCSRFTester ä½¿ç”¨æ–¹æ³•å¤§è‡´åˆ†ä¸‹é¢å‡ ä¸ªæ­¥éª¤ï¼š\n\n- æ­¥éª¤ 1ï¼šè®¾ç½®æµè§ˆå™¨ä»£ç†\n\nCSRFTester é»˜è®¤ä½¿ç”¨ Localhost ä¸Šçš„ç«¯å£ 8008 ä½œä¸ºå…¶ä»£ç†ï¼Œå¦‚æœä»£ç†é…ç½®æˆåŠŸï¼ŒCSRFTester å°†ä¸ºæ‚¨çš„æµè§ˆå™¨ç”Ÿæˆçš„æ‰€æœ‰åç»­ HTTP è¯·æ±‚ç”Ÿæˆè°ƒè¯•æ¶ˆæ¯ã€‚\n\n- æ­¥éª¤ 2ï¼šä½¿ç”¨åˆæ³•è´¦æˆ·è®¿é—®ç½‘ç«™å¼€å§‹æµ‹è¯•\n\næˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæˆ‘ä»¬æƒ³è¦ä¸º CSRF æµ‹è¯•çš„ç‰¹å®šä¸šåŠ¡ Web é¡µé¢ã€‚æ‰¾åˆ°æ­¤é¡µé¢åï¼Œé€‰æ‹© CSRFTester ä¸­çš„â€œå¼€å§‹å½•åˆ¶â€æŒ‰é’®å¹¶æ‰§è¡Œä¸šåŠ¡åŠŸèƒ½ï¼›å®Œæˆåï¼Œç‚¹å‡» CSRFTester ä¸­çš„â€œåœæ­¢å½•åˆ¶â€æŒ‰é’®ï¼›æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¯¥è½¯ä»¶ä¼šå…¨éƒ¨éå†ä¸€éå½“å‰é¡µé¢çš„æ‰€æœ‰è¯·æ±‚ã€‚\n\n- æ­¥éª¤ 3ï¼šé€šè¿‡ CSRF ä¿®æ”¹å¹¶ä¼ªé€ è¯·æ±‚\n\nä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç°è½¯ä»¶ä¸Šæœ‰ä¸€ç³»åˆ—è·‘å‡ºæ¥çš„è®°å½•è¯·æ±‚ï¼Œè¿™äº›éƒ½æ˜¯æˆ‘ä»¬çš„æµè§ˆå™¨åœ¨æ‰§è¡Œä¸šåŠ¡åŠŸèƒ½æ—¶ç”Ÿæˆçš„æ‰€æœ‰ GET æˆ–è€… POST è¯·æ±‚ã€‚é€šè¿‡é€‰æ‹©åˆ—è¡¨ä¸­çš„æŸä¸€è¡Œï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä¿®æ”¹ç”¨äºæ‰§è¡Œä¸šåŠ¡åŠŸèƒ½çš„å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ç‚¹å‡»å¯¹åº”çš„è¯·æ±‚ä¿®æ”¹ query å’Œ form çš„å‚æ•°ã€‚å½“ä¿®æ”¹å®Œæ‰€æœ‰æˆ‘ä»¬å¸Œæœ›è¯±å¯¼ç”¨æˆ· form æœ€ç»ˆçš„æäº¤å€¼ï¼Œå¯ä»¥é€‰æ‹©å¼€å§‹ç”Ÿæˆ HTML æŠ¥å‘Šã€‚\n\n- æ­¥éª¤ 4ï¼šæ‹¿åˆ°ç»“æœå¦‚æœ‰æ¼æ´è¿›è¡Œä¿®å¤\n\né¦–å…ˆå¿…é¡»é€‰æ‹©â€œæŠ¥å‘Šç±»å‹â€ã€‚æŠ¥å‘Šç±»å‹å†³å®šäº†æˆ‘ä»¬å¸Œæœ›å—å®³è€…æµè§ˆå™¨å¦‚ä½•æäº¤å…ˆå‰è®°å½•çš„è¯·æ±‚ã€‚ç›®å‰æœ‰ 5 ç§å¯èƒ½çš„æŠ¥å‘Šï¼šè¡¨å•ã€iFrameã€IMGã€XHR å’Œé“¾æ¥ã€‚ä¸€æ—¦é€‰æ‹©äº†æŠ¥å‘Šç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åœ¨æµè§ˆå™¨ä¸­å¯åŠ¨æ–°ç”Ÿæˆçš„æŠ¥å‘Šï¼Œæœ€åæ ¹æ®æŠ¥å‘Šçš„æƒ…å†µè¿›è¡Œå¯¹åº”çš„æ’æŸ¥å’Œä¿®å¤ã€‚\n\n#### CSRF ç›‘æ§\n\nå¯¹äºä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ç½‘ç«™ç³»ç»Ÿï¼ŒæŸäº›é¡¹ç›®ã€é¡µé¢ã€æ¥å£æ¼æ‰äº† CSRF é˜²æŠ¤æªæ–½æ˜¯å¾ˆå¯èƒ½çš„ã€‚\n\nä¸€æ—¦å‘ç”Ÿäº† CSRF æ”»å‡»ï¼Œæˆ‘ä»¬å¦‚ä½•åŠæ—¶çš„å‘ç°è¿™äº›æ”»å‡»å‘¢ï¼Ÿ\n\nCSRF æ”»å‡»æœ‰ç€æ¯”è¾ƒæ˜æ˜¾çš„ç‰¹å¾ï¼š\n\n- è·¨åŸŸè¯·æ±‚ã€‚\n- GET ç±»å‹è¯·æ±‚ Header çš„ MIME ç±»å‹å¤§æ¦‚ç‡ä¸ºå›¾ç‰‡ï¼Œè€Œå®é™…è¿”å› Header çš„ MIME ç±»å‹ä¸º Textã€JSONã€HTMLã€‚\n\næˆ‘ä»¬å¯ä»¥åœ¨ç½‘ç«™çš„ä»£ç†å±‚ç›‘æ§æ‰€æœ‰çš„æ¥å£è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚ç¬¦åˆä¸Šé¢çš„ç‰¹å¾ï¼Œå°±å¯ä»¥è®¤ä¸ºè¯·æ±‚æœ‰ CSRF æ”»å‡»å«Œç–‘ã€‚æˆ‘ä»¬å¯ä»¥æé†’å¯¹åº”çš„é¡µé¢å’Œé¡¹ç›®è´Ÿè´£äººï¼Œæ£€æŸ¥æˆ–è€… Review å…¶ CSRF é˜²æŠ¤ç­–ç•¥ã€‚\n\n### ä¸ªäººç”¨æˆ· CSRF å®‰å…¨çš„å»ºè®®\n\nç»å¸¸ä¸Šç½‘çš„ä¸ªäººç”¨æˆ·ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•æ¥ä¿æŠ¤è‡ªå·±ï¼š\n\n- ä½¿ç”¨ç½‘é¡µç‰ˆé‚®ä»¶çš„æµè§ˆé‚®ä»¶æˆ–è€…æ–°é—»ä¹Ÿä¼šå¸¦æ¥é¢å¤–çš„é£é™©ï¼Œå› ä¸ºæŸ¥çœ‹é‚®ä»¶æˆ–è€…æ–°é—»æ¶ˆæ¯æœ‰å¯èƒ½å¯¼è‡´æ¶æ„ä»£ç çš„æ”»å‡»ã€‚\n- å°½é‡ä¸è¦æ‰“å¼€å¯ç–‘çš„é“¾æ¥ï¼Œä¸€å®šè¦æ‰“å¼€æ—¶ï¼Œä½¿ç”¨ä¸å¸¸ç”¨çš„æµè§ˆå™¨ã€‚\n","tags":["JavaScript","å®‰å…¨"],"categories":["å®‰å…¨"]},{"title":"XSSæ”»å‡»","url":"/2019/06/13/XSSæ”»å‡»/","content":"\n# XSS æ”»å‡»\n\n## 1.ä»€ä¹ˆæ˜¯ XSS\n\nCross-Site Scriptingï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰ç®€ç§° XSSï¼Œæ˜¯ä¸€ç§ä»£ç æ³¨å…¥æ”»å‡»ã€‚æ”»å‡»è€…é€šè¿‡åœ¨ç›®æ ‡ç½‘ç«™ä¸Šæ³¨å…¥æ¶æ„è„šæœ¬ï¼Œä½¿ä¹‹åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šè¿è¡Œã€‚åˆ©ç”¨è¿™äº›æ¶æ„è„šæœ¬ï¼Œæ”»å‡»è€…å¯è·å–ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯å¦‚ Cookieã€SessionID ç­‰ï¼Œè¿›è€Œå±å®³æ•°æ®å®‰å…¨ã€‚\n\nä¸ºäº†å’Œ CSS åŒºåˆ†ï¼Œè¿™é‡ŒæŠŠæ”»å‡»çš„ç¬¬ä¸€ä¸ªå­—æ¯æ”¹æˆäº† Xï¼Œäºæ˜¯å«åš XSSã€‚\n\nXSS çš„æœ¬è´¨æ˜¯ï¼šæ¶æ„ä»£ç æœªç»è¿‡æ»¤ï¼Œä¸ç½‘ç«™æ­£å¸¸çš„ä»£ç æ··åœ¨ä¸€èµ·ï¼›æµè§ˆå™¨æ— æ³•åˆ†è¾¨å“ªäº›è„šæœ¬æ˜¯å¯ä¿¡çš„ï¼Œå¯¼è‡´æ¶æ„è„šæœ¬è¢«æ‰§è¡Œã€‚\n\n  <!-- more -->\n\nè€Œç”±äºç›´æ¥åœ¨ç”¨æˆ·çš„ç»ˆç«¯æ‰§è¡Œï¼Œæ¶æ„ä»£ç èƒ½å¤Ÿç›´æ¥è·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œæˆ–è€…åˆ©ç”¨è¿™äº›ä¿¡æ¯å†’å……ç”¨æˆ·å‘ç½‘ç«™å‘èµ·æ”»å‡»è€…å®šä¹‰çš„è¯·æ±‚ã€‚\n\nåœ¨å¤„ç†è¾“å…¥æ—¶ï¼Œä»¥ä¸‹å†…å®¹éƒ½ä¸å¯ä¿¡ï¼š\n\n- æ¥è‡ªç”¨æˆ·çš„ UGC ä¿¡æ¯\n- æ¥è‡ªç¬¬ä¸‰æ–¹çš„é“¾æ¥\n- URL å‚æ•°\n- POST å‚æ•°\n- Referer ï¼ˆå¯èƒ½æ¥è‡ªä¸å¯ä¿¡çš„æ¥æºï¼‰\n- Cookie ï¼ˆå¯èƒ½æ¥è‡ªå…¶ä»–å­åŸŸæ³¨å…¥ï¼‰\n\n## 2.XSS åˆ†ç±»\n\næ ¹æ®æ”»å‡»çš„æ¥æºï¼ŒXSS æ”»å‡»å¯åˆ†ä¸ºå­˜å‚¨å‹ã€åå°„å‹å’Œ DOM å‹ä¸‰ç§ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5yj76xtj31by0ecgm2.jpg)\n\n#### å­˜å‚¨å‹ XSS\n\nå­˜å‚¨å‹ XSS çš„æ”»å‡»æ­¥éª¤ï¼š\n\n1. æ”»å‡»è€…å°†æ¶æ„ä»£ç æäº¤åˆ°ç›®æ ‡ç½‘ç«™çš„æ•°æ®åº“ä¸­ã€‚\n2. ç”¨æˆ·æ‰“å¼€ç›®æ ‡ç½‘ç«™æ—¶ï¼Œç½‘ç«™æœåŠ¡ç«¯å°†æ¶æ„ä»£ç ä»æ•°æ®åº“å–å‡ºï¼Œæ‹¼æ¥åœ¨ HTML ä¸­è¿”å›ç»™æµè§ˆå™¨ã€‚\n3. ç”¨æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§è¡Œï¼Œæ··åœ¨å…¶ä¸­çš„æ¶æ„ä»£ç ä¹Ÿè¢«æ‰§è¡Œã€‚\n4. æ¶æ„ä»£ç çªƒå–ç”¨æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œæˆ–è€…å†’å……ç”¨æˆ·çš„è¡Œä¸ºï¼Œè°ƒç”¨ç›®æ ‡ç½‘ç«™æ¥å£æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ“ä½œã€‚\n\nè¿™ç§æ”»å‡»å¸¸è§äºå¸¦æœ‰ç”¨æˆ·ä¿å­˜æ•°æ®çš„ç½‘ç«™åŠŸèƒ½ï¼Œå¦‚è®ºå›å‘å¸–ã€å•†å“è¯„è®ºã€ç”¨æˆ·ç§ä¿¡ç­‰ã€‚\n\n#### åå°„å‹ XSS\n\nåå°„å‹ XSS çš„æ”»å‡»æ­¥éª¤ï¼š\n\n1. æ”»å‡»è€…æ„é€ å‡ºç‰¹æ®Šçš„ URLï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚\n2. ç”¨æˆ·æ‰“å¼€å¸¦æœ‰æ¶æ„ä»£ç çš„ URL æ—¶ï¼Œç½‘ç«™æœåŠ¡ç«¯å°†æ¶æ„ä»£ç ä» URL ä¸­å–å‡ºï¼Œæ‹¼æ¥åœ¨ HTML ä¸­è¿”å›ç»™æµè§ˆå™¨ã€‚\n3. ç”¨æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§è¡Œï¼Œæ··åœ¨å…¶ä¸­çš„æ¶æ„ä»£ç ä¹Ÿè¢«æ‰§è¡Œã€‚\n4. æ¶æ„ä»£ç çªƒå–ç”¨æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œæˆ–è€…å†’å……ç”¨æˆ·çš„è¡Œä¸ºï¼Œè°ƒç”¨ç›®æ ‡ç½‘ç«™æ¥å£æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ“ä½œã€‚\n\nåå°„å‹ XSS è·Ÿå­˜å‚¨å‹ XSS çš„åŒºåˆ«æ˜¯ï¼šå­˜å‚¨å‹ XSS çš„æ¶æ„ä»£ç å­˜åœ¨æ•°æ®åº“é‡Œï¼Œåå°„å‹ XSS çš„æ¶æ„ä»£ç å­˜åœ¨ URL é‡Œã€‚\n\nåå°„å‹ XSS æ¼æ´å¸¸è§äºé€šè¿‡ URL ä¼ é€’å‚æ•°çš„åŠŸèƒ½ï¼Œå¦‚ç½‘ç«™æœç´¢ã€è·³è½¬ç­‰ã€‚\n\nç”±äºéœ€è¦ç”¨æˆ·ä¸»åŠ¨æ‰“å¼€æ¶æ„çš„ URL æ‰èƒ½ç”Ÿæ•ˆï¼Œæ”»å‡»è€…å¾€å¾€ä¼šç»“åˆå¤šç§æ‰‹æ®µè¯±å¯¼ç”¨æˆ·ç‚¹å‡»ã€‚\n\nPOST çš„å†…å®¹ä¹Ÿå¯ä»¥è§¦å‘åå°„å‹ XSSï¼Œåªä¸è¿‡å…¶è§¦å‘æ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼ˆéœ€è¦æ„é€ è¡¨å•æäº¤é¡µé¢ï¼Œå¹¶å¼•å¯¼ç”¨æˆ·ç‚¹å‡»ï¼‰ï¼Œæ‰€ä»¥éå¸¸å°‘è§ã€‚\n\n#### DOM å‹ XSS\n\nDOM å‹ XSS çš„æ”»å‡»æ­¥éª¤ï¼š\n\n1. æ”»å‡»è€…æ„é€ å‡ºç‰¹æ®Šçš„ URLï¼Œå…¶ä¸­åŒ…å«æ¶æ„ä»£ç ã€‚\n2. ç”¨æˆ·æ‰“å¼€å¸¦æœ‰æ¶æ„ä»£ç çš„ URLã€‚\n3. ç”¨æˆ·æµè§ˆå™¨æ¥æ”¶åˆ°å“åº”åè§£ææ‰§è¡Œï¼Œå‰ç«¯ JavaScript å–å‡º URL ä¸­çš„æ¶æ„ä»£ç å¹¶æ‰§è¡Œã€‚\n4. æ¶æ„ä»£ç çªƒå–ç”¨æˆ·æ•°æ®å¹¶å‘é€åˆ°æ”»å‡»è€…çš„ç½‘ç«™ï¼Œæˆ–è€…å†’å……ç”¨æˆ·çš„è¡Œä¸ºï¼Œè°ƒç”¨ç›®æ ‡ç½‘ç«™æ¥å£æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„æ“ä½œã€‚\n\nDOM å‹ XSS è·Ÿå‰ä¸¤ç§ XSS çš„åŒºåˆ«ï¼šDOM å‹ XSS æ”»å‡»ä¸­ï¼Œå–å‡ºå’Œæ‰§è¡Œæ¶æ„ä»£ç ç”±æµè§ˆå™¨ç«¯å®Œæˆï¼Œå±äºå‰ç«¯ JavaScript è‡ªèº«çš„å®‰å…¨æ¼æ´ï¼Œè€Œå…¶ä»–ä¸¤ç§ XSS éƒ½å±äºæœåŠ¡ç«¯çš„å®‰å…¨æ¼æ´ã€‚\n\n## 3.XSS çš„é¢„é˜²\n\nXSS æ”»å‡»æœ‰ä¸¤å¤§è¦ç´ ï¼š\n\n1. æ”»å‡»è€…æäº¤æ¶æ„ä»£ç ã€‚\n2. æµè§ˆå™¨æ‰§è¡Œæ¶æ„ä»£ç ã€‚\n\n- ### è¾“å…¥è¿‡æ»¤\n\n  è¾“å…¥ä¾§è¿‡æ»¤èƒ½å¤Ÿåœ¨æŸäº›æƒ…å†µä¸‹è§£å†³ç‰¹å®šçš„ XSS é—®é¢˜ï¼Œä½†ä¼šå¼•å…¥å¾ˆå¤§çš„ä¸ç¡®å®šæ€§å’Œä¹±ç é—®é¢˜ã€‚\n\n  å¯¹äºæ˜ç¡®çš„è¾“å…¥ç±»å‹ï¼Œä¾‹å¦‚æ•°å­—ã€URLã€ç”µè¯å·ç ã€é‚®ä»¶åœ°å€ç­‰ç­‰å†…å®¹ï¼Œè¿›è¡Œè¾“å…¥è¿‡æ»¤è¿˜æ˜¯å¿…è¦çš„ã€‚\n\n  è¾“å…¥è¿‡æ»¤å¹¶éå®Œå…¨å¯é ï¼Œæˆ‘ä»¬å°±è¦é€šè¿‡â€œé˜²æ­¢æµè§ˆå™¨æ‰§è¡Œæ¶æ„ä»£ç â€æ¥é˜²èŒƒ XSSã€‚è¿™éƒ¨åˆ†åˆ†ä¸ºä¸¤ç±»ï¼š\n\n  - é˜²æ­¢ HTML ä¸­å‡ºç°æ³¨å…¥ã€‚\n  - é˜²æ­¢ JavaScript æ‰§è¡Œæ—¶ï¼Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚\n\n- ### é¢„é˜²å­˜å‚¨å‹å’Œåå°„å‹ XSS æ”»å‡»\n\n  é¢„é˜²è¿™ä¸¤ç§æ¼æ´ï¼Œæœ‰ä¸¤ç§å¸¸è§åšæ³•ï¼š\n\n  - æ”¹æˆçº¯å‰ç«¯æ¸²æŸ“ï¼ŒæŠŠä»£ç å’Œæ•°æ®åˆ†éš”å¼€ã€‚\n\n    çº¯å‰ç«¯æ¸²æŸ“çš„è¿‡ç¨‹ï¼š\n\n    1. æµè§ˆå™¨å…ˆåŠ è½½ä¸€ä¸ªé™æ€ HTMLï¼Œæ­¤ HTML ä¸­ä¸åŒ…å«ä»»ä½•è·Ÿä¸šåŠ¡ç›¸å…³çš„æ•°æ®ã€‚\n    2. ç„¶åæµè§ˆå™¨æ‰§è¡Œ HTML ä¸­çš„ JavaScriptã€‚\n    3. JavaScript é€šè¿‡ Ajax åŠ è½½ä¸šåŠ¡æ•°æ®ï¼Œè°ƒç”¨ DOM API æ›´æ–°åˆ°é¡µé¢ä¸Šã€‚\n\n    åœ¨çº¯å‰ç«¯æ¸²æŸ“ä¸­ï¼Œæˆ‘ä»¬ä¼šæ˜ç¡®çš„å‘Šè¯‰æµè§ˆå™¨ï¼šä¸‹é¢è¦è®¾ç½®çš„å†…å®¹æ˜¯æ–‡æœ¬ï¼ˆ`.innerText`ï¼‰ï¼Œè¿˜æ˜¯å±æ€§ï¼ˆ`.setAttribute`ï¼‰ï¼Œè¿˜æ˜¯æ ·å¼ï¼ˆ`.style`ï¼‰ç­‰ç­‰ã€‚æµè§ˆå™¨ä¸ä¼šè¢«è½»æ˜“çš„è¢«æ¬ºéª—ï¼Œæ‰§è¡Œé¢„æœŸå¤–çš„ä»£ç äº†ã€‚\n\n    ä½†çº¯å‰ç«¯æ¸²æŸ“è¿˜éœ€æ³¨æ„é¿å… DOM å‹ XSS æ¼æ´\n\n  - å¯¹ HTML åšå……åˆ†è½¬ä¹‰ã€‚\n\n    **è½¬ä¹‰åº”è¯¥åœ¨è¾“å‡º HTML æ—¶è¿›è¡Œï¼Œè€Œä¸æ˜¯åœ¨æäº¤ç”¨æˆ·è¾“å…¥æ—¶ã€‚**\n\n    å¸¸ç”¨çš„æ¨¡æ¿å¼•æ“ï¼Œå¦‚ doT.jsã€ejsã€FreeMarker ç­‰ï¼Œå¯¹äº HTML è½¬ä¹‰é€šå¸¸åªæœ‰ä¸€ä¸ªè§„åˆ™ï¼Œå°±æ˜¯æŠŠ `& < > \" ' /` è¿™å‡ ä¸ªå­—ç¬¦è½¬ä¹‰æ‰ï¼Œç¡®å®èƒ½èµ·åˆ°ä¸€å®šçš„ XSS é˜²æŠ¤ä½œç”¨ï¼Œä½†å¹¶ä¸å®Œå–„ï¼š\n\n  ![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5yiazcnj31by0giaac.jpg)\n\n- ### é¢„é˜² DOM å‹ XSS æ”»å‡»\n\n  1. åœ¨ä½¿ç”¨ `.innerHTML`ã€`.outerHTML`ã€`document.write()` æ—¶è¦ç‰¹åˆ«å°å¿ƒï¼Œä¸è¦æŠŠä¸å¯ä¿¡çš„æ•°æ®ä½œä¸º HTML æ’åˆ°é¡µé¢ä¸Šï¼Œè€Œåº”å°½é‡ä½¿ç”¨ `.textContent`ã€`.setAttribute()` ç­‰ã€‚\n  2. å¦‚æœç”¨ Vue/React æŠ€æœ¯æ ˆï¼Œå¹¶ä¸”ä¸ä½¿ç”¨ `v-html`/`dangerouslySetInnerHTML` åŠŸèƒ½ï¼Œå°±åœ¨å‰ç«¯ render é˜¶æ®µé¿å… `innerHTML`ã€`outerHTML` çš„ XSS éšæ‚£ã€‚\n  3. DOM ä¸­çš„å†…è”äº‹ä»¶ç›‘å¬å™¨ï¼Œå¦‚ `location`ã€`onclick`ã€`onerror`ã€`onload`ã€`onmouseover` ç­‰ï¼Œ`<a>` æ ‡ç­¾çš„ `href` å±æ€§ï¼ŒJavaScript çš„ `eval()`ã€`setTimeout()`ã€`setInterval()` ç­‰ï¼Œéƒ½èƒ½æŠŠå­—ç¬¦ä¸²ä½œä¸ºä»£ç è¿è¡Œã€‚å¦‚æœä¸å¯ä¿¡çš„æ•°æ®æ‹¼æ¥åˆ°å­—ç¬¦ä¸²ä¸­ä¼ é€’ç»™è¿™äº› APIï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿå®‰å…¨éšæ‚£ï¼Œè¯·åŠ¡å¿…é¿å…ã€‚\n\n## 4.å…¶ä»– XSS é˜²èŒƒæªæ–½\n\n### Content Security Policy\n\nä¸¥æ ¼çš„ CSP åœ¨ XSS çš„é˜²èŒƒä¸­å¯ä»¥èµ·åˆ°ä»¥ä¸‹çš„ä½œç”¨ï¼š\n\n- ç¦æ­¢åŠ è½½å¤–åŸŸä»£ç ï¼Œé˜²æ­¢å¤æ‚çš„æ”»å‡»é€»è¾‘ã€‚\n- ç¦æ­¢å¤–åŸŸæäº¤ï¼Œç½‘ç«™è¢«æ”»å‡»åï¼Œç”¨æˆ·çš„æ•°æ®ä¸ä¼šæ³„éœ²åˆ°å¤–åŸŸã€‚\n- ç¦æ­¢å†…è”è„šæœ¬æ‰§è¡Œï¼ˆè§„åˆ™è¾ƒä¸¥æ ¼ï¼Œç›®å‰å‘ç° GitHub ä½¿ç”¨ï¼‰ã€‚\n- ç¦æ­¢æœªæˆæƒçš„è„šæœ¬æ‰§è¡Œï¼ˆæ–°ç‰¹æ€§ï¼ŒGoogle Map ç§»åŠ¨ç‰ˆåœ¨ä½¿ç”¨ï¼‰ã€‚\n- åˆç†ä½¿ç”¨ä¸ŠæŠ¥å¯ä»¥åŠæ—¶å‘ç° XSSï¼Œåˆ©äºå°½å¿«ä¿®å¤é—®é¢˜ã€‚\n\n### è¾“å…¥å†…å®¹é•¿åº¦æ§åˆ¶\n\nå¯¹äºä¸å—ä¿¡ä»»çš„è¾“å…¥ï¼Œéƒ½åº”è¯¥é™å®šä¸€ä¸ªåˆç†çš„é•¿åº¦ã€‚è™½ç„¶æ— æ³•å®Œå…¨é˜²æ­¢ XSS å‘ç”Ÿï¼Œä½†å¯ä»¥å¢åŠ  XSS æ”»å‡»çš„éš¾åº¦ã€‚\n\n### å…¶ä»–å®‰å…¨æªæ–½\n\n- HTTP-only Cookie: ç¦æ­¢ JavaScript è¯»å–æŸäº›æ•æ„Ÿ Cookieï¼Œæ”»å‡»è€…å®Œæˆ XSS æ³¨å…¥åä¹Ÿæ— æ³•çªƒå–æ­¤ Cookieã€‚\n- éªŒè¯ç ï¼šé˜²æ­¢è„šæœ¬å†’å……ç”¨æˆ·æäº¤å±é™©æ“ä½œã€‚\n\n## 5.XSS æ¼æ´æ€»ç»“\n\n### æ¼æ´æ€»ç»“\n\n- åœ¨ HTML ä¸­å†…åµŒçš„æ–‡æœ¬ä¸­ï¼Œæ¶æ„å†…å®¹ä»¥ script æ ‡ç­¾å½¢æˆæ³¨å…¥ã€‚\n- åœ¨å†…è”çš„ JavaScript ä¸­ï¼Œæ‹¼æ¥çš„æ•°æ®çªç ´äº†åŸæœ¬çš„é™åˆ¶ï¼ˆå­—ç¬¦ä¸²ï¼Œå˜é‡ï¼Œæ–¹æ³•åç­‰ï¼‰ã€‚\n- åœ¨æ ‡ç­¾å±æ€§ä¸­ï¼Œæ¶æ„å†…å®¹åŒ…å«å¼•å·ï¼Œä»è€Œçªç ´å±æ€§å€¼çš„é™åˆ¶ï¼Œæ³¨å…¥å…¶ä»–å±æ€§æˆ–è€…æ ‡ç­¾ã€‚\n- åœ¨æ ‡ç­¾çš„ hrefã€src ç­‰å±æ€§ä¸­ï¼ŒåŒ…å« `javascript:` ç­‰å¯æ‰§è¡Œä»£ç ã€‚\n- åœ¨ onloadã€onerrorã€onclick ç­‰äº‹ä»¶ä¸­ï¼Œæ³¨å…¥ä¸å—æ§åˆ¶ä»£ç ã€‚\n- åœ¨ style å±æ€§å’Œæ ‡ç­¾ä¸­ï¼ŒåŒ…å«ç±»ä¼¼ `background-image:url(\"javascript:...\");` çš„ä»£ç ï¼ˆæ–°ç‰ˆæœ¬æµè§ˆå™¨å·²ç»å¯ä»¥é˜²èŒƒï¼‰ã€‚\n- åœ¨ style å±æ€§å’Œæ ‡ç­¾ä¸­ï¼ŒåŒ…å«ç±»ä¼¼ `expression(...)` çš„ CSS è¡¨è¾¾å¼ä»£ç ï¼ˆæ–°ç‰ˆæœ¬æµè§ˆå™¨å·²ç»å¯ä»¥é˜²èŒƒï¼‰ã€‚\n\næ€»ä¹‹ï¼Œå¦‚æœå¼€å‘è€…æ²¡æœ‰å°†ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬è¿›è¡Œåˆé€‚çš„è¿‡æ»¤ï¼Œå°±è´¸ç„¶æ’å…¥åˆ° HTML ä¸­ï¼Œè¿™å¾ˆå®¹æ˜“é€ æˆæ³¨å…¥æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ¼æ´ï¼Œæ„é€ å‡ºæ¶æ„çš„ä»£ç æŒ‡ä»¤ï¼Œè¿›è€Œåˆ©ç”¨æ¶æ„ä»£ç å±å®³æ•°æ®å®‰å…¨ã€‚\n\n- å†…è” JSON ä¹Ÿæ˜¯ä¸å®‰å…¨çš„ï¼š\n  - å½“ JSON ä¸­åŒ…å« `U+2028` æˆ– `U+2029` è¿™ä¸¤ä¸ªå­—ç¬¦æ—¶ï¼Œä¸èƒ½ä½œä¸º JavaScript çš„å­—é¢é‡ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ›å‡ºè¯­æ³•é”™è¯¯ã€‚\n  - å½“ JSON ä¸­åŒ…å«å­—ç¬¦ä¸² `</script>` æ—¶ï¼Œå½“å‰çš„ script æ ‡ç­¾å°†ä¼šè¢«é—­åˆï¼Œåé¢çš„å­—ç¬¦ä¸²å†…å®¹æµè§ˆå™¨ä¼šæŒ‰ç…§ HTML è¿›è¡Œè§£æï¼›é€šè¿‡å¢åŠ ä¸‹ä¸€ä¸ª `<script>` æ ‡ç­¾ç­‰æ–¹æ³•å°±å¯ä»¥å®Œæˆæ³¨å…¥ã€‚\n\n## 6.å‡å°‘æ¼æ´äº§ç”Ÿçš„åŸåˆ™\n\n- **åˆ©ç”¨æ¨¡æ¿å¼•æ“**\n  å¼€å¯æ¨¡æ¿å¼•æ“è‡ªå¸¦çš„ HTML è½¬ä¹‰åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼š\n  åœ¨ ejs ä¸­ï¼Œå°½é‡ä½¿ç”¨ `<%= data %>` è€Œä¸æ˜¯ `<%- data %>`ï¼›\n  ![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j6vu6iq2j30ns01gjr9.jpg)\n  åœ¨ FreeMarker ä¸­ï¼Œç¡®ä¿å¼•æ“ç‰ˆæœ¬é«˜äº 2.3.24ï¼Œå¹¶ä¸”é€‰æ‹©æ­£ç¡®çš„ `freemarker.core.OutputFormat`ã€‚\n- **é¿å…å†…è”äº‹ä»¶**\n  å°½é‡ä¸è¦ä½¿ç”¨ `onLoad=\"onload('{{data}}')\"`ã€`onClick=\"go('{{action}}')\"` è¿™ç§æ‹¼æ¥å†…è”äº‹ä»¶çš„å†™æ³•ã€‚åœ¨ JavaScript ä¸­é€šè¿‡ `.addEventlistener()` äº‹ä»¶ç»‘å®šä¼šæ›´å®‰å…¨ã€‚\n- **é¿å…æ‹¼æ¥ HTML**\n  å‰ç«¯é‡‡ç”¨æ‹¼æ¥ HTML çš„æ–¹æ³•æ¯”è¾ƒå±é™©ï¼Œå¦‚æœæ¡†æ¶å…è®¸ï¼Œä½¿ç”¨ `createElement`ã€`setAttribute` ä¹‹ç±»çš„æ–¹æ³•å®ç°ã€‚æˆ–è€…é‡‡ç”¨æ¯”è¾ƒæˆç†Ÿçš„æ¸²æŸ“æ¡†æ¶ï¼Œå¦‚ Vue/React ç­‰ã€‚\n- **æ—¶åˆ»ä¿æŒè­¦æƒ•**\n  åœ¨æ’å…¥ä½ç½®ä¸º DOM å±æ€§ã€é“¾æ¥ç­‰ä½ç½®æ—¶ï¼Œè¦æ‰“èµ·ç²¾ç¥ï¼Œä¸¥åŠ é˜²èŒƒã€‚\n- **å¢åŠ æ”»å‡»éš¾åº¦ï¼Œé™ä½æ”»å‡»åæœ**\n  é€šè¿‡ CSPã€è¾“å…¥é•¿åº¦é…ç½®ã€æ¥å£å®‰å…¨æªæ–½ç­‰æ–¹æ³•ï¼Œå¢åŠ æ”»å‡»çš„éš¾åº¦ï¼Œé™ä½æ”»å‡»çš„åæœã€‚\n- **ä¸»åŠ¨æ£€æµ‹å’Œå‘ç°**\n  å¯ä½¿ç”¨ XSS æ”»å‡»å­—ç¬¦ä¸²å’Œè‡ªåŠ¨æ‰«æå·¥å…·å¯»æ‰¾æ½œåœ¨çš„ XSS æ¼æ´ã€‚\n\n## 7.vue react æ¡†æ¶å¯¹ xss çš„é˜²æŠ¤æœ‰åšä»€ä¹ˆï¼Ÿ\n\n- VUE\n\n  - å°½é‡ä½¿ç”¨æ’å€¼è¡¨è¾¾å¼(åŒèŠ±æ‹¬å·)ï¼Œå®ƒä¼šæŠŠè¦æ˜¾ç¤ºçš„å†…å®¹è½¬ä¸ºå­—ç¬¦ä¸²ã€‚\n  - - å¦‚æœä½¿ç”¨`v-html`ï¼Œè¦ä¿è¯æ¥è‡ªæœåŠ¡ç«¯çš„æ¸²æŸ“æ•°æ®éƒ½æ˜¯å®‰å…¨çš„ã€‚\n  - åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹ UI ç»„ä»¶åº“çš„çš„æ—¶å€™ï¼Œè¦æ£€æŸ¥ä¸€ä¸‹å®ƒä»¬æ¸²æŸ“é¡µé¢çš„æ–¹å¼ï¼Œæ˜¯å¦ä½¿ç”¨äº†`v-html`\n\n- REACT\n\n  XSS é˜²å¾¡æªæ–½å°±æ˜¯å¯¹ä»»ä½•ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯è¿›è¡Œå¤„ç†ï¼Œåªå…è®¸åˆæ³•å€¼ï¼Œå…¶å®ƒå€¼ä¸€æ¦‚è¿‡æ»¤æ‰\n\n  1. æ‰€æœ‰çš„ç”¨æˆ·è¾“å…¥éƒ½éœ€è¦ç»è¿‡ HTML å®ä½“ç¼–ç ï¼ŒReact å·²ç»åšäº†ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»º DOM èŠ‚ç‚¹ç„¶åå¡«å…¥æ–‡æœ¬å†…å®¹ (ä¹Ÿå¯ä»¥å¼ºåˆ¶è®¾ç½® HTML å†…å®¹ï¼Œä¸è¿‡è¿™æ ·æ¯”è¾ƒå±é™©)\n  2. åºåˆ—åŒ–æŸäº›çŠ¶æ€å¹¶ä¸”ä¼ ç»™å®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œä¹Ÿè¿›è¡Œ HTML å®ä½“ç¼–ç ï¼Œå¯ä»¥ä½¿ç”¨ Yahoo çš„ Serialize JavaScript ä¸­çš„ serialize æ–¹æ³•æ›¿æ¢ JSON.stringify æ–¹æ³•ï¼ŒSerialize JavaScript ä¸­çš„æ–¹æ³•ä¼šè‡ªåŠ¨å°† HTML å’Œ JavaScript ä»£ç è¿›è¡Œè½¬ç ï¼ŒGitHub è®¿é—®åœ°å€ : https://github.com/yahoo/serialize-javascript\n\n  é»˜è®¤æƒ…å†µä¸‹ï¼ŒReact DOM åœ¨é‡æ–°æ¸²æŸ“é¡µé¢æ—¶å°†æ‰€æœ‰è¿›è¡Œè½¬ç ï¼Œå®˜æ–¹å®£ç§°åœ¨ React åº”ç”¨ä¸­ç¡®ä¿ä¸ä¼šæ³¨å…¥ä»»ä½•æ²¡æ˜¾å¼ç¼–å†™çš„æ•°æ®ï¼Œæ‰€æœ‰çš„æ•°æ®åœ¨é¡µé¢æ¸²æŸ“ä¹‹å‰éƒ½ä¼šè¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œè¿™é˜²æ­¢ XSS è¿›æ”»\n\n## 8.xss æ”»å‡»åæœï¼Ÿ\n\næ¶æ„ä»£ç æœªç»è¿‡æ»¤ï¼Œä¸ç½‘ç«™æ­£å¸¸çš„ä»£ç æ··åœ¨ä¸€èµ·ï¼›æµè§ˆå™¨æ— æ³•åˆ†è¾¨å“ªäº›è„šæœ¬æ˜¯å¯ä¿¡çš„ï¼Œå¯¼è‡´æ¶æ„è„šæœ¬è¢«æ‰§è¡Œã€‚\n\nè€Œç”±äºç›´æ¥åœ¨ç”¨æˆ·çš„ç»ˆç«¯æ‰§è¡Œï¼Œæ¶æ„ä»£ç èƒ½å¤Ÿç›´æ¥è·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œæˆ–è€…åˆ©ç”¨è¿™äº›ä¿¡æ¯å†’å……ç”¨æˆ·å‘ç½‘ç«™å‘èµ·æ”»å‡»è€…å®šä¹‰çš„è¯·æ±‚ã€‚\n\n## 9.éœ€è¦è½¬ä¹‰çš„å­—ç¬¦ï¼Ÿ\n\n- `escapeHTML()` æŒ‰ç…§å¦‚ä¸‹è§„åˆ™è¿›è¡Œè½¬ä¹‰ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5yh9feqj30ne0gqglm.jpg)\n\n- è¿ `javascript:` è¿™æ ·çš„å­—ç¬¦ä¸²å¦‚æœå‡ºç°åœ¨ç‰¹å®šçš„ä½ç½®ä¹Ÿä¼šå¼•å‘ XSS æ”»å‡»ã€‚\n\n  `%20javascript:alert('XSS')` ç»è¿‡ URL è§£æåå˜æˆ `javascript:alert('XSS')`ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ä»¥ç©ºæ ¼å¼€å¤´ã€‚è¿™æ ·æ”»å‡»è€…å¯ä»¥ç»•è¿‡åç«¯çš„å…³é”®è¯è§„åˆ™ï¼ŒåˆæˆåŠŸçš„å®Œæˆäº†æ³¨å…¥ã€‚\n\n- æ’å…¥ JSON çš„åœ°æ–¹ä¸èƒ½ä½¿ç”¨ `escapeHTML()`ï¼Œå› ä¸ºè½¬ä¹‰ `\"` åï¼ŒJSON æ ¼å¼ä¼šè¢«ç ´åã€‚\n\n  è¦å®ç°ä¸€ä¸ª `escapeEmbedJSON()` å‡½æ•°ï¼Œå¯¹å†…è” JSON è¿›è¡Œè½¬ä¹‰ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j5ygpakdj31bk0csq2y.jpg)\n","tags":["JavaScript","å®‰å…¨"],"categories":["å®‰å…¨"]},{"title":"ES6 çš„æ–°ç‰¹æ€§æ€»ç»“","url":"/2019/06/01/ES6 çš„æ–°ç‰¹æ€§æ€»ç»“/","content":"\n# ES6 çš„æ–°ç‰¹æ€§\n\n## 1. æ•°ç»„çš„æ‹“å±•\n\n### æ•°ç»„çš„æ–¹æ³•\n\n- `array.concat(array1, array2,â€¦arrayN)`åˆå¹¶å¤šä¸ªæ•°ç»„ï¼Œè¿”å›åˆå¹¶åçš„æ–°æ•°ç»„ï¼ŒåŸæ•°ç»„æ²¡æœ‰å˜åŒ–ã€‚\n- `array.every(callback[, thisArg])`æ£€æµ‹æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æ˜¯å¦éƒ½é€šè¿‡äº† callback æµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚\n- `array.filter(callback[, thisArg])`è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼ŒåŒ…å«é€šè¿‡ callback å‡½æ•°æµ‹è¯•çš„æ‰€æœ‰å…ƒç´ ã€‚(callback å®šä¹‰ï¼Œä¸‰ä¸ªå‚æ•°ï¼š element:å½“å‰å…ƒç´ å€¼ï¼›indexï¼šå½“å‰å…ƒç´ ä¸‹æ ‡ï¼› array:å½“å‰æ•°ç»„)\n- `array.find(callback[, thisArg])`è¿”å›é€šè¿‡ callback å‡½æ•°æµ‹è¯•çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦åˆ™è¿”å› undefinedï¼Œcallback å‡½æ•°å®šä¹‰åŒä¸Šã€‚\n  <!-- more -->\n- `array.findIndex(callback[, thisArg])`è¿”å›é€šè¿‡ callback å‡½æ•°æµ‹è¯•çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œå¦åˆ™è¿”å›-1ï¼Œcallback å‡½æ•°å®šä¹‰åŒä¸Šã€‚\n- `array.includes(searchElement, fromIndex)`includes() æ–¹æ³•ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œè¿”å› true æˆ– falseã€‚searchElementï¼šè¦æŸ¥æ‰¾çš„å…ƒç´ ï¼›fromIndexï¼šå¼€å§‹æŸ¥æ‰¾çš„ç´¢å¼•ä½ç½®ã€‚\n- `array.indexOf(searchElement[, fromIndex = 0])`è¿”å›åœ¨æ•°ç»„ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç»™å®šå…ƒç´ çš„ç¬¬ä¸€ä¸ªç´¢å¼•ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›-1ã€‚searchElementï¼šè¦æŸ¥æ‰¾çš„å…ƒç´ ï¼›fromIndexï¼šå¼€å§‹æŸ¥æ‰¾çš„ç´¢å¼•ä½ç½®ã€‚\n- `array.join(separator=',')`å°†æ•°ç»„ä¸­çš„å…ƒç´ é€šè¿‡ separator è¿æ¥æˆå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›è¯¥å­—ç¬¦ä¸²ï¼Œseparator é»˜è®¤ä¸º\",\"ã€‚\n- `array.map(callback[, thisArg])`è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œæ–°æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯è°ƒç”¨ callback å‡½æ•°åè¿”å›çš„ç»“æœã€‚æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰ return å€¼ï¼Œåˆ™æ–°æ•°ç»„ä¼šæ’å…¥ä¸€ä¸ª undefined å€¼ã€‚array.map ç”±äºä¸å…·æœ‰è¿‡æ»¤çš„åŠŸèƒ½ï¼Œå› æ­¤ array è°ƒç”¨ map å‡½æ•°æ—¶ï¼Œå¦‚æœ array ä¸­çš„æ•°æ®å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªéƒ½ä¼š returnï¼Œåˆ™å¿…é¡»å…ˆ filterï¼Œç„¶åå† mapï¼Œå³ map è°ƒç”¨æ—¶å¿…é¡»æ˜¯å¯¹æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æœ‰æ•ˆã€‚\n- `array.pop() ä¸ array.shift()`pop ä¸ºä»æ•°ç»„ä¸­åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›æœ€åä¸€ä¸ªå…ƒç´ çš„å€¼ï¼ŒåŸæ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ è¢«åˆ é™¤ã€‚æ•°ç»„ä¸ºç©ºæ—¶è¿”å› undefinedã€‚shift åˆ é™¤æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ŒåŸæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ è¢«åˆ é™¤ã€‚æ•°ç»„ä¸ºç©ºè¿”å› undefinedã€‚\n- `array.push(element1, element2, ....elementN) ä¸ array.unshift(element1, element2, ...elementN)`push æ˜¯å°†ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„æœ«å°¾ï¼Œå¹¶è¿”å›æ–°æ•°ç»„çš„é•¿åº¦; unshift å°†ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æ·»åŠ åˆ°æ•°ç»„çš„å¼€å¤´ï¼Œå¹¶è¿”å›æ–°æ•°ç»„çš„é•¿åº¦ã€‚å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯æ’å…¥çš„ä½ç½®ä¸åŒã€‚\n- `array.reduce(callback[, initialValue])`å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼ˆä»å·¦åˆ°å³ï¼‰æ‰§è¡Œ callback å‡½æ•°ç´¯åŠ ï¼Œå°†å…¶å‡å°‘ä¸ºå•ä¸ªå€¼ã€‚\n- `array.reverse()`å°†æ•°ç»„ä¸­å…ƒç´ çš„ä½ç½®é¢ å€’ã€‚\n- `array.slice(begin, end)`è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼ŒåŒ…å«åŸæ•°ç»„ä» begin åˆ° end(ä¸åŒ…å« end)ç´¢å¼•ä½ç½®çš„æ‰€æœ‰å…ƒç´ ã€‚\n- `array.some(callback[, thisArg])`åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦åŒ…å«å¯ä»¥é€šè¿‡ callback æµ‹è¯•çš„å…ƒç´ ï¼Œä¸ every ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œåªè¦æŸä¸€ä¸ªå…ƒç´ é€šè¿‡æµ‹è¯•ï¼Œå³è¿”å› trueã€‚callback å®šä¹‰åŒä¸Šã€‚\n- `array.sort([compareFunction])`å¯¹æ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºï¼ŒcompareFunction ä¸å­˜åœ¨æ—¶ï¼Œå…ƒç´ æŒ‰ç…§è½¬æ¢ä¸ºçš„å­—ç¬¦ä¸²çš„è¯¸ä¸ªå­—ç¬¦çš„ Unicode ä½ç‚¹è¿›è¡Œæ’åºï¼Œæ…ç”¨ï¼è¯·ä½¿ç”¨æ—¶ä¸€å®šè¦åŠ  compareFunction å‡½æ•°ï¼Œè€Œä¸”è¯¥æ’åºæ˜¯ä¸ç¨³å®šçš„ã€‚\n- `array.splice(start[, deleteCount, item1, item2, ...])`é€šè¿‡åˆ é™¤ç°æœ‰å…ƒç´ å’Œ/æˆ–æ·»åŠ æ–°å…ƒç´ æ¥æ›´æ”¹ä¸€ä¸ªæ•°ç»„çš„å†…å®¹ã€‚start:æŒ‡å®šä¿®æ”¹çš„å¼€å§‹ä½ç½®ï¼›deleteCountï¼šä» start ä½ç½®å¼€å§‹è¦åˆ é™¤çš„å…ƒç´ ä¸ªæ•°ï¼›item...ï¼šè¦æ·»åŠ è¿›æ•°ç»„çš„å…ƒç´ ,ä» start ä½ç½®å¼€å§‹ã€‚è¿”å›å€¼æ˜¯ç”±è¢«åˆ é™¤çš„å…ƒç´ ç»„æˆçš„ä¸€ä¸ªæ•°ç»„ã€‚å¦‚æœåªåˆ é™¤äº†ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™è¿”å›åªåŒ…å«ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„ã€‚å¦‚æœæ²¡æœ‰åˆ é™¤å…ƒç´ ï¼Œåˆ™è¿”å›ç©ºæ•°ç»„ã€‚å¦‚æœ deleteCount å¤§äº start ä¹‹åçš„å…ƒç´ çš„æ€»æ•°ï¼Œåˆ™ä» start åé¢çš„å…ƒç´ éƒ½å°†è¢«åˆ é™¤ï¼ˆå«ç¬¬ start ä½ï¼‰ã€‚\n\næ³¨ï¼špushã€ shiftã€ popã€ unshiftã€ reverseã€ sortã€ splice æ–¹æ³•ä¼šå¯¹åŸæ¥çš„æ•°ç»„è¿›è¡Œä¿®æ”¹ï¼Œå…¶ä»–çš„æ•°ç»„æ“ä½œæ–¹æ³•åªæœ‰è¿”å›å€¼ä¸åŒï¼Œå¯¹åŸæ•°ç»„éƒ½æ²¡æœ‰å½±å“ï¼Œå³åŸæ•°ç»„ä¸å˜ã€‚\n\n### ES6 ä¸­å¯¹æ•°ç»„çš„æ‰©å±•\n\n- Array.from() : å°†ä¼ªæ•°ç»„å¯¹è±¡æˆ–å¯éå†å¯¹è±¡è½¬æ¢ä¸ºçœŸæ•°ç»„\n\n- Array.of(v1, v2, v3) : å°†ä¸€ç³»åˆ—å€¼è½¬æ¢æˆæ•°ç»„ã€‚\n\n  å½“ä½¿ç”¨å•ä¸ªæ•°å€¼å‚æ•°æ¥è°ƒç”¨ Array æ„é€ å™¨æ—¶ï¼Œæ•°ç»„çš„é•¿åº¦å±æ€§ä¼šè¢«è®¾ç½®ä¸ºè¯¥å‚æ•°ã€‚ å¦‚æœä½¿ç”¨å¤šä¸ªå‚æ•°(æ— è®ºæ˜¯å¦ä¸ºæ•°å€¼ç±»å‹)æ¥è°ƒç”¨ï¼Œè¿™äº›å‚æ•°ä¹Ÿä¼šæˆä¸ºç›®æ ‡æ•°ç»„çš„é¡¹ã€‚æ•°ç»„çš„è¿™ç§è¡Œä¸ºæ—¢æ··ä¹±åˆæœ‰é£é™©ï¼Œå› ä¸ºæœ‰æ—¶å¯èƒ½ä¸ä¼šç•™æ„æ‰€ä¼ å‚æ•°çš„ç±»å‹ã€‚\n\n  Array.of( )æ–¹æ³•æ€»ä¼šåˆ›å»ºä¸€ä¸ªåŒ…å«æ‰€æœ‰ä¼ å…¥å‚æ•°çš„æ•°ç»„ï¼Œè€Œä¸ç®¡å‚æ•°çš„æ•°é‡ä¸ç±»å‹\n\n  ```javascript\n  let items = Array.of(1, 2);\n  console.log(items.length); // 2\n  console.log(items[0]); // 1\n  console.log(items[1]); // 2\n  items = Array.of(2);\n  console.log(items.length); // 1\n  console.log(items[0]); // 2\n  ```\n\n  Array.of åŸºæœ¬ä¸Šå¯ä»¥ç”¨æ¥æ›¿ä»£ Array()æˆ– newArray()ï¼Œå¹¶ä¸”ä¸å­˜åœ¨ç”±äºå‚æ•°ä¸åŒè€Œå¯¼è‡´çš„é‡è½½ï¼Œè€Œä¸”ä»–ä»¬çš„è¡Œä¸ºéå¸¸ç»Ÿä¸€ã€‚\n\n- æ•°ç»„å®ä¾‹çš„ find() å’Œ findIndex()\n\n  - find æ–¹æ³•ï¼Œç”¨äºæ‰¾å‡ºç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„æˆå‘˜ã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ‰€æœ‰æ•°ç»„æˆå‘˜ä¾æ¬¡æ‰§è¡Œè¯¥å›è°ƒå‡½æ•°ï¼Œç›´åˆ°æ‰¾å‡ºç¬¬ä¸€ä¸ªè¿”å›å€¼ä¸º true çš„æˆå‘˜ï¼Œç„¶åè¿”å›è¯¥æˆå‘˜ã€‚å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æˆå‘˜ï¼Œåˆ™è¿”å› undefinedã€‚\n\n    ```javascript\n    [1, 4, -5, 10].find(n => n < 0); // -5\n    ```\n\n* findIndex æ–¹æ³•çš„ç”¨æ³•ä¸ find æ–¹æ³•éå¸¸ç±»ä¼¼ï¼Œè¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„æˆå‘˜çš„ä½ç½®ï¼Œå¦‚æœæ‰€æœ‰æˆå‘˜éƒ½ä¸ç¬¦åˆæ¡ä»¶ï¼Œåˆ™è¿”å›-1ã€‚\n\n  ```javascript\n  [1, 5, 10, 15].findIndex(function(value, index, arr) {\n    return value > 9;\n  }); // 2\n  ```\n\n* æ•°ç»„å®ä¾‹çš„ includes()\n\n  Array.prototype.includes æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ç»™å®šçš„å€¼ã€‚è¯¥æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæœç´¢çš„èµ·å§‹ä½ç½®ï¼Œé»˜è®¤ä¸º 0ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸ºè´Ÿæ•°ï¼Œåˆ™è¡¨ç¤ºå€’æ•°çš„ä½ç½®ï¼Œå¦‚æœè¿™æ—¶å®ƒå¤§äºæ•°ç»„é•¿åº¦ï¼ˆæ¯”å¦‚ç¬¬äºŒä¸ªå‚æ•°ä¸º-4ï¼Œä½†æ•°ç»„é•¿åº¦ä¸º 3ï¼‰ï¼Œåˆ™ä¼šé‡ç½®ä¸ºä» 0 å¼€å§‹ã€‚\n\n  ```javascript\n  [1, 2, 3]\n    .includes(2) // true\n    [(1, 2, 3)].includes(3, -1); // true\n  [1, 2, 3, 5, 1].includes(1, 2); // true\n  ```\n\n  æ²¡æœ‰è¯¥æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨æ•°ç»„çš„ indexOf æ–¹æ³•ï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«æŸä¸ªå€¼ã€‚å®ƒå†…éƒ¨ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ===ï¼‰è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¼šå¯¼è‡´å¯¹ NaN çš„è¯¯åˆ¤ã€‚\n\n  ```javascript\n  [NaN]\n    .indexOf(NaN) // -1\n    [NaN].includes(NaN); // true\n  ```\n\n* æ•°ç»„å®ä¾‹çš„ entries()ï¼Œkeys() å’Œ values()\n\n  å®ƒä»¬éƒ½è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå¯ä»¥ç”¨ for...of å¾ªç¯è¿›è¡Œéå†ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ keys()æ˜¯å¯¹é”®åçš„éå†ã€values()æ˜¯å¯¹é”®å€¼çš„éå†ï¼Œentries()æ˜¯å¯¹é”®å€¼å¯¹çš„éå†ã€‚\n\n  ```javascript\n  for (let index of [\"a\", \"b\"].keys()) {\n    console.log(index);\n  }\n  // 0\n  // 1\n\n  for (let elem of [\"a\", \"b\"].values()) {\n    console.log(elem);\n  }\n  // 'a'\n  // 'b'\n\n  for (let [index, elem] of [\"a\", \"b\"].entries()) {\n    console.log(index, elem);\n  }\n  // 0 \"a\"\n  // 1 \"b\"\n  ```\n\n## 2. ç®­å¤´å‡½æ•°\n\n- ç¼©å‡ä»£ç å’Œæ”¹å˜ this æŒ‡å‘\n- ä½¿ç”¨æ³¨æ„ç‚¹ï¼š\n  - å‡½æ•°ä½“å†…çš„ this å¯¹è±¡ï¼Œå°±æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ—¶æ‰€åœ¨çš„å¯¹è±¡ã€‚\n  - ä¸å¯ä»¥å½“ä½œæ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯ä»¥ä½¿ç”¨ new å‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚\n  - ä¸å¯ä»¥ä½¿ç”¨ arguments å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨å‡½æ•°ä½“å†…ä¸å­˜åœ¨ã€‚å¦‚æœè¦ç”¨ï¼Œå¯ä»¥ç”¨ rest å‚æ•°ä»£æ›¿ã€‚\n  - ä¸å¯ä»¥ä½¿ç”¨ yield å‘½ä»¤ï¼Œå› æ­¤ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œ Generator å‡½æ•°ã€‚\n\n## 3. rest å‚æ•°\n\n- ç”¨äºè·å–å‡½æ•°çš„å¤šä½™å‚æ•°ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä½¿ç”¨ arguments å¯¹è±¡äº†ã€‚rest å‚æ•°æ­é…çš„å˜é‡æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥å˜é‡å°†å¤šä½™çš„å‚æ•°æ”¾å…¥æ•°ç»„ä¸­ã€‚\n- æ³¨æ„ç‚¹ï¼š\n  - æ¯ä¸ªå‡½æ•°æœ€å¤šåªèƒ½å£°æ˜ä¸€ä¸ª rest å‚æ•°ï¼Œè€Œä¸” rest å‚æ•°å¿…é¡»æ˜¯æœ€åä¸€ä¸ªå‚æ•°ï¼Œå¦åˆ™æŠ¥é”™ã€‚\n  - rest å‚æ•°ä¸èƒ½ç”¨äºå¯¹è±¡å­—é¢é‡ setter ä¹‹ä¸­\n\n## 4. å±•å¼€è¿ç®—ç¬¦\n\nå‰©ä½™å‚æ•°å…è®¸ä½ æŠŠå¤šä¸ªç‹¬ç«‹çš„å‚æ•°åˆå¹¶åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼›è€Œæ‰©å±•è¿ç®—ç¬¦åˆ™å…è®¸å°†ä¸€ä¸ªæ•°ç»„åˆ†å‰²ï¼Œå¹¶å°†å„ä¸ªé¡¹ä½œä¸ºåˆ†ç¦»çš„å‚æ•°ä¼ ç»™å‡½æ•°ã€‚\n\n## 5. è§£æ„èµ‹å€¼----æ›´æ–¹ä¾¿çš„æ•°æ®è®¿é—®\n\n## 6. æ¨¡æ¿å­—ç¬¦ä¸²\n\nç”¨åå¼•å·ï¼ˆ`ï¼‰æ ‡è¯†ã€‚å®ƒå¯ä»¥å½“ä½œæ™®é€šå­—ç¬¦ä¸²ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å®šä¹‰å¤šè¡Œå­—ç¬¦ä¸²ï¼Œæˆ–è€…åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡ã€‚æ¨¡æ¿å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡å’Œå‡½æ•°ï¼Œéœ€è¦å°†å˜é‡åå†™åœ¨\\${}ä¹‹ä¸­ã€‚\n\n## 7. class ç±»\n\n## 8. promise\n\n## 9. Iterator å’Œ for...of å¾ªç¯\n\nJavaScript åŸæœ‰çš„è¡¨ç¤ºâ€œé›†åˆâ€çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦æ˜¯æ•°ç»„ï¼ˆArrayï¼‰å’Œå¯¹è±¡ï¼ˆObjectï¼‰ï¼ŒES6 æ·»åŠ äº† Map å’Œ Setã€‚\n\nä»»ä½•æ•°æ®ç»“æ„åªè¦éƒ¨ç½² Iterator æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œï¼ˆå³ä¾æ¬¡å¤„ç†è¯¥æ•°æ®ç»“æ„çš„æ‰€æœ‰æˆå‘˜ï¼‰ã€‚\n\n- Iterator çš„ä½œç”¨ï¼š\n  - ä¸ºå„ç§æ•°æ®ç»“æ„ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ã€ç®€ä¾¿çš„è®¿é—®æ¥å£ï¼›\n  - ä½¿å¾—æ•°æ®ç»“æ„çš„æˆå‘˜èƒ½å¤ŸæŒ‰æŸç§æ¬¡åºæ’åˆ—\n  - ES6 åˆ›é€ äº†ä¸€ç§æ–°çš„éå†å‘½ä»¤ for...of å¾ªç¯ï¼ŒIterator æ¥å£ä¸»è¦ä¾› for...of æ¶ˆè´¹ã€‚\n- åŸç”Ÿå…·å¤‡ iterator æ¥å£çš„æ•°æ®(å¯ç”¨ for of éå†)\n  - Array\n  - set å®¹å™¨\n  - map å®¹å™¨\n  - String\n  - å‡½æ•°çš„ arguments å¯¹è±¡\n  - NodeList å¯¹è±¡\n- å‡ ç§éå†æ–¹å¼æ¯”è¾ƒ\n  - for of å¾ªç¯ä¸ä»…æ”¯æŒæ•°ç»„ã€å¤§å¤šæ•°ä¼ªæ•°ç»„å¯¹è±¡ï¼Œä¹Ÿæ”¯æŒå­—ç¬¦ä¸²éå†ï¼Œæ­¤å¤–è¿˜æ”¯æŒ Map å’Œ Set å¯¹è±¡éå†\n  - for in å¾ªç¯å¯ä»¥éå†å­—ç¬¦ä¸²ã€å¯¹è±¡ã€æ•°ç»„ï¼Œä¸èƒ½éå† Set/Map\n  - forEach å¾ªç¯ä¸èƒ½éå†å­—ç¬¦ä¸²ã€å¯¹è±¡,å¯ä»¥éå† Set/Map\n\n## 10. ES6 æ¨¡å—åŒ–\n\nå…¶æ¨¡å—åŠŸèƒ½ä¸»è¦ç”±ä¸¤ä¸ªå‘½ä»¤æ„æˆï¼šexport å’Œ importã€‚export å‘½ä»¤ç”¨äºè§„å®šæ¨¡å—çš„å¯¹å¤–æ¥å£ï¼Œimport å‘½ä»¤ç”¨äºè¾“å…¥å…¶ä»–æ¨¡å—æä¾›çš„åŠŸèƒ½ã€‚\n","tags":["JavaScript","ES6"],"categories":["ES6"]},{"title":"CSSå…ƒç´ å±…ä¸­","url":"/2019/05/23/CSSå…ƒç´ å±…ä¸­/","content":"\n# CSS å…ƒç´ å±…ä¸­\n\n## 1.æ°´å¹³å±…ä¸­\n\n- ### è¡Œå†…å…ƒç´ æ°´å¹³å±…ä¸­\n\n**åˆ©ç”¨ text-align: center å¯ä»¥å®ç°åœ¨å—çº§å…ƒç´ å†…éƒ¨çš„è¡Œå†…å…ƒç´ æ°´å¹³å±…ä¸­**ã€‚æ­¤æ–¹æ³•å¯¹ inlineã€inline-blockã€inline-table å’Œ inline-flex å…ƒç´ æ°´å¹³å±…ä¸­éƒ½æœ‰æ•ˆã€‚\n\n<!-- more -->\n\n```css\n.parent {\n  //åœ¨çˆ¶å®¹å™¨è®¾ç½®\n  text-align: center;\n}\n```\n\næ­¤å¤–ï¼Œå¦‚æœå—çº§å…ƒç´ å†…éƒ¨åŒ…ç€ä¹Ÿæ˜¯ä¸€ä¸ªå—çº§å…ƒç´ ï¼Œ**æˆ‘ä»¬å¯ä»¥å…ˆå°†å…¶ç”±å—çº§å…ƒç´ æ”¹å˜ä¸ºè¡Œå†…å—å…ƒç´ ï¼Œå†é€šè¿‡è®¾ç½®è¡Œå†…å—å…ƒç´ å±…ä¸­ä»¥è¾¾åˆ°æ°´å¹³å±…ä¸­**ã€‚\n\n```html\n<div class=\"parent\">\n  <div class=\"child\">Demo</div>\n</div>\n<style>\n  .parent {\n    text-align: center;\n  }\n  .child {\n    display: inline-block;\n  }\n</style>\n```\n\n- ### å—çº§å…ƒç´ çš„æ°´å¹³å±…ä¸­\n\nè¿™ç§æƒ…å½¢å¯ä»¥æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œä¸‹é¢æˆ‘ä»¬è¯¦ç»†ä»‹ç»:\n\n#### â‘  å°†è¯¥å—çº§å…ƒç´ å·¦å³å¤–è¾¹è· margin-left å’Œ margin-right è®¾ç½®ä¸º auto\n\n```css\n.child {\n  width: 100px; //ç¡®ä¿è¯¥å—çº§å…ƒç´ å®šå®½\n  margin: 0 auto;\n}\n```\n\n#### â‘¡ ä½¿ç”¨ table+margin\n\nå…ˆå°†å­å…ƒç´ è®¾ç½®ä¸ºå—çº§è¡¨æ ¼æ¥æ˜¾ç¤ºï¼ˆç±»ä¼¼ï¼‰ï¼Œå†å°†å…¶è®¾ç½®æ°´å¹³å±…ä¸­\n\ndisplay:table åœ¨è¡¨ç°ä¸Šç±»ä¼¼ block å…ƒç´ ï¼Œä½†æ˜¯å®½åº¦ä¸ºå†…å®¹å®½ã€‚\n\n```html\n<div class=\"parent\">\n  <div class=\"child\">Demo</div>\n</div>\n<style>\n  .child {\n    display: table;\n    margin: 0 auto;\n  }\n</style>\n```\n\n#### â‘¢ ä½¿ç”¨ absolute+transform\n\nå…ˆå°†çˆ¶å…ƒç´ è®¾ç½®ä¸ºç›¸å¯¹å®šä½ï¼Œå†å°†å­å…ƒç´ è®¾ç½®ä¸ºç»å¯¹å®šä½ï¼Œå‘å³ç§»åŠ¨å­å…ƒç´ ï¼Œç§»åŠ¨è·ç¦»ä¸ºçˆ¶å®¹å™¨çš„ä¸€åŠï¼Œæœ€åé€šè¿‡å‘å·¦ç§»åŠ¨å­å…ƒç´ çš„ä¸€åŠå®½åº¦ä»¥è¾¾åˆ°æ°´å¹³å±…ä¸­ã€‚\n\n```html\n<div class=\"parent\">\n  <div class=\"child\">Demo</div>\n</div>\n<style>\n  .child {\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n  }\n  .parent {\n    position: relative;\n  }\n</style>\n```\n\nä¸è¿‡ transform å±äº css3 å†…å®¹ï¼Œå…¼å®¹æ€§å­˜åœ¨ä¸€å®šé—®é¢˜ï¼Œé«˜ç‰ˆæœ¬æµè§ˆå™¨éœ€è¦æ·»åŠ ä¸€äº›å‰ç¼€\n\n#### â‘£ ä½¿ç”¨ flex+justify-content\n\né€šè¿‡ CSS3 ä¸­çš„å¸ƒå±€åˆ©å™¨ flex ä¸­çš„ justify-content å±æ€§æ¥è¾¾åˆ°æ°´å¹³å±…ä¸­ã€‚\n\n```html\n<div class=\"parent\">\n  <div class=\"child\">Demo</div>\n</div>\n<style>\n  .parent {\n    display: flex;\n    justify-content: center;\n  }\n</style>\n```\n\n#### â‘¤ ä½¿ç”¨ flex+margin\n\né€šè¿‡ flex å°†çˆ¶å®¹å™¨è®¾ç½®ä¸ºä¸º Flex å¸ƒå±€ï¼Œå†è®¾ç½®å­å…ƒç´ å±…ä¸­ã€‚\n\n```\n<div class=\"parent\">\n  <div class=\"child\">Demo</div>\n</div>\n<style>\n  .parent {\n    display: flex;\n  }\n  .child {\n    margin:0 auto;\n  }\n</style>\n```\n\n- ### å¤šå—çº§å…ƒç´ æ°´å¹³å±…ä¸­\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iywusnatj30gg03q3yv.jpg)\n\n#### â‘  åˆ©ç”¨ flex å¸ƒå±€\n\n**åˆ©ç”¨å¼¹æ€§å¸ƒå±€(flex)ï¼Œå®ç°æ°´å¹³å±…ä¸­ï¼Œå…¶ä¸­ justify-content ç”¨äºè®¾ç½®å¼¹æ€§ç›’å­å…ƒç´ åœ¨ä¸»è½´ï¼ˆé»˜è®¤æ¨ªè½´ï¼‰æ–¹å‘ä¸Šçš„å¯¹é½æ–¹å¼**ï¼Œæœ¬ä¾‹ä¸­è®¾ç½®å­å…ƒç´ æ°´å¹³å±…ä¸­æ˜¾ç¤ºã€‚\n\n```css\n#container {\n  display: flex;\n  justify-content: center;\n}\n```\n\n#### â‘¡ åˆ©ç”¨ inline-block\n\nå°†è¦æ°´å¹³æ’åˆ—çš„å—çŠ¶å…ƒç´ è®¾ä¸º display:inline-blockï¼Œç„¶ååœ¨çˆ¶çº§å…ƒç´ ä¸Šè®¾ç½® text-align:centerï¼Œè¾¾åˆ°ä¸ä¸Šé¢çš„è¡Œå†…å…ƒç´ çš„æ°´å¹³å±…ä¸­ä¸€æ ·çš„æ•ˆæœã€‚\n\n```css\n.container {\n  text-align: center;\n}\n.inline-block {\n  display: inline-block;\n}\n```\n\n- ### æµ®åŠ¨å…ƒç´ æ°´å¹³å±…ä¸­\n\n  - å¯¹äºå®šå®½çš„æµ®åŠ¨å…ƒç´ ï¼Œé€šè¿‡å­å…ƒç´ è®¾ç½® relative + è´Ÿ margin\n  - å¯¹äºä¸å®šå®½çš„æµ®åŠ¨å…ƒç´ ï¼Œçˆ¶å­å®¹å™¨éƒ½ç”¨ç›¸å¯¹å®šä½\n  - é€šç”¨æ–¹æ³•(ä¸ç®¡æ˜¯å®šå®½è¿˜æ˜¯ä¸å®šå®½)ï¼šflex å¸ƒå±€\n\n#### â‘  å®šå®½çš„éæµ®åŠ¨å…ƒç´ \n\n**é€šè¿‡å­å…ƒç´ è®¾ç½® relative + è´Ÿ margin,åŸç†è§ä¸‹å›¾ï¼š**\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iyzsq98xj30i80acmx5.jpg)\n**æ³¨æ„ï¼šæ ·å¼è®¾ç½®åœ¨æµ®åŠ¨å…ƒç´ æœ¬èº«**\n\n```html\n.child { position:relative; left:50%; margin-left:-250px; }\n<div class=\"parent\">\n  <span class=\"child\" style=\"float: left;width: 500px;\"\n    >æˆ‘æ˜¯è¦å±…ä¸­çš„æµ®åŠ¨å…ƒç´ </span\n  >\n</div>\n```\n\n#### â‘¡ ä¸å®šå®½çš„æµ®åŠ¨å…ƒç´ \n\né€šè¿‡çˆ¶å­å®¹å™¨éƒ½ç›¸å¯¹å®šä½ï¼Œåç§»ä½ç§»è§ä¸‹å›¾ï¼š\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iyxlpetcj30pw06tmx8.jpg)\n**æ³¨æ„ï¼šè¦æ¸…é™¤æµ®åŠ¨ï¼Œç»™å¤–éƒ¨å…ƒç´ åŠ ä¸Š floatã€‚è¿™é‡Œçš„çˆ¶å…ƒç´ å°±æ˜¯å¤–éƒ¨å…ƒç´ **\n\n```html\n<div class=\"box\">\n  <p>æˆ‘æ˜¯æµ®åŠ¨çš„</p>\n  <p>æˆ‘ä¹Ÿæ˜¯å±…ä¸­çš„</p>\n</div>\n.box{ float:left; position:relative; left:50%; } p{ float:left;\nposition:relative; right:50%; }\n```\n\n#### â‘¢ é€šç”¨åŠæ³• flex å¸ƒå±€(ä¸ç®¡æ˜¯å®šå®½è¿˜æ˜¯ä¸å®šå®½)\n\n**åˆ©ç”¨å¼¹æ€§å¸ƒå±€(flex)çš„ justify-content å±æ€§ï¼Œå®ç°æ°´å¹³å±…ä¸­**ã€‚\n\n```html\n.parent { display:flex; justify-content:center; } .chlid{ float: left; width:\n200px;//æœ‰æ— å®½åº¦ä¸å½±å“å±…ä¸­ }\n<div class=\"parent\">\n  <span class=\"chlid\">æˆ‘æ˜¯è¦å±…ä¸­çš„æµ®åŠ¨å…ƒç´ </span>\n</div>\n```\n\n- ### ç»å¯¹å®šä½å…ƒç´ æ°´å¹³å±…ä¸­\n\nè¿™ç§æ–¹å¼éå¸¸ç‹¬ç‰¹ï¼Œ**é€šè¿‡å­å…ƒç´ ç»å¯¹å®šä½ï¼Œå¤–åŠ  margin: 0 auto æ¥å®ç°**ã€‚\n\n```html\n<div class=\"parent\">\n  <div class=\"child\">è®©ç»å¯¹å®šä½çš„å…ƒç´ æ°´å¹³å±…ä¸­å¯¹é½ã€‚</div>\n</div>\n.parent{ position:relative; } .child{ position: absolute; /*ç»å¯¹å®šä½*/ width:\n200px; height:100px; background: yellow; margin: 0 auto; /*æ°´å¹³å±…ä¸­*/ left: 0;\n/*æ­¤å¤„ä¸èƒ½çœç•¥ï¼Œä¸”ä¸º0*/ right: 0;/*æ­¤å¤„ä¸èƒ½çœç•¥ï¼Œä¸”ä¸º0*/ }\n```\n\n## 2.å‚ç›´å±…ä¸­\n\n- ### å•è¡Œå†…è”å…ƒç´ å‚ç›´å±…ä¸­\n\n```html\n<div id=\"box\"><span>å•è¡Œå†…è”å…ƒç´ å‚ç›´å±…ä¸­ã€‚</span>ã€‚</div>\n<style>\n  #box {\n    height: 120px;\n    line-height: 120px;\n    border: 2px dashed #f69c55;\n  }\n</style>\n```\n\n- ### å¤šè¡Œå†…è”å…ƒç´ å‚ç›´å±…ä¸­\n\n#### â‘  åˆ©ç”¨ flex å¸ƒå±€ï¼ˆflexï¼‰\n\n**åˆ©ç”¨ flex å¸ƒå±€å®ç°å‚ç›´å±…ä¸­ï¼Œå…¶ä¸­ flex-direction: column å®šä¹‰ä¸»è½´æ–¹å‘ä¸ºçºµå‘**ã€‚è¿™ç§æ–¹å¼åœ¨è¾ƒè€çš„æµè§ˆå™¨å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚\n\n```html\n<div class=\"parent\">\n  <p>\n    Dance like nobody is watching, code like everybody is. Dance like nobody is\n    watching, code like everybody is. Dance like nobody is watching, code like\n    everybody is.\n  </p>\n</div>\n<style>\n  .parent {\n    height: 140px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    border: 2px dashed #f69c55;\n  }\n</style>\n```\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iz0f2donj30k504ejrj.jpg)\n\n#### â‘¡ åˆ©ç”¨è¡¨å¸ƒå±€ï¼ˆtableï¼‰\n\n**åˆ©ç”¨è¡¨å¸ƒå±€çš„ vertical-align: middle å¯ä»¥å®ç°å­å…ƒç´ çš„å‚ç›´å±…ä¸­**\n\n```html\n<div class=\"parent\">\n  <p class=\"child\">\n    The more technology you learn, the more you realize how little you know. The\n    more technology you learn, the more you realize how little you know. The\n    more technology you learn, the more you realize how little you know.\n  </p>\n</div>\n<style>\n  .parent {\n    display: table;\n    height: 140px;\n    border: 2px dashed #f69c55;\n  }\n  .child {\n    display: table-cell;\n    vertical-align: middle;\n  }\n</style>\n```\n\n- ### å—çº§å…ƒç´ å‚ç›´å±…ä¸­\n\n#### â‘  ä½¿ç”¨ absolute+è´Ÿ margin(å·²çŸ¥é«˜åº¦å®½åº¦)\n\n**é€šè¿‡ç»å¯¹å®šä½å…ƒç´ è·ç¦»é¡¶éƒ¨ 50%ï¼Œå¹¶è®¾ç½® margin-top å‘ä¸Šåç§»å…ƒç´ é«˜åº¦çš„ä¸€åŠï¼Œå°±å¯ä»¥å®ç°äº†**ã€‚\n\n```html\n<div class=\"parent\">\n  <div class=\"child\">å›ºå®šé«˜åº¦çš„å—çº§å…ƒç´ å‚ç›´å±…ä¸­ã€‚</div>\n</div>\n.parent { position: relative; } .child { position: absolute; top: 50%; height:\n100px; margin-top: -50px; }\n```\n\n#### â‘¡ ä½¿ç”¨ absolute+transform\n\n**å½“å‚ç›´å±…ä¸­çš„å…ƒç´ çš„é«˜åº¦å’Œå®½åº¦æœªçŸ¥æ—¶ï¼Œå¯ä»¥å€ŸåŠ© CSS3 ä¸­çš„ transform å±æ€§å‘ Y è½´åå‘åç§» 50%çš„æ–¹æ³•å®ç°å‚ç›´å±…ä¸­**ã€‚ä½†æ˜¯éƒ¨åˆ†æµè§ˆå™¨å­˜åœ¨å…¼å®¹æ€§çš„é—®é¢˜ã€‚\n\n```html\n<div class=\"parent\">\n  <div class=\"child\">æœªçŸ¥é«˜åº¦çš„å—çº§å…ƒç´ å‚ç›´å±…ä¸­ã€‚</div>\n</div>\n.parent { position: relative; } .child { position: absolute; top: 50%;\ntransform: translateY(-50%); }\n```\n\n#### â‘¢ ä½¿ç”¨ flex+align-items\n\n**é€šè¿‡è®¾ç½® flex å¸ƒå±€ä¸­çš„å±æ€§ align-itemsï¼Œä½¿å­å…ƒç´ å‚ç›´å±…ä¸­**ã€‚\n\n```html\n<div class=\"parent\">\n  <div class=\"child\">æœªçŸ¥é«˜åº¦çš„å—çº§å…ƒç´ å‚ç›´å±…ä¸­ã€‚</div>\n</div>\n.parent { display:flex; align-items:center; }\n```\n\n#### â‘£ ä½¿ç”¨ table-cell+vertical-align\n\n**é€šè¿‡å°†çˆ¶å…ƒç´ è½¬åŒ–ä¸ºä¸€ä¸ªè¡¨æ ¼å•å…ƒæ ¼æ˜¾ç¤ºï¼ˆç±»ä¼¼ <td> å’Œ <th>ï¼‰ï¼Œå†é€šè¿‡è®¾ç½® vertical-align å±æ€§ï¼Œä½¿è¡¨æ ¼å•å…ƒæ ¼å†…å®¹å‚ç›´å±…ä¸­ã€‚**\n\n```html\n<div class=\"parent\">\n  <div class=\"child\">Demo</div>\n</div>\n<style>\n  .parent {\n    display: table-cell;\n    vertical-align: middle;\n  }\n</style>\n```\n\n## 3.æ°´å¹³å‚ç›´å±…ä¸­\n\n```html\n// htmléƒ¨åˆ†(è¿™éƒ¨åˆ†ä¸åšå˜åŒ–,ä¸‹é¢ä¾‹å­ç›´æ¥å…±ç”¨)\n<body>\n  <div id=\"container\">\n    <div id=\"center\" style=\"width: 100px;height: 100px;background-color: #666\">\n      center\n    </div>\n  </div>\n</body>\n```\n\n- ### ç»å¯¹å®šä½ä¸è´Ÿè¾¹è·å®ç°ï¼ˆå·²çŸ¥é«˜åº¦å®½åº¦ï¼‰\n\n**è¿™ç§æ–¹å¼éœ€è¦çŸ¥é“è¢«å‚ç›´å±…ä¸­å…ƒç´ çš„é«˜å’Œå®½ï¼Œæ‰èƒ½è®¡ç®—å‡º margin å€¼ï¼Œå…¼å®¹æ‰€æœ‰æµè§ˆå™¨**ã€‚\n\n```css\n// csséƒ¨åˆ†\n#container {\n  position: relative;\n}\n#center {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  margin: -50px 0 0 -50px;\n}\n```\n\n- ### ç»å¯¹å®šä½ä¸ margin:autoï¼ˆå·²çŸ¥é«˜åº¦å®½åº¦ï¼‰\n\n**è¿™ç§æ–¹å¼æ— éœ€çŸ¥é“è¢«å‚ç›´å±…ä¸­å…ƒç´ çš„é«˜å’Œå®½ï¼Œä½†ä¸èƒ½å…¼å®¹ä½ç‰ˆæœ¬çš„ IE æµè§ˆå™¨ã€‚**\n\n```css\n#container {\n  position: relative;\n  height: 100px; //å¿…é¡»æœ‰ä¸ªé«˜åº¦\n}\n#center {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  margin: auto; //æ³¨æ„æ­¤å¤„çš„å†™æ³•\n}\n```\n\n- ### ç»å¯¹å®šä½+transform(æœªçŸ¥å…ƒç´ çš„é«˜å®½)\n\n**åˆ©ç”¨ Css3 çš„ transformï¼Œå¯ä»¥è½»æ¾çš„åœ¨æœªçŸ¥å…ƒç´ çš„é«˜å®½çš„æƒ…å†µä¸‹å®ç°å…ƒç´ çš„å‚ç›´å±…ä¸­**ã€‚\nCSS3 çš„ transform å›ºç„¶å¥½ç”¨ï¼Œä½†åœ¨é¡¹ç›®çš„å®é™…è¿ç”¨ä¸­å¿…é¡»è€ƒè™‘å…¼å®¹é—®é¢˜ï¼Œå¤§é‡çš„ hack ä»£ç å¯èƒ½ä¼šå¯¼è‡´å¾—ä¸å¿å¤±ã€‚\n\n```css\n#container {\n  position: relative;\n}\n#center {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n```\n\n- ### flex å¸ƒå±€\n\n**åˆ©ç”¨ flex å¸ƒå±€ï¼Œå…¶ä¸­ justify-content ç”¨äºè®¾ç½®æˆ–æ£€ç´¢å¼¹æ€§ç›’å­å…ƒç´ åœ¨ä¸»è½´ï¼ˆæ¨ªè½´ï¼‰æ–¹å‘ä¸Šçš„å¯¹é½æ–¹å¼ï¼›è€Œ align-items å±æ€§å®šä¹‰ flex å­é¡¹åœ¨ flex å®¹å™¨çš„å½“å‰è¡Œçš„ä¾§è½´ï¼ˆçºµè½´ï¼‰æ–¹å‘ä¸Šçš„å¯¹é½æ–¹å¼ã€‚ä¸èƒ½å…¼å®¹ä½ç‰ˆæœ¬çš„ IE æµè§ˆå™¨ã€‚**\n\n```css\n#container {\n  //ç›´æ¥åœ¨çˆ¶å®¹å™¨è®¾ç½®å³å¯\n  height: 100vh; //å¿…é¡»æœ‰é«˜åº¦\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n```\n\n- ### flex/grid ä¸ margin:auto(æœ€ç®€å•å†™æ³•)\n\n**å®¹å™¨å…ƒç´ è®¾ä¸º flex å¸ƒå±€æˆ–æ˜¯ grid å¸ƒå±€ï¼Œå­å…ƒç´ åªè¦å†™ margin: auto å³å¯,ä¸èƒ½å…¼å®¹ä½ç‰ˆæœ¬çš„ IE æµè§ˆå™¨ã€‚**\n\n```css\n#container {\n  height: 100vh; //å¿…é¡»æœ‰é«˜åº¦\n  display: grid;\n}\n#center {\n  margin: auto;\n}\n```\n","tags":["CSS","å±…ä¸­"],"categories":["CSS"]},{"title":"CSSå¤šåˆ—å¸ƒå±€","url":"/2019/05/08/CSSå¤šåˆ—å¸ƒå±€/","content":"\n## 1.å•åˆ—å¸ƒå±€\n\nå¸¸è§çš„å•åˆ—å¸ƒå±€æœ‰ä¸¤ç§ï¼š\n\n- header,content å’Œ footer ç­‰å®½çš„å•åˆ—å¸ƒå±€\n- header ä¸ footer ç­‰å®½,content ç•¥çª„çš„å•åˆ—å¸ƒå±€\n  <!-- more -->\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iysrsoe5j31100h2q3f.jpg)\n\n### ç¬¬ä¸€ç§ï¼š\n\nå¯¹äºç¬¬ä¸€ç§ï¼Œå…ˆé€šè¿‡å¯¹ header,content,footer ç»Ÿä¸€è®¾ç½® widthï¼š1000px;æˆ–è€… max-widthï¼š1000px(è¿™ä¸¤è€…çš„åŒºåˆ«æ˜¯å½“å±å¹•å°äº 1000px æ—¶ï¼Œå‰è€…ä¼šå‡ºç°æ»šåŠ¨æ¡ï¼Œåè€…åˆ™ä¸ä¼šï¼Œæ˜¾ç¤ºå‡ºå®é™…å®½åº¦);ç„¶åè®¾ç½® margin:auto å®ç°å±…ä¸­å³å¯å¾—åˆ°ã€‚\n\n```html\n<div class=\"header\"></div>\n<div class=\"content\"></div>\n<div class=\"footer\"></div>\n```\n\n```css\n.header {\n  margin: 0 auto;\n  max-width: 960px;\n  height: 100px;\n  background-color: blue;\n}\n.content {\n  margin: 0 auto;\n  max-width: 960px;\n  height: 400px;\n  background-color: aquamarine;\n}\n.footer {\n  margin: 0 auto;\n  max-width: 960px;\n  height: 100px;\n  background-color: aqua;\n}\n```\n\n### ç¬¬äºŒç§ï¼š\n\nå¯¹äºç¬¬äºŒç§ï¼Œheaderã€footer çš„å†…å®¹å®½åº¦ä¸è®¾ç½®ï¼Œå—çº§å…ƒç´ å……æ»¡æ•´ä¸ªå±å¹•ï¼Œä½† headerã€content å’Œ footer çš„å†…å®¹åŒºè®¾ç½®åŒä¸€ä¸ª widthï¼Œå¹¶é€šè¿‡ margin:auto å®ç°å±…ä¸­ã€‚\n\n```html\n<div class=\"header\">\n  <div class=\"nav\"></div>\n</div>\n<div class=\"content\"></div>\n<div class=\"footer\"></div>\n```\n\n```css\n.header {\n  margin: 0 auto;\n  max-width: 960px;\n  height: 100px;\n  background-color: blue;\n}\n.nav {\n  margin: 0 auto;\n  max-width: 800px;\n  background-color: darkgray;\n  height: 50px;\n}\n.content {\n  margin: 0 auto;\n  max-width: 800px;\n  height: 400px;\n  background-color: aquamarine;\n}\n.footer {\n  margin: 0 auto;\n  max-width: 960px;\n  height: 100px;\n  background-color: aqua;\n}\n```\n\n## 2.ä¸¤åˆ—è‡ªé€‚åº”å¸ƒå±€\n\n**ä¸¤åˆ—è‡ªé€‚åº”å¸ƒå±€æ˜¯æŒ‡ä¸€åˆ—ç”±å†…å®¹æ’‘å¼€ï¼Œå¦ä¸€åˆ—æ’‘æ»¡å‰©ä½™å®½åº¦çš„å¸ƒå±€æ–¹å¼**\n\n### float+overflow:hidden\n\nå¦‚æœæ˜¯æ™®é€šçš„ä¸¤åˆ—å¸ƒå±€ï¼Œ**æµ®åŠ¨+æ™®é€šå…ƒç´ çš„ margin**ä¾¿å¯ä»¥å®ç°ï¼Œä½†å¦‚æœæ˜¯è‡ªé€‚åº”çš„ä¸¤åˆ—å¸ƒå±€ï¼Œåˆ©ç”¨**float+overflow:hidden**ä¾¿å¯ä»¥å®ç°ï¼Œ**è¿™ç§åŠæ³•ä¸»è¦é€šè¿‡ overflow è§¦å‘ BFC,è€Œ BFC ä¸ä¼šé‡å æµ®åŠ¨å…ƒç´ **ã€‚ç”±äºè®¾ç½® overflow:hidden å¹¶ä¸ä¼šè§¦å‘ IE6-æµè§ˆå™¨çš„ haslayout å±æ€§ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½® zoom:1 æ¥å…¼å®¹ IE6-æµè§ˆå™¨ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š\n\n```html\n<div class=\"parent\" style=\"background-color: lightgrey;\">\n  <div class=\"left\" style=\"background-color: lightblue;\">\n    <p>left</p>\n  </div>\n  <div class=\"right\" style=\"background-color: lightgreen;\">\n    <p>right</p>\n    <p>right</p>\n  </div>\n</div>\n```\n\n```css\n.parent {\n  overflow: hidden;\n  zoom: 1;\n}\n.left {\n  float: left;\n  margin-right: 20px;\n}\n.right {\n  overflow: hidden;\n  zoom: 1;\n}\n```\n\næ³¨æ„ç‚¹:å¦‚æœä¾§è¾¹æ åœ¨å³è¾¹æ—¶ï¼Œæ³¨æ„æ¸²æŸ“é¡ºåºã€‚å³åœ¨ HTML ä¸­ï¼Œå…ˆå†™ä¾§è¾¹æ åå†™ä¸»å†…å®¹\n\n### Flex å¸ƒå±€\n\nFlex å¸ƒå±€ï¼Œä¹Ÿå«å¼¹æ€§ç›’å­å¸ƒå±€ï¼ŒåŒºåŒºç®€å•å‡ è¡Œä»£ç å°±å¯ä»¥å®ç°å„ç§é¡µé¢çš„çš„å¸ƒå±€ã€‚\n\n```css\n//htmléƒ¨åˆ†åŒä¸Š\n.parent {\n  display: flex;\n}\n.right {\n  margin-left: 20px;\n  flex: 1;\n}\n```\n\n### grid å¸ƒå±€\n\nGrid å¸ƒå±€ï¼Œæ˜¯ä¸€ä¸ªåŸºäºç½‘æ ¼çš„äºŒç»´å¸ƒå±€ç³»ç»Ÿï¼Œç›®çš„æ˜¯ç”¨æ¥ä¼˜åŒ–ç”¨æˆ·ç•Œé¢è®¾è®¡ã€‚\n\n```css\n//htmléƒ¨åˆ†åŒä¸Š\n.parent {\n  display: grid;\n  grid-template-columns: auto 1fr;\n  grid-gap: 20px;\n}\n```\n\n## 3.ä¸‰æ å¸ƒå±€\n\n**ç‰¹å¾ï¼šä¸­é—´åˆ—è‡ªé€‚åº”å®½åº¦ï¼Œæ—è¾¹ä¸¤ä¾§å›ºå®šå®½åº¦**\n\n### åœ£æ¯å¸ƒå±€\n\n- #### ç‰¹ç‚¹\n\n**æ¯”è¾ƒç‰¹æ®Šçš„ä¸‰æ å¸ƒå±€ï¼ŒåŒæ ·ä¹Ÿæ˜¯ä¸¤è¾¹å›ºå®šå®½åº¦ï¼Œä¸­é—´è‡ªé€‚åº”ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯ dom ç»“æ„å¿…é¡»æ˜¯å…ˆå†™ä¸­é—´åˆ—éƒ¨åˆ†ï¼Œè¿™æ ·å®ç°ä¸­é—´åˆ—å¯ä»¥ä¼˜å…ˆåŠ è½½**ã€‚\n\n```html\n<article class=\"container\">\n  <div class=\"center\">\n    <h2>åœ£æ¯å¸ƒå±€</h2>\n  </div>\n  <div class=\"left\"></div>\n  <div class=\"right\"></div>\n</article>\n```\n\n```css\n.container {\n  padding-left: 220px; //ä¸ºå·¦å³æ è…¾å‡ºç©ºé—´\n  padding-right: 220px;\n}\n.left {\n  float: left;\n  width: 200px;\n  height: 400px;\n  background: red;\n  margin-left: -100%;\n  position: relative;\n  left: -220px;\n}\n.center {\n  float: left;\n  width: 100%;\n  height: 500px;\n  background: yellow;\n}\n.right {\n  float: left;\n  width: 200px;\n  height: 400px;\n  background: blue;\n  margin-left: -200px;\n  position: relative;\n  right: -220px;\n}\n```\n\n- #### å®ç°æ­¥éª¤\n\n  - ä¸‰ä¸ªéƒ¨åˆ†éƒ½è®¾å®šä¸ºå·¦æµ®åŠ¨ï¼Œ**å¦åˆ™å·¦å³ä¸¤è¾¹å†…å®¹ä¸Šä¸å»ï¼Œå°±ä¸å¯èƒ½ä¸ä¸­é—´åˆ—åŒä¸€è¡Œ**ã€‚ç„¶åè®¾ç½® center çš„å®½åº¦ä¸º 100%(**å®ç°ä¸­é—´åˆ—å†…å®¹è‡ªé€‚åº”**)ï¼Œæ­¤æ—¶ï¼Œleft å’Œ right éƒ¨åˆ†ä¼šè·³åˆ°ä¸‹ä¸€è¡Œ\n  - é€šè¿‡è®¾ç½® margin-left ä¸ºè´Ÿå€¼è®© left å’Œ right éƒ¨åˆ†å›åˆ°ä¸ center éƒ¨åˆ†åŒä¸€è¡Œ\n  - é€šè¿‡è®¾ç½®çˆ¶å®¹å™¨çš„ padding-left å’Œ padding-rightï¼Œè®©å·¦å³ä¸¤è¾¹ç•™å‡ºé—´éš™ã€‚\n  - é€šè¿‡è®¾ç½®ç›¸å¯¹å®šä½ï¼Œè®© left å’Œ right éƒ¨åˆ†ç§»åŠ¨åˆ°ä¸¤è¾¹ã€‚\n\n- #### ç¼ºç‚¹\n\n  - center éƒ¨åˆ†çš„æœ€å°å®½åº¦ä¸èƒ½å°äº left éƒ¨åˆ†çš„å®½åº¦ï¼Œå¦åˆ™ä¼š left éƒ¨åˆ†æ‰åˆ°ä¸‹ä¸€è¡Œ\n  - å¦‚æœå…¶ä¸­ä¸€åˆ—å†…å®¹é«˜åº¦æ‹‰é•¿(å¦‚ä¸‹å›¾)ï¼Œå…¶ä»–ä¸¤åˆ—çš„èƒŒæ™¯å¹¶ä¸ä¼šè‡ªåŠ¨å¡«å……ã€‚(å€ŸåŠ©ç­‰é«˜å¸ƒå±€æ­£ padding+è´Ÿ margin å¯è§£å†³ï¼Œä¸‹æ–‡ä¼šä»‹ç»)\n\n### åŒé£ç¿¼å¸ƒå±€\n\n- #### ç‰¹ç‚¹\n\n**åŒæ ·ä¹Ÿæ˜¯ä¸‰æ å¸ƒå±€ï¼Œåœ¨åœ£æ¯å¸ƒå±€åŸºç¡€ä¸Šè¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œè§£å†³äº†åœ£æ¯å¸ƒå±€é”™ä¹±é—®é¢˜ï¼Œå®ç°äº†å†…å®¹ä¸å¸ƒå±€çš„åˆ†ç¦»ã€‚è€Œä¸”ä»»ä½•ä¸€æ éƒ½å¯ä»¥æ˜¯æœ€é«˜æ ï¼Œä¸ä¼šå‡ºé—®é¢˜**ã€‚\n\n```html\n<article class=\"container\">\n  <div class=\"center\">\n    <div class=\"inner\">åŒé£ç¿¼å¸ƒå±€</div>\n  </div>\n  <div class=\"left\"></div>\n  <div class=\"right\"></div>\n</article>\n```\n\n```css\n.container {\n  min-width: 600px; //ç¡®ä¿ä¸­é—´å†…å®¹å¯ä»¥æ˜¾ç¤ºå‡ºæ¥ï¼Œä¸¤å€leftå®½+rightå®½\n}\n.left {\n  float: left;\n  width: 200px;\n  height: 400px;\n  background: red;\n  margin-left: -100%;\n}\n.center {\n  float: left;\n  width: 100%;\n  height: 500px;\n  background: yellow;\n}\n.center .inner {\n  margin: 0 200px; //æ–°å¢éƒ¨åˆ†\n}\n.right {\n  float: left;\n  width: 200px;\n  height: 400px;\n  background: blue;\n  margin-left: -200px;\n}\n```\n\n- #### å®ç°æ­¥éª¤(å‰ä¸¤æ­¥ä¸åœ£æ¯å¸ƒå±€ä¸€æ ·)\n\n  - ä¸‰ä¸ªéƒ¨åˆ†éƒ½è®¾å®šä¸ºå·¦æµ®åŠ¨ï¼Œç„¶åè®¾ç½® center çš„å®½åº¦ä¸º 100%ï¼Œæ­¤æ—¶ï¼Œleft å’Œ right éƒ¨åˆ†ä¼šè·³åˆ°ä¸‹ä¸€è¡Œï¼›\n  - é€šè¿‡è®¾ç½® margin-left ä¸ºè´Ÿå€¼è®© left å’Œ right éƒ¨åˆ†å›åˆ°ä¸ center éƒ¨åˆ†åŒä¸€è¡Œï¼›\n  - center éƒ¨åˆ†å¢åŠ ä¸€ä¸ªå†…å±‚ divï¼Œå¹¶è®¾ margin: 0 200pxï¼›\n\n- #### ç¼ºç‚¹\n\n  **å¤šåŠ ä¸€å±‚ dom æ ‘èŠ‚ç‚¹ï¼Œå¢åŠ æ¸²æŸ“æ ‘ç”Ÿæˆçš„è®¡ç®—é‡**ã€‚\n\n- #### ä¸¤ç§å¸ƒå±€å®ç°æ–¹å¼å¯¹æ¯”:\n\n  - ä¸¤ç§å¸ƒå±€æ–¹å¼éƒ½æ˜¯æŠŠä¸»åˆ—æ”¾åœ¨æ–‡æ¡£æµæœ€å‰é¢ï¼Œä½¿ä¸»åˆ—ä¼˜å…ˆåŠ è½½ã€‚\n  - ä¸¤ç§å¸ƒå±€æ–¹å¼åœ¨å®ç°ä¸Šä¹Ÿæœ‰ç›¸åŒä¹‹å¤„ï¼Œéƒ½æ˜¯è®©ä¸‰åˆ—æµ®åŠ¨ï¼Œç„¶åé€šè¿‡è´Ÿå¤–è¾¹è·å½¢æˆä¸‰åˆ—å¸ƒå±€ã€‚\n  - ä¸¤ç§å¸ƒå±€æ–¹å¼çš„ä¸åŒä¹‹å¤„åœ¨äºå¦‚ä½•å¤„ç†ä¸­é—´ä¸»åˆ—çš„ä½ç½®ï¼š\n    **åœ£æ¯å¸ƒå±€æ˜¯åˆ©ç”¨çˆ¶å®¹å™¨çš„å·¦ã€å³å†…è¾¹è·+ä¸¤ä¸ªä»åˆ—ç›¸å¯¹å®šä½**ï¼›\n    **åŒé£ç¿¼å¸ƒå±€æ˜¯æŠŠä¸»åˆ—åµŒå¥—åœ¨ä¸€ä¸ªæ–°çš„çˆ¶çº§å—ä¸­åˆ©ç”¨ä¸»åˆ—çš„å·¦ã€å³å¤–è¾¹è·è¿›è¡Œå¸ƒå±€è°ƒæ•´**\n\n### æµ®åŠ¨å¸ƒå±€\n\n```html\n<article class=\"left-right-center\">\n  <div class=\"left\"></div>\n  <div class=\"right\"></div>\n  // å³æ éƒ¨åˆ†è¦å†™åœ¨ä¸­é—´å†…å®¹ä¹‹å‰\n  <div class=\"center\">\n    <h2>æµ®åŠ¨è§£å†³æ–¹æ¡ˆ</h2>\n    1.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 2.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n    3.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 4.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n    5.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 6.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n  </div>\n</article>\n```\n\n```css\n.layout.float .left {\n  float: left;\n  width: 300px;\n  background: red;\n}\n.layout.float .center {\n  background: yellow;\n}\n.layout.float .right {\n  float: right;\n  width: 300px;\n  background: blue;\n}\n```\n\nè¿™ç§å¸ƒå±€æ–¹å¼ï¼Œdom ç»“æ„å¿…é¡»æ˜¯å…ˆå†™æµ®åŠ¨éƒ¨åˆ†ï¼Œç„¶åå†ä¸­é—´å—ï¼Œå¦åˆ™å³æµ®åŠ¨å—ä¼šæ‰åˆ°ä¸‹ä¸€è¡Œã€‚\n**æµ®åŠ¨å¸ƒå±€çš„ä¼˜ç‚¹å°±æ˜¯æ¯”è¾ƒç®€å•ï¼Œå…¼å®¹æ€§ä¹Ÿæ¯”è¾ƒå¥½ã€‚ä½†æµ®åŠ¨å¸ƒå±€æ˜¯æœ‰å±€é™æ€§çš„ï¼Œæµ®åŠ¨å…ƒç´ è„±ç¦»æ–‡æ¡£æµï¼Œè¦åšæ¸…é™¤æµ®åŠ¨ï¼Œè¿™ä¸ªå¤„ç†ä¸å¥½çš„è¯ï¼Œä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚çˆ¶å®¹å™¨é«˜åº¦å¡Œé™·ç­‰**ã€‚\n\n### ç»å¯¹å¸ƒå±€\n\n```html\n<article class=\"left-center-right\">\n  <div class=\"left\"></div>\n  <div class=\"center\">\n    <h2>ç»å¯¹å®šä½è§£å†³æ–¹æ¡ˆ</h2>\n    1.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 2.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n    3.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 4.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n    5.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 6.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n  </div>\n  <div class=\"right\"></div>\n</article>\n```\n\n```css\n.layout.absolute .left-center-right > div {\n  position: absolute; //ä¸‰å—éƒ½æ˜¯ç»å¯¹å®šä½\n}\n.layout.absolute .left {\n  left: 0;\n  width: 300px;\n  background: red;\n}\n.layout.absolute .center {\n  right: 300px;\n  left: 300px; //ç¦»å·¦å³å„ä¸‰ç™¾\n  background: yellow;\n}\n.layout.absolute .right {\n  right: 0;\n  width: 300px;\n  background: blue;\n}\n```\n\n**ç»å¯¹å®šä½å¸ƒå±€ä¼˜ç‚¹å°±æ˜¯å¿«æ·ï¼Œè®¾ç½®å¾ˆæ–¹ä¾¿ï¼Œè€Œä¸”ä¹Ÿä¸å®¹æ˜“å‡ºé—®é¢˜ã€‚ç¼ºç‚¹å°±æ˜¯ï¼Œå®¹å™¨è„±ç¦»äº†æ–‡æ¡£æµï¼Œåä»£å…ƒç´ ä¹Ÿè„±ç¦»äº†æ–‡æ¡£æµï¼Œé«˜åº¦æœªçŸ¥çš„æ—¶å€™ï¼Œä¼šæœ‰é—®é¢˜ï¼Œè¿™å°±å¯¼è‡´äº†è¿™ç§æ–¹æ³•çš„æœ‰æ•ˆæ€§å’Œå¯ä½¿ç”¨æ€§æ˜¯æ¯”è¾ƒå·®çš„ã€‚**\n\n### flexbox å¸ƒå±€\n\n```html\n<article class=\"left-center-right\">\n  <div class=\"left\"></div>\n  <div class=\"center\">\n    <h2>flexboxè§£å†³æ–¹æ¡ˆ</h2>\n    1.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 2.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n    3.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 4.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n    5.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 6.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n  </div>\n  <div class=\"right\"></div>\n</article>\n```\n\n```css\n.layout.flexbox .left-center-right {\n  display: flex;\n}\n.layout.flexbox .left {\n  width: 300px;\n  background: red;\n}\n.layout.flexbox .center {\n  background: yellow;\n  flex: 1;\n}\n.layout.flexbox .right {\n  width: 300px;\n  background: blue;\n}\n```\n\n**flexbox å¸ƒå±€æ˜¯ css3 é‡Œæ–°å‡ºçš„ä¸€ä¸ªï¼Œå®ƒå°±æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°ä¸¤ç§æ–¹å¼çš„ä¸è¶³å‡ºç°çš„ï¼Œæ˜¯æ¯”è¾ƒå®Œç¾çš„ä¸€ä¸ªã€‚ç›®å‰ç§»åŠ¨ç«¯çš„å¸ƒå±€ä¹Ÿéƒ½æ˜¯ç”¨ flexboxã€‚ flexbox çš„ç¼ºç‚¹å°±æ˜¯ IE10 å¼€å§‹æ”¯æŒï¼Œä½†æ˜¯ IE10 çš„æ˜¯-ms å½¢å¼çš„ã€‚**\n\n### è¡¨æ ¼å¸ƒå±€\n\n```html\n<article class=\"left-center-right\">\n  <div class=\"left\"></div>\n  <div class=\"center\">\n    <h2>è¡¨æ ¼å¸ƒå±€è§£å†³æ–¹æ¡ˆ</h2>\n    1.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 2.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n    3.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 4.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n    5.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 6.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n  </div>\n  <div class=\"right\"></div>\n</article>\n```\n\n```css\n.layout.table .left-center-right {\n  display: table;\n  height: 150px;\n  width: 100%;\n}\n.layout.table .left-center-right > div {\n  display: table-cell;\n}\n.layout.table .left {\n  width: 300px;\n  background: red;\n}\n.layout.table .center {\n  background: yellow;\n}\n.layout.table .right {\n  width: 300px;\n  background: blue;\n}\n```\n\n**è¡¨æ ¼å¸ƒå±€çš„å…¼å®¹æ€§å¾ˆå¥½(è§ä¸‹å›¾)ï¼Œåœ¨ flex å¸ƒå±€ä¸å…¼å®¹çš„æ—¶å€™ï¼Œå¯ä»¥å°è¯•è¡¨æ ¼å¸ƒå±€ã€‚å½“å†…å®¹æº¢å‡ºæ—¶ä¼šè‡ªåŠ¨æ’‘å¼€çˆ¶å…ƒç´ **ã€‚\n\n**è¡¨æ ¼å¸ƒå±€ä¹Ÿæ˜¯æœ‰ç¼ºé™·:â‘  æ— æ³•è®¾ç½®æ è¾¹è·ï¼›â‘¡ å¯¹ seo ä¸å‹å¥½ï¼›â‘¢ å½“å…¶ä¸­ä¸€ä¸ªå•å…ƒæ ¼é«˜åº¦è¶…å‡ºçš„æ—¶å€™ï¼Œä¸¤ä¾§çš„å•å…ƒæ ¼ä¹Ÿæ˜¯ä¼šè·Ÿç€ä¸€èµ·å˜é«˜çš„ï¼Œç„¶è€Œæœ‰æ—¶å€™è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚**\n\n### ç½‘æ ¼å¸ƒå±€\n\n```html\n<article class=\"left-center-right\">\n  <div class=\"left\"></div>\n  <div class=\"center\">\n    <h2>ç½‘æ ¼å¸ƒå±€è§£å†³æ–¹æ¡ˆ</h2>\n    1.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 2.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n    3.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 4.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n    5.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼› 6.è¿™æ˜¯ä¸‰æ å¸ƒå±€çš„æµ®åŠ¨è§£å†³æ–¹æ¡ˆï¼›\n  </div>\n  <div class=\"right\"></div>\n</article>\n```\n\n```css\n.layout.grid .left-center-right {\n  display: grid;\n  width: 100%;\n  grid-template-columns: 300px auto 300px;\n  grid-template-rows: 150px; //è¡Œé«˜\n}\n.layout.grid .left {\n  background: red;\n}\n.layout.grid .center {\n  background: yellow;\n}\n.layout.grid .right {\n  background: blue;\n}\n```\n\n**CSS Grid æ˜¯åˆ›å»ºç½‘æ ¼å¸ƒå±€æœ€å¼ºå¤§å’Œæœ€ç®€å•çš„å·¥å…·ã€‚å°±åƒè¡¨æ ¼ä¸€æ ·ï¼Œç½‘æ ¼å¸ƒå±€å¯ä»¥è®© Web è®¾è®¡å¸ˆæ ¹æ®å…ƒç´ æŒ‰åˆ—æˆ–è¡Œå¯¹é½æ’åˆ—ï¼Œä½†ä»–å’Œè¡¨æ ¼ä¸åŒï¼Œç½‘æ ¼å¸ƒå±€æ²¡æœ‰å†…å®¹ç»“æ„ï¼Œä»è€Œä½¿å„ç§å¸ƒå±€ä¸å¯èƒ½ä¸è¡¨æ ¼ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç½‘æ ¼å¸ƒå±€ä¸­çš„å­å…ƒç´ éƒ½å¯ä»¥å®šä½è‡ªå·±çš„ä½ç½®ï¼Œè¿™æ ·ä»–ä»¬å¯ä»¥é‡å å’Œç±»ä¼¼å…ƒç´ å®šä½**ã€‚\n\n**ä½†ç½‘æ ¼å¸ƒå±€çš„å…¼å®¹æ€§ä¸å¥½ã€‚IE10+ä¸Šæ”¯æŒï¼Œè€Œä¸”ä¹Ÿä»…æ”¯æŒéƒ¨åˆ†å±æ€§**ã€‚\n\n## 4.ç­‰é«˜å¸ƒå±€\n\nç­‰é«˜å¸ƒå±€æ˜¯æŒ‡å­å…ƒç´ åœ¨çˆ¶å…ƒç´ ä¸­é«˜åº¦ç›¸ç­‰çš„å¸ƒå±€æ–¹å¼ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»å¸¸è§å‡ ç§å®ç°æ–¹å¼ï¼š\n\n- #### åˆ©ç”¨æ­£ padding+è´Ÿ margin\n\næˆ‘ä»¬é€šè¿‡ç­‰é«˜å¸ƒå±€ä¾¿å¯è§£å†³åœ£æ¯å¸ƒå±€çš„ç¬¬äºŒç‚¹ç¼ºç‚¹ï¼Œå› ä¸ºèƒŒæ™¯æ˜¯åœ¨ padding åŒºåŸŸæ˜¾ç¤ºçš„ï¼Œ**è®¾ç½®ä¸€ä¸ªå¤§æ•°å€¼çš„ padding-bottomï¼Œå†è®¾ç½®ç›¸åŒæ•°å€¼çš„è´Ÿçš„ margin-bottomï¼Œå¹¶åœ¨æ‰€æœ‰åˆ—å¤–é¢åŠ ä¸Šä¸€ä¸ªå®¹å™¨ï¼Œå¹¶è®¾ç½® overflow:hidden æŠŠæº¢å‡ºèƒŒæ™¯åˆ‡æ‰**ã€‚è¿™ç§å¯èƒ½å®ç°å¤šåˆ—ç­‰é«˜å¸ƒå±€ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å®ç°åˆ—ä¸åˆ—ä¹‹é—´åˆ†éš”çº¿æ•ˆæœï¼Œç»“æ„ç®€å•ï¼Œå…¼å®¹æ‰€æœ‰æµè§ˆå™¨ã€‚æ–°å¢ä»£ç å¦‚ä¸‹ï¼š\n\n```css\n.center,\n.left,\n.right {\n  padding-bottom: 10000px;\n  margin-bottom: -10000px;\n}\n.container {\n  padding-left: 220px;\n  padding-right: 220px;\n  overflow: hidden; //æŠŠæº¢å‡ºèƒŒæ™¯åˆ‡æ‰\n}\n```\n\n- #### åˆ©ç”¨èƒŒæ™¯å›¾ç‰‡\n\nè¿™ç§æ–¹æ³•æ˜¯æˆ‘ä»¬å®ç°ç­‰é«˜åˆ—æœ€æ—©ä½¿ç”¨çš„ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨èƒŒæ™¯å›¾ç‰‡ï¼Œåœ¨åˆ—çš„çˆ¶å…ƒç´ ä¸Šä½¿ç”¨è¿™ä¸ªèƒŒæ™¯å›¾è¿›è¡Œ Y è½´çš„é“ºæ”¾ï¼Œä»è€Œå®ç°ä¸€ç§ç­‰é«˜åˆ—çš„å‡è±¡ã€‚å®ç°æ–¹æ³•ç®€å•ï¼Œå…¼å®¹æ€§å¼ºï¼Œä¸éœ€è¦å¤ªå¤šçš„ css æ ·å¼å°±å¯ä»¥è½»æ¾å®ç°,ä½†æ­¤æ–¹æ³•ä¸é€‚åˆæµä½“å¸ƒå±€ç­‰é«˜åˆ—çš„å¸ƒå±€ã€‚\n\nåœ¨åˆ¶ä½œæ ·å¼ä¹‹å‰éœ€è¦ä¸€å¼ ç±»ä¼¼ä¸‹é¢çš„èƒŒæ™¯å›¾ï¼š\n\n[![img](https://camo.githubusercontent.com/7b26b4a48392ca95709486320efc031dd8e9ea58/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f31322f32312f313637636633633031343664323436343f773d35303026683d313226663d67696626733d333133)](https://camo.githubusercontent.com/7b26b4a48392ca95709486320efc031dd8e9ea58/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f31322f32312f313637636633633031343664323436343f773d35303026683d313226663d67696626733d333133)\n\n```html\n<div class=\"â€container\" clearfixâ€>\n  <div class=\"â€leftâ€\"></div>\n  <div class=\"â€contentâ€\"></div>\n  <div class=\"â€rightâ€\"></div>\n</div>\n```\n\n```css\n.container {\n  background: url(\"column.png\") repeat-y;\n  width: 960px;\n  margin: 0 auto;\n}\n.left {\n  float: left;\n  width: 220px;\n}\n.content {\n  float: left;\n  width: 480px;\n}\n.right {\n  float: left;\n  width: 220px;\n}\n```\n\n- #### æ¨¡ä»¿è¡¨æ ¼å¸ƒå±€\n\nè¿™æ˜¯ä¸€ç§éå¸¸ç®€å•ï¼Œæ˜“äºå®ç°çš„æ–¹æ³•ã€‚ä¸è¿‡å…¼å®¹æ€§ä¸å¥½ï¼Œåœ¨ ie6-7 æ— æ³•æ­£å¸¸è¿è¡Œã€‚\n\n```html\n<div class=\"container table\">\n  <div class=\"containerInner tableRow\">\n    <div class=\"column tableCell cell1\">\n      <div class=\"left aside\">\n        ....\n      </div>\n    </div>\n    <div class=\"column tableCell cell2\">\n      <div class=\"content section\">\n        ...\n      </div>\n    </div>\n    <div class=\"column tableCell cell3\">\n      <div class=\"right aside\">\n        ...\n      </div>\n    </div>\n  </div>\n</div>\n```\n\n```css\n.table {\n  width: auto;\n  min-width: 1000px;\n  margin: 0 auto;\n  padding: 0;\n  display: table;\n}\n.tableRow {\n  display: table-row;\n}\n.tableCell {\n  display: table-cell;\n  width: 33%;\n}\n.cell1 {\n  background: #f00;\n  height: 800px;\n}\n.cell2 {\n  background: #0f0;\n}\n.cell3 {\n  background: #00f;\n}\n```\n\n- #### ä½¿ç”¨è¾¹æ¡†å’Œå®šä½\n\nè¿™ç§æ–¹æ³•æ˜¯ä½¿ç”¨è¾¹æ¡†å’Œç»å¯¹å®šä½æ¥å®ç°ä¸€ä¸ªå‡çš„é«˜åº¦ç›¸ç­‰åˆ—çš„æ•ˆæœã€‚ç»“æ„ç®€å•ï¼Œå…¼å®¹å„æµè§ˆå™¨ï¼Œå®¹æ˜“æŒæ¡ã€‚å‡è®¾ä½ éœ€è¦å®ç°ä¸€ä¸ªä¸¤åˆ—ç­‰é«˜å¸ƒå±€ï¼Œä¾§æ é«˜åº¦è¦å’Œä¸»å†…å®¹é«˜åº¦ç›¸ç­‰ã€‚\n\n```html\n<div id=\"wrapper\">\n  <div id=\"mainContent\">...</div>\n  <div id=\"sidebar\">...</div>\n</div>\n```\n\n```css\n#wrapper {\n  width: 960px;\n  margin: 0 auto;\n}\n#mainContent {\n  border-right: 220px solid #dfdfdf;\n  position: absolute;\n  width: 740px;\n  height: 800px;\n  background: green;\n}\n#sidebar {\n  background: #dfdfdf;\n  margin-left: 740px;\n  position: absolute;\n  height: 800px;\n  width: 220px;\n}\n```\n\n## 5.ç²˜è¿å¸ƒå±€\n\n- #### ç‰¹ç‚¹\n\n  - æœ‰ä¸€å—å†…å®¹`<main>`ï¼Œå½“`<main>`çš„é«˜åº·è¶³å¤Ÿé•¿çš„æ—¶å€™ï¼Œç´§è·Ÿåœ¨`<main>`åé¢çš„å…ƒç´ `<footer>`ä¼šè·Ÿåœ¨`<main>`å…ƒç´ çš„åé¢ã€‚\n  - å½“`<main>`å…ƒç´ æ¯”è¾ƒçŸ­çš„æ—¶å€™(æ¯”å¦‚å°äºå±å¹•çš„é«˜åº¦),æˆ‘ä»¬æœŸæœ›è¿™ä¸ª`<footer>`å…ƒç´ èƒ½å¤Ÿâ€œç²˜è¿â€åœ¨å±å¹•çš„åº•éƒ¨\n\nå…·ä½“ä»£ç å¦‚ä¸‹ï¼š\n\n```html\n<div id=\"wrap\">\n  <div class=\"main\">\n    main <br />\n    main <br />\n    main <br />\n  </div>\n</div>\n<div id=\"footer\">footer</div>\n```\n\n```css\n* {\n  margin: 0;\n  padding: 0;\n}\nhtml,\nbody {\n  height: 100%; //é«˜åº¦ä¸€å±‚å±‚ç»§æ‰¿ä¸‹æ¥\n}\n#wrap {\n  min-height: 100%;\n  background: pink;\n  text-align: center;\n  overflow: hidden;\n}\n#wrap .main {\n  padding-bottom: 50px;\n}\n#footer {\n  height: 50px;\n  line-height: 50px;\n  background: deeppink;\n  text-align: center;\n  margin-top: -50px;\n}\n```\n\n- #### å®ç°æ­¥éª¤\n\n  - footer å¿…é¡»æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç»“æ„ï¼Œä¸ wrap æ²¡æœ‰ä»»ä½•åµŒå¥—å…³ç³»\n  - wrap åŒºåŸŸçš„é«˜åº¦é€šè¿‡è®¾ç½® min-heightï¼Œå˜ä¸ºè§†å£é«˜åº¦\n  - footer è¦ä½¿ç”¨ margin ä¸ºè´Ÿæ¥ç¡®å®šè‡ªå·±çš„ä½ç½®\n  - åœ¨ main åŒºåŸŸéœ€è¦è®¾ç½® padding-bottomã€‚è¿™ä¹Ÿæ˜¯ä¸ºäº†é˜²æ­¢è´Ÿ margin å¯¼è‡´ footer è¦†ç›–ä»»ä½•å®é™…å†…å®¹ã€‚\n","tags":["CSS","å¸ƒå±€"],"categories":["CSS"]},{"title":"CSSå¸¸ç”¨å¸ƒå±€æ–¹å¼","url":"/2019/05/02/CSSå¸¸ç”¨å¸ƒå±€æ–¹å¼/","content":"\n# CSS å¸¸ç”¨å¸ƒå±€æ–¹å¼\n\n## 1.é™æ€å¸ƒå±€ï¼ˆå›ºå®šå¸ƒå±€ï¼‰\n\n### å¸ƒå±€ç‰¹ç‚¹\n\nä¸ç®¡æµè§ˆå™¨å°ºå¯¸å…·ä½“æ˜¯å¤šå°‘ï¼Œç½‘é¡µå¸ƒå±€å§‹ç»ˆæŒ‰ç…§æœ€åˆå†™ä»£ç æ—¶çš„å¸ƒå±€æ¥æ˜¾ç¤ºã€‚å¸¸è§„çš„ pc çš„ç½‘ç«™éƒ½æ˜¯é™æ€ï¼ˆå®šå®½åº¦ï¼‰å¸ƒå±€çš„ï¼Œä¹Ÿå°±æ˜¯è®¾ç½®äº† min-widthï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æœå°äºè¿™ä¸ªå®½åº¦å°±ä¼šå‡ºç°æ»šåŠ¨æ¡ï¼Œå¦‚æœå¤§äºè¿™ä¸ªå®½åº¦åˆ™å†…å®¹å±…ä¸­å¤–åŠ èƒŒæ™¯ï¼Œè¿™ç§è®¾è®¡å¸¸è§äº pc ç«¯ã€‚\n\n  <!-- more -->\n\n### è®¾è®¡æ–¹æ³•\n\n- PCï¼šå±…ä¸­å¸ƒå±€ï¼Œæ‰€æœ‰æ ·å¼ä½¿ç”¨ç»å¯¹å®½åº¦/é«˜åº¦(px)ï¼Œè®¾è®¡ä¸€ä¸ª Layoutï¼Œåœ¨å±å¹•å®½é«˜æœ‰è°ƒæ•´æ—¶ï¼Œä½¿ç”¨æ¨ªå‘å’Œç«–å‘çš„æ»šåŠ¨æ¡æ¥æŸ¥é˜…è¢«é®æ©éƒ¨åˆ†ï¼›\n\n```css\n.wrap {\n  width: 640px;\n  overflow: hidden;\n  margin: 0 auto;\n}\n```\n\nâ€‹ æœ‰å›ºå®šçš„ç‰ˆå‹å¤§å°ï¼Œä¾‹å¦‚ 640pxï¼Œç„¶åè®¾ç½® marginï¼š0 autoï¼›æ¥å±…ä¸­ã€‚å°äº 640 æ—¶å‡ºç°æ»šåŠ¨æ¡ã€‚\n\n- ç§»åŠ¨è®¾å¤‡ï¼šå¦å¤–å»ºç«‹ç§»åŠ¨ç½‘ç«™ï¼Œå•ç‹¬è®¾è®¡ä¸€ä¸ªå¸ƒå±€ï¼Œä½¿ç”¨ä¸åŒçš„åŸŸåå¦‚ wap.æˆ– m.ã€‚åœ¨ `<viewport meta>` æ ‡ç­¾ä¸Šè®¾ç½® `width`ï¼Œé¡µé¢çš„å„ä¸ªå…ƒç´ ä¹Ÿé‡‡ç”¨`px`ä½œä¸ºå•ä½ã€‚é€šè¿‡ç”¨ JS åŠ¨æ€ä¿®æ”¹æ ‡ç­¾çš„`initial-scale`ä½¿å¾—é¡µé¢ç­‰æ¯”ç¼©æ”¾ï¼Œä»è€Œåˆšå¥½å æ»¡æ•´ä¸ªå±å¹•ã€‚\n\n### å®ç°æ–¹æ³•\n\n- æ™®é€š/æ–‡æ¡£æµ å¸ƒå±€\n- Float å¸ƒå±€\n- ç»å¯¹å¸ƒå±€\n\n### ä¼˜ç¼ºç‚¹\n\nä¼˜ç‚¹ï¼šè¿™ç§å¸ƒå±€æ–¹å¼å¯¹è®¾è®¡å¸ˆå’Œ CSS ç¼–å†™è€…æ¥è¯´éƒ½æ˜¯æœ€ç®€å•çš„ï¼Œäº¦æ²¡æœ‰å…¼å®¹æ€§é—®é¢˜ã€‚\n\nç¼ºç‚¹ï¼šæ˜¾è€Œæ˜“è§ï¼Œä¸èƒ½æ ¹æ®ç”¨æˆ·çš„å±å¹•å°ºå¯¸åšå‡ºä¸åŒçš„å±•ç°ã€‚å½“å‰ï¼Œå¤§éƒ¨åˆ†é—¨æˆ·ç½‘ç«™ã€å¤§éƒ¨åˆ†ä¼ä¸šçš„ PC å®£ä¼ ç«™ç‚¹éƒ½é‡‡ç”¨äº†è¿™ç§å¸ƒå±€æ–¹å¼ã€‚å›ºå®šåƒç´ å°ºå¯¸çš„ç½‘é¡µæ˜¯åŒ¹é…å›ºå®šåƒç´ å°ºå¯¸æ˜¾ç¤ºå™¨çš„æœ€ç®€å•åŠæ³•ã€‚ä½†è¿™ç§æ–¹æ³•ä¸æ˜¯ä¸€ç§å®Œå…¨å…¼å®¹æœªæ¥ç½‘é¡µçš„åˆ¶ä½œæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›é€‚åº”æœªçŸ¥è®¾å¤‡çš„æ–¹æ³•ã€‚\n\n- çª„å±å¹•æ»šåŠ¨æ¡ä½“éªŒå¾ˆå·®\n- å®½å±æœ‰å¤§ç‰‡ç©ºç™½ï¼Œä¸åˆ©äºç©ºé—´åˆ©ç”¨\n\n## 2.æµå¼å¸ƒå±€\n\næµå¼å¸ƒå±€ï¼ˆLiquidï¼‰çš„ç‰¹ç‚¹ï¼ˆä¹Ÿå«\"Fluid\") æ˜¯**é¡µé¢å…ƒç´ çš„å®½åº¦**æŒ‰ç…§å±å¹•åˆ†è¾¨ç‡è¿›è¡Œé€‚é…è°ƒæ•´ï¼Œä½†æ•´ä½“å¸ƒå±€ä¸å˜ã€‚ä»£è¡¨ä½œæ …æ ç³»ç»Ÿï¼ˆç½‘æ ¼ç³»ç»Ÿï¼‰ã€‚ç½‘é¡µä¸­ä¸»è¦çš„åˆ’åˆ†åŒºåŸŸçš„**å°ºå¯¸ä½¿ç”¨ç™¾åˆ†æ•°**ï¼ˆæ­é… min-*ã€max-*å±æ€§ä½¿ç”¨ï¼‰ï¼Œä¾‹å¦‚ï¼Œè®¾ç½®ç½‘é¡µä¸»ä½“çš„å®½åº¦ä¸º 80%ï¼Œmin-width ä¸º 960pxã€‚å›¾ç‰‡ä¹Ÿä½œç±»ä¼¼å¤„ç†ï¼ˆwidth:100%, max-width ä¸€èˆ¬è®¾å®šä¸ºå›¾ç‰‡æœ¬èº«çš„å°ºå¯¸ï¼Œé˜²æ­¢è¢«æ‹‰ä¼¸è€Œå¤±çœŸï¼‰ã€‚\n\n### å¸ƒå±€ç‰¹ç‚¹\n\nå±å¹•åˆ†è¾¨ç‡å˜åŒ–æ—¶ï¼Œé¡µé¢é‡Œå…ƒç´ çš„å¤§å°ä¼šå˜åŒ–è€Œä½†å¸ƒå±€ä¸å˜ã€‚ã€è¿™å°±å¯¼è‡´å¦‚æœå±å¹•å¤ªå¤§æˆ–è€…å¤ªå°éƒ½ä¼šå¯¼è‡´å…ƒç´ æ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚\n\n### è®¾è®¡æ–¹æ³•\n\n**ä½¿ç”¨%ç™¾åˆ†æ¯”å®šä¹‰å®½åº¦ï¼Œè€Œé«˜åº¦å¤§éƒ½æ˜¯ç”¨ px æ¥å›ºå®šä½**ï¼Œå¯ä»¥æ ¹æ®å¯è§†åŒºåŸŸ (viewport) å’Œçˆ¶å…ƒç´ çš„å®æ—¶å°ºå¯¸è¿›è¡Œè°ƒæ•´ï¼Œå°½å¯èƒ½çš„é€‚åº”å„ç§åˆ†è¾¨ç‡ã€‚å¾€å¾€é…åˆ max-width/min-width ç­‰å±æ€§æ§åˆ¶å°ºå¯¸æµåŠ¨èŒƒå›´ä»¥å…è¿‡å¤§æˆ–è€…è¿‡å°å½±å“é˜…è¯»ã€‚\n\n**è¿™ç§å¸ƒå±€æ–¹å¼åœ¨ Web å‰ç«¯å¼€å‘çš„æ—©æœŸå†å²ä¸Šï¼Œç”¨æ¥åº”å¯¹ä¸åŒå°ºå¯¸çš„ PC å±å¹•**ï¼ˆé‚£æ—¶å±å¹•å°ºå¯¸çš„å·®å¼‚ä¸ä¼šå¤ªå¤§ï¼‰ï¼Œ**åœ¨å½“ä»Šçš„ç§»åŠ¨ç«¯å¼€å‘ä¹Ÿæ˜¯å¸¸ç”¨å¸ƒå±€æ–¹å¼**ã€‚æµå¼å¸ƒå±€ç›®çš„æ˜¯åœ¨ä¸åŒå¤§å°çš„è®¾å¤‡ä¸Š**æ»¡å±å‘ˆç°åŒæ ·ç½‘é¡µ**ã€‚å®ƒæ˜¯ç”¨äºè§£å†³ç±»ä¼¼çš„è®¾å¤‡ä¸åŒåˆ†è¾¨ç‡ä¹‹é—´çš„å…¼å®¹(ä¸€èˆ¬åˆ†è¾¨ç‡å·®å¼‚è¾ƒå°‘)ã€‚\n\n**ç™¾åˆ†æ¯”èƒ½å¤Ÿè®¾ç½®çš„å±æ€§æ˜¯ widthã€heightã€paddingã€marginã€‚å…¶ä»–å±æ€§æ¯”å¦‚ borderã€font-size ä¸èƒ½ç”¨ç™¾åˆ†æ¯”è®¾ç½®çš„ã€‚**\n\n- å¦‚æœç”¨ç™¾åˆ†æ¯”å†™ widthï¼Œé‚£ä¹ˆæŒ‡çš„æ˜¯çˆ¶å…ƒç´  width çš„ç™¾åˆ†ä¹‹å¤šå°‘ã€‚\n- å¦‚æœç”¨ç™¾åˆ†æ¯”å†™ heightï¼Œé‚£ä¹ˆæŒ‡çš„æ˜¯çˆ¶å…ƒç´  height çš„ç™¾åˆ†ä¹‹å¤šå°‘ã€‚\n- å¦‚æœç”¨ç™¾åˆ†æ¯”å†™ paddingï¼Œé‚£ä¹ˆæŒ‡çš„æ˜¯**çˆ¶å…ƒç´  width **çš„ç™¾åˆ†ä¹‹å¤šå°‘ï¼Œæ— è®ºæ˜¯æ°´å¹³çš„ padding è¿˜æ˜¯ç«–ç›´çš„ paddingã€‚\n- å¦‚æœç”¨ç™¾åˆ†æ¯”å†™ marginï¼Œé‚£ä¹ˆæŒ‡çš„æ˜¯**çˆ¶å…ƒç´  width** çš„ç™¾åˆ†ä¹‹å¤šå°‘ï¼Œæ— è®ºæ˜¯æ°´å¹³çš„ margin è¿˜æ˜¯ç«–ç›´çš„ marginã€‚\n- ä¸èƒ½ç”¨ç™¾åˆ†æ¯”å†™ border çš„å®½åº¦\n\n### å®ç°æ–¹æ³•\n\n- å…è®¸ç½‘é¡µå®½åº¦è‡ªåŠ¨è°ƒæ•´ï¼š`<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />`\n- ä¸ä½¿ç”¨ç»å¯¹å°ºå¯¸ï¼ˆåŒ…æ‹¬å®¹å™¨/å­—ä½“/å›¾ç‰‡ï¼‰ï¼Œä½¿ç”¨ç™¾åˆ†æ¯”ã€emã€remã€vwã€vh ç­‰\n- å¯ä½¿ç”¨ flex ç­‰å¼¹æ€§ç›’å­ï¼ˆä¸è¦ä½¿ç”¨ px å®šå°ºå¯¸ï¼‰\n\n### ä¼˜ç¼ºç‚¹\n\nä¼˜ç‚¹ï¼šé¡µé¢å·¦å³æ»¡å±ã€‚\n\nä½†ç¼ºç‚¹æ˜æ˜¾ï¼š\n\nä¸»è¦çš„é—®é¢˜\\*\\*æ˜¯å¦‚æœå±å¹•å°ºåº¦è·¨åº¦å¤ªå¤§ï¼Œé‚£ä¹ˆåœ¨ç›¸å¯¹å…¶åŸå§‹è®¾è®¡è€Œè¨€è¿‡å°æˆ–è¿‡å¤§çš„å±å¹•ä¸Šä¸èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚å› ä¸ºå®½åº¦ä½¿ç”¨%ç™¾åˆ†æ¯”å®šä¹‰ï¼Œä½†æ˜¯é«˜åº¦å’Œæ–‡å­—å¤§å°ç­‰å¤§éƒ½æ˜¯ç”¨ px æ¥å›ºå®šï¼Œæ‰€ä»¥åœ¨å¤§å±å¹•çš„æ‰‹æœºä¸‹æ˜¾ç¤ºæ•ˆæœä¼šå˜æˆæœ‰äº›é¡µé¢å…ƒç´ å®½åº¦è¢«æ‹‰çš„å¾ˆé•¿ï¼Œä½†æ˜¯é«˜åº¦ã€æ–‡å­—å¤§å°è¿˜æ˜¯å’ŒåŸæ¥ä¸€æ ·ï¼ˆå³ï¼Œè¿™äº›ä¸œè¥¿æ— æ³•å˜å¾—â€œæµå¼â€ï¼‰ï¼Œæ˜¾ç¤ºéå¸¸ä¸åè°ƒ\n\n- ä½¿ç”¨ç™¾åˆ†æ¯”å®šä¹‰ï¼Œæ‰€ä»¥åœ¨å¤§å±å¹•çš„æ‰‹æœº/Pad ä¸‹ï¼ˆæˆ–è€…æ¨ªå±ä¸‹ï¼‰æ˜¾ç¤ºæ•ˆæœä¼šå˜æˆæœ‰äº›é¡µé¢å…ƒç´ è¢«æ‹‰çš„å¾ˆå¤§ï¼Œä½†æ˜¯å†…å®¹æ•°é‡å´ä¸å˜ï¼Œæ˜¾å¾—ç¨€ç–ä¸ç´§å‡‘ï¼Œç©ºé—´åˆ©ç”¨ç‡ä½ä¸‹ã€‚\n- å¦‚æœæ–‡å­—ä¹ŸæŒ‰ç…§ç™¾åˆ†æ¯”æ”¾å¤§ï¼Œåˆ™æ•´ä½“æ•ˆæœä¼šéå¸¸ä¸åè°ƒï¼ˆè€äººæœºæ•ˆæœï¼‰ã€‚\n\n### ä¾‹å­\n\nhttps://www.trip.com/flightsh5/status/\n\n## 3.è‡ªé€‚åº”å¸ƒå±€\n\nè‡ªé€‚åº”å¸ƒå±€çš„ç‰¹ç‚¹æ˜¯åˆ†åˆ«ä¸ºä¸åŒçš„å±å¹•åˆ†è¾¨ç‡å®šä¹‰å¸ƒå±€ï¼Œå³åˆ›å»ºå¤šä¸ªé™æ€å¸ƒå±€ï¼Œæ¯ä¸ªé™æ€å¸ƒå±€å¯¹åº”ä¸€ä¸ªå±å¹•åˆ†è¾¨ç‡èŒƒå›´ã€‚æ”¹å˜å±å¹•åˆ†è¾¨ç‡å¯ä»¥åˆ‡æ¢ä¸åŒçš„é™æ€å±€éƒ¨ï¼ˆé¡µé¢å…ƒç´ ä½ç½®å‘ç”Ÿæ”¹å˜ï¼‰ï¼Œä½†åœ¨æ¯ä¸ªé™æ€å¸ƒå±€ä¸­ï¼Œé¡µé¢å…ƒç´ ä¸éšçª—å£å¤§å°çš„è°ƒæ•´å‘ç”Ÿå˜åŒ–ã€‚å¯ä»¥æŠŠè‡ªé€‚åº”å¸ƒå±€çœ‹ä½œæ˜¯é™æ€å¸ƒå±€çš„ä¸€ä¸ªåˆé›†ã€‚\n\n### å¸ƒå±€ç‰¹ç‚¹\n\nå±å¹•åˆ†è¾¨ç‡å˜åŒ–æ—¶ï¼Œé¡µé¢é‡Œé¢å…ƒç´ çš„ä½ç½®ä¼šå˜åŒ–è€Œå¤§å°ä¸ä¼šå˜åŒ–ã€‚\n\n### è®¾è®¡æ–¹æ³•\n\nä½¿ç”¨ @media åª’ä½“æŸ¥è¯¢ç»™ä¸åŒå°ºå¯¸å’Œä»‹è´¨çš„è®¾å¤‡åˆ‡æ¢ä¸åŒçš„æ ·å¼ã€‚åœ¨ä¼˜ç§€çš„å“åº”èŒƒå›´è®¾è®¡ä¸‹å¯ä»¥ç»™é€‚é…èŒƒå›´å†…çš„è®¾å¤‡æœ€å¥½çš„ä½“éªŒï¼Œåœ¨åŒä¸€ä¸ªè®¾å¤‡ä¸‹å®é™…è¿˜æ˜¯å›ºå®šçš„å¸ƒå±€ã€‚\n\n### å®ç°æ–¹å¼\n\n- é™æ€å¸ƒå±€æ–¹æ³•\n- åˆ†è¾¨ç‡ detectorï¼ˆmedia query/server-side detector/UAï¼‰\n\n### ä¼˜ç¼ºç‚¹\n\nä¼˜ç‚¹ï¼šè‡ªé€‚åº”å¸ƒå±€**é¡µé¢é‡Œé¢å…ƒç´ çš„ä½ç½®ä¼šå˜åŒ–ï¼Œå¾ˆå¥½çš„è§£å†³äº†æµå¼å¸ƒå±€ä¸­çš„å¤§å±ç©ºé—´åˆ©ç”¨ç‡ä¸é«˜å¼Šç«¯**ã€‚\n\nç¼ºç‚¹ï¼šå•ä¸ªå¸ƒå±€å®¹å™¨æ— æ³•çµæ´»ä¼¸ç¼©ï¼Œæœªè§¦å‘å¸ƒå±€åˆ‡æ¢çš„æƒ…å†µä¸‹ï¼Œå®¹å™¨ä»ç„¶å®¹æ˜“å‡ºç°é™æ€å¸ƒå±€ä¸­æåˆ°çš„é—®é¢˜ã€‚\n\n### ä¾‹å­\n\n[www.baidu.com/](https://link.juejin.im/?target=https%3A%2F%2Fwww.baidu.com%2F)\n\n### è‡ªé€‚åº”è®¾è®¡ï¼ˆAWDï¼‰\n\nè‡ªé€‚åº”è®¾è®¡æ˜¯é€šè¿‡**æœåŠ¡ç«¯æ£€æµ‹è®¾å¤‡ç±»å‹ã€ä» site çš„ä¸åŒç‰ˆæœ¬ä¸­é€‰æ‹©æœ€åˆé€‚è¯¥è®¾å¤‡ç±»å‹çš„è®¾è®¡å¸ƒå±€/å°ºå¯¸çš„ç‰ˆæœ¬è¿›è¡Œå±•ç¤ºã€‚**å®ƒå¯ä»¥ä½¿ç”¨åˆ°æ‰€æœ‰ï¼ˆåŒ…æ‹¬å“åº”å¼å¸ƒå±€ï¼‰å¸ƒå±€æ–¹æ¡ˆã€‚\n\nå®ç°æ–¹å¼ï¼š\n\n- server-side detection\n\n- different versions to different devices\n\n  å¯¹äº PC: å¯ä½¿ç”¨æµå¼å¸ƒå±€ï¼›\n\n  å¯¹äº Mobile: å¯ä½¿ç”¨æµå¼å¸ƒå±€ã€‚æ¨èä¸€ä¸ª Rem è§£å†³æ–¹æ¡ˆï¼š\n\n  - è®¾ç½®å…ƒç´ ï¼ˆå¯ä»¥åŒ…æ‹¬å­—ä½“ç­‰ï¼‰å¤§å°ä¸º `rem` ï¼ˆ`rem` æ˜¯ä»¥è·Ÿå…ƒç´ `font-size`ä¸ºåŸºå‡†çš„å•ä½ï¼‰\n  - æŒ‰ç…§å±å¹•å®½åº¦çš„ä¸åŒï¼ŒJS åŠ¨æ€è®¾ç½® `<html>` çš„ `font-size` å¤§å°ï¼Œå…ƒç´ åŒæ ·ä¼šæŒ‰ç…§å±å¹•å®½åº¦ç­‰æ¯”ä¾‹æ”¾å¤§ç¼©å°\n\nä¸¾ä¸ªæ —å­ï¼š[www.trip.com/](https://link.juejin.im/?target=https%3A%2F%2Fwww.trip.com%2F)\n\n## 4.å“åº”å¼å¸ƒå±€ï¼ˆåª’ä½“æŸ¥è¯¢ï¼‰\n\néšç€ CSS3 å‡ºç°äº†åª’ä½“æŸ¥è¯¢æŠ€æœ¯ï¼Œåˆå‡ºç°äº†å“åº”å¼è®¾è®¡çš„æ¦‚å¿µã€‚å“åº”å¼è®¾è®¡çš„ç›®æ ‡æ˜¯ç¡®ä¿ä¸€ä¸ªé¡µé¢åœ¨æ‰€æœ‰ç»ˆç«¯ä¸Šï¼ˆå„ç§å°ºå¯¸çš„ PCã€æ‰‹æœºã€æ‰‹è¡¨ã€å†°ç®±çš„ Web æµè§ˆå™¨ç­‰ç­‰ï¼‰éƒ½èƒ½æ˜¾ç¤ºå‡ºä»¤äººæ»¡æ„çš„æ•ˆæœï¼Œå¯¹ CSS ç¼–å†™è€…è€Œè¨€ï¼Œåœ¨å®ç°ä¸Šä¸æ‹˜æ³¥äºå…·ä½“æ‰‹æ³•ï¼Œä½†é€šå¸¸æ˜¯ç³…åˆäº†æµå¼å¸ƒå±€+å¼¹æ€§å¸ƒå±€ï¼Œå†æ­é…åª’ä½“æŸ¥è¯¢æŠ€æœ¯ä½¿ç”¨ã€‚â€”â€”åˆ†åˆ«ä¸ºä¸åŒçš„å±å¹•åˆ†è¾¨ç‡å®šä¹‰å¸ƒå±€ï¼ŒåŒæ—¶ï¼Œåœ¨æ¯ä¸ªå¸ƒå±€ä¸­ï¼Œåº”ç”¨æµå¼å¸ƒå±€çš„ç†å¿µï¼Œå³é¡µé¢å…ƒç´ å®½åº¦éšç€çª—å£è°ƒæ•´è€Œè‡ªåŠ¨é€‚é…ã€‚å³ï¼šåˆ›å»ºå¤šä¸ªæµä½“å¼å¸ƒå±€ï¼Œåˆ†åˆ«å¯¹åº”ä¸€ä¸ªå±å¹•åˆ†è¾¨ç‡èŒƒå›´ã€‚æ”¹å˜å±å¹•åˆ†è¾¨ç‡å¯ä»¥é€šè¿‡ CSS Media query å®æ—¶åœ°åˆ‡æ¢ä¸åŒçš„å¸ƒå±€ï¼ˆé¡µé¢å…ƒç´ ä½ç½®å¯èƒ½å‘ç”Ÿæ”¹å˜ï¼‰ï¼Œåœ¨æ¯ä¸ªå¸ƒå±€ä¸­ï¼Œé¡µé¢å…ƒç´ ä¼šéšçª—å£å¤§å°çš„è°ƒæ•´å‘ç”Ÿæµå¼å¸ƒå±€ä¸­çš„è‡ªåŠ¨å°ºå¯¸å˜åŒ–ã€‚å¯ä»¥æŠŠå“åº”å¼å¸ƒå±€çœ‹ä½œæ˜¯æµå¼å¸ƒå±€å’Œè‡ªé€‚åº”å¸ƒå±€è®¾è®¡ç†å¿µçš„èåˆã€‚\n\nå“åº”å¼å‡ ä¹å·²ç»æˆä¸ºä¼˜ç§€é¡µé¢å¸ƒå±€çš„æ ‡å‡†ã€‚\n\n### å¸ƒå±€ç‰¹ç‚¹\n\næ¯ä¸ªå±å¹•åˆ†è¾¨ç‡ä¸‹é¢ä¼šæœ‰ä¸€ä¸ªå¸ƒå±€æ ·å¼ï¼Œå³å…ƒç´ ä½ç½®å’Œå¤§å°éƒ½ä¼šå˜ã€‚\n\n### è®¾è®¡æ–¹æ³•\n\nåª’ä½“æŸ¥è¯¢+æµå¼å¸ƒå±€ã€‚é€šå¸¸ä½¿ç”¨ @media åª’ä½“æŸ¥è¯¢å’Œç½‘æ ¼ç³»ç»Ÿ (Grid System) é…åˆç›¸å¯¹å¸ƒå±€å•ä½è¿›è¡Œå¸ƒå±€ï¼Œå®é™…ä¸Šå°±æ˜¯ç»¼åˆå“åº”å¼ã€æµåŠ¨ç­‰ä¸Šè¿°æŠ€æœ¯é€šè¿‡ CSS ç»™å•ä¸€ç½‘é¡µä¸åŒè®¾å¤‡è¿”å›ä¸åŒæ ·å¼çš„æŠ€æœ¯ç»Ÿç§°ã€‚\n\n### å®ç°æ–¹å¼\n\n- æµå¼å¸ƒå±€\n- CSS media query\n\n### ä¼˜ç¼ºç‚¹\n\nä¼˜ç‚¹ï¼šé€‚åº” pc å’Œç§»åŠ¨ç«¯ï¼Œå¦‚æœè¶³å¤Ÿè€å¿ƒï¼Œæ•ˆæœå®Œç¾ã€‚èåˆäº†æµå¼å¸ƒå±€å’Œè‡ªé€‚åº”å¸ƒå±€çš„ä¼˜åŠ¿ã€‚\n\nç¼ºç‚¹ï¼š\n\n- åª’ä½“æŸ¥è¯¢æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æšä¸¾å‡ºæ¥çš„ï¼Œåªèƒ½é€‚åº”ä¸»æµçš„å®½é«˜ã€‚\n- è¦åŒ¹é…è¶³å¤Ÿå¤šçš„å±å¹•å¤§å°ï¼Œå·¥ä½œé‡ä¸å°ï¼Œè®¾è®¡ä¹Ÿéœ€è¦å¤šä¸ªç‰ˆæœ¬ã€‚\n- CSS ä»£ç ç¹çï¼Œå¯¹äºç‰¹å®šçš„è®¾å¤‡æœ‰è¾ƒå¤šå†—ä½™ï¼Œé€‚ç”¨äºå¯¹äºå„ä¸ªç»ˆç«¯ï¼ˆç‰¹åˆ«æ˜¯ç§»åŠ¨ç«¯ï¼‰æ€§èƒ½è¦æ±‚ä¸é«˜çš„ Blog Dos ç«™ç‚¹ã€‚\n\nå“åº”å¼é¡µé¢åœ¨å¤´éƒ¨ä¼šåŠ ä¸Šè¿™ä¸€æ®µä»£ç ï¼š\n\n```html\n<meta name=\"applicable-device\" content=\"pc,mobile\" />\n<meta http-equiv=\"Cache-Control\" content=\"no-transform \" />\n```\n\n### ä¾‹å­\n\n[elevenbeans.github.io/](https://link.juejin.im/?target=http%3A%2F%2Felevenbeans.github.io%2F)\n\n### å“åº”å¼è®¾è®¡ï¼ˆRWDï¼‰\n\nå“åº”å¼è®¾è®¡åŸºäºå“åº”å¼å¸ƒå±€ï¼Œ**ä½¿ç”¨åŒä¸€å¥—é¡µé¢åœ¨å„ç§å„æ ·ä¸åŒå¤§å°çš„è®¾å¤‡ä¸Šè¿›è¡Œå¤§å°åˆé€‚ã€å¸ƒå±€ï¼ˆç”šè‡³åŠŸèƒ½ï¼‰åˆç†çš„å±•ç°ã€‚**\n\nå“åº”å¼è®¾è®¡ä¼šæ ¹æ®è¯†åˆ«å±å¹•å®½åº¦å¯¹äºå±•ç¤ºçš„å…·ä½“å†…å®¹å—è¿›è¡Œä½ç½®è°ƒæ•´ï¼Œç”šè‡³å±•ç¤ºå’Œéšè—ã€‚\n\nå®ç°æ–¹å¼ï¼š\n\n- å“åº”å¼å¸ƒå±€\n- ç‰¹æ€§æ£€æµ‹ ï¼ˆç”¨äºç½‘é¡µåŠŸèƒ½çš„æ¸è¿›å¢å¼ºï¼‰\n\n> ä¸¾ä¸ªæ —å­ï¼š[elevenbeans.github.io/ï¼Œ](https://link.juejin.im/?target=http%3A%2F%2Felevenbeans.github.io%2Fï¼Œ)\n\n### RWD å’Œ AWD çš„å¼‚åŒ\n\nç›¸åŒç‚¹ï¼š\n\n- å‡é’ˆå¯¹ä¸åŒçš„åˆ†è¾¨ç‡/device é‡‡ç”¨ä¸åŒçš„æ ·å¼å’Œå¸ƒå±€è¾¾åˆ°é¡µé¢å±•ç¤ºæœ€ä¼˜\n- å¸ƒå±€æ–¹å¼æœ¬è´¨æ²¡æœ‰å·®åˆ«ï¼ˆAWD ä¹Ÿ including responsive layoutï¼‰\n\nä¸åŒç‚¹ï¼š\n\n- å‰è€…å¼ºè°ƒåŒä¸€å¥—é¡µé¢å¤šç«¯å…¼å®¹å±•ç¤ºï¼Œè€Œåè€…ç»™å‡ºå¤šå¥—é¡µé¢ï¼Œå¯¹äºä¸åŒ device è¿›è¡Œäº†åˆ†ç±»å¤„ç†\n- å‰è€…æ˜¯é€šè¿‡ CSS Media query è¿›è¡Œåˆ†è¾¨ç‡æ£€æµ‹ï¼Œå¯ä»¥å®æ—¶çš„å“åº”æµè§ˆå™¨å°ºå¯¸å˜åŒ–ï¼Œæ”¹å˜å…ƒç´ å°ºå¯¸/å¸ƒå±€ï¼Œè€Œåè€…ä¸€èˆ¬æ˜¯ server side detectionï¼Œä¸€æ¬¡æ€§æ¸²æŸ“æ—¢å®šå¸ƒå±€å’Œæ ·å¼\n\n### åª’ä½“æŸ¥è¯¢ç”¨æ³•\n\n- #### å¼€å§‹åœ¨ html ä¸­å†™å…¥ Media\n\nåœ¨ html å¤´éƒ¨æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œç”¨æ¥æ˜¾ç¤ºå…¼å®¹ç§»åŠ¨è®¾å¤‡çš„æ˜¾ç¤ºæ•ˆæœ\n\n```html\n<meta\n  name=\"viewport\"\n  content=\"width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no\"\n/>\n```\n\nå‚æ•°è¯¦è§£ï¼š\n\n`width=device-width` ï¼šå®½åº¦ç­‰äºå½“å‰è®¾å¤‡çš„å®½åº¦\n\n`initial-scale=1` ï¼šåˆå§‹çš„ç¼©æ”¾æ¯”ä¾‹ã€‚ï¼ˆé»˜è®¤ä¸º 1ï¼‰\n\n`minimum-scale=1` ï¼šå…è®¸ç”¨æˆ·ç¼©æ”¾åˆ°çš„æœ€å°æ¯”ä¾‹ã€‚ï¼ˆé»˜è®¤ä¸º 1ï¼‰\n\n`maximum-scale=1` ï¼šå…è®¸ç”¨æˆ·ç¼©æ”¾åˆ°çš„æœ€å¤§æ¯”ä¾‹ã€‚ï¼ˆé»˜è®¤ä¸º 1ï¼‰\n\n`user-scalable=no` ï¼šç”¨æˆ·æ˜¯å¦å¯ä»¥æ‰‹åŠ¨ç¼©æ”¾ï¼ˆé»˜è®¤ä¸º noï¼‰\n\n- #### å¼•å…¥åŒ…å« Media çš„ css æ–‡ä»¶\n\n  **æˆ‘ä»¬åœ¨åª’ä½“æŸ¥è¯¢å¤–é¢å†™çš„ç¬¬ä¸€æ¡è§„åˆ™ï¼Œæ˜¯â€œåŸºæœ¬çš„â€æ ·å¼ï¼Œå®ƒé€‚ç”¨äºä»»ä½•è®¾å¤‡ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å†ä¸ºä¸åŒè§†å£ã€ä¸åŒèƒ½åŠ›çš„è®¾å¤‡ï¼Œæ¸è¿›å¢åŠ ä¸åŒçš„è§†è§‰æ•ˆæœå’ŒåŠŸèƒ½ã€‚**(**IE6ã€7ã€8 ä¸æ”¯æŒåª’ä½“æŸ¥è¯¢ï¼Œä¹Ÿä¸ºäº†é˜²æ­¢æ‰‹æœºç«¯çš„æŸäº›æµè§ˆå™¨ä¸æ”¯æŒåª’ä½“æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¸è¦æŠŠæ‰€æœ‰çš„é€‰æ‹©å™¨éƒ½æ”¾åœ¨åª’ä½“æŸ¥è¯¢é‡Œé¢ã€‚**)\n\n  ```css\n  body {\n    background-color: grey;\n  }\n  @media screen and (min-width: 1200px) {\n    body {\n      background-color: pink;\n    }\n  }\n  @media screen and (min-width: 700px) and (max-width: 1200px) {\n    body {\n      background-color: blue;\n    }\n  }\n  @media screen and (max-width: 700px) {\n    body {\n      background-color: orange;\n    }\n  }\n  ```\n\n1. åª’ä½“ç±»å‹\n\n   | å€¼         | æè¿°                                                                  |\n   | :--------- | :-------------------------------------------------------------------- |\n   | all        | ç”¨äºæ‰€æœ‰è®¾å¤‡                                                          |\n   | aural      | å·²åºŸå¼ƒã€‚ç”¨äºè¯­éŸ³å’Œå£°éŸ³åˆæˆå™¨                                          |\n   | braille    | å·²åºŸå¼ƒã€‚ åº”ç”¨äºç›²æ–‡è§¦æ‘¸å¼åé¦ˆè®¾å¤‡                                     |\n   | embossed   | å·²åºŸå¼ƒã€‚ ç”¨äºæ‰“å°çš„ç›²äººå°åˆ·è®¾å¤‡                                       |\n   | handheld   | å·²åºŸå¼ƒã€‚ ç”¨äºæŒä¸Šè®¾å¤‡æˆ–æ›´å°çš„è£…ç½®ï¼Œå¦‚ PDA å’Œå°å‹ç”µè¯                  |\n   | print      | ç”¨äºæ‰“å°æœºå’Œæ‰“å°é¢„è§ˆ                                                  |\n   | projection | å·²åºŸå¼ƒã€‚ ç”¨äºæŠ•å½±è®¾å¤‡                                                 |\n   | screen     | ç”¨äºç”µè„‘å±å¹•ï¼Œå¹³æ¿ç”µè„‘ï¼Œæ™ºèƒ½æ‰‹æœºç­‰ã€‚                                  |\n   | speech     | åº”ç”¨äºå±å¹•é˜…è¯»å™¨ç­‰å‘å£°è®¾å¤‡                                            |\n   | tty        | å·²åºŸå¼ƒã€‚ ç”¨äºå›ºå®šçš„å­—ç¬¦ç½‘æ ¼ï¼Œå¦‚ç”µæŠ¥ã€ç»ˆç«¯è®¾å¤‡å’Œå¯¹å­—ç¬¦æœ‰é™åˆ¶çš„ä¾¿æºè®¾å¤‡ |\n   | tv         | å·²åºŸå¼ƒã€‚ ç”¨äºç”µè§†å’Œç½‘ç»œç”µè§†                                           |\n\n2. é€»è¾‘æ“ä½œç¬¦\n\n   - `and`æ“ä½œç¬¦ç”¨æ¥æŠŠå¤šä¸ª[åª’ä½“å±æ€§](https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Media_queries#Media_features)ç»„åˆæˆä¸€æ¡åª’ä½“æŸ¥è¯¢ï¼Œå¯¹æˆé“¾å¼çš„ç‰¹å¾è¿›è¡Œè¯·æ±‚ï¼Œåªæœ‰å½“æ¯ä¸ªå±æ€§éƒ½ä¸ºçœŸæ—¶ï¼Œç»“æœæ‰ä¸ºçœŸã€‚\n   - `not`æ“ä½œç¬¦ç”¨æ¥å¯¹ä¸€æ¡åª’ä½“æŸ¥è¯¢çš„ç»“æœè¿›è¡Œå–åã€‚\n   - `only`æ“ä½œç¬¦ä»…åœ¨åª’ä½“æŸ¥è¯¢åŒ¹é…æˆåŠŸçš„æƒ…å†µä¸‹è¢«ç”¨äºåº”ç”¨ä¸€ä¸ªæ ·å¼ï¼Œè¿™å¯¹äºé˜²æ­¢è®©é€‰ä¸­çš„æ ·å¼åœ¨è€å¼æµè§ˆå™¨ä¸­è¢«åº”ç”¨åˆ°ã€‚\n   - ä¹Ÿå¯ä»¥å°†å¤šä¸ªåª’ä½“æŸ¥è¯¢ä»¥é€—å·åˆ†éš”æ”¾åœ¨ä¸€èµ·ï¼›åªè¦å…¶ä¸­ä»»ä½•ä¸€ä¸ªä¸ºçœŸï¼Œæ•´ä¸ªåª’ä½“è¯­å¥å°±è¿”å›çœŸã€‚ç›¸å½“äº`or`æ“ä½œç¬¦ã€‚\n   - è‹¥ä½¿ç”¨äº†`not`æˆ–`only`æ“ä½œç¬¦ï¼Œå¿…é¡»æ˜ç¡®æŒ‡å®šä¸€ä¸ªåª’ä½“ç±»å‹ã€‚\n\n3. åª’ä½“åŠŸèƒ½\n\n   | å€¼                  | æè¿°                                                                             | å€¼                      | åª’ä½“           | æ˜¯å¦æ¥å— min/max å‰ç¼€ |\n   | :------------------ | :------------------------------------------------------------------------------- | ----------------------- | -------------- | --------------------- |\n   | aspect-ratio        | å®šä¹‰è¾“å‡ºè®¾å¤‡ä¸­çš„é¡µé¢å¯è§åŒºåŸŸå®½åº¦ä¸é«˜åº¦çš„æ¯”ç‡                                     | <ratio>                 | visual/tactile | æ˜¯                    |\n   | color               | å®šä¹‰è¾“å‡ºè®¾å¤‡æ¯ä¸€ç»„å½©è‰²åŸä»¶çš„ä¸ªæ•°ã€‚å¦‚æœä¸æ˜¯å½©è‰²è®¾å¤‡ï¼Œåˆ™å€¼ç­‰äº 0                   | <integer>               | visual         | æ˜¯                    |\n   | color-index         | å®šä¹‰åœ¨è¾“å‡ºè®¾å¤‡çš„å½©è‰²æŸ¥è¯¢è¡¨ä¸­çš„æ¡ç›®æ•°ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨å½©è‰²æŸ¥è¯¢è¡¨ï¼Œåˆ™å€¼ç­‰äº 0         | <integer>               | visual         | æ˜¯                    |\n   | device-aspect-ratio | å®šä¹‰è¾“å‡ºè®¾å¤‡çš„å±å¹•å¯è§å®½åº¦ä¸é«˜åº¦çš„æ¯”ç‡ã€‚                                         | <ratio>                 | visual/tactile | æ˜¯                    |\n   | device-height       | å®šä¹‰è¾“å‡ºè®¾å¤‡çš„å±å¹•å¯è§é«˜åº¦ã€‚                                                     | <length>                | visual/tactile | æ˜¯                    |\n   | device-width        | å®šä¹‰è¾“å‡ºè®¾å¤‡çš„å±å¹•å¯è§å®½åº¦ã€‚                                                     | <length>                | visual/tactile | æ˜¯                    |\n   | grid                | ç”¨æ¥æŸ¥è¯¢è¾“å‡ºè®¾å¤‡æ˜¯å¦ä½¿ç”¨æ …æ ¼æˆ–ç‚¹é˜µã€‚                                             | <integer>               | all            | å¦                    |\n   | height              | å®šä¹‰è¾“å‡ºè®¾å¤‡ä¸­çš„é¡µé¢å¯è§åŒºåŸŸé«˜åº¦ã€‚                                               | <length>                | visual/tactile | æ˜¯                    |\n   | monochrome          | å®šä¹‰åœ¨ä¸€ä¸ªå•è‰²æ¡†æ¶ç¼“å†²åŒºä¸­æ¯åƒç´ åŒ…å«çš„å•è‰²åŸä»¶ä¸ªæ•°ã€‚å¦‚æœä¸æ˜¯å•è‰²è®¾å¤‡ï¼Œåˆ™å€¼ç­‰äº 0 | <integer>               | visual         | æ˜¯                    |\n   | orientation         | å®šä¹‰è¾“å‡ºè®¾å¤‡ä¸­çš„é¡µé¢å¯è§åŒºåŸŸé«˜åº¦æ˜¯å¦å¤§äºæˆ–ç­‰äºå®½åº¦ã€‚                             | landscape`|`portrait    | visual         | å¦                    |\n   | resolution          | å®šä¹‰è®¾å¤‡çš„åˆ†è¾¨ç‡ã€‚å¦‚ï¼š96dpi, 300dpi, 118dpcm                                     | <resolution>            | bitmap         | æ˜¯                    |\n   | scan                | å®šä¹‰ç”µè§†ç±»è®¾å¤‡çš„æ‰«æå·¥åºã€‚                                                       | progressive`|`interlace | tv             | å¦                    |\n   | width               | å®šä¹‰è¾“å‡ºè®¾å¤‡ä¸­çš„é¡µé¢å¯è§åŒºåŸŸå®½åº¦ã€‚                                               | <length>                | visual/tactile | æ˜¯                    |\n\n## 5.å¼¹æ€§å¸ƒå±€ï¼ˆflexï¼‰\n\nFlex æ˜¯ Flexible Box çš„ç¼©å†™ï¼Œæ„ä¸º\"å¼¹æ€§å¸ƒå±€\"ï¼Œç”¨æ¥ä¸ºç›’çŠ¶æ¨¡å‹æä¾›æœ€å¤§çš„çµæ´»æ€§ã€‚å¼•å…¥å¼¹æ€§ç›’å¸ƒå±€æ¨¡å‹çš„ç›®çš„æ˜¯æä¾›ä¸€ç§æ›´åŠ æœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹ä¸€ä¸ªå®¹å™¨ä¸­çš„å­å…ƒç´ è¿›è¡Œæ’åˆ—ã€å¯¹é½å’Œåˆ†é…ç©ºç™½ç©ºé—´ï¼ˆä»–ä¼šæ ¹æ®é¡µé¢çš„å‰©ä½™å®½åº¦è‡ªåŠ¨åˆ†é…ç©ºé—´ï¼‰ã€‚\n\né‡‡ç”¨ Flex å¸ƒå±€çš„å…ƒç´ ï¼Œç§°ä¸º Flex å®¹å™¨ï¼ˆflex containerï¼‰ï¼Œç®€ç§°\"å®¹å™¨\"ã€‚å®ƒçš„æ‰€æœ‰å­å…ƒç´ è‡ªåŠ¨æˆä¸ºå®¹å™¨æˆå‘˜ï¼Œç§°ä¸º Flex é¡¹ç›®ï¼ˆflex itemï¼‰ï¼Œç®€ç§°\"é¡¹ç›®\"ã€‚\n\nå®¹å™¨é»˜è®¤å­˜åœ¨ä¸¤æ ¹è½´ï¼šæ°´å¹³çš„ä¸»è½´ï¼ˆmain axisï¼‰å’Œå‚ç›´çš„äº¤å‰è½´ï¼ˆcross axisï¼‰ã€‚ä¸»è½´çš„å¼€å§‹ä½ç½®ï¼ˆä¸è¾¹æ¡†çš„äº¤å‰ç‚¹ï¼‰å«åš`main start`ï¼Œç»“æŸä½ç½®å«åš`main end`ï¼›äº¤å‰è½´çš„å¼€å§‹ä½ç½®å«åš`cross start`ï¼Œç»“æŸä½ç½®å«åš`cross end`ã€‚\n\né¡¹ç›®é»˜è®¤æ²¿ä¸»è½´æ’åˆ—ã€‚å•ä¸ªé¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´å«åš`main size`ï¼Œå æ®çš„äº¤å‰è½´ç©ºé—´å«åš`cross size`ã€‚\n\n### å®¹å™¨çš„å±æ€§\n\n**åŸºæœ¬è¯­æ³•ï¼š**\n\n```css\n.box {\n  display: flex; /* æˆ–è€… inline-flex */\n}\n```\n\nä¸Šè¿°å†™æ³•ï¼Œå®šä¹‰äº†ä¸€ä¸ª flex å®¹å™¨ï¼Œæ ¹æ®è®¾å€¼çš„ä¸åŒå¯ä»¥æ˜¯å—çŠ¶å®¹å™¨æˆ–å†…è”å®¹å™¨ã€‚è¿™ä½¿å¾—ç›´æ¥å­ç»“ç‚¹æ‹¥æœ‰äº†ä¸€ä¸ª flex ä¸Šä¸‹æ–‡ã€‚\n\n- flex-direction\n- flex-wrap\n- flex-flow\n- justify-content\n- align-items\n- align-content\n\n#### 1.flex-direction\n\nå±æ€§å†³å®šä¸»è½´çš„æ–¹å‘ï¼ˆå³é¡¹ç›®çš„æ’åˆ—æ–¹å‘ï¼‰ã€‚\n\n- `row`ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å·¦ç«¯ã€‚\n- `row-reverse`ï¼šä¸»è½´ä¸ºæ°´å¹³æ–¹å‘ï¼Œèµ·ç‚¹åœ¨å³ç«¯ã€‚\n- `column`ï¼šä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸Šæ²¿ã€‚\n- `column-reverse`ï¼šä¸»è½´ä¸ºå‚ç›´æ–¹å‘ï¼Œèµ·ç‚¹åœ¨ä¸‹æ²¿ã€‚\n\n#### 2.flex-wrap\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œé¡¹ç›®éƒ½æ’åœ¨ä¸€æ¡çº¿ï¼ˆåˆç§°\"è½´çº¿\"ï¼‰ä¸Šã€‚`flex-wrap`å±æ€§å®šä¹‰ï¼Œå¦‚æœä¸€æ¡è½´çº¿æ’ä¸ä¸‹ï¼Œå¦‚ä½•æ¢è¡Œã€‚\n\n- `nowrap`ï¼ˆé»˜è®¤ï¼‰ï¼šä¸æ¢è¡Œã€‚\n- `wrap`ï¼šæ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸Šæ–¹ã€‚\n- `wrap-reverse`ï¼šæ¢è¡Œï¼Œç¬¬ä¸€è¡Œåœ¨ä¸‹æ–¹ã€‚\n\n#### 3.flex-flow\n\n`flex-flow`å±æ€§æ˜¯`flex-direction`å±æ€§å’Œ`flex-wrap`å±æ€§çš„ç®€å†™å½¢å¼ï¼Œé»˜è®¤å€¼ä¸º`row nowrap`ã€‚\n\n```css\n.box {\n  flex-flow: <flex-direction> || <flex-wrap>;\n}\n```\n\n#### 4.justify-content\n\nå®šä¹‰äº†é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼ã€‚\n\n- `flex-start`ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå·¦å¯¹é½\n- `flex-end`ï¼šå³å¯¹é½\n- `center`ï¼š å±…ä¸­\n- `space-between`ï¼šä¸¤ç«¯å¯¹é½ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”éƒ½ç›¸ç­‰ã€‚\n- `space-around`ï¼šæ¯ä¸ªé¡¹ç›®ä¸¤ä¾§çš„é—´éš”ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”æ¯”é¡¹ç›®ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iyhrshycj30hp0l7dg9.jpg)\n\n#### 5.align-items\n\nå®šä¹‰é¡¹ç›®åœ¨äº¤å‰è½´ä¸Šå¦‚ä½•å¯¹é½ã€‚\n\n- `flex-start`ï¼šäº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚\n- `flex-end`ï¼šäº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚\n- `center`ï¼šäº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚\n- `baseline`: é¡¹ç›®çš„ç¬¬ä¸€è¡Œæ–‡å­—çš„åŸºçº¿å¯¹é½ã€‚\n- `stretch`ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šå¦‚æœé¡¹ç›®æœªè®¾ç½®é«˜åº¦æˆ–è®¾ä¸º autoï¼Œå°†å æ»¡æ•´ä¸ªå®¹å™¨çš„é«˜åº¦ã€‚\n  ![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iyikbcvij30h50lujrx.jpg)\n\n#### 6.align-content\n\nå®šä¹‰äº†å¤šæ ¹è½´çº¿çš„å¯¹é½æ–¹å¼ã€‚å¦‚æœé¡¹ç›®åªæœ‰ä¸€æ ¹è½´çº¿ï¼Œè¯¥å±æ€§ä¸èµ·ä½œç”¨ã€‚\n\n- `flex-start`ï¼šä¸äº¤å‰è½´çš„èµ·ç‚¹å¯¹é½ã€‚\n- `flex-end`ï¼šä¸äº¤å‰è½´çš„ç»ˆç‚¹å¯¹é½ã€‚\n- `center`ï¼šä¸äº¤å‰è½´çš„ä¸­ç‚¹å¯¹é½ã€‚\n- `space-between`ï¼šä¸äº¤å‰è½´ä¸¤ç«¯å¯¹é½ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”å¹³å‡åˆ†å¸ƒã€‚\n- `space-around`ï¼šæ¯æ ¹è½´çº¿ä¸¤ä¾§çš„é—´éš”éƒ½ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œè½´çº¿ä¹‹é—´çš„é—´éš”æ¯”è½´çº¿ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚\n- `stretch`ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šè½´çº¿å æ»¡æ•´ä¸ªäº¤å‰è½´ã€‚\n  ![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iyj94lshj30h80lumxy.jpg)\n\n### é¡¹ç›®çš„å±æ€§\n\n- `order`\n- `flex-grow`\n- `flex-shrink`\n- `flex-basis`\n- `flex`\n- `align-self`\n\n#### 1.order\n\nå®šä¹‰é¡¹ç›®çš„æ’åˆ—é¡ºåºã€‚æ•°å€¼è¶Šå°ï¼Œæ’åˆ—è¶Šé å‰ï¼Œé»˜è®¤ä¸º 0ã€‚\n\n```css\n.item {\n  order: <integer>;\n}\n```\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iyk0vxo7j30kv0dct8w.jpg)\n\n#### 2.flex-grow\n\nå®šä¹‰é¡¹ç›®çš„æ”¾å¤§æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º`0`ï¼Œå³å¦‚æœå­˜åœ¨å‰©ä½™ç©ºé—´ï¼Œä¹Ÿä¸æ”¾å¤§ã€‚\n\nå¦‚æœæ‰€æœ‰é¡¹ç›®çš„`flex-grow`å±æ€§éƒ½ä¸º 1ï¼Œåˆ™å®ƒä»¬å°†ç­‰åˆ†å‰©ä½™ç©ºé—´ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„`flex-grow`å±æ€§ä¸º 2ï¼Œå…¶ä»–é¡¹ç›®éƒ½ä¸º 1ï¼Œåˆ™å‰è€…å æ®çš„å‰©ä½™ç©ºé—´å°†æ¯”å…¶ä»–é¡¹å¤šä¸€å€ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iylyev7sj30ma05v0sq.jpg)\n\n#### 3.flex-shrink\n\nå®šä¹‰äº†é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º 1ï¼Œå³å¦‚æœç©ºé—´ä¸è¶³ï¼Œè¯¥é¡¹ç›®å°†ç¼©å°ã€‚\n\nå¦‚æœæ‰€æœ‰é¡¹ç›®çš„`flex-shrink`å±æ€§éƒ½ä¸º 1ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶ï¼Œéƒ½å°†ç­‰æ¯”ä¾‹ç¼©å°ã€‚å¦‚æœä¸€ä¸ªé¡¹ç›®çš„`flex-shrink`å±æ€§ä¸º 0ï¼Œå…¶ä»–é¡¹ç›®éƒ½ä¸º 1ï¼Œåˆ™ç©ºé—´ä¸è¶³æ—¶ï¼Œå‰è€…ä¸ç¼©å°ã€‚\n\nè´Ÿå€¼å¯¹è¯¥å±æ€§æ— æ•ˆã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iymkslb9j30jg041glp.jpg)\n\n#### 4.flex-basis\n\nå®šä¹‰äº†åœ¨åˆ†é…å¤šä½™ç©ºé—´ä¹‹å‰ï¼Œé¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´ï¼ˆmain sizeï¼‰ã€‚æµè§ˆå™¨æ ¹æ®è¿™ä¸ªå±æ€§ï¼Œè®¡ç®—ä¸»è½´æ˜¯å¦æœ‰å¤šä½™ç©ºé—´ã€‚å®ƒçš„é»˜è®¤å€¼ä¸º`auto`ï¼Œå³é¡¹ç›®çš„æœ¬æ¥å¤§å°ã€‚\n\nå®ƒå¯ä»¥è®¾ä¸ºè·Ÿ`width`æˆ–`height`å±æ€§ä¸€æ ·çš„å€¼ï¼ˆæ¯”å¦‚ 350pxï¼‰ï¼Œåˆ™é¡¹ç›®å°†å æ®å›ºå®šç©ºé—´ã€‚\n\n#### 5.flex\n\n`flex`å±æ€§æ˜¯`flex-grow`, `flex-shrink` å’Œ `flex-basis`çš„ç®€å†™ï¼Œé»˜è®¤å€¼ä¸º`0 1 auto`ã€‚åä¸¤ä¸ªå±æ€§å¯é€‰ã€‚\n\nè¯¥å±æ€§æœ‰ä¸¤ä¸ªå¿«æ·å€¼ï¼š`auto` (`1 1 auto`) å’Œ none (`0 0 auto`)ã€‚\n\nå»ºè®®ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œè€Œä¸æ˜¯å•ç‹¬å†™ä¸‰ä¸ªåˆ†ç¦»çš„å±æ€§ï¼Œå› ä¸ºæµè§ˆå™¨ä¼šæ¨ç®—ç›¸å…³å€¼ã€‚\n\n#### 6.align-self\n\nå…è®¸å•ä¸ªé¡¹ç›®æœ‰ä¸å…¶ä»–é¡¹ç›®ä¸ä¸€æ ·çš„å¯¹é½æ–¹å¼ï¼Œå¯è¦†ç›–`align-items`å±æ€§ã€‚é»˜è®¤å€¼ä¸º`auto`ï¼Œè¡¨ç¤ºç»§æ‰¿çˆ¶å…ƒç´ çš„`align-items`å±æ€§ï¼Œå¦‚æœæ²¡æœ‰çˆ¶å…ƒç´ ï¼Œåˆ™ç­‰åŒäº`stretch`ã€‚\n\nè¯¥å±æ€§å¯èƒ½å– 6 ä¸ªå€¼ï¼Œé™¤äº† autoï¼Œå…¶ä»–éƒ½ä¸ align-items å±æ€§å®Œå…¨ä¸€è‡´ã€‚\n\n```css\n.item {\n  align-self: auto | flex-start | flex-end | center | baseline | stretch;\n}\n```\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iynadp42j30kn0aut8r.jpg)\n\n### å…¼å®¹æ€§\n\n| Chrome | Safari | Firefox | Opera | IE  | Android | iOS  |\n| ------ | ------ | ------- | ----- | --- | ------- | ---- |\n| 21+    | 6.1+   | 22+     | 12.1+ | 11+ | 4.4+    | 7.1+ |\n\nFlexbox éœ€è¦ä¸€äº›ç‰¹å®šçš„å‰ç¼€ä»¥æ”¯æŒå¤§å¤šæ•°çš„æµè§ˆå™¨ã€‚ç”šè‡³è¿˜å­˜åœ¨å®Œå…¨ä¸åŒçš„å±æ€§åç§°æˆ–å±æ€§å€¼ã€‚è¿™å°±éœ€è¦[Autoprefixer](https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fpostcss%2Fautoprefixer)æˆ–ç±»ä¼¼çš„ CSS åå¤„ç†å™¨çš„è¾…åŠ©ï¼Œå…·ä½“å†…å®¹è¯·å‚è€ƒç›¸å…³æ–‡æ¡£ã€‚\n\n## 6.REM å¸ƒå±€\n\n### rem/em åŒºåˆ«\n\n**rem:å½“å‰é¡µé¢ä¸­å…ƒç´ çš„ REM å•ä½çš„æ ·å¼å€¼éƒ½æ˜¯é’ˆå¯¹äº HTML å…ƒç´ çš„ font-size çš„å€¼è¿›è¡ŒåŠ¨æ€è®¡ç®—çš„**\n\n**em:è¡¨ç¤ºçˆ¶å…ƒç´ çš„å­—å·çš„å€æ•°ã€‚(ç‰¹ä¾‹ï¼šåœ¨ text-indent å±æ€§ä¸­ï¼Œè¡¨ç¤ºæ–‡å­—å®½åº¦)**em å•ä½ä¸ä»…ä»…å¯ä»¥ç”¨æ¥è®¾ç½®å­—å·ï¼Œè¿˜å¯ä»¥è®¾ç½®ä»»ä½•ç›’æ¨¡å‹çš„å±æ€§ï¼Œæ¯”å¦‚ widthã€heightã€paddingã€marginã€borderã€‚\n\nrem ä½œç”¨äºéæ ¹å…ƒç´ æ—¶ï¼Œç›¸å¯¹äºæ ¹å…ƒç´ å­—ä½“å¤§å°ï¼›rem ä½œç”¨äºæ ¹å…ƒç´ å­—ä½“å¤§å°æ—¶ï¼Œç›¸å¯¹äºå…¶å‡ºåˆå§‹å­—ä½“å¤§å°ï¼ˆ16pxï¼‰ã€‚\n\n**rem æœ‰ä¸€ç‚¹ä¼˜åŠ¿å°±æ˜¯å¯ä»¥å’Œåª’ä½“æŸ¥è¯¢é…åˆï¼Œå®ç°å“åº”å¼å¸ƒå±€ï¼š**\n\nä½¿ç”¨ em æˆ– rem å•ä½è¿›è¡Œç›¸å¯¹å¸ƒå±€ï¼Œç›¸å¯¹%ç™¾åˆ†æ¯”æ›´åŠ çµæ´»ï¼ŒåŒæ—¶å¯ä»¥æ”¯æŒæµè§ˆå™¨çš„å­—ä½“å¤§å°è°ƒæ•´å’Œç¼©æ”¾ç­‰çš„æ­£å¸¸æ˜¾ç¤ºï¼Œå› ä¸º em æ˜¯ç›¸å¯¹çˆ¶çº§å…ƒç´ çš„åŸå› æ²¡æœ‰å¾—åˆ°æ¨å¹¿ã€‚ã€ä¸­å›½ç«™ç‚¹åˆ¶ä½œç½‘é¡µçš„æ—¶å€™ï¼Œä¹ æƒ¯ç”¨ CSS å¼ºåˆ¶å®šä¹‰å­—ä½“å¤§å°ï¼Œä¿è¯æ¯ä¸ªäººéƒ½çœ‹åˆ°ä¸€è‡´çš„æ•ˆæœï¼ŒåŒ…æ‹¬ç½‘æ˜“ã€æœç‹è¿™äº›é—¨æˆ·ç½‘ç«™åœ¨å†…çš„å¤§éƒ¨åˆ†ç«™ç‚¹ï¼Œç”¨çš„éƒ½æ˜¯ç»å¯¹å•ä½ pxï¼ˆåƒç´ ï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœä»ç½‘ç«™**æ˜“ç”¨æ€§**æ–¹é¢è€ƒè™‘ï¼Œå­—ä½“å¤§å°åº”è¯¥æ˜¯å¯å˜çš„ï¼Œä¸€äº›è§†åŠ›ä¸æ˜¯é‚£ä¹ˆå¥½çš„äººéœ€è¦æ”¾å¤§å­—ä½“æ‰èƒ½çœ‹å¾—æ¸…é¡µé¢å†…å®¹ã€‚ç„¶è€Œï¼Œå æ®å¤§éƒ¨åˆ†æµè§ˆå™¨å¸‚åœºçš„ IE æ— æ³•è°ƒæ•´é‚£äº›ä½¿ç”¨ px ä½œä¸ºå•ä½çš„å­—ä½“å¤§å°ã€‚å›½å¤–äººå£«éå¸¸é‡è§†ç½‘ç«™çš„æ˜“ç”¨æ€§ï¼Œç›¸å½“ä¸€éƒ¨åˆ†å¤–å›½ç«™ç‚¹å·²ç»ä½¿ç”¨ em ä½œä¸ºå­—ä½“å•ä½ã€‚\n\n### å¸ƒå±€ç‰¹ç‚¹\n\n**åŒ…è£¹æ–‡å­—çš„å„å…ƒç´ çš„å°ºå¯¸é‡‡ç”¨ em/rem åšå•ä½ï¼Œè€Œé¡µé¢çš„ä¸»è¦åˆ’åˆ†åŒºåŸŸçš„å°ºå¯¸ä»ä½¿ç”¨ç™¾åˆ†æ•°æˆ– px åšå•ä½ï¼ˆåŒã€Œæµå¼å¸ƒå±€ã€æˆ–ã€Œé™æ€/å›ºå®šå¸ƒå±€ã€ï¼‰**ã€‚**æ—©æœŸæµè§ˆå™¨ä¸æ”¯æŒæ•´ä¸ªé¡µé¢æŒ‰æ¯”ä¾‹ç¼©æ”¾**ï¼Œä»…æ”¯æŒç½‘é¡µå†…æ–‡å­—å°ºå¯¸çš„æ”¾å¤§ï¼Œè¿™ç§æƒ…å†µä¸‹ã€‚ä½¿ç”¨ em/rem åšå•ä½ï¼Œå¯ä»¥ä½¿åŒ…è£¹æ–‡å­—çš„å…ƒç´ éšç€æ–‡å­—çš„ç¼©æ”¾è€Œç¼©æ”¾ã€‚\n\næµè§ˆå™¨çš„é»˜è®¤å­—ä½“é«˜åº¦ä¸€èˆ¬ä¸º`16px`ï¼Œå³ 1em:16pxï¼Œä½†æ˜¯ 1:16 çš„æ¯”ä¾‹ä¸æ–¹ä¾¿è®¡ç®—ï¼Œä¸ºäº†ä½¿å•ä½ em/rem æ›´ç›´è§‚ï¼ŒCSS ç¼–å†™è€…å¸¸å¸¸å°†é¡µé¢è·ŸèŠ‚ç‚¹å­—ä½“è®¾ä¸º 62.5%ï¼Œæ¯”å¦‚é€‰æ‹©ç”¨ rem æ§åˆ¶å­—ä½“æ—¶ï¼Œå…ˆéœ€è¦è®¾ç½®æ ¹èŠ‚ç‚¹ html çš„å­—ä½“å¤§å°ï¼Œå› ä¸ºæµè§ˆå™¨é»˜è®¤å­—ä½“å¤§å° 16px\\*62.5%=10pxã€‚è¿™æ · 1rem ä¾¿æ˜¯ 10pxï¼Œæ–¹ä¾¿äº†è®¡ç®—ã€‚\n\n### è®¾è®¡æ€æƒ³\n\n1. ä¸€èˆ¬ä¸è¦ç»™å…ƒç´ è®¾ç½®å…·ä½“çš„å®½åº¦,ä½†æ˜¯å¯¹äºä¸€äº›å°å›¾æ ‡å¯ä»¥è®¾å®šå…·ä½“å®½åº¦å€¼\n2. é«˜åº¦å€¼å¯ä»¥è®¾ç½®å›ºå®šå€¼,è®¾è®¡ç¨¿æœ‰å¤šå¤§,æˆ‘ä»¬å°±ä¸¥æ ¼å†™å¤šå¤§\n3. æ‰€æœ‰è®¾ç½®çš„å›ºå®šå€¼éƒ½ç”¨ REM åšå•ä½(é¦–å…ˆåœ¨ HTML ä¸­è®¾ç½®ä¸€ä¸ªåŸºå‡†å€¼ï¼šPX å’Œ REM çš„å¯¹åº”æ¯”ä¾‹,ç„¶ååœ¨æ•ˆæœå›¾ä¸Šè·å– PX å€¼,å¸ƒå±€çš„æ—¶å€™è½¬åŒ–ä¸º REM å€¼)\n4. JS è·å–çœŸå®å±å¹•çš„å®½åº¦,è®©å…¶é™¤ä»¥è®¾è®¡ç¨¿çš„å®½åº¦,ç®—å‡ºæ¯”ä¾‹,æŠŠä¹‹å‰çš„åŸºå‡†å€¼æŒ‰ç…§æ¯”ä¾‹è¿›è¡Œé‡æ–°çš„è®¾å®š,è¿™æ ·é¡¹ç›®å°±å¯ä»¥åœ¨ç§»åŠ¨ç«¯è‡ªé€‚åº”äº†\n\n### ä¼˜ç‚¹\n\næ›´èƒ½é€‚åº”ç¼©è¿›/ä»¥å­—ä½“å•ä½ padding æˆ– marginï¼æµè§ˆå™¨è®¾ç½®å­—ä½“å°ºå¯¸ç­‰æƒ…å†µï¼ˆå› ä¸º em/rem ç›¸å¯¹äºå­—ä½“å¤§å°ï¼Œä¼šåŒæ­¥æ”¹å˜ï¼‰ã€‚ä¾‹å¦‚ï¼šp{ text-indent: 2em; }ã€‚\n\n```css\np {\n  text-indent: 2em;\n}\n```\n\nrem å•ä½å¯¹äºï¼ˆæ ¹æ®å±å¹•å°ºå¯¸ï¼‰è°ƒæ•´é¡µé¢çš„å„å…ƒç´ çš„å°ºå¯¸ã€æ–‡å­—å¤§å°æ—¶æ¯”è¾ƒå¥½ç”¨\n\n### Rem å¸ƒå±€çš„ js å®ç°\n\n```javascript\n// pxè½¬remï¼Œæ–¹ä¾¿æ¨¡æ‹Ÿå°ç¨‹åº rpx\npx2rem($px) {\n  $px / 750 * 10 * 1rem;\n}\n```\n\n```javascript\nif remlayout\n      script.\n        (function flexible (window, document) {\n          var docEl = document.documentElement\n          var dpr = window.devicePixelRatio || 1\n          function setBodyFontSize () {\n            if (document.body) {\n              document.body.style.fontSize = (12 * dpr) + 'px'\n            }\n            else {\n              document.addEventListener('DOMContentLoaded', setBodyFontSize)\n            }\n          }\n          setBodyFontSize()\n          function setRemUnit () {\n            var rem = docEl.clientWidth / 10\n            docEl.style.fontSize = rem + 'px'\n          }\n          setRemUnit()\n          window.addEventListener('resize', setRemUnit)\n          window.addEventListener('pageshow', function (e) {\n            if (e.persisted) { setRemUnit() }\n          })\n\n          if (dpr >= 2) {\n            var fakeBody = document.createElement('body')\n            var testElement = document.createElement('div')\n            testElement.style.border = '.5px solid transparent'\n            fakeBody.appendChild(testElement)\n            docEl.appendChild(fakeBody)\n            if (testElement.offsetHeight === 1) {\n              docEl.classList.add('hairlines')\n            }\n            docEl.removeChild(fakeBody)\n          }\n        }(window, document))\n```\n\n### å¯¹æ¯”ä¸‰ç§æ–¹å¼ï¼ˆå“åº”å¼&&REM&&viewportï¼‰\n\n#### å“åº”å¼çš„ä¼˜ç¼ºç‚¹\n\nä¼˜ç‚¹ï¼šå…¼å®¹æ€§å¥½ï¼Œ@media åœ¨ ie9 ä»¥ä¸Šæ˜¯æ”¯æŒçš„ï¼ŒPC å’Œ MOBILE æ˜¯åŒä¸€å¥—ä»£ç çš„ï¼Œä¸ç”¨åˆ†å¼€ã€‚\n\nç¼ºç‚¹ï¼šè¦å†™å¾— css ç›¸å¯¹å¦å¤–ä¸¤ä¸ªå¤šå¾ˆå¤šï¼Œè€Œä¸”å„ä¸ªæ–­ç‚¹éƒ½è¦åšå¥½ã€‚css æ ·å¼ä¼šç¨å¾®å¤§ç‚¹ï¼Œæ›´éº»çƒ¦ã€‚\n\n#### REM ä¼˜ç¼ºç‚¹\n\nä¼˜ç‚¹ï¼šèƒ½ç»´æŒèƒ½æ•´ä½“çš„å¸ƒå±€æ•ˆæœï¼Œç§»åŠ¨ç«¯å…¼å®¹æ€§å¥½ï¼Œä¸ç”¨å†™å¤šä¸ª css ä»£ç ï¼Œè€Œä¸”è¿˜å¯ä»¥åˆ©ç”¨@media è¿›è¡Œä¼˜åŒ–ã€‚\n\nç¼ºç‚¹ï¼šå¼€å¤´è¦å¼•å…¥ä¸€æ®µ js ä»£ç ï¼Œå•ä½éƒ½è¦æ”¹æˆ rem(font-size å¯ä»¥ç”¨ px)ï¼Œè®¡ç®— rem æ¯”è¾ƒéº»çƒ¦(å¯ä»¥å¼•ç”¨é¢„å¤„ç†å™¨ï¼Œä½†æ˜¯å¢åŠ äº†ç¼–è¯‘è¿‡ç¨‹ï¼Œç›¸å¯¹éº»çƒ¦äº†ç‚¹)ã€‚pc å’Œ mobile è¦åˆ†å¼€ã€‚\n\n#### è®¾ç½® viewport ä¸­çš„ width\n\n```html\n<meta name=\"viewport\" content=\"width=750\" />\n```\n\nä¼˜ç‚¹ï¼šå’Œ REM ç›¸åŒï¼Œè€Œä¸”ä¸ç”¨å†™ remï¼Œç›´æ¥ä½¿ç”¨ pxï¼Œæ›´åŠ å¿«æ·ã€‚\n\nç¼ºç‚¹ï¼šæ•ˆæœå¯èƒ½æ²¡ rem çš„å¥½ï¼Œå›¾ç‰‡å¯èƒ½ä¼šç›¸å¯¹æ¨¡ç³Šï¼Œè€Œä¸”æ— æ³•ä½¿ç”¨@media è¿›è¡Œæ–­ç‚¹ï¼Œä¸åŒ size çš„æ‰‹æœºä¸Šæ˜¾ç¤ºï¼Œé«˜åº¦é—´è·å¯èƒ½ä¼šç›¸å·®å¾ˆå¤§ã€‚\n\n## 7.Grid å¸ƒå±€ï¼ˆBOOTSTRAP å¸ƒå±€ï¼‰\n\nç½‘æ ¼å¸ƒå±€ï¼ˆGridï¼‰æ˜¯æœ€å¼ºå¤§çš„ CSS å¸ƒå±€æ–¹æ¡ˆã€‚\n\nå®ƒå°†ç½‘é¡µåˆ’åˆ†æˆä¸€ä¸ªä¸ªç½‘æ ¼ï¼Œå¯ä»¥ä»»æ„ç»„åˆä¸åŒçš„ç½‘æ ¼ï¼Œåšå‡ºå„ç§å„æ ·çš„å¸ƒå±€ã€‚ä»¥å‰ï¼Œåªèƒ½é€šè¿‡å¤æ‚çš„ CSS æ¡†æ¶è¾¾åˆ°çš„æ•ˆæœï¼Œç°åœ¨æµè§ˆå™¨å†…ç½®äº†ã€‚\n\nFlex å¸ƒå±€æ˜¯è½´çº¿å¸ƒå±€ï¼Œåªèƒ½æŒ‡å®š\"é¡¹ç›®\"é’ˆå¯¹è½´çº¿çš„ä½ç½®ï¼Œå¯ä»¥çœ‹ä½œæ˜¯**ä¸€ç»´å¸ƒå±€**ã€‚Grid å¸ƒå±€åˆ™æ˜¯å°†å®¹å™¨åˆ’åˆ†æˆ\"è¡Œ\"å’Œ\"åˆ—\"ï¼Œäº§ç”Ÿå•å…ƒæ ¼ï¼Œç„¶åæŒ‡å®š\"é¡¹ç›®æ‰€åœ¨\"çš„å•å…ƒæ ¼ï¼Œå¯ä»¥çœ‹ä½œæ˜¯**äºŒç»´å¸ƒå±€**ã€‚Grid å¸ƒå±€è¿œæ¯” Flex å¸ƒå±€å¼ºå¤§ã€‚\n\né‡‡ç”¨ç½‘æ ¼å¸ƒå±€çš„åŒºåŸŸï¼Œç§°ä¸º\"å®¹å™¨\"ï¼ˆcontainerï¼‰ã€‚å®¹å™¨å†…éƒ¨é‡‡ç”¨ç½‘æ ¼å®šä½çš„å­å…ƒç´ ï¼Œç§°ä¸º\"é¡¹ç›®\"ï¼ˆitemï¼‰ã€‚å®¹å™¨é‡Œé¢çš„æ°´å¹³åŒºåŸŸç§°ä¸º\"è¡Œ\"ï¼ˆrowï¼‰ï¼Œå‚ç›´åŒºåŸŸä¸º\"åˆ—\"ï¼ˆcolumnï¼‰ã€‚è¡Œå’Œåˆ—çš„äº¤å‰åŒºåŸŸï¼Œç§°ä¸º\"å•å…ƒæ ¼\"ï¼ˆcellï¼‰ã€‚åˆ’åˆ†ç½‘æ ¼çš„çº¿ï¼Œç§°ä¸º\"ç½‘æ ¼çº¿\"ï¼ˆgrid lineï¼‰ã€‚æ°´å¹³ç½‘æ ¼çº¿åˆ’åˆ†å‡ºè¡Œï¼Œå‚ç›´ç½‘æ ¼çº¿åˆ’åˆ†å‡ºåˆ—ã€‚\n\n### å®¹å™¨çš„å±æ€§\n\n#### 1.display\n\n`display: grid`æŒ‡å®šä¸€ä¸ªå®¹å™¨é‡‡ç”¨ç½‘æ ¼å¸ƒå±€ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨å…ƒç´ éƒ½æ˜¯å—çº§å…ƒç´ ï¼Œä½†ä¹Ÿå¯ä»¥è®¾æˆè¡Œå†…å…ƒç´ ã€‚`display: inline-grid;`\n\næ³¨æ„ï¼Œè®¾ä¸ºç½‘æ ¼å¸ƒå±€ä»¥åï¼Œå®¹å™¨å­å…ƒç´ ï¼ˆé¡¹ç›®ï¼‰çš„`float`ã€`display: inline-block`ã€`display: table-cell`ã€`vertical-align`å’Œ`column-*`ç­‰è®¾ç½®éƒ½å°†å¤±æ•ˆã€‚\n\n#### 2.grid-template-columns å±æ€§ï¼Œ grid-template-rows å±æ€§\n\nå®¹å™¨æŒ‡å®šäº†ç½‘æ ¼å¸ƒå±€ä»¥åï¼Œæ¥ç€å°±è¦åˆ’åˆ†è¡Œå’Œåˆ—ã€‚`grid-template-columns`å±æ€§å®šä¹‰æ¯ä¸€åˆ—çš„åˆ—å®½ï¼Œ`grid-template-rows`å±æ€§å®šä¹‰æ¯ä¸€è¡Œçš„è¡Œé«˜ã€‚\n\n```css\n.container {\n  display: grid;\n  grid-template-columns: 100px 100px 100px;\n  grid-template-rows: 100px 100px 100px;\n}\n```\n\né™¤äº†ä½¿ç”¨ç»å¯¹å•ä½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç™¾åˆ†æ¯”\n\n- repeat()ï¼šæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é‡å¤çš„æ¬¡æ•°ï¼ˆä¸Šä¾‹æ˜¯ 3ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰€è¦é‡å¤çš„å€¼ã€‚é‡å¤æŸç§æ¨¡å¼ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\n\n  ```css\n  grid-template-columns: repeat(2, 100px 20px 80px);\n  ```\n\n- auto-fill å…³é”®å­—ï¼šæœ‰æ—¶ï¼Œå•å…ƒæ ¼çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯å®¹å™¨çš„å¤§å°ä¸ç¡®å®šã€‚å¦‚æœå¸Œæœ›æ¯ä¸€è¡Œï¼ˆæˆ–æ¯ä¸€åˆ—ï¼‰å®¹çº³å°½å¯èƒ½å¤šçš„å•å…ƒæ ¼ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨`auto-fill`å…³é”®å­—è¡¨ç¤ºè‡ªåŠ¨å¡«å……ã€‚\n\n  ```css\n  .container {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, 100px);\n  }\n  ```\n\n- fr å…³é”®å­—ï¼šä¸ºäº†æ–¹ä¾¿è¡¨ç¤ºæ¯”ä¾‹å…³ç³»ï¼Œç½‘æ ¼å¸ƒå±€æä¾›äº†`fr`å…³é”®å­—ï¼ˆfraction çš„ç¼©å†™ï¼Œæ„ä¸º\"ç‰‡æ®µ\"ï¼‰ã€‚å¦‚æœä¸¤åˆ—çš„å®½åº¦åˆ†åˆ«ä¸º`1fr`å’Œ`2fr`ï¼Œå°±è¡¨ç¤ºåè€…æ˜¯å‰è€…çš„ä¸¤å€ã€‚ï¼ˆ`fr`å¯ä»¥ä¸ç»å¯¹é•¿åº¦çš„å•ä½ç»“åˆä½¿ç”¨ï¼‰\n\n- minmax()ï¼š`minmax()`å‡½æ•°äº§ç”Ÿä¸€ä¸ªé•¿åº¦èŒƒå›´ï¼Œè¡¨ç¤ºé•¿åº¦å°±åœ¨è¿™ä¸ªèŒƒå›´ä¹‹ä¸­ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºæœ€å°å€¼å’Œæœ€å¤§å€¼ã€‚\n\n  ```css\n  grid-template-columns: 1fr 1fr minmax(100px, 1fr);\n  ```\n\n  ä¸Šé¢ä»£ç ä¸­ï¼Œ`minmax(100px, 1fr)`è¡¨ç¤ºåˆ—å®½ä¸å°äº`100px`ï¼Œä¸å¤§äº`1fr`ã€‚\n\n- auto å…³é”®å­—ï¼šè¡¨ç¤ºç”±æµè§ˆå™¨è‡ªå·±å†³å®šé•¿åº¦\n\n- ç½‘æ ¼çº¿çš„åç§°ï¼š`grid-template-columns`å±æ€§å’Œ`grid-template-rows`å±æ€§é‡Œé¢ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·ï¼ŒæŒ‡å®šæ¯ä¸€æ ¹ç½‘æ ¼çº¿çš„åå­—ï¼Œæ–¹ä¾¿ä»¥åçš„å¼•ç”¨ã€‚ï¼ˆç½‘æ ¼å¸ƒå±€å…è®¸åŒä¸€æ ¹çº¿æœ‰å¤šä¸ªåå­—ï¼Œæ¯”å¦‚`[fifth-line row-5]`ã€‚ï¼‰\n\n  ```css\n  .container {\n    display: grid;\n    grid-template-columns: [c1] 100px [c2] 100px [c3] auto [c4];\n    grid-template-rows: [r1] 100px [r2] 100px [r3] auto [r4];\n  }\n  ```\n\n#### 3.grid-row-gap å±æ€§ï¼Œ grid-column-gap å±æ€§ï¼Œ grid-gap å±æ€§\n\n- `grid-row-gap`å±æ€§è®¾ç½®è¡Œä¸è¡Œçš„é—´éš”ï¼ˆè¡Œé—´è·ï¼‰\n- `grid-column-gap`å±æ€§è®¾ç½®åˆ—ä¸åˆ—çš„é—´éš”ï¼ˆåˆ—é—´è·ï¼‰ã€‚\n- `grid-gap`å±æ€§æ˜¯`grid-column-gap`å’Œ`grid-row-gap`çš„åˆå¹¶ç®€å†™å½¢å¼ï¼š`grid-gap: <grid-row-gap> <grid-column-gap>;`(å¦‚æœ`grid-gap`çœç•¥äº†ç¬¬äºŒä¸ªå€¼ï¼Œæµè§ˆå™¨è®¤ä¸ºç¬¬äºŒä¸ªå€¼ç­‰äºç¬¬ä¸€ä¸ªå€¼ã€‚)\n\n1.  æ ¹æ®æœ€æ–°æ ‡å‡†ï¼Œä¸Šé¢ä¸‰ä¸ªå±æ€§åçš„`grid-`å‰ç¼€å·²ç»åˆ é™¤ï¼Œ`grid-column-gap`å’Œ`grid-row-gap`å†™æˆ`column-gap`å’Œ`row-gap`ï¼Œ`grid-gap`å†™æˆ`gap`ã€‚\n\n#### 4.grid-template-areas å±æ€§\n\nç½‘æ ¼å¸ƒå±€å…è®¸æŒ‡å®š\"åŒºåŸŸ\"ï¼ˆareaï¼‰ï¼Œä¸€ä¸ªåŒºåŸŸç”±å•ä¸ªæˆ–å¤šä¸ªå•å…ƒæ ¼ç»„æˆã€‚\n\n```css\ngrid-template-areas:\n  \"header header header\"\n  \"main main sidebar\"\n  \"footer footer footer\";\n```\n\nåŒºåŸŸçš„å‘½åä¼šå½±å“åˆ°ç½‘æ ¼çº¿ã€‚æ¯ä¸ªåŒºåŸŸçš„èµ·å§‹ç½‘æ ¼çº¿ï¼Œä¼šè‡ªåŠ¨å‘½åä¸º`åŒºåŸŸå-start`ï¼Œç»ˆæ­¢ç½‘æ ¼çº¿è‡ªåŠ¨å‘½åä¸º`åŒºåŸŸå-end`ã€‚\n\n#### 5.grid-auto-flow å±æ€§\n\nåˆ’åˆ†ç½‘æ ¼ä»¥åï¼Œå®¹å™¨çš„å­å…ƒç´ ä¼šæŒ‰ç…§é¡ºåºï¼Œè‡ªåŠ¨æ”¾ç½®åœ¨æ¯ä¸€ä¸ªç½‘æ ¼ã€‚é»˜è®¤çš„æ”¾ç½®é¡ºåºæ˜¯\"å…ˆè¡Œååˆ—\"ï¼Œå³å…ˆå¡«æ»¡ç¬¬ä¸€è¡Œï¼Œå†å¼€å§‹æ”¾å…¥ç¬¬äºŒè¡Œï¼Œå³ä¸‹å›¾æ•°å­—çš„é¡ºåºã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iyo19otvj30au0b6glp.jpg)\n\n- è¿™ä¸ªé¡ºåºç”±`grid-auto-flow`å±æ€§å†³å®šï¼Œé»˜è®¤å€¼æ˜¯`row`ï¼Œå³\"å…ˆè¡Œååˆ—\"ã€‚\n- ä¹Ÿå¯ä»¥å°†å®ƒè®¾æˆ`column`ï¼Œå˜æˆ\"å…ˆåˆ—åè¡Œ\"ã€‚\n- è®¾ä¸º`row dense`ï¼Œè¡¨ç¤º\"å…ˆè¡Œååˆ—\"ï¼Œå¹¶ä¸”å°½å¯èƒ½ç´§å¯†å¡«æ»¡ï¼Œå°½é‡ä¸å‡ºç°ç©ºæ ¼ã€‚\n- `column dense`ï¼Œè¡¨ç¤º\"å…ˆåˆ—åè¡Œ\"ï¼Œå¹¶ä¸”å°½é‡å¡«æ»¡ç©ºæ ¼ã€‚\n\n#### 6.justify-items å±æ€§ï¼Œ align-items å±æ€§ï¼Œ place-items å±æ€§\n\n- `justify-items`å±æ€§è®¾ç½®å•å…ƒæ ¼å†…å®¹çš„æ°´å¹³ä½ç½®ï¼ˆå·¦ä¸­å³ï¼‰\n\n- `align-items`å±æ€§è®¾ç½®å•å…ƒæ ¼å†…å®¹çš„å‚ç›´ä½ç½®ï¼ˆä¸Šä¸­ä¸‹ï¼‰ã€‚\n\n  è¿™ä¸¤ä¸ªå±æ€§çš„å†™æ³•å®Œå…¨ç›¸åŒï¼Œéƒ½å¯ä»¥å–ä¸‹é¢è¿™äº›å€¼ã€‚\n\n  - startï¼šå¯¹é½å•å…ƒæ ¼çš„èµ·å§‹è¾¹ç¼˜ã€‚\n  - endï¼šå¯¹é½å•å…ƒæ ¼çš„ç»“æŸè¾¹ç¼˜ã€‚\n  - centerï¼šå•å…ƒæ ¼å†…éƒ¨å±…ä¸­ã€‚\n  - stretchï¼šæ‹‰ä¼¸ï¼Œå æ»¡å•å…ƒæ ¼çš„æ•´ä¸ªå®½åº¦ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚\n\n- `place-items`å±æ€§æ˜¯`align-items`å±æ€§å’Œ`justify-items`å±æ€§çš„åˆå¹¶ç®€å†™å½¢å¼ã€‚ï¼ˆå¦‚æœçœç•¥ç¬¬äºŒä¸ªå€¼ï¼Œåˆ™æµè§ˆå™¨è®¤ä¸ºä¸ç¬¬ä¸€ä¸ªå€¼ç›¸ç­‰ã€‚ï¼‰\n\n  ```css\n  place-items: <align-items> <justify-items>;\n  ```\n\n#### 7.justify-content å±æ€§ï¼Œ align-content å±æ€§ï¼Œ place-content å±æ€§\n\n- `justify-content`å±æ€§æ˜¯æ•´ä¸ªå†…å®¹åŒºåŸŸåœ¨å®¹å™¨é‡Œé¢çš„æ°´å¹³ä½ç½®ï¼ˆå·¦ä¸­å³ï¼‰\n\n- `align-content`å±æ€§æ˜¯æ•´ä¸ªå†…å®¹åŒºåŸŸçš„å‚ç›´ä½ç½®ï¼ˆä¸Šä¸­ä¸‹ï¼‰ã€‚\n\n  è¿™ä¸¤ä¸ªå±æ€§çš„å†™æ³•å®Œå…¨ç›¸åŒï¼Œéƒ½å¯ä»¥å–ä¸‹é¢è¿™äº›å€¼ã€‚\n\n  åªæ˜¯å°†æ°´å¹³æ–¹å‘æ”¹æˆå‚ç›´æ–¹å‘ã€‚ï¼‰\n\n  - start - å¯¹é½å®¹å™¨çš„èµ·å§‹è¾¹æ¡†ã€‚\n  - end - å¯¹é½å®¹å™¨çš„ç»“æŸè¾¹æ¡†ã€‚\n  - center - å®¹å™¨å†…éƒ¨å±…ä¸­ã€‚\n  - stretch - é¡¹ç›®å¤§å°æ²¡æœ‰æŒ‡å®šæ—¶ï¼Œæ‹‰ä¼¸å æ®æ•´ä¸ªç½‘æ ¼å®¹å™¨ã€‚\n  - space-around - æ¯ä¸ªé¡¹ç›®ä¸¤ä¾§çš„é—´éš”ç›¸ç­‰ã€‚æ‰€ä»¥ï¼Œé¡¹ç›®ä¹‹é—´çš„é—´éš”æ¯”é¡¹ç›®ä¸å®¹å™¨è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€ã€‚\n  - space-between - é¡¹ç›®ä¸é¡¹ç›®çš„é—´éš”ç›¸ç­‰ï¼Œé¡¹ç›®ä¸å®¹å™¨è¾¹æ¡†ä¹‹é—´æ²¡æœ‰é—´éš”ã€‚\n  - space-evenly - é¡¹ç›®ä¸é¡¹ç›®çš„é—´éš”ç›¸ç­‰ï¼Œé¡¹ç›®ä¸å®¹å™¨è¾¹æ¡†ä¹‹é—´ä¹Ÿæ˜¯åŒæ ·é•¿åº¦çš„é—´éš”ã€‚\n\n- `place-content`å±æ€§æ˜¯`align-content`å±æ€§å’Œ`justify-content`å±æ€§çš„åˆå¹¶ç®€å†™å½¢å¼ã€‚ï¼ˆå¦‚æœçœç•¥ç¬¬äºŒä¸ªå€¼ï¼Œæµè§ˆå™¨å°±ä¼šå‡å®šç¬¬äºŒä¸ªå€¼ç­‰äºç¬¬ä¸€ä¸ªå€¼ã€‚ï¼‰\n\n  ```css\n  place-content: <align-content> <justify-content>;\n  ```\n\n#### 8.grid-auto-columns å±æ€§ï¼Œ grid-auto-rows å±æ€§\n\næœ‰æ—¶å€™ï¼Œä¸€äº›é¡¹ç›®çš„æŒ‡å®šä½ç½®ï¼Œåœ¨ç°æœ‰ç½‘æ ¼çš„å¤–éƒ¨ã€‚æ¯”å¦‚ç½‘æ ¼åªæœ‰ 3 åˆ—ï¼Œä½†æ˜¯æŸä¸€ä¸ªé¡¹ç›®æŒ‡å®šåœ¨ç¬¬ 5 è¡Œã€‚è¿™æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ç”Ÿæˆå¤šä½™çš„ç½‘æ ¼ï¼Œä»¥ä¾¿æ”¾ç½®é¡¹ç›®ã€‚\n\n`grid-auto-columns`å±æ€§å’Œ`grid-auto-rows`å±æ€§ç”¨æ¥è®¾ç½®ï¼Œæµè§ˆå™¨è‡ªåŠ¨åˆ›å»ºçš„å¤šä½™ç½‘æ ¼çš„åˆ—å®½å’Œè¡Œé«˜ã€‚å®ƒä»¬çš„å†™æ³•ä¸`grid-template-columns`å’Œ`grid-template-rows`å®Œå…¨ç›¸åŒã€‚å¦‚æœä¸æŒ‡å®šè¿™ä¸¤ä¸ªå±æ€§ï¼Œæµè§ˆå™¨å®Œå…¨æ ¹æ®å•å…ƒæ ¼å†…å®¹çš„å¤§å°ï¼Œå†³å®šæ–°å¢ç½‘æ ¼çš„åˆ—å®½å’Œè¡Œé«˜ã€‚\n\nåˆ’åˆ†å¥½çš„ç½‘æ ¼æ˜¯ 3 è¡Œ x 3 åˆ—ï¼Œä½†æ˜¯ï¼Œ8 å·é¡¹ç›®æŒ‡å®šåœ¨ç¬¬ 4 è¡Œï¼Œ9 å·é¡¹ç›®æŒ‡å®šåœ¨ç¬¬ 5 è¡Œã€‚\n\n```css\n.container {\n  display: grid;\n  grid-template-columns: 100px 100px 100px;\n  grid-template-rows: 100px 100px 100px;\n  grid-auto-rows: 50px;\n}\n```\n\nä¸Šé¢ä»£ç æŒ‡å®šæ–°å¢çš„è¡Œé«˜ç»Ÿä¸€ä¸º 50pxï¼ˆåŸå§‹çš„è¡Œé«˜ä¸º 100pxï¼‰ã€‚\n\n#### 9.grid-template å±æ€§ï¼Œ grid å±æ€§\n\n`grid-template`å±æ€§æ˜¯`grid-template-columns`ã€`grid-template-rows`å’Œ`grid-template-areas`è¿™ä¸‰ä¸ªå±æ€§çš„åˆå¹¶ç®€å†™å½¢å¼ã€‚\n\n`grid`å±æ€§æ˜¯`grid-template-rows`ã€`grid-template-columns`ã€`grid-template-areas`ã€ `grid-auto-rows`ã€`grid-auto-columns`ã€`grid-auto-flow`è¿™å…­ä¸ªå±æ€§çš„åˆå¹¶ç®€å†™å½¢å¼ã€‚\n\n### é¡¹ç›®å±æ€§\n\n#### 1.grid-column-start å±æ€§ï¼Œ grid-column-end å±æ€§ï¼Œ grid-row-start å±æ€§ï¼Œ grid-row-end å±æ€§\n\né¡¹ç›®çš„ä½ç½®æ˜¯å¯ä»¥æŒ‡å®šçš„ï¼Œå…·ä½“æ–¹æ³•å°±æ˜¯æŒ‡å®šé¡¹ç›®çš„å››ä¸ªè¾¹æ¡†ï¼Œåˆ†åˆ«å®šä½åœ¨å“ªæ ¹ç½‘æ ¼çº¿ã€‚\n\n- `grid-column-start`å±æ€§ï¼šå·¦è¾¹æ¡†æ‰€åœ¨çš„å‚ç›´ç½‘æ ¼çº¿\n- `grid-column-end`å±æ€§ï¼šå³è¾¹æ¡†æ‰€åœ¨çš„å‚ç›´ç½‘æ ¼çº¿\n- `grid-row-start`å±æ€§ï¼šä¸Šè¾¹æ¡†æ‰€åœ¨çš„æ°´å¹³ç½‘æ ¼çº¿\n- `grid-row-end`å±æ€§ï¼šä¸‹è¾¹æ¡†æ‰€åœ¨çš„æ°´å¹³ç½‘æ ¼çº¿\n\n```css\n.item-1 {\n  grid-column-start: 2;\n  grid-column-end: 4;\n}\n```\n\nè¿™å››ä¸ªå±æ€§çš„å€¼è¿˜å¯ä»¥ä½¿ç”¨`span`å…³é”®å­—ï¼Œè¡¨ç¤º\"è·¨è¶Š\"ï¼Œå³å·¦å³è¾¹æ¡†ï¼ˆä¸Šä¸‹è¾¹æ¡†ï¼‰ä¹‹é—´è·¨è¶Šå¤šå°‘ä¸ªç½‘æ ¼ã€‚\n\nä½¿ç”¨è¿™å››ä¸ªå±æ€§ï¼Œå¦‚æœäº§ç”Ÿäº†é¡¹ç›®çš„é‡å ï¼Œåˆ™ä½¿ç”¨`z-index`å±æ€§æŒ‡å®šé¡¹ç›®çš„é‡å é¡ºåºã€‚\n\n#### 2.grid-column å±æ€§ï¼Œ grid-row å±æ€§\n\n- `grid-column`å±æ€§æ˜¯`grid-column-start`å’Œ`grid-column-end`çš„åˆå¹¶ç®€å†™å½¢å¼\n\n- `grid-row`å±æ€§æ˜¯`grid-row-start`å±æ€§å’Œ`grid-row-end`çš„åˆå¹¶ç®€å†™å½¢å¼ã€‚\n\n  è¿™ä¸¤ä¸ªå±æ€§ä¹‹ä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`span`å…³é”®å­—ï¼Œè¡¨ç¤ºè·¨è¶Šå¤šå°‘ä¸ªç½‘æ ¼ã€‚æ–œæ ä»¥åŠåé¢çš„éƒ¨åˆ†å¯ä»¥çœç•¥ï¼Œé»˜è®¤è·¨è¶Šä¸€ä¸ªç½‘æ ¼ã€‚\n\n  ```css\n  .item-1 {\n    background: #b03532;\n    grid-column: 1 / 3;\n    grid-row: 1 / 3;\n  }\n  /* ç­‰åŒäº */\n  .item-1 {\n    background: #b03532;\n    grid-column: 1 / span 2;\n    grid-row: 1 / span 2;\n  }\n  ```\n\n#### 3.grid-area å±æ€§\n\n`grid-area`å±æ€§æŒ‡å®šé¡¹ç›®æ”¾åœ¨å“ªä¸€ä¸ªåŒºåŸŸã€‚\n\n```css\n.item-1 {\n  grid-area: e;\n}\n```\n\n`grid-area`å±æ€§è¿˜å¯ç”¨ä½œ`grid-row-start`ã€`grid-column-start`ã€`grid-row-end`ã€`grid-column-end`çš„åˆå¹¶ç®€å†™å½¢å¼ï¼Œç›´æ¥æŒ‡å®šé¡¹ç›®çš„ä½ç½®ã€‚\n\n```css\n.item {\n  grid-area: <row-start> / <column-start> / <row-end> / <column-end>;\n}\n```\n\n#### 4.justify-self å±æ€§ï¼Œ align-self å±æ€§ï¼Œ place-self å±æ€§\n\n- `justify-self`å±æ€§è®¾ç½®å•å…ƒæ ¼å†…å®¹çš„æ°´å¹³ä½ç½®ï¼ˆå·¦ä¸­å³ï¼‰ï¼Œè·Ÿ`justify-items`å±æ€§çš„ç”¨æ³•å®Œå…¨ä¸€è‡´ï¼Œä½†åªä½œç”¨äºå•ä¸ªé¡¹ç›®ã€‚\n\n- `align-self`å±æ€§è®¾ç½®å•å…ƒæ ¼å†…å®¹çš„å‚ç›´ä½ç½®ï¼ˆä¸Šä¸­ä¸‹ï¼‰ï¼Œè·Ÿ`align-items`å±æ€§çš„ç”¨æ³•å®Œå…¨ä¸€è‡´ï¼Œä¹Ÿæ˜¯åªä½œç”¨äºå•ä¸ªé¡¹ç›®ã€‚\n\n  è¿™ä¸¤ä¸ªå±æ€§éƒ½å¯ä»¥å–ä¸‹é¢å››ä¸ªå€¼ã€‚\n\n  - startï¼šå¯¹é½å•å…ƒæ ¼çš„èµ·å§‹è¾¹ç¼˜ã€‚\n  - endï¼šå¯¹é½å•å…ƒæ ¼çš„ç»“æŸè¾¹ç¼˜ã€‚\n  - centerï¼šå•å…ƒæ ¼å†…éƒ¨å±…ä¸­ã€‚\n  - stretchï¼šæ‹‰ä¼¸ï¼Œå æ»¡å•å…ƒæ ¼çš„æ•´ä¸ªå®½åº¦ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚\n\n- `place-self`å±æ€§æ˜¯`align-self`å±æ€§å’Œ`justify-self`å±æ€§çš„åˆå¹¶ç®€å†™å½¢å¼ã€‚\n\n  ```css\n  place-self: <align-self> <justify-self>;\n  ```\n\n### å…¼å®¹æ€§\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iyqd0osoj326m0rok1w.jpg)\n\n### å¯¹æ¯” Bootstrap\n\n- æ ‡ç­¾ä¼šæ›´åŠ ç®€æ´ï¼šç›¸æ¯”`Bootstrap`ï¼Œä½¿ç”¨ grid ä¼šä½¿ä½ çš„ HTML æ›´åŠ å¹²å‡€ã€‚`Bootstrap`éœ€è¦åˆ›å»ºçš„æ ‡ç­¾ï¼Œæ¯ä¸ª row éƒ½éœ€è¦ä¸€ä¸ª`<div>`æ ‡ç­¾ï¼Œä½¿ç”¨äº† class name æ¥æŒ‡å®šå¸ƒå±€(`col-xs-2`)ã€‚grid ç”¨æ¥å¸ƒå±€çœ‹èµ·æ¥æ›´ç®€å•ï¼Œä¸‘é™‹çš„ç±»åå’Œæ¯è¡Œæ‰€éœ€çš„é¢å¤–çš„ div æ ‡ç­¾ä¸€å»ä¸å¤è¿”äº†ï¼Œç®€ç®€å•å•ä¸€ä¸ª container å’Œé‡Œé¢çš„ itemã€‚ä¸`Bootstrap`ä¸åŒçš„æ˜¯ï¼Œéšç€å¸ƒå±€å¤æ‚åº¦çš„å¢åŠ ï¼ŒGrid å¸ƒå±€æ ‡ç­¾çš„å¤æ‚åº¦å°†ä¸ä¼šå¢åŠ å¤ªå¤šã€‚\n- æ›´çµæ´»ï¼šç”¨`CSS Grid`çš„è¯ä¼šéå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ª`media query`å°±å¯ä»¥é‡æ–°æ’åˆ—å¸ƒå±€ã€‚è€Œå¦‚æœæƒ³åœ¨`Bootstrap`ä¸­åšåŒæ ·çš„äº‹æƒ…ï¼Œå°±å¿…é¡»å¾—ä¿®æ”¹ HTML äº†ï¼Œéœ€è¦è°ƒæ•´æ ‡ç­¾çš„é¡ºåºã€‚\n- ä¸å†é™æ­» 12 åˆ—ï¼š`Bootstrap`çš„ grid ç³»ç»Ÿåˆ†ä¸ºäº† 12 åˆ—ï¼Œå¦‚æœä½ æƒ³è¦ä¸€ä¸ª 5 åˆ—çš„å¸ƒå±€å°±ä¼šçº ç»“ï¼Œæˆ–æ˜¯ 7 åˆ—ã€9 åˆ—ã€ä»»ä½•ä¸ä¼šåˆä¸º 12 åˆ—çš„ã€‚`CSS Grid`å°±æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œä½ å¯ä»¥è®© grid æ­£å¥½æœ‰ä½ æƒ³è¦çš„æ•°é‡ã€‚\n- æµè§ˆå™¨æ”¯æŒï¼šå…¨çƒ 75%çš„ç½‘ç«™æµé‡æ”¯æŒ`CSS Grid`\n\n## ç»“è®ºï¼š\n\n1. å¦‚æœåªåš pc ç«¯ï¼Œé‚£ä¹ˆé™æ€å¸ƒå±€ï¼ˆå®šå®½åº¦ï¼‰æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼›\n2. å¦‚æœåšç§»åŠ¨ç«¯ï¼Œä¸”è®¾è®¡å¯¹é«˜åº¦å’Œå…ƒç´ é—´è·è¦æ±‚ä¸é«˜ï¼Œé‚£ä¹ˆå¼¹æ€§å¸ƒå±€ï¼ˆrem+jsï¼‰æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œä¸€ä»½ css+ä¸€ä»½ js è°ƒèŠ‚ font-size æå®šï¼›\n3. å¦‚æœ pcï¼Œç§»åŠ¨è¦å…¼å®¹ï¼Œè€Œä¸”è¦æ±‚å¾ˆé«˜é‚£ä¹ˆå“åº”å¼å¸ƒå±€è¿˜æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œå‰ææ˜¯è®¾è®¡æ ¹æ®ä¸åŒçš„é«˜å®½åšä¸åŒçš„è®¾è®¡ï¼Œå“åº”å¼æ ¹æ®åª’ä½“æŸ¥è¯¢åšä¸åŒçš„å¸ƒå±€.\n","tags":["CSS","å¸ƒå±€"],"categories":["CSS"]},{"title":"CSS3æ–°ç‰¹æ€§","url":"/2019/04/28/CSS3æ–°ç‰¹æ€§/","content":"\n# CSS3 æ–°ç‰¹æ€§\n\n## 1. é€‰æ‹©å™¨\n\nCSS3 ä¸­æ–°æ·»åŠ äº†å¾ˆå¤šé€‰æ‹©å™¨ï¼Œè§£å†³äº†å¾ˆå¤šä¹‹å‰éœ€è¦ç”¨ javascript æ‰èƒ½è§£å†³çš„å¸ƒå±€é—®é¢˜ã€‚\n\n- element1~element2: é€‰æ‹©å‰é¢æœ‰ element1 å…ƒç´ çš„æ¯ä¸ª element2 å…ƒç´ ã€‚\n- [attribute^=value] ï¼šé€‰æ‹©æŸå…ƒç´  attribute å±æ€§æ˜¯ä»¥ value å¼€å¤´çš„ã€‚\n- [attribute$=value]ï¼šé€‰æ‹©æŸå…ƒç´  attribute å±æ€§æ˜¯ä»¥ value ç»“å°¾çš„ã€‚\n- [attribute*=value]ï¼šé€‰æ‹©æŸå…ƒç´  attribute å±æ€§åŒ…å« value å­—ç¬¦ä¸²çš„ã€‚\n- E:first-of-type: é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ çš„é¦–ä¸ª E å…ƒç´ çš„æ¯ä¸ª E å…ƒç´ ã€‚\n- E:last-of-type: é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ çš„æœ€å E å…ƒç´ çš„æ¯ä¸ª E å…ƒç´ ã€‚\n- E:only-of-type: é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ å”¯ä¸€çš„ E å…ƒç´ çš„æ¯ä¸ª E å…ƒç´ ã€‚\n- E:only-child: é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ çš„å”¯ä¸€å­å…ƒç´ çš„æ¯ä¸ª E å…ƒç´ ã€‚\n- E:nth-child(n): é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ çš„ç¬¬ n ä¸ªå­å…ƒç´ çš„æ¯ä¸ª E å…ƒç´ ã€‚\n- E:nth-last-child(n): é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ çš„å€’æ•°ç¬¬ n ä¸ªå­å…ƒç´ çš„æ¯ä¸ª E å…ƒç´ ã€‚\n- E:nth-of-type(n): é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ ç¬¬ n ä¸ª E å…ƒç´ çš„æ¯ä¸ª E å…ƒç´ ã€‚\n- E:nth-last-of-type(n): é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ å€’æ•°ç¬¬ n ä¸ª E å…ƒç´ çš„æ¯ä¸ª E å…ƒç´ ã€‚\n- E:last-child: é€‰æ‹©å±äºå…¶çˆ¶å…ƒç´ æœ€åä¸€ä¸ªå­å…ƒç´ æ¯ä¸ª E å…ƒç´ ã€‚\n- :root: é€‰æ‹©æ–‡æ¡£çš„æ ¹å…ƒç´ ã€‚\n- E:empty: é€‰æ‹©æ²¡æœ‰å­å…ƒç´ çš„æ¯ä¸ª E å…ƒç´ ï¼ˆåŒ…æ‹¬æ–‡æœ¬èŠ‚ç‚¹)ã€‚\n- E:target: é€‰æ‹©å½“å‰æ´»åŠ¨çš„ E å…ƒç´ ã€‚\n- E:enabled: é€‰æ‹©æ¯ä¸ªå¯ç”¨çš„ E å…ƒç´ ã€‚\n- E:disabled: é€‰æ‹©æ¯ä¸ªç¦ç”¨çš„ E å…ƒç´ ã€‚\n- E:checked: é€‰æ‹©æ¯ä¸ªè¢«é€‰ä¸­çš„ E å…ƒç´ ã€‚\n- E:not(selector): é€‰æ‹©é selector å…ƒç´ çš„æ¯ä¸ªå…ƒç´ ã€‚\n- E::selection: é€‰æ‹©è¢«ç”¨æˆ·é€‰å–çš„å…ƒç´ éƒ¨åˆ†ã€‚\n  <!-- more -->\n\n## 2. Transition,Transform å’Œ Animation\n\nè¿™ä¸‰ä¸ªç‰¹æ€§æ˜¯ CSS3 æ–°å¢çš„å’ŒåŠ¨ç”»ç›¸å…³çš„ç‰¹æ€§ã€‚\n\n- Transition\n\n  Transition å¯ä»¥åœ¨å½“å…ƒç´ ä»ä¸€ç§æ ·å¼å˜æ¢ä¸ºå¦ä¸€ç§æ ·å¼æ—¶ä¸ºå…ƒç´ æ·»åŠ æ•ˆæœï¼Œè€Œä¸ç”¨ä½¿ç”¨ Flash åŠ¨ç”»æˆ– JavaScriptã€‚\n  Transition æœ‰å¦‚ä¸‹å±æ€§ï¼š\n\n  - transition-property: è§„å®šåº”ç”¨è¿‡æ¸¡çš„ CSS å±æ€§çš„åç§°ã€‚\n  - transition-duration: è§„å®šå®Œæˆè¿‡æ¸¡æ•ˆæœéœ€è¦å¤šé•¿æ—¶é—´ã€‚\n  - transition-delay: è§„å®šè¿‡æ¸¡æ•ˆæœä½•æ—¶å¼€å§‹ï¼Œé»˜è®¤æ˜¯ 0ã€‚\n  - transition-timing-function: è§„å®šè¿‡æ¸¡æ•ˆæœçš„æ—¶é—´æ›²çº¿ï¼Œé»˜è®¤æ˜¯â€easeâ€ï¼Œè¿˜æœ‰ linearã€ease-inã€ease-outã€ease-in-out å’Œ cubic-bezier ç­‰è¿‡æ¸¡ç±»å‹ã€‚\n  - transition: ç®€å†™å±æ€§ï¼Œç”¨äºåœ¨ä¸€ä¸ªå±æ€§ä¸­è®¾ç½®å››ä¸ªè¿‡æ¸¡å±æ€§ã€‚\n\n- Transform\n\n  Transform ç”¨æ¥å‘å…ƒç´ åº”ç”¨å„ç§ 2D å’Œ 3D è½¬æ¢ï¼Œè¯¥å±æ€§å…è®¸æˆ‘ä»¬å¯¹å…ƒç´ è¿›è¡Œæ—‹è½¬ã€ç¼©æ”¾ã€ç§»åŠ¨æˆ–å€¾æ–œç­‰æ“ä½œã€‚\n\n  å˜æ¢ç±»å‹ï¼š\n\n  - none: å®šä¹‰ä¸è¿›è¡Œè½¬æ¢ã€‚\n  - matrix(n,n,n,n,n,n): å®šä¹‰ 2D è½¬æ¢ï¼Œä½¿ç”¨å…­ä¸ªå€¼çš„çŸ©é˜µã€‚\n  - matrix3d(n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n): å®šä¹‰ 3D è½¬æ¢ï¼Œä½¿ç”¨ 16 ä¸ªå€¼çš„ 4x4 çŸ©é˜µã€‚\n  - translate(x,y): å®šä¹‰ 2D ä½ç§»è½¬æ¢ã€‚\n  - translate3d(x,y,z): å®šä¹‰ 3D ä½ç§»è½¬æ¢ã€‚\n  - translateX(x): å®šä¹‰ä½ç§»è½¬æ¢ï¼Œåªæ˜¯ç”¨ X è½´çš„å€¼ã€‚\n  - translateY(y): å®šä¹‰ä½ç§»è½¬æ¢ï¼Œåªæ˜¯ç”¨ Y è½´çš„å€¼ã€‚\n  - translateZ(z): å®šä¹‰ 3D ä½ç§»è½¬æ¢ï¼Œåªæ˜¯ç”¨ Z è½´çš„å€¼ã€‚\n  - scale(x,y): å®šä¹‰ 2D ç¼©æ”¾è½¬æ¢ã€‚\n  - scale3d(x,y,z): å®šä¹‰ 3D ç¼©æ”¾è½¬æ¢ã€‚\n  - scaleX(x): é€šè¿‡è®¾ç½® X è½´çš„å€¼æ¥å®šä¹‰ç¼©æ”¾è½¬æ¢ã€‚\n  - scaleY(y): é€šè¿‡è®¾ç½® Y è½´çš„å€¼æ¥å®šä¹‰ç¼©æ”¾è½¬æ¢ã€‚\n  - scaleZ(z): é€šè¿‡è®¾ç½® Z è½´çš„å€¼æ¥å®šä¹‰ 3D ç¼©æ”¾è½¬æ¢ã€‚\n  - rotate(angle): å®šä¹‰ 2D æ—‹è½¬ï¼Œåœ¨å‚æ•°ä¸­è§„å®šè§’åº¦ã€‚\n  - rotate3d(x,y,z,angle): å®šä¹‰ 3D æ—‹è½¬ã€‚\n  - rotateX(angle): å®šä¹‰æ²¿ç€ X è½´çš„ 3D æ—‹è½¬ã€‚\n  - rotateY(angle): å®šä¹‰æ²¿ç€ Y è½´çš„ 3D æ—‹è½¬ã€‚\n  - rotateZ(angle): å®šä¹‰æ²¿ç€ Z è½´çš„ 3D æ—‹è½¬ã€‚\n  - skew(x-angle,y-angle): å®šä¹‰æ²¿ç€ X å’Œ Y è½´çš„ 2D å€¾æ–œè½¬æ¢ã€‚\n  - skewX(angle): å®šä¹‰æ²¿ç€ X è½´çš„ 2D å€¾æ–œè½¬æ¢ã€‚\n  - skewY(angle): å®šä¹‰æ²¿ç€ Y è½´çš„ 2D å€¾æ–œè½¬æ¢ã€‚\n  - perspective(n): ä¸º 3D è½¬æ¢å…ƒç´ å®šä¹‰é€è§†è§†å›¾ã€‚\n\n- Animation\n\n  Animation è®© CSS æ‹¥æœ‰äº†å¯ä»¥åˆ¶ä½œåŠ¨ç”»çš„åŠŸèƒ½ã€‚ä½¿ç”¨ CSS3 çš„ Animation åˆ¶ä½œåŠ¨ç”»æˆ‘ä»¬å¯ä»¥çœå»å¤æ‚çš„ js ä»£ç ã€‚\n\n## 3. è¾¹æ¡†\n\nCSS3 æ–°å¢äº†ä¸‰ä¸ªè¾¹æ¡†å±æ€§ï¼Œåˆ†åˆ«æ˜¯ border-radiusã€box-shadow å’Œ border-imageã€‚\n\n- border-radius å¯ä»¥åˆ›å»ºåœ†è§’è¾¹æ¡†\n- box-shadow å¯ä»¥ä¸ºå…ƒç´ æ·»åŠ é˜´å½±\n- border-image å¯ä»¥ä½¿ç”¨å›¾ç‰‡æ¥ç»˜åˆ¶è¾¹æ¡†ã€‚\n\n## 4. èƒŒæ™¯\n\nCSS3 æ–°å¢äº†å‡ ä¸ªå…³äºèƒŒæ™¯çš„å±æ€§ï¼Œåˆ†åˆ«æ˜¯ background-clipã€background-originã€background-size å’Œ background-breakã€‚\n\n- background-clip\n\n  background-clip å±æ€§ç”¨äºç¡®å®šèƒŒæ™¯ç”»åŒºï¼Œæœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½çš„å±æ€§ï¼š\n\n  - background-clip: border-box; èƒŒæ™¯ä» border å¼€å§‹æ˜¾ç¤º\n  - background-clip: padding-box; èƒŒæ™¯ä» padding å¼€å§‹æ˜¾ç¤º\n  - background-clip: content-box; èƒŒæ™¯æ˜¾ content åŒºåŸŸå¼€å§‹æ˜¾ç¤º\n  - background-clip: no-clip; é»˜è®¤å±æ€§ï¼Œç­‰åŒäº border-box\n\n  é€šå¸¸æƒ…å†µï¼ŒèƒŒæ™¯éƒ½æ˜¯è¦†ç›–æ•´ä¸ªå…ƒç´ çš„ï¼Œåˆ©ç”¨è¿™ä¸ªå±æ€§å¯ä»¥è®¾å®šèƒŒæ™¯é¢œè‰²æˆ–å›¾ç‰‡çš„è¦†ç›–èŒƒå›´ã€‚\n\n- background-origin\n\n  background-clip å±æ€§ç”¨äºç¡®å®šèƒŒæ™¯çš„ä½ç½®ï¼Œå®ƒé€šå¸¸ä¸ background-position è”åˆä½¿ç”¨ï¼Œå¯ä»¥ä» borderã€paddingã€content æ¥è®¡ç®— background-positionï¼ˆå°±åƒ background-clipï¼‰ã€‚\n\n  - background-origin: border-box; ä» border å¼€å§‹è®¡ç®— background-position\n  - background-origin: padding-box; ä» padding å¼€å§‹è®¡ç®— background-position\n  - background-origin: content-box; ä» content å¼€å§‹è®¡ç®— background-position\n\n- background-size\n\n  background-size å±æ€§å¸¸ç”¨æ¥è°ƒæ•´èƒŒæ™¯å›¾ç‰‡çš„å¤§å°ï¼Œä¸»è¦ç”¨äºè®¾å®šå›¾ç‰‡æœ¬èº«ã€‚æœ‰ä»¥ä¸‹å¯èƒ½çš„å±æ€§ï¼š\n\n  - background-size: contain; ç¼©å°å›¾ç‰‡ä»¥é€‚åˆå…ƒç´ ï¼ˆç»´æŒåƒç´ é•¿å®½æ¯”ï¼‰\n  - background-size: cover; æ‰©å±•å…ƒç´ ä»¥å¡«è¡¥å…ƒç´ ï¼ˆç»´æŒåƒç´ é•¿å®½æ¯”ï¼‰\n  - background-size: 100px 100px; ç¼©å°å›¾ç‰‡è‡³æŒ‡å®šçš„å¤§å°\n  - background-size: 50% 100%; ç¼©å°å›¾ç‰‡è‡³æŒ‡å®šçš„å¤§å°ï¼Œç™¾åˆ†æ¯”æ˜¯ç›¸å¯¹åŒ… å«å…ƒç´ çš„å°ºå¯¸\n\n- background-break\n\n  CSS3 ä¸­ï¼Œå…ƒç´ å¯ä»¥è¢«åˆ†æˆå‡ ä¸ªç‹¬ç«‹çš„ç›’å­ï¼ˆå¦‚ä½¿å†…è”å…ƒç´  span è·¨è¶Šå¤šè¡Œï¼‰ï¼Œbackground-break å±æ€§ç”¨æ¥æ§åˆ¶èƒŒæ™¯æ€æ ·åœ¨è¿™äº›ä¸åŒçš„ç›’å­ä¸­æ˜¾ç¤ºã€‚\n\n  - background-break: continuous; é»˜è®¤å€¼ã€‚å¿½ç•¥ç›’ä¹‹é—´çš„è·ç¦»ï¼ˆä¹Ÿå°±æ˜¯åƒå…ƒç´ æ²¡æœ‰åˆ†æˆå¤šä¸ªç›’å­ï¼Œä¾ç„¶æ˜¯ä¸€ä¸ªæ•´ä½“ä¸€æ ·ï¼‰\n  - background-break: bounding-box; æŠŠç›’ä¹‹é—´çš„è·ç¦»è®¡ç®—åœ¨å†…ï¼›\n  - background-break: each-box; ä¸ºæ¯ä¸ªç›’å­å•ç‹¬é‡ç»˜èƒŒæ™¯ã€‚\n\n## 5. æ–‡å­—æ•ˆæœ\n\n- word-wrap\n\n  CSS3 ä¸­ï¼Œword-wrap å±æ€§å…è®¸æ‚¨å…è®¸æ–‡æœ¬å¼ºåˆ¶æ–‡æœ¬è¿›è¡Œæ¢è¡Œï¼Œå³è¿™æ„å‘³ç€ä¼šå¯¹å•è¯è¿›è¡Œæ‹†åˆ†ã€‚æ‰€æœ‰ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒ word-wrap å±æ€§ã€‚\n\n- text-overflow\n\n  å®ƒä¸ word-wrap æ˜¯ååŒå·¥ä½œçš„ï¼Œword-wrap è®¾ç½®æˆ–æ£€ç´¢å½“å½“å‰è¡Œè¶…è¿‡æŒ‡å®šå®¹å™¨çš„è¾¹ç•Œæ—¶æ˜¯å¦æ–­å¼€è½¬è¡Œï¼Œè€Œ text-overflow åˆ™è®¾ç½®æˆ–æ£€ç´¢å½“å½“å‰è¡Œè¶…è¿‡æŒ‡å®šå®¹å™¨çš„è¾¹ç•Œæ—¶å¦‚ä½•æ˜¾ç¤ºã€‚å¯¹äºâ€œtext-overflowâ€å±æ€§ï¼Œæœ‰â€œclipâ€å’Œâ€œellipsisâ€ä¸¤ç§å¯ä¾›é€‰æ‹©ã€‚\n\n- text-shadow\n\n  CSS3 ä¸­ï¼Œtext-shadow å¯å‘æ–‡æœ¬åº”ç”¨é˜´å½±ã€‚èƒ½å¤Ÿè§„å®šæ°´å¹³é˜´å½±ã€å‚ç›´é˜´å½±ã€æ¨¡ç³Šè·ç¦»ï¼Œä»¥åŠé˜´å½±çš„é¢œè‰²ã€‚\n\n- text-decoration\n\n  CSS3 é‡Œé¢å¼€å§‹æ”¯æŒå¯¹æ–‡å­—çš„æ›´æ·±å±‚æ¬¡çš„æ¸²æŸ“ï¼Œå…·ä½“æœ‰ä¸‰ä¸ªå±æ€§å¯ä¾›è®¾ç½®ï¼š\n\n  - text-fill-color: è®¾ç½®æ–‡å­—å†…éƒ¨å¡«å……é¢œè‰²\n  - text-stroke-color: è®¾ç½®æ–‡å­—è¾¹ç•Œå¡«å……é¢œè‰²\n  - text-stroke-width: è®¾ç½®æ–‡å­—è¾¹ç•Œå®½åº¦\n\n## 6. æ¸å˜\n\nCSS3 æ–°å¢äº†æ¸å˜æ•ˆæœï¼ŒåŒ…æ‹¬ linear-gradient(çº¿æ€§æ¸å˜)å’Œ radial-gradient(å¾„å‘æ¸å˜)ã€‚\n\n## 7. @font-face ç‰¹æ€§\n\né€šè¿‡ CSS3ï¼Œweb è®¾è®¡å¸ˆå¯ä»¥ä½¿ç”¨ä»–ä»¬å–œæ¬¢çš„ä»»æ„å­—ä½“ã€‚å½“æ‚¨æ‚¨æ‰¾åˆ°æˆ–è´­ä¹°åˆ°å¸Œæœ›ä½¿ç”¨çš„å­—ä½“æ—¶ï¼Œå¯å°†è¯¥å­—ä½“æ–‡ä»¶å­˜æ”¾åˆ° web æœåŠ¡å™¨ä¸Šï¼Œå®ƒä¼šåœ¨éœ€è¦æ—¶è¢«è‡ªåŠ¨ä¸‹è½½åˆ°ç”¨æˆ·çš„è®¡ç®—æœºä¸Šã€‚å­—ä½“æ˜¯åœ¨ CSS3 @font-face è§„åˆ™ä¸­å®šä¹‰çš„ã€‚Firefoxã€Chromeã€Safari ä»¥åŠ Opera æ”¯æŒ .ttf(True Type Fonts)å’Œ .otf(OpenType Fonts)ç±»å‹çš„å­—ä½“ã€‚IE9+ æ”¯æŒæ–°çš„@font-face è§„åˆ™ï¼Œä½†æ˜¯ä»…æ”¯æŒ .eot ç±»å‹çš„å­—ä½“(Embedded OpenType)ã€‚\n\nåœ¨æ–°çš„@font-face è§„åˆ™ä¸­ï¼Œå¿…é¡»é¦–å…ˆå®šä¹‰å­—ä½“çš„åç§°ï¼ˆæ¯”å¦‚ myFontï¼‰ï¼Œç„¶åæŒ‡å‘è¯¥å­—ä½“æ–‡ä»¶ã€‚\nå¦‚éœ€ä¸º HTML å…ƒç´ ä½¿ç”¨å­—ä½“ï¼Œè¯·é€šè¿‡ font-family å±æ€§æ¥å¼•ç”¨å­—ä½“çš„åç§° (myFont)\n\n## 8. å¤šåˆ—å¸ƒå±€\n\né€šè¿‡ CSS3ï¼Œèƒ½å¤Ÿåˆ›å»ºå¤šä¸ªåˆ—æ¥å¯¹æ–‡æœ¬è¿›è¡Œå¸ƒå±€ï¼ŒIE10 å’Œ Opera æ”¯æŒå¤šåˆ—å±æ€§ã€‚Firefox éœ€è¦å‰ç¼€-moz-ï¼ŒChrome å’Œ Safari éœ€è¦å‰ç¼€-webkit-ã€‚ä¸»è¦æœ‰å¦‚ä¸‹ä¸‰ä¸ªå±æ€§ï¼š\n\n- column-count: è§„å®šå…ƒç´ åº”è¯¥è¢«åˆ†éš”çš„åˆ—æ•°ã€‚\n- column-gap: è§„å®šåˆ—ä¹‹é—´çš„é—´éš”ã€‚\n- column-rule: è®¾ç½®åˆ—ä¹‹é—´çš„å®½åº¦ã€æ ·å¼å’Œé¢œè‰²è§„åˆ™\n\n## 9. ç”¨æˆ·ç•Œé¢\n\nCSS3 ä¸­ï¼Œæ–°çš„ç”¨æˆ·ç•Œé¢ç‰¹æ€§åŒ…æ‹¬é‡è®¾å…ƒç´ å°ºå¯¸ã€ç›’å°ºå¯¸ä»¥åŠè½®å»“ç­‰ã€‚Firefoxã€Chrome ä»¥åŠ Safari æ”¯æŒ resize å±æ€§ã€‚IEã€Chromeã€Safari ä»¥åŠ Opera æ”¯æŒ box-sizing å±æ€§ã€‚Firefox éœ€è¦å‰ç¼€-moz-ã€‚\næ‰€æœ‰ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒ outline-offset å±æ€§ï¼Œé™¤äº† IEã€‚\n\n- resize\n\n  resize å±æ€§è§„å®šæ˜¯å¦å¯ç”±ç”¨æˆ·è°ƒæ•´å…ƒç´ å°ºå¯¸ã€‚å¦‚æœå¸Œæœ›æ­¤å±æ€§ç”Ÿæ•ˆï¼Œéœ€è¦è®¾ç½®å…ƒç´ çš„ overflow å±æ€§ï¼Œå€¼å¯ä»¥æ˜¯ autoã€hidden æˆ– scrollã€‚\n\n- box-sizing\n\n  box-sizing å±æ€§å¯è®¾ç½®çš„å€¼æœ‰ content-boxã€border-box å’Œ inheritã€‚\n\n  - content-box: padding å’Œ border ä¸è¢«åŒ…å«åœ¨å®šä¹‰çš„ width å’Œ height ä¹‹å†…ã€‚å¯¹è±¡çš„å®é™…å®½åº¦ç­‰äºè®¾ç½®çš„ width å€¼å’Œ borderã€padding ä¹‹å’Œï¼Œå³ (Element width = width + border + padding)ï¼Œæ­¤å±æ€§è¡¨ç°ä¸ºæ ‡å‡†æ¨¡å¼ä¸‹çš„ç›’æ¨¡å‹ã€‚\n  - border-box: padding å’Œ border è¢«åŒ…å«åœ¨å®šä¹‰çš„ width å’Œ height ä¹‹å†…ã€‚å¯¹è±¡çš„å®é™…å®½åº¦å°±ç­‰äºè®¾ç½®çš„ width å€¼ï¼Œå³ä½¿å®šä¹‰æœ‰ border å’Œ padding ä¹Ÿä¸ä¼šæ”¹å˜å¯¹è±¡çš„å®é™…å®½åº¦ï¼Œå³ (Element width = width)ï¼Œæ­¤å±æ€§è¡¨ç°ä¸ºæ€ªå¼‚æ¨¡å¼ä¸‹çš„ç›’æ¨¡å‹ã€‚\n\n- outline-offset\n\n  outline-offset å±æ€§å¯¹è½®å»“è¿›è¡Œåç§»ï¼Œå¹¶åœ¨è¶…å‡ºè¾¹æ¡†è¾¹ç¼˜çš„ä½ç½®ç»˜åˆ¶è½®å»“ã€‚\n","tags":["CSS"],"categories":["CSS"]},{"title":"BFC","url":"/2019/04/10/BFC/","content":"\n# BFC\n\n## BFC çš„å®šä¹‰ï¼š\n\nBFC(Block formatting context)ç›´è¯‘ä¸º\"å—çº§æ ¼å¼åŒ–ä¸Šä¸‹æ–‡\"ã€‚å®ƒ**æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¸²æŸ“åŒºåŸŸ**ï¼Œåªæœ‰**Block-level box**å‚ä¸ï¼ˆåœ¨ä¸‹é¢æœ‰è§£é‡Šï¼‰ï¼Œ å®ƒè§„å®šäº†å†…éƒ¨çš„ Block-level Box å¦‚ä½•å¸ƒå±€ï¼Œå¹¶ä¸”ä¸è¿™ä¸ªåŒºåŸŸå¤–éƒ¨æ¯«ä¸ç›¸å¹²ã€‚**é€šä¿—åœ°è®²ï¼ŒBFC æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œç”¨äºç®¡ç†å—çº§å…ƒç´ ã€‚**\n\n <!-- more -->\n\n## è§¦å‘ BFC çš„æ–¹å¼ï¼ˆä»¥ä¸‹ä»»æ„ä¸€æ¡å°±å¯ä»¥ï¼‰\n\n1. æ ¹å…ƒç´ ï¼Œå³ HTML å…ƒç´ \n2. float çš„å€¼ä¸ä¸º noneï¼ˆä¸º `left`æˆ–`right`ï¼‰\n3. overflow çš„å€¼ä¸ä¸º visibleï¼ˆä¸º`hidden`æˆ–`auto`æˆ–`scroll`ï¼‰\n4. display çš„å€¼ä¸º`table-cell`ã€`table-caption`ã€`inline-flex`ã€`flex`å’Œ`inline-block`ä¹‹ä¸€\n5. position çš„å€¼ä¸ä¸º static æˆ–è€… releative ä¸­ä»»ä½•ä¸€ä¸ª(ä¸º`absolute`æˆ–`fixed`)\n\n## BFC çš„å¸ƒå±€è§„åˆ™\n\n1. å†…éƒ¨çš„ Box ä¼šåœ¨å‚ç›´æ–¹å‘ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ”¾ç½®ã€‚\n2. Box å‚ç›´æ–¹å‘çš„è·ç¦»ç”± margin å†³å®šã€‚å±äºåŒä¸€ä¸ª BFC çš„ä¸¤ä¸ªç›¸é‚» Box çš„ margin ä¼šå‘ç”Ÿé‡å ï¼ˆ**margin é‡å ä¸‰ä¸ªæ¡ä»¶:åŒå±äºä¸€ä¸ª BFC;ç›¸é‚»;å—çº§å…ƒç´ **ï¼‰ï¼Œä¸¤ä¸ªç›¸é‚»çš„ BFC ä¸Šä¸‹ margin ä¸ä¼šé‡å \n3. æ¯ä¸ªå…ƒç´ çš„ margin box çš„å·¦è¾¹ï¼Œ ä¸åŒ…å«å— border box çš„å·¦è¾¹ç›¸æ¥è§¦(å¯¹äºä»å·¦å¾€å³çš„æ ¼å¼åŒ–ï¼Œå¦åˆ™ç›¸å)ã€‚å³ä½¿å­˜åœ¨æµ®åŠ¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚\n4. BFC çš„åŒºåŸŸä¸ä¼šä¸ float box é‡å ã€‚éæµ®åŠ¨å…ƒç´ ä¸ä¼šè¦†ç›–æµ®åŠ¨å…ƒç´ çš„ä½ç½®ã€‚\n5. BFC å°±æ˜¯é¡µé¢ä¸Šçš„ä¸€ä¸ªéš”ç¦»çš„ç‹¬ç«‹å®¹å™¨ï¼Œå®¹å™¨é‡Œé¢çš„å­å…ƒç´ ä¸ä¼šå½±å“åˆ°å¤–é¢çš„å…ƒç´ ã€‚åä¹‹ä¹Ÿå¦‚æ­¤ã€‚ï¼ˆè§¦å‘ BFCï¼Œå›æµçš„å±€éƒ¨æ¸²æŸ“ï¼‰\n6. è®¡ç®— BFC çš„é«˜åº¦æ—¶ï¼Œæµ®åŠ¨å…ƒç´ ä¹Ÿå‚ä¸è®¡ç®—ï¼ˆæ¸…é™¤æµ®åŠ¨ haslayoutï¼‰\n7. margin ä¸ä¼šä¼ é€’ç»™çˆ¶çº§ï¼ˆçˆ¶çº§è§¦å‘äº† BFCï¼‰\n\n### å¯¹æ¯”æ™®é€šæ–‡æ¡£æµçš„å¸ƒå±€è§„åˆ™\n\n1. æµ®åŠ¨çš„å…ƒç´ æ˜¯ä¸ä¼šè¢«çˆ¶çº§è®¡ç®—é«˜åº¦\n2. éæµ®åŠ¨å…ƒç´ ä¼šè¦†ç›–æµ®åŠ¨å…ƒç´ çš„ä½ç½®\n3. margin ä¼šä¼ é€’ç»™çˆ¶çº§\n4. ä¸¤ä¸ªç›¸é‚»çš„å…ƒç´ ä¸Šä¸‹ margin ä¼šé‡å \n\n## BFC æœ‰å“ªäº›ä½œç”¨ï¼š\n\n1. è‡ªé€‚åº”ä¸¤æ å¸ƒå±€ï¼ˆè§„åˆ™ 4ï¼‰\n2. å¯ä»¥é˜»æ­¢å…ƒç´ è¢«æµ®åŠ¨å…ƒç´ è¦†ç›–ï¼ˆè§„åˆ™ 4ï¼‰\n3. å¯ä»¥åŒ…å«æµ®åŠ¨å…ƒç´ â€”â€”æ¸…é™¤å†…éƒ¨æµ®åŠ¨ï¼ˆè§„åˆ™ 6ï¼‰\n4. åˆ†å±äºä¸åŒçš„ BFC æ—¶å¯ä»¥é˜»æ­¢ margin é‡å ï¼ˆè§„åˆ™ 2ï¼‰\n","tags":["CSS","å¸ƒå±€"],"categories":["CSS"]},{"title":"å­—ç¬¦ç¼–ç ï¼šUnicodeä¸JavaScript","url":"/2019/04/06/å­—ç¬¦ç¼–ç ï¼šUnicodeä¸Javascript/","content":"\n# å­—ç¬¦ç¼–ç ï¼šUnicode ä¸ Javascript\n\n## 1.**ASCII ç **\n\næˆ‘ä»¬çŸ¥é“ï¼Œè®¡ç®—æœºå†…éƒ¨ï¼Œæ‰€æœ‰ä¿¡æ¯æœ€ç»ˆéƒ½æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å€¼ã€‚æ¯ä¸€ä¸ªäºŒè¿›åˆ¶ä½ï¼ˆbitï¼‰æœ‰`0`å’Œ`1`ä¸¤ç§çŠ¶æ€ï¼Œå› æ­¤å…«ä¸ªäºŒè¿›åˆ¶ä½å°±å¯ä»¥ç»„åˆå‡º 256 ç§çŠ¶æ€ï¼Œè¿™è¢«ç§°ä¸ºä¸€ä¸ªå­—èŠ‚ï¼ˆbyteï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå­—èŠ‚ä¸€å…±å¯ä»¥ç”¨æ¥è¡¨ç¤º 256 ç§ä¸åŒçš„çŠ¶æ€ï¼Œæ¯ä¸€ä¸ªçŠ¶æ€å¯¹åº”ä¸€ä¸ªç¬¦å·ï¼Œå°±æ˜¯ 256 ä¸ªç¬¦å·ï¼Œä»`00000000`åˆ°`11111111`ã€‚\n\nä¸Šä¸ªä¸–çºª 60 å¹´ä»£ï¼Œç¾å›½åˆ¶å®šäº†ä¸€å¥—å­—ç¬¦ç¼–ç ï¼Œå¯¹è‹±è¯­å­—ç¬¦ä¸äºŒè¿›åˆ¶ä½ä¹‹é—´çš„å…³ç³»ï¼Œåšäº†ç»Ÿä¸€è§„å®šã€‚è¿™è¢«ç§°ä¸º ASCII ç ï¼Œä¸€ç›´æ²¿ç”¨è‡³ä»Šã€‚\n\nASCII ç ä¸€å…±è§„å®šäº† 128 ä¸ªå­—ç¬¦çš„ç¼–ç ï¼Œæ¯”å¦‚ç©ºæ ¼`SPACE`æ˜¯ 32ï¼ˆäºŒè¿›åˆ¶`00100000`ï¼‰ï¼Œå¤§å†™çš„å­—æ¯`A`æ˜¯ 65ï¼ˆäºŒè¿›åˆ¶`01000001`ï¼‰ã€‚è¿™ 128 ä¸ªç¬¦å·ï¼ˆåŒ…æ‹¬ 32 ä¸ªä¸èƒ½æ‰“å°å‡ºæ¥çš„æ§åˆ¶ç¬¦å·ï¼‰ï¼Œåªå ç”¨äº†ä¸€ä¸ªå­—èŠ‚çš„åé¢ 7 ä½ï¼Œæœ€å‰é¢çš„ä¸€ä½ç»Ÿä¸€è§„å®šä¸º`0`ã€‚\n\n <!-- more -->\n\n## 2.é ASCII ç¼–ç \n\nè‹±è¯­ç”¨ 128 ä¸ªç¬¦å·ç¼–ç å°±å¤Ÿäº†ï¼Œä½†æ˜¯ç”¨æ¥è¡¨ç¤ºå…¶ä»–è¯­è¨€ï¼Œ128 ä¸ªç¬¦å·æ˜¯ä¸å¤Ÿçš„ã€‚æ¯”å¦‚ï¼Œåœ¨æ³•è¯­ä¸­ï¼Œå­—æ¯ä¸Šæ–¹æœ‰æ³¨éŸ³ç¬¦å·ï¼Œå®ƒå°±æ— æ³•ç”¨ ASCII ç è¡¨ç¤ºã€‚äºæ˜¯ï¼Œä¸€äº›æ¬§æ´²å›½å®¶å°±å†³å®šï¼Œåˆ©ç”¨å­—èŠ‚ä¸­é—²ç½®çš„æœ€é«˜ä½ç¼–å…¥æ–°çš„ç¬¦å·ã€‚æ¯”å¦‚ï¼Œæ³•è¯­ä¸­çš„`Ã©`çš„ç¼–ç ä¸º 130ï¼ˆäºŒè¿›åˆ¶`10000010`ï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¿™äº›æ¬§æ´²å›½å®¶ä½¿ç”¨çš„ç¼–ç ä½“ç³»ï¼Œå¯ä»¥è¡¨ç¤ºæœ€å¤š 256 ä¸ªç¬¦å·ã€‚\n\nè¿™é‡Œå°±åˆå‡ºç°äº†æ–°çš„é—®é¢˜ã€‚ä¸åŒçš„å›½å®¶æœ‰ä¸åŒçš„å­—æ¯ï¼Œå› æ­¤ï¼Œå“ªæ€•å®ƒä»¬éƒ½ä½¿ç”¨ 256 ä¸ªç¬¦å·çš„ç¼–ç æ–¹å¼ï¼Œä»£è¡¨çš„å­—æ¯å´ä¸ä¸€æ ·ã€‚æ¯”å¦‚ï¼Œ130 åœ¨æ³•è¯­ç¼–ç ä¸­ä»£è¡¨äº†`Ã©`ï¼Œåœ¨å¸Œä¼¯æ¥è¯­ç¼–ç ä¸­å´ä»£è¡¨äº†å­—æ¯`Gimel` (`×’`)ï¼Œåœ¨ä¿„è¯­ç¼–ç ä¸­åˆä¼šä»£è¡¨å¦ä¸€ä¸ªç¬¦å·ã€‚ä½†æ˜¯ä¸ç®¡æ€æ ·ï¼Œæ‰€æœ‰è¿™äº›ç¼–ç æ–¹å¼ä¸­ï¼Œ0--127 è¡¨ç¤ºçš„ç¬¦å·æ˜¯ä¸€æ ·çš„ï¼Œä¸ä¸€æ ·çš„åªæ˜¯ 128--255 çš„è¿™ä¸€æ®µã€‚\n\nè‡³äºäºšæ´²å›½å®¶çš„æ–‡å­—ï¼Œä½¿ç”¨çš„ç¬¦å·å°±æ›´å¤šäº†ï¼Œæ±‰å­—å°±å¤šè¾¾ 10 ä¸‡å·¦å³ã€‚ä¸€ä¸ªå­—èŠ‚åªèƒ½è¡¨ç¤º 256 ç§ç¬¦å·ï¼Œè‚¯å®šæ˜¯ä¸å¤Ÿçš„ï¼Œå°±å¿…é¡»ä½¿ç”¨å¤šä¸ªå­—èŠ‚è¡¨è¾¾ä¸€ä¸ªç¬¦å·ã€‚æ¯”å¦‚ï¼Œç®€ä½“ä¸­æ–‡å¸¸è§çš„ç¼–ç æ–¹å¼æ˜¯ GB2312ï¼Œä½¿ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ï¼Œæ‰€ä»¥ç†è®ºä¸Šæœ€å¤šå¯ä»¥è¡¨ç¤º 256 x 256 = 65536 ä¸ªç¬¦å·ã€‚\n\nä¸­æ–‡ç¼–ç çš„é—®é¢˜éœ€è¦ä¸“æ–‡è®¨è®ºï¼Œæ­¤å¤„ä¸æ¶‰åŠã€‚è¿™é‡ŒåªæŒ‡å‡ºï¼Œè™½ç„¶éƒ½æ˜¯ç”¨å¤šä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç¬¦å·ï¼Œä½†æ˜¯ GB ç±»çš„æ±‰å­—ç¼–ç ä¸åæ–‡çš„ Unicode å’Œ UTF-8 æ˜¯æ¯«æ— å…³ç³»çš„ã€‚\n\n## 3.Unicode\n\nUnicode æºäºä¸€ä¸ªå¾ˆç®€å•çš„æƒ³æ³•ï¼šå°†å…¨ä¸–ç•Œæ‰€æœ‰çš„å­—ç¬¦åŒ…å«åœ¨ä¸€ä¸ªé›†åˆé‡Œï¼Œè®¡ç®—æœºåªè¦æ”¯æŒè¿™ä¸€ä¸ªå­—ç¬¦é›†ï¼Œå°±èƒ½æ˜¾ç¤ºæ‰€æœ‰çš„å­—ç¬¦ï¼Œå†ä¹Ÿä¸ä¼šæœ‰ä¹±ç äº†ã€‚\n\nUnicode å½“ç„¶æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é›†åˆï¼Œç°åœ¨çš„è§„æ¨¡å¯ä»¥å®¹çº³ 100 å¤šä¸‡ä¸ªç¬¦å·ã€‚æ¯ä¸ªç¬¦å·çš„ç¼–ç éƒ½ä¸ä¸€æ ·ï¼Œæ¯”å¦‚ï¼Œ`U+0639`è¡¨ç¤ºé˜¿æ‹‰ä¼¯å­—æ¯`Ain`ï¼Œ`U+0041`è¡¨ç¤ºè‹±è¯­çš„å¤§å†™å­—æ¯`A`ï¼Œ`U+4E25`è¡¨ç¤ºæ±‰å­—`ä¸¥`ã€‚å…·ä½“çš„ç¬¦å·å¯¹åº”è¡¨ï¼Œå¯ä»¥æŸ¥è¯¢[unicode.org](http://www.unicode.org/)ï¼Œæˆ–è€…ä¸“é—¨çš„[æ±‰å­—å¯¹åº”è¡¨](http://www.chi2ko.com/tool/CJK.htm)ã€‚\n\n### ç ç‚¹\n\n**å®ƒä» 0 å¼€å§‹ï¼Œä¸ºæ¯ä¸ªç¬¦å·æŒ‡å®šä¸€ä¸ªç¼–å·ï¼Œè¿™å«åš\"ç ç‚¹\"ï¼ˆcode pointï¼‰ã€‚**æ¯”å¦‚ï¼Œç ç‚¹ 0 çš„ç¬¦å·å°±æ˜¯ nullï¼ˆè¡¨ç¤ºæ‰€æœ‰äºŒè¿›åˆ¶ä½éƒ½æ˜¯ 0ï¼‰ã€‚\n\n```javascript\nU+0000 = null\n```\n\nä¸Šå¼ä¸­ï¼ŒU+è¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„åå…­è¿›åˆ¶æ•°æ˜¯ Unicode çš„ç ç‚¹ã€‚\n\nç›®å‰ï¼ŒUnicode çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 7.0 ç‰ˆï¼Œä¸€å…±æ”¶å…¥äº† 109449 ä¸ªç¬¦å·ï¼Œå…¶ä¸­çš„ä¸­æ—¥éŸ©æ–‡å­—ä¸º 74500 ä¸ªã€‚å¯ä»¥è¿‘ä¼¼è®¤ä¸ºï¼Œå…¨ä¸–ç•Œç°æœ‰çš„ç¬¦å·å½“ä¸­ï¼Œä¸‰åˆ†ä¹‹äºŒä»¥ä¸Šæ¥è‡ªä¸œäºšæ–‡å­—ã€‚æ¯”å¦‚ï¼Œä¸­æ–‡\"å¥½\"çš„ç ç‚¹æ˜¯åå…­è¿›åˆ¶çš„ 597Dã€‚\n\n### åˆ†åŒºï¼ˆåŸºæœ¬å¹³é¢&&è¾…åŠ©å¹³é¢ï¼‰\n\nè¿™ä¹ˆå¤šç¬¦å·ï¼ŒUnicode ä¸æ˜¯ä¸€æ¬¡æ€§å®šä¹‰çš„ï¼Œè€Œæ˜¯åˆ†åŒºå®šä¹‰ã€‚æ¯ä¸ªåŒºå¯ä»¥å­˜æ”¾ 65536 ä¸ªï¼ˆ216ï¼‰å­—ç¬¦ï¼Œç§°ä¸ºä¸€ä¸ªå¹³é¢ï¼ˆplaneï¼‰ã€‚ç›®å‰ï¼Œä¸€å…±æœ‰ 17 ä¸ªï¼ˆ25ï¼‰å¹³é¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ª Unicode å­—ç¬¦é›†çš„å¤§å°ç°åœ¨æ˜¯ 221ã€‚\n\næœ€å‰é¢çš„ 65536 ä¸ªå­—ç¬¦ä½ï¼Œç§°ä¸ºåŸºæœ¬å¹³é¢ï¼ˆç¼©å†™ BMPï¼‰ï¼Œå®ƒçš„ç ç‚¹èŒƒå›´æ˜¯ä» 0 ä¸€ç›´åˆ° 216-1ï¼Œå†™æˆ 16 è¿›åˆ¶å°±æ˜¯ä» U+0000 åˆ° U+FFFFã€‚æ‰€æœ‰æœ€å¸¸è§çš„å­—ç¬¦éƒ½æ”¾åœ¨è¿™ä¸ªå¹³é¢ï¼Œè¿™æ˜¯ Unicode æœ€å…ˆå®šä¹‰å’Œå…¬å¸ƒçš„ä¸€ä¸ªå¹³é¢ã€‚\n\nå‰©ä¸‹çš„å­—ç¬¦éƒ½æ”¾åœ¨è¾…åŠ©å¹³é¢ï¼ˆç¼©å†™ SMPï¼‰ï¼Œç ç‚¹èŒƒå›´ä» U+010000 ä¸€ç›´åˆ° U+10FFFFã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy7fmupoj30ug0fedin.jpg)\n\n### é—®é¢˜\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒUnicode åªæ˜¯ä¸€ä¸ªç¬¦å·é›†ï¼Œå®ƒåªè§„å®šäº†ç¬¦å·çš„äºŒè¿›åˆ¶ä»£ç ï¼Œå´æ²¡æœ‰è§„å®šè¿™ä¸ªäºŒè¿›åˆ¶ä»£ç åº”è¯¥å¦‚ä½•å­˜å‚¨ã€‚\n\næ¯”å¦‚ï¼Œæ±‰å­—`ä¸¥`çš„ Unicode æ˜¯åå…­è¿›åˆ¶æ•°`4E25`ï¼Œè½¬æ¢æˆäºŒè¿›åˆ¶æ•°è¶³è¶³æœ‰ 15 ä½ï¼ˆ`100111000100101`ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªç¬¦å·çš„è¡¨ç¤ºè‡³å°‘éœ€è¦ 2 ä¸ªå­—èŠ‚ã€‚è¡¨ç¤ºå…¶ä»–æ›´å¤§çš„ç¬¦å·ï¼Œå¯èƒ½éœ€è¦ 3 ä¸ªå­—èŠ‚æˆ–è€… 4 ä¸ªå­—èŠ‚ï¼Œç”šè‡³æ›´å¤šã€‚\n\n- å¦‚ä½•æ‰èƒ½åŒºåˆ« Unicode å’Œ ASCII ï¼Ÿè®¡ç®—æœºæ€ä¹ˆçŸ¥é“ä¸‰ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç¬¦å·ï¼Œè€Œä¸æ˜¯åˆ†åˆ«è¡¨ç¤ºä¸‰ä¸ªç¬¦å·å‘¢ï¼Ÿ\n- æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œè‹±æ–‡å­—æ¯åªç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºå°±å¤Ÿäº†ï¼Œå¦‚æœ Unicode ç»Ÿä¸€è§„å®šï¼Œæ¯ä¸ªç¬¦å·ç”¨ä¸‰ä¸ªæˆ–å››ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œé‚£ä¹ˆæ¯ä¸ªè‹±æ–‡å­—æ¯å‰éƒ½å¿…ç„¶æœ‰äºŒåˆ°ä¸‰ä¸ªå­—èŠ‚æ˜¯`0`ï¼Œè¿™å¯¹äºå­˜å‚¨æ¥è¯´æ˜¯æå¤§çš„æµªè´¹ï¼Œæ–‡æœ¬æ–‡ä»¶çš„å¤§å°ä¼šå› æ­¤å¤§å‡ºäºŒä¸‰å€ï¼Œè¿™æ˜¯æ— æ³•æ¥å—çš„ã€‚\n\n## 4.UTF-32 ä¸ UTF-8\n\n### UTF-32\n\n**æœ€ç›´è§‚çš„ç¼–ç æ–¹æ³•æ˜¯ï¼Œæ¯ä¸ªç ç‚¹ä½¿ç”¨å››ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå­—èŠ‚å†…å®¹ä¸€ä¸€å¯¹åº”ç ç‚¹ã€‚è¿™ç§ç¼–ç æ–¹æ³•å°±å«åš UTF-32ã€‚**æ¯”å¦‚ï¼Œç ç‚¹ 0 å°±ç”¨å››ä¸ªå­—èŠ‚çš„ 0 è¡¨ç¤ºï¼Œç ç‚¹ 597D å°±åœ¨å‰é¢åŠ ä¸¤ä¸ªå­—èŠ‚çš„ 0ã€‚\n\n```javascript\nU+0000 = 0x0000 0000\n\nU+597D = 0x0000 597D\n```\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy7hhpnmj30tc0g8412.jpg)\n\n- #### UTF-32 çš„ä¼˜ç‚¹\n\n  è½¬æ¢è§„åˆ™ç®€å•ç›´è§‚ï¼ŒæŸ¥æ‰¾æ•ˆç‡é«˜ã€‚\n\n- #### ç¼ºç‚¹\n\n  æµªè´¹ç©ºé—´ï¼ŒåŒæ ·å†…å®¹çš„è‹±è¯­æ–‡æœ¬ï¼Œå®ƒä¼šæ¯” ASCII ç¼–ç å¤§å››å€ã€‚è¿™ä¸ªç¼ºç‚¹å¾ˆè‡´å‘½ï¼Œå¯¼è‡´å®é™…ä¸Šæ²¡æœ‰äººä½¿ç”¨è¿™ç§ç¼–ç æ–¹æ³•ï¼ŒHTML 5 æ ‡å‡†å°±æ˜æ–‡è§„å®šï¼Œç½‘é¡µä¸å¾—ç¼–ç æˆ UTF-32ã€‚\n\n### UTF-8\n\n**UTF-8 æ˜¯ä¸€ç§å˜é•¿çš„ç¼–ç æ–¹æ³•ï¼Œå­—ç¬¦é•¿åº¦ä» 1 ä¸ªå­—èŠ‚åˆ° 4 ä¸ªå­—èŠ‚ä¸ç­‰ã€‚**è¶Šæ˜¯å¸¸ç”¨çš„å­—ç¬¦ï¼Œå­—èŠ‚è¶ŠçŸ­ï¼Œæœ€å‰é¢çš„ 128 ä¸ªå­—ç¬¦ï¼Œåªä½¿ç”¨ 1 ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œä¸ ASCII ç å®Œå…¨ç›¸åŒã€‚\n\nç”±äº UTF-8 è¿™ç§èŠ‚çœç©ºé—´çš„ç‰¹æ€§ï¼Œå¯¼è‡´å®ƒæˆä¸ºäº’è”ç½‘ä¸Šæœ€å¸¸è§çš„ç½‘é¡µç¼–ç ã€‚\n\n- #### UTF-8 çš„ç¼–ç è§„åˆ™å¾ˆç®€å•ï¼Œåªæœ‰äºŒæ¡ï¼š\n\n1ï¼‰å¯¹äºå•å­—èŠ‚çš„ç¬¦å·ï¼Œå­—èŠ‚çš„ç¬¬ä¸€ä½è®¾ä¸º`0`ï¼Œåé¢ 7 ä½ä¸ºè¿™ä¸ªç¬¦å·çš„ Unicode ç ã€‚å› æ­¤å¯¹äºè‹±è¯­å­—æ¯ï¼ŒUTF-8 ç¼–ç å’Œ ASCII ç æ˜¯ç›¸åŒçš„ã€‚\n\n2ï¼‰å¯¹äº`n`å­—èŠ‚çš„ç¬¦å·ï¼ˆ`n > 1`ï¼‰ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„å‰`n`ä½éƒ½è®¾ä¸º`1`ï¼Œç¬¬`n + 1`ä½è®¾ä¸º`0`ï¼Œåé¢å­—èŠ‚çš„å‰ä¸¤ä½ä¸€å¾‹è®¾ä¸º`10`ã€‚å‰©ä¸‹çš„æ²¡æœ‰æåŠçš„äºŒè¿›åˆ¶ä½ï¼Œå…¨éƒ¨ä¸ºè¿™ä¸ªç¬¦å·çš„ Unicode ç ã€‚\n\n- #### ç¼–ç è§„åˆ™ï¼š\n\n```javascript\nUnicodeç¬¦å·èŒƒå›´      |        UTF-8ç¼–ç æ–¹å¼\n(åå…­è¿›åˆ¶)        \t |              ï¼ˆäºŒè¿›åˆ¶ï¼‰\n----------------------+---------------------------------------------\n0000 0000-0000 007F | 0xxxxxxx\n0000 0080-0000 07FF | 110xxxxx 10xxxxxx\n0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx\n0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n```\n\nè·Ÿæ®ä¸Šè¡¨ï¼Œè§£è¯» UTF-8 ç¼–ç éå¸¸ç®€å•ã€‚å¦‚æœä¸€ä¸ªå­—èŠ‚çš„ç¬¬ä¸€ä½æ˜¯`0`ï¼Œåˆ™è¿™ä¸ªå­—èŠ‚å•ç‹¬å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼›å¦‚æœç¬¬ä¸€ä½æ˜¯`1`ï¼Œåˆ™è¿ç»­æœ‰å¤šå°‘ä¸ª`1`ï¼Œå°±è¡¨ç¤ºå½“å‰å­—ç¬¦å ç”¨å¤šå°‘ä¸ªå­—èŠ‚ã€‚\n\nä¸‹é¢ï¼Œè¿˜æ˜¯ä»¥æ±‰å­—`ä¸¥`ä¸ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•å®ç° UTF-8 ç¼–ç ã€‚\n\n`ä¸¥`çš„ Unicode æ˜¯`4E25`ï¼ˆ`100111000100101`ï¼‰ï¼Œæ ¹æ®ä¸Šè¡¨ï¼Œå¯ä»¥å‘ç°`4E25`å¤„åœ¨ç¬¬ä¸‰è¡Œçš„èŒƒå›´å†…ï¼ˆ`0000 0800 - 0000 FFFF`ï¼‰ï¼Œå› æ­¤`ä¸¥`çš„ UTF-8 ç¼–ç éœ€è¦ä¸‰ä¸ªå­—èŠ‚ï¼Œå³æ ¼å¼æ˜¯`1110xxxx 10xxxxxx 10xxxxxx`ã€‚ç„¶åï¼Œä»`ä¸¥`çš„æœ€åä¸€ä¸ªäºŒè¿›åˆ¶ä½å¼€å§‹ï¼Œä¾æ¬¡ä»åå‘å‰å¡«å…¥æ ¼å¼ä¸­çš„`x`ï¼Œå¤šå‡ºçš„ä½è¡¥`0`ã€‚è¿™æ ·å°±å¾—åˆ°äº†ï¼Œ`ä¸¥`çš„ UTF-8 ç¼–ç æ˜¯`11100100 10111000 10100101`ï¼Œè½¬æ¢æˆåå…­è¿›åˆ¶å°±æ˜¯`E4B8A5`ã€‚\n\n## 5.UTF-16\n\nUTF-16 ç¼–ç ä»‹äº UTF-32 ä¸ UTF-8 ä¹‹é—´ï¼ŒåŒæ—¶ç»“åˆäº†å®šé•¿å’Œå˜é•¿ä¸¤ç§ç¼–ç æ–¹æ³•çš„ç‰¹ç‚¹ã€‚\n\nå®ƒçš„ç¼–ç è§„åˆ™å¾ˆç®€å•ï¼šåŸºæœ¬å¹³é¢çš„å­—ç¬¦å ç”¨ 2 ä¸ªå­—èŠ‚ï¼Œè¾…åŠ©å¹³é¢çš„å­—ç¬¦å ç”¨ 4 ä¸ªå­—èŠ‚ã€‚**ä¹Ÿå°±æ˜¯è¯´ï¼ŒUTF-16 çš„ç¼–ç é•¿åº¦è¦ä¹ˆæ˜¯ 2 ä¸ªå­—èŠ‚ï¼ˆU+0000 åˆ° U+FFFFï¼‰ï¼Œè¦ä¹ˆæ˜¯ 4 ä¸ªå­—èŠ‚ï¼ˆU+010000 åˆ° U+10FFFFï¼‰ã€‚**\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy7e7xfaj30q40e40v3.jpg)\n\näºæ˜¯å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“æˆ‘ä»¬é‡åˆ°ä¸¤ä¸ªå­—èŠ‚ï¼Œæ€ä¹ˆçœ‹å‡ºå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªå­—ç¬¦ï¼Œè¿˜æ˜¯éœ€è¦è·Ÿå…¶ä»–ä¸¤ä¸ªå­—èŠ‚æ”¾åœ¨ä¸€èµ·è§£è¯»ï¼Ÿ\n\nåœ¨åŸºæœ¬å¹³é¢å†…ï¼Œä» U+D800 åˆ° U+DFFF æ˜¯ä¸€ä¸ªç©ºæ®µï¼Œå³è¿™äº›ç ç‚¹ä¸å¯¹åº”ä»»ä½•å­—ç¬¦ã€‚å› æ­¤ï¼Œè¿™ä¸ªç©ºæ®µå¯ä»¥ç”¨æ¥æ˜ å°„è¾…åŠ©å¹³é¢çš„å­—ç¬¦ã€‚\n\nå…·ä½“æ¥è¯´ï¼Œè¾…åŠ©å¹³é¢çš„å­—ç¬¦ä½å…±æœ‰ 220 ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹åº”è¿™äº›å­—ç¬¦è‡³å°‘éœ€è¦ 20 ä¸ªäºŒè¿›åˆ¶ä½ã€‚UTF-16 å°†è¿™ 20 ä½æ‹†æˆä¸¤åŠï¼Œå‰ 10 ä½æ˜ å°„åœ¨ U+D800 åˆ° U+DBFFï¼ˆç©ºé—´å¤§å° 210ï¼‰ï¼Œç§°ä¸ºé«˜ä½ï¼ˆHï¼‰ï¼Œå 10 ä½æ˜ å°„åœ¨ U+DC00 åˆ° U+DFFFï¼ˆç©ºé—´å¤§å° 210ï¼‰ï¼Œç§°ä¸ºä½ä½ï¼ˆLï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œä¸€ä¸ªè¾…åŠ©å¹³é¢çš„å­—ç¬¦ï¼Œè¢«æ‹†æˆä¸¤ä¸ªåŸºæœ¬å¹³é¢çš„å­—ç¬¦è¡¨ç¤ºã€‚\n\n- #### ç¼–ç è§„åˆ™\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy7gmgarj30w20g2myq.jpg)\n\n**æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬é‡åˆ°ä¸¤ä¸ªå­—èŠ‚ï¼Œå‘ç°å®ƒçš„ç ç‚¹åœ¨ U+D800 åˆ° U+DBFF ä¹‹é—´ï¼Œå°±å¯ä»¥æ–­å®šï¼Œç´§è·Ÿåœ¨åé¢çš„ä¸¤ä¸ªå­—èŠ‚çš„ç ç‚¹ï¼Œåº”è¯¥åœ¨ U+DC00 åˆ° U+DFFF ä¹‹é—´ï¼Œè¿™å››ä¸ªå­—èŠ‚å¿…é¡»æ”¾åœ¨ä¸€èµ·è§£è¯»ã€‚**\n\n- #### Unicode ç ç‚¹ä¸ UTF-16 è½¬ç \n\né¦–å…ˆåŒºåˆ†è¿™æ˜¯åŸºæœ¬å¹³é¢å­—ç¬¦ï¼Œè¿˜æ˜¯è¾…åŠ©å¹³é¢å­—ç¬¦ã€‚å¦‚æœæ˜¯å‰è€…ï¼Œç›´æ¥å°†ç ç‚¹è½¬ä¸ºå¯¹åº”çš„åå…­è¿›åˆ¶å½¢å¼ï¼Œé•¿åº¦ä¸ºä¸¤å­—èŠ‚ã€‚\n\n```javascript\nU+597D = 0x597D\n```\n\nå¦‚æœæ˜¯è¾…åŠ©å¹³é¢å­—ç¬¦ï¼ŒUnicode 3.0 ç‰ˆç»™å‡ºäº†è½¬ç å…¬å¼ã€‚\n\n```javascript\nH = Math.floor((c - 0x10000) / 0x400) + 0xd800;\n\nL = ((c - 0x10000) % 0x400) + 0xdc00;\n```\n\n## 6.JavaScript ç”¨çš„æ˜¯ UCS-2\n\nJavaScript è¯­è¨€é‡‡ç”¨ Unicode å­—ç¬¦é›†ï¼Œä½†æ˜¯åªæ”¯æŒä¸€ç§ç¼–ç æ–¹æ³•ã€‚**UCS-2ï¼**\n\n_äº’è”ç½‘è¿˜æ²¡å‡ºç°çš„å¹´ä»£ï¼Œæ›¾ç»æœ‰ä¸¤ä¸ªå›¢é˜Ÿï¼Œä¸çº¦è€ŒåŒæƒ³æç»Ÿä¸€å­—ç¬¦é›†ã€‚ä¸€ä¸ªæ˜¯ 1988 å¹´æˆç«‹çš„ Unicode å›¢é˜Ÿï¼Œå¦ä¸€ä¸ªæ˜¯ 1989 å¹´æˆç«‹çš„ UCS å›¢é˜Ÿã€‚ç­‰åˆ°ä»–ä»¬å‘ç°äº†å¯¹æ–¹çš„å­˜åœ¨ï¼Œå¾ˆå¿«å°±è¾¾æˆä¸€è‡´ï¼šä¸–ç•Œä¸Šä¸éœ€è¦ä¸¤å¥—ç»Ÿä¸€å­—ç¬¦é›† 1991 å¹´ 10 æœˆï¼Œä¸¤ä¸ªå›¢é˜Ÿå†³å®šåˆå¹¶å­—ç¬¦é›†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»ä»Šä»¥ååªå‘å¸ƒä¸€å¥—å­—ç¬¦é›†ï¼Œå°±æ˜¯ Unicodeï¼Œå¹¶ä¸”ä¿®è®¢æ­¤å‰å‘å¸ƒçš„å­—ç¬¦é›†ï¼ŒUCS çš„ç ç‚¹å°†ä¸ Unicode å®Œå…¨ä¸€è‡´ã€‚_\n\n**ä¸¤è€…çš„å…³ç³»ç®€å•è¯´ï¼Œå°±æ˜¯ UTF-16 å–ä»£äº† UCS-2ï¼Œæˆ–è€…è¯´ UCS-2 æ•´åˆè¿›äº† UTF-16ã€‚**\n\n**åœ¨ JavaScript è¯­è¨€å‡ºç°çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰ UTF-16 ç¼–ç ã€‚**\n\n**ç”±äº JavaScript åªèƒ½å¤„ç† UCS-2 ç¼–ç ï¼Œé€ æˆæ‰€æœ‰å­—ç¬¦åœ¨è¿™é—¨è¯­è¨€ä¸­éƒ½æ˜¯ 2 ä¸ªå­—èŠ‚ï¼Œå¦‚æœæ˜¯ 4 ä¸ªå­—èŠ‚çš„å­—ç¬¦ï¼Œä¼šå½“ä½œä¸¤ä¸ªåŒå­—èŠ‚çš„å­—ç¬¦å¤„ç†ã€‚**JavaScript çš„å­—ç¬¦å‡½æ•°éƒ½å—åˆ°è¿™ä¸€ç‚¹çš„å½±å“ï¼Œæ— æ³•è¿”å›æ­£ç¡®ç»“æœã€‚\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy7g1rsaj30xi0bogn7.jpg)\n\nä»¥å­—ç¬¦![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy7epbosj301c01g741.jpg)ä¸ºä¾‹ï¼Œå®ƒçš„ UTF-16 ç¼–ç æ˜¯ 4 ä¸ªå­—èŠ‚çš„ 0xD834 DF06ã€‚é—®é¢˜å°±æ¥äº†ï¼Œ4 ä¸ªå­—èŠ‚çš„ç¼–ç ä¸å±äº UCS-2ï¼ŒJavaScript ä¸è®¤è¯†ï¼Œåªä¼šæŠŠå®ƒçœ‹ä½œå•ç‹¬çš„ä¸¤ä¸ªå­—ç¬¦ U+D834 å’Œ U+DF06ã€‚å‰é¢è¯´è¿‡ï¼Œè¿™ä¸¤ä¸ªç ç‚¹æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ JavaScript ä¼šè®¤ä¸º![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy7epbosj301c01g741.jpg)æ˜¯ä¸¤ä¸ªç©ºå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ï¼\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy7gyspej30gk0go0tp.jpg)\n\nä¸Šé¢ä»£ç è¡¨ç¤ºï¼ŒJavaScript è®¤ä¸ºå­—ç¬¦![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy7epbosj301c01g741.jpg)çš„é•¿åº¦æ˜¯ 2ï¼Œå–åˆ°çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ç©ºå­—ç¬¦ï¼Œå–åˆ°çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ç ç‚¹æ˜¯ 0xDB34ã€‚è¿™äº›ç»“æœéƒ½ä¸æ­£ç¡®ï¼\n\nè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»å¯¹ç ç‚¹åšä¸€ä¸ªåˆ¤æ–­ï¼Œç„¶åæ‰‹åŠ¨è°ƒæ•´ã€‚ä¸‹é¢æ˜¯æ­£ç¡®çš„éå†å­—ç¬¦ä¸²çš„å†™æ³•ã€‚\n\n```javascript\nwhile (++index < length) {\n  // ...\n  if (charCode >= 0xd800 && charCode <= 0xdbff) {\n    output.push(character + string.charAt(++index));\n  } else {\n    output.push(character);\n  }\n}\n```\n\nä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œéå†å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå¿…é¡»å¯¹ç ç‚¹åšä¸€ä¸ªåˆ¤æ–­ï¼Œåªè¦è½åœ¨ 0xD800 åˆ° 0xDBFF çš„åŒºé—´ï¼Œå°±è¦è¿åŒåé¢ 2 ä¸ªå­—èŠ‚ä¸€èµ·è¯»å–ã€‚\n\nç±»ä¼¼çš„é—®é¢˜å­˜åœ¨äºæ‰€æœ‰çš„ JavaScript å­—ç¬¦æ“ä½œå‡½æ•°ã€‚\n\n- String.prototype.replace()\n- String.prototype.substring()\n- String.prototype.slice()\n- ...\n\nä¸Šé¢çš„å‡½æ•°éƒ½åªå¯¹ 2 å­—èŠ‚çš„ç ç‚¹æœ‰æ•ˆã€‚è¦æ­£ç¡®å¤„ç† 4 å­—èŠ‚çš„ç ç‚¹ï¼Œå°±å¿…é¡»é€ä¸€éƒ¨ç½²è‡ªå·±çš„ç‰ˆæœ¬ï¼Œåˆ¤æ–­ä¸€ä¸‹å½“å‰å­—ç¬¦çš„ç ç‚¹èŒƒå›´ã€‚\n\n## 7.ES6\n\nECMAScript 6ï¼ˆç®€ç§° ES6ï¼‰ï¼Œå¤§å¹…å¢å¼ºäº† Unicode æ”¯æŒï¼ŒåŸºæœ¬ä¸Šè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚\n\n**ï¼ˆ1ï¼‰æ­£ç¡®è¯†åˆ«å­—ç¬¦**\n\nES6 å¯ä»¥è‡ªåŠ¨è¯†åˆ« 4 å­—èŠ‚çš„ç ç‚¹ã€‚å› æ­¤ï¼Œéå†å­—ç¬¦ä¸²å°±ç®€å•å¤šäº†ã€‚\n\n```javascript\nfor (let s of string) {\n  // ...\n}\n```\n\nä½†æ˜¯ï¼Œä¸ºäº†ä¿æŒå…¼å®¹ï¼Œlength å±æ€§è¿˜æ˜¯åŸæ¥çš„è¡Œä¸ºæ–¹å¼ã€‚ä¸ºäº†å¾—åˆ°å­—ç¬¦ä¸²çš„æ­£ç¡®é•¿åº¦ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼ã€‚\n\n```javascript\nArray.from(string).length;\n```\n\n**ï¼ˆ2ï¼‰ç ç‚¹è¡¨ç¤ºæ³•**\n\nJavaScript å…è®¸ç›´æ¥ç”¨ç ç‚¹è¡¨ç¤º Unicode å­—ç¬¦ï¼Œå†™æ³•æ˜¯\"åæ–œæ +u+ç ç‚¹\"ã€‚\n\n```javascript\n\"å¥½\" === \"\\u597D\"; // true\n```\n\nä½†æ˜¯ï¼Œè¿™ç§è¡¨ç¤ºæ³•å¯¹ 4 å­—èŠ‚çš„ç ç‚¹æ— æ•ˆã€‚ES6 ä¿®æ­£äº†è¿™ä¸ªé—®é¢˜ï¼Œåªè¦å°†ç ç‚¹æ”¾åœ¨å¤§æ‹¬å·å†…ï¼Œå°±èƒ½æ­£ç¡®è¯†åˆ«ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy7f113bj30xo08mgm0.jpg)\n\n**ï¼ˆ3ï¼‰å­—ç¬¦ä¸²å¤„ç†å‡½æ•°**\n\nES6 æ–°å¢äº†å‡ ä¸ªä¸“é—¨å¤„ç† 4 å­—èŠ‚ç ç‚¹çš„å‡½æ•°ã€‚\n\n- **String.fromCodePoint()**ï¼šä» Unicode ç ç‚¹è¿”å›å¯¹åº”å­—ç¬¦\n- **String.prototype.codePointAt()**ï¼šä»å­—ç¬¦è¿”å›å¯¹åº”çš„ç ç‚¹\n- **String.prototype.at()**ï¼šè¿”å›å­—ç¬¦ä¸²ç»™å®šä½ç½®çš„å­—ç¬¦\n\n**ï¼ˆ4ï¼‰æ­£åˆ™è¡¨è¾¾å¼**\n\nES6 æä¾›äº† u ä¿®é¥°ç¬¦ï¼Œå¯¹æ­£åˆ™è¡¨è¾¾å¼æ·»åŠ  4 å­—èŠ‚ç ç‚¹çš„æ”¯æŒã€‚\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy7emd6cj30xu08qt95.jpg)\n\n**ï¼ˆ5ï¼‰Unicode æ­£è§„åŒ–**\n\næœ‰äº›å­—ç¬¦é™¤äº†å­—æ¯ä»¥å¤–ï¼Œè¿˜æœ‰[é™„åŠ ç¬¦å·](http://zh.wikipedia.org/wiki/é™„åŠ ç¬¦å·)ã€‚æ¯”å¦‚ï¼Œæ±‰è¯­æ‹¼éŸ³çš„ Ç‘ï¼Œå­—æ¯ä¸Šé¢çš„å£°è°ƒå°±æ˜¯é™„åŠ ç¬¦å·ã€‚å¯¹äºè®¸å¤šæ¬§æ´²è¯­è¨€æ¥è¯´ï¼Œå£°è°ƒç¬¦å·æ˜¯éå¸¸é‡è¦çš„ã€‚\n\nUnicode æä¾›äº†ä¸¤ç§è¡¨ç¤ºæ–¹æ³•ã€‚ä¸€ç§æ˜¯å¸¦é™„åŠ ç¬¦å·çš„å•ä¸ªå­—ç¬¦ï¼Œå³ä¸€ä¸ªç ç‚¹è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚ Ç‘ çš„ç ç‚¹æ˜¯ U+01D1ï¼›å¦ä¸€ç§æ˜¯å°†é™„åŠ ç¬¦å·å•ç‹¬ä½œä¸ºä¸€ä¸ªç ç‚¹ï¼Œä¸ä¸»ä½“å­—ç¬¦å¤åˆæ˜¾ç¤ºï¼Œå³ä¸¤ä¸ªç ç‚¹è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚ Ç‘ å¯ä»¥å†™æˆ Oï¼ˆU+004Fï¼‰ + Ë‡ï¼ˆU+030Cï¼‰ã€‚\n\n```javascript\n// æ–¹æ³•ä¸€\n\"\\u01D1\";\n// 'Ç‘'\n\n// æ–¹æ³•äºŒ\n\"\\u004F\\u030C\";\n// 'Ç‘'\n```\n\nè¿™ä¸¤ç§è¡¨ç¤ºæ–¹æ³•ï¼Œè§†è§‰å’Œè¯­ä¹‰éƒ½å®Œå…¨ä¸€æ ·ï¼Œç†åº”ä½œä¸ºç­‰åŒæƒ…å†µå¤„ç†ã€‚ä½†æ˜¯ï¼ŒJavaScript æ— æ³•è¾¨åˆ«ã€‚\n\n```javascript\n\"\\u01D1\" === \"\\u004F\\u030C\";\n//false\n```\n\nES6 æä¾›äº† normalize æ–¹æ³•ï¼Œå…è®¸[\"Unicode æ­£è§„åŒ–\"](http://zh.wikipedia.org/wiki/Unicodeæ­£è¦åŒ–)ï¼Œå³å°†ä¸¤ç§æ–¹æ³•è½¬ä¸ºåŒæ ·çš„åºåˆ—ã€‚\n\n```javascript\n\"\\u01D1\".normalize() === \"\\u004F\\u030C\".normalize();\n// true\n```\n\n## 8.æ€»ç»“æˆªå–å«æœ‰å››å­—èŠ‚å­—ç¬¦çš„å­—ç¬¦ä¸²ä¸ä¼šå‡ºç°ä¹±ç çš„æ–¹æ³•\n\n```javascript\nlet nickname = \"éæ‹‰ğŸ’éæ‹‰\";\nnickname.length; // 6\n```\n\n### Array.from æ–¹æ³•\n\n`Array.from`è¿™ä¸ªæ–¹æ³•èƒ½å¤Ÿå°†ç±»æ•°ç»„è½¬æ¢ä¸ºçœŸå®çš„æ•°ç»„ï¼Œæ¯”å¦‚`NodeList`, `argument`ç­‰ï¼ŒåŒæ ·ï¼Œä¹ŸåŒ…æ‹¬å­—ç¬¦ä¸²ã€‚\n\n```javascript\nArray.from(nickname); // [\"é\", \"æ‹‰\", \"ğŸ’\", \"é\", \"æ‹‰\"]\nnickname.split(\"\"); // [\"é\", \"æ‹‰\", \"ï¿½\", \"ï¿½\", \"é\", \"æ‹‰\"]\n```\n\nä½¿ç”¨ Array.from æŠŠ nickname è½¬æ¢åï¼Œå¯ä»¥çœ‹åˆ°è½¬æ¢æˆä¸€ä¸ªçœŸå®çš„æ•°ç»„äº†ï¼Œæ¨±æ¡ƒå­—ç¬¦å äº†æ•°ç»„ä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œç„¶åæŒ‰ç…§æ•°ç»„ä¸­çš„æ–¹æ³•æˆªå–å†è¿›è¡Œæ‹¼æ¥å³å¯ï¼Œè€Œä½¿ç”¨ split æ–¹æ³•æ‹†åˆ†ï¼Œåˆ™è¿˜æ˜¯ä¹±ç ï¼š\n\n```javascript\nfunction truncated(str, num) {\n  return Array.from(str)\n    .slice(0, num)\n    .join(\"\");\n}\ntruncated(nickname, 3); // éæ‹‰ğŸ’\n```\n\n### codePointAt()æ–¹æ³•\n\nåœ¨ ES6 ä¹‹å‰ï¼Œ JS çš„å­—ç¬¦ä¸²ä»¥ 16 ä½å­—ç¬¦ç¼–ç (UTF-16)ä¸ºåŸºç¡€ã€‚æ¯ä¸ª 16 ä½åºåˆ—(ç›¸å½“äº 2 ä¸ªå­—èŠ‚)æ˜¯ä¸€ä¸ªç¼–ç å•å…ƒ(code unit)ï¼Œå¯ç®€ç§°ä¸ºç å…ƒï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚å­—ç¬¦ä¸²æ‰€æœ‰çš„å±æ€§ä¸æ–¹æ³•(å¦‚ length å±æ€§ä¸ charAt() æ–¹æ³•ç­‰)éƒ½æ˜¯åŸºäº 16 ä½åºåˆ—ã€‚\n\næ¯”å¦‚ length æ–¹æ³•ã€nickname[2]ã€split æ–¹æ³•ç­‰æ“ä½œï¼Œéƒ½ä¼šäº§ç”Ÿå¼‚å¸¸ã€‚ä¸ºæ­¤åœ¨ ES6 ä¸­ï¼ŒåŠ å¼ºäº†å¯¹ Unicode çš„æ”¯æŒï¼Œå¹¶ä¸”æ‰©å±•äº†å­—ç¬¦ä¸²å¯¹è±¡ã€‚\n\nå¯¹äº Unicode ç ç‚¹å¤§äº 0xFFFF çš„å­—ç¬¦ï¼Œæ˜¯ä½¿ç”¨ 4 ä¸ªå­—èŠ‚è¿›è¡Œå­˜å‚¨ã€‚ES6 æä¾›äº†`codePointAt`æ–¹æ³•ï¼Œèƒ½å¤Ÿæ­£ç¡®å¤„ç† 4 ä¸ªå­—èŠ‚å‚¨å­˜çš„å­—ç¬¦ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦çš„ç ç‚¹ã€‚\n\n```javascript\n// è·å–æ¨±æ¡ƒçš„ç ç‚¹\n\"ğŸ’\".codePointAt(0).toString(16); // 1f352\n\n// è¾“å‡ºç ç‚¹å¯¹åº”çš„å­—ç¬¦\n(\"\\u{1f352}\"); // ğŸ’\n```\n\nè¯·æ³¨æ„ï¼š åœ¨ä¹‹å‰ Unicode ç¼–ç ï¼Œå‡åœ¨`[\\u000-\\uFFFF]`ä¹‹é—´ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ç±»ä¼¼`\\u0047`è¿™æ ·çš„ç¼–ç ï¼›ä½†æ˜¯ç°åœ¨ç ç‚¹è¶…è¿‡`\\uFFFF`çš„ç•Œé™ï¼Œè‹¥å†è¿™æ ·ä½¿ç”¨ï¼Œåˆ™è·å–ä¸åˆ°å¯¹åº”çš„å­—ç¬¦ã€‚å› æ­¤åœ¨ ES6 ä¸­ï¼Œç ç‚¹çš„å­—ç¬¦æ”¾åœ¨ä¸­æ‹¬å·å†…ï¼Œç±»ä¼¼ä¸Šé¢çš„æ ¼å¼ï¼ˆæ‰€æœ‰çš„ç ç‚¹å‡å¯ä»¥ä½¿ç”¨è¿™ç§æ ¼å¼ï¼‰ï¼š\n\n```javascript\n\"\\u{1f352}\"; // ğŸ’\n\"\\u{47}\"; // G\n\"\\u{0047}\"; // G\n```\n\né‚£ä¹ˆå°±å®¹æ˜“äº†ï¼šåˆ¤æ–­éœ€è¦æˆªå–çš„ä½ç½®æ˜¯å¦æ­£å¥½æ˜¯ 4 å­—èŠ‚çš„å­—ç¬¦ï¼Œå¦‚æœæ˜¯åˆ™å»¶é•¿ä¸€ä½æˆªå–ï¼Œå¦åˆ™æ­£å¸¸æˆªå–ï¼š\n\n```javascript\nfunction truncated(str, num) {\n  let index = Array.from(str)[num - 1].codePointAt(0) > 0xffff ? num + 1 : num;\n  return str.slice(0, index);\n}\ntruncated(nickname, 3); // éæ‹‰ğŸ’\n```\n\n### for-of\n\n`for-in`æ–¹æ³•æ˜¯éå† key å€¼ï¼Œ`for-of`æ˜¯éå† value å€¼ï¼š\n\n```javascript\nlet arr = [\"a\", \"b\", \"c\"];\nfor (let k in arr) {\n  console.log(k); // 0 1 2\n}\n\nfor (let v of arr) {\n  console.log(v); // a b c\n}\n\nfor (let v of nickname) {\n  console.log(v); // é æ‹‰ ğŸ’ é æ‹‰\n}\n```\n\nå› æ­¤åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½è¿›è¡Œæˆªå–ï¼š\n\n```javascript\nfunction truncated(str, num) {\n  let s = \"\";\n  for (let v of nickname) {\n    s += v;\n    num--;\n    if (num <= 0) {\n      break;\n    }\n  }\n  return s;\n}\ntruncated(nickname, 3);\n```\n\n### æ­£ç¡®è¾“å‡ºå­—ç¬¦ä¸²çš„å­—ç¬¦ä¸ªæ•°ï¼š\n\n```javascript\nfunction getLen(str) {\n  var len = str.length;\n  for (var i = 0; i < len; i++) {\n    var charCode = str.charCodeAt(i);\n    if (charCode >= 0xd800 && charCode <= 0xdbff) {\n      len--;\n      i++;\n    }\n  }\n  return len;\n}\n```\n\n```javascript\nArray.from(str).length;\n```\n\n## 9.string.length\n\n### string.length è¿”å›çš„æ˜¯ä»€ä¹ˆ å­—ç¬¦çš„ä¸ªæ•°è¿˜æ˜¯å­—èŠ‚æ•°ï¼Ÿä¸ºä»€ä¹ˆä¼šä¸å®é™…é•¿åº¦ä¸ä¸€æ ·ï¼Ÿç¼–ç çš„éƒ¨åˆ†è¯¦ç»†è¯´\n\nstring.length():\nè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚æ˜¯ç¬¦åˆå­—ç¬¦ä¸²å†…å®¹çš„å®é™…å­—èŠ‚æ•°ï¼Œä¸ä¸€å®šç­‰äºå…¶å®¹é‡ã€‚\n\nstring.size()å’Œ string.length()æ˜¯åŒä¹‰è¯ï¼Œå¹¶è¿”å›å®Œå…¨ç›¸åŒçš„å€¼ã€‚\n\nstring.max_size()ï¼š\nè¿”å›å­—ç¬¦ä¸²çš„æœ€å¤§å¤§å°ï¼Œè¿”å›å­—ç¬¦ä¸²å¯ä»¥è¾¾åˆ°çš„æœ€å¤§é•¿åº¦ã€‚\n\nstring.resize():\nstring.resize(n)ï¼šæŠŠå­—ç¬¦ä¸²çš„é•¿åº¦è®¾ç½®ä¸º n ä¸ªå­—ç¬¦\nå¦‚æœ n å°äºå½“å‰å­—ç¬¦ä¸²é•¿åº¦ ï¼Œåˆ™åªæˆªå–å‰ n ä¸ªå­—ç¬¦ï¼Œåˆ é™¤è¶…å‡ºç¬¬ n ä¸ªå­—ç¬¦çš„å­—ç¬¦ã€‚\nå¦‚æœå¤§äºï¼Œåˆ™åœ¨æœ«ç«¯æ’å…¥å°½å¯èƒ½å¤šçš„å­—ç¬¦æ¥æ‰©å±•å½“å‰å†…å®¹ï¼Œä»¥è¾¾åˆ°å¤§å° nã€‚ å¦‚æœæŒ‡å®š cï¼Œåˆ™æ–°å…ƒç´ å°†åˆå§‹åŒ–ä¸º c çš„å‰¯æœ¬ï¼Œå¦åˆ™ä¸ºå€¼åˆå§‹åŒ–å­—ç¬¦ï¼ˆç©ºå­—ç¬¦ï¼‰ã€‚\n\nstring.capacity()ï¼š\nè¿”å›å·²åˆ†é…å­˜å‚¨çš„å¤§å°ã€‚å½“å‰ä¸ºå­—ç¬¦ä¸²åˆ†é…çš„å­˜å‚¨ç©ºé—´çš„å¤§å°ï¼Œä»¥å­—èŠ‚è¡¨ç¤ºã€‚\n\næ­¤å®¹é‡ä¸ä¸€å®šç­‰äºå­—ç¬¦ä¸²é•¿åº¦ã€‚ å®ƒå¯ä»¥ç›¸ç­‰æˆ–æ›´å¤§ï¼Œé¢å¤–çš„ç©ºé—´å…è®¸å¯¹è±¡åœ¨å°†æ–°å­—ç¬¦æ·»åŠ åˆ°å­—ç¬¦ä¸²æ—¶ä¼˜åŒ–å…¶æ“ä½œã€‚\n","tags":["JavaScript"],"categories":["JavaScript"]},{"title":"å¸¸ç”¨çš„æ­£åˆ™","url":"/2019/03/29/å¸¸ç”¨çš„æ­£åˆ™/","content":"\n# æ­£åˆ™\n\n## 1.æ ¡éªŒæ•°å­—\n\n```javascript\næ•°å­—ï¼š^\\d*$\nnä½çš„æ•°å­—ï¼š^\\d{n}$\nè‡³å°‘nä½çš„æ•°å­—ï¼š^\\d{n,}$\nm-nä½çš„æ•°å­—ï¼š^\\d{m,n}$\né›¶å’Œéé›¶å¼€å¤´çš„æ•°å­—ï¼š^(0|[1-9][0-9]*)$\néé›¶å¼€å¤´çš„æœ€å¤šå¸¦ä¸¤ä½å°æ•°çš„æ•°å­—ï¼š^([1-9]\\d*)+(\\.\\d{1,2})?$\nå¸¦1-2ä½å°æ•°çš„æ­£æ•°æˆ–è´Ÿæ•°ï¼š^(\\-)?\\d+\\.\\d{1,2}$\næ­£æ•°ã€è´Ÿæ•°ã€å’Œå°æ•°ï¼š^(\\-)?\\d+(\\.\\d+)?$\næœ‰ä¸¤ä½å°æ•°çš„æ­£å®æ•°ï¼š^\\d+\\.\\d{2}$\næœ‰1~3ä½å°æ•°çš„æ­£å®æ•°ï¼š^\\d+\\.\\d{1,3}$\néé›¶çš„æ­£æ•´æ•°ï¼š^[1-9]\\d*$\néé›¶çš„è´Ÿæ•´æ•°ï¼š^-[1-9]\\d*$\néæ­£æ•´æ•°ï¼š^-[1-9]\\d*|0$ æˆ– ^((-\\d+)|(0+))$\néè´Ÿæµ®ç‚¹æ•°ï¼š^\\d+(\\.\\d+)?$ æˆ– ^[1-9]\\d*\\.\\d*|0\\.\\d*[1-9]\\d*|0?\\.0+|0$\néæ­£æµ®ç‚¹æ•°ï¼š^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$ æˆ– ^(-([1-9]\\d*\\.\\d*|0\\.\\d*[1-9]\\d*))|0?\\.0+|0$\næ­£æµ®ç‚¹æ•°ï¼š^[1-9]\\d*\\.\\d*|0\\.\\d*[1-9]\\d*$ æˆ– ^(([0-9]+\\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\\.[0-9]+)|([0-9]*[1-9][0-9]*))$\nè´Ÿæµ®ç‚¹æ•°ï¼š^-([1-9]\\d*\\.\\d*|0\\.\\d*[1-9]\\d*)$ æˆ– ^(-(([0-9]+\\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\\.[0-9]+)|([0-9]*[1-9][0-9]*)))$\næµ®ç‚¹æ•°ï¼š^(-?\\d+)(\\.\\d+)?$ æˆ– ^-?([1-9]\\d*\\.\\d*|0\\.\\d*[1-9]\\d*|0?\\.0+|0)$\n```\n\n   <!-- more -->\n\n## 2.æ ¡éªŒå­—ç¬¦çš„è¡¨è¾¾å¼\n\n```javascript\næ±‰å­—ï¼š^[\\u4e00-\\u9fa5]+$\nè‹±æ–‡å’Œæ•°å­—ï¼š^[A-Za-z0-9]+$\né•¿åº¦ä¸º3-20çš„æ‰€æœ‰å­—ç¬¦ï¼š^.{3,20}$\nç”±26ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^[A-Za-z]+$\nç”±26ä¸ªå¤§å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^[A-Z]+$\nç”±26ä¸ªå°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^[a-z]+$\nç”±æ•°å­—å’Œ26ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^[A-Za-z0-9]+$\nç”±æ•°å­—ã€26ä¸ªè‹±æ–‡å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ç»„æˆçš„å­—ç¬¦ä¸²ï¼š^\\w+$\nä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—åŒ…æ‹¬ä¸‹åˆ’çº¿ï¼š^[\\u4E00-\\u9FA5A-Za-z0-9_]+$\nä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—ä½†ä¸åŒ…æ‹¬ä¸‹åˆ’çº¿ç­‰ç¬¦å·ï¼š^[\\u4E00-\\u9FA5A-Za-z0-9]+$\nå¯ä»¥è¾“å…¥å«æœ‰^%&',;=?$\\\"ç­‰å­—ç¬¦ï¼š[^%&',;=?$\\x22]+\nç¦æ­¢è¾“å…¥å«æœ‰~çš„å­—ç¬¦ï¼š[^~\\x22]+\n```\n\n## 3.ç‰¹æ®Šéœ€æ±‚è¡¨è¾¾å¼\n\n```javascript\nEmailåœ°å€ï¼š^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$\nåŸŸåï¼š[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(/.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+/.?\nInternetURLï¼š[a-zA-z]+://[^\\s]* æˆ– ^http://([\\w-]+\\.)+[\\w-]+(/[\\w-./?%&=]*)?$\nå›½å†…æ‰‹æœºå·ç ï¼š^1[34578]{1}\\d{9}\nå¸å·æ˜¯å¦åˆæ³•(å­—æ¯å¼€å¤´ï¼Œå…è®¸5-16å­—èŠ‚ï¼Œå…è®¸å­—æ¯æ•°å­—ä¸‹åˆ’çº¿)ï¼š^[a-zA-Z]\\w{4,15}$\nå¯†ç (ä»¥å­—æ¯å¼€å¤´ï¼Œé•¿åº¦åœ¨6~18ä¹‹é—´ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿)ï¼š^[a-zA-Z]\\w{5,17}$\nå¼ºå¯†ç (å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—çš„ç»„åˆï¼Œä¸èƒ½ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼Œé•¿åº¦åœ¨8-10ä¹‹é—´)ï¼š^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{8,10}$\næ—¥æœŸæ ¼å¼ï¼š^\\d{4}-\\d{1,2}-\\d{1,2}\nä¸€å¹´çš„12ä¸ªæœˆ(01ï½09å’Œ1ï½12)ï¼š^(0?[1-9]|1[0-2])$\nä¸€ä¸ªæœˆçš„31å¤©(01ï½09å’Œ1ï½31)ï¼š^((0?[1-9])|((1|2)[0-9])|30|31)$\nè…¾è®¯QQå·ï¼š[1-9][0-9]{4,}    (è…¾è®¯QQå·ä»10000å¼€å§‹)\nIPåœ°å€ï¼š\\d+\\.\\d+\\.\\d+\\.\\d+    (æå–IPåœ°å€æ—¶æœ‰ç”¨)\nIPåœ°å€ï¼š^(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])(\\.(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])){3}$\nxmlæ–‡ä»¶ï¼š^([a-zA-Z]+-?)+[a-zA-Z0-9]+\\\\.[x|X][m|M][l|L]$\n```\n","tags":["JavaScript","æ­£åˆ™"],"categories":["JavaScript"]},{"title":"ç§»åŠ¨ç«¯çš„è§¦å±äº‹ä»¶","url":"/2019/03/22/ç§»åŠ¨ç«¯çš„è§¦å±äº‹ä»¶/","content":"\n# ç§»åŠ¨ç«¯çš„è§¦å±äº‹ä»¶\n\n## 1.åŸç”Ÿè§¦æ‘¸äº‹ä»¶ï¼ˆtouch ç±»äº‹ä»¶ï¼‰\n\nåœ¨ç§»åŠ¨ç«¯ï¼ŒåŸç”Ÿè§¦æ‘¸äº‹ä»¶åªæœ‰ä»¥ä¸‹ä¸‰ç§ç±»å‹ï¼Œå…¶ä»–æ‰€æœ‰çš„è§¦æ‘¸äº‹ä»¶éƒ½æ˜¯ç”±è¿™ä¸‰ç§äº‹ä»¶ç›¸ç»“åˆäº§ç”Ÿçš„ï¼Œä¾‹å¦‚ï¼Œä¸Šåˆ’ã€ä¸‹æ»‘ã€å·¦æ»‘ã€å³æ»‘ã€åŒå‡»ç­‰ç­‰ï¼›\n\n   <!-- more -->\n\nè¿™ä¸‰ç§åŸç”Ÿè§¦æ‘¸äº‹ä»¶ä¸ºï¼š\n\n- **touchstart**ï¼šå¼€å§‹è§¦æ‘¸\n- **touchmove**ï¼šè§¦æ‘¸è¿‡ç¨‹ä¸­\n- **touchend**ï¼šè§¦æ‘¸ç»“æŸ\n\nå¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªè§¦æ‘¸è¢«ç³»ç»Ÿå–æ¶ˆçš„äº‹ä»¶ï¼š**touchcancel**ï¼ˆç”±æ›´é«˜çº§çš„äº‹ä»¶æ‰“æ–­å½“å‰æ­£åœ¨æ‰§è¡Œçš„ç§»åŠ¨ç«¯äº‹ä»¶æ—¶ï¼Œä¼šè§¦å‘è¯¥äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªäº‹ä»¶ä¸­ä¿å­˜å½“å‰ç›¸å…³çš„è§¦ç¢°äº‹ä»¶æ“ä½œçš„æ•°æ®ï¼Œä»¥ä¿è¯ç”¨æˆ·å›åˆ°é¡µé¢åæ¥ç€åˆšæ‰æ–­å¼€çš„ä½ç½®ç»§ç»­æ“ä½œï¼‰ï¼›\n\n### è§¦æ‘¸äº‹ä»¶ä¸‹çš„ä¸€äº›ç›¸å…³å±æ€§\n\n- **targetTouchesï¼š**å¯è·å–åˆ°äº‹ä»¶å¯¹è±¡ä¸‹çš„è§¦æ‘¸ç‚¹ï¼Œè¯¥å±æ€§æ˜¯ä¸€ä¸ªç±»æ•°ç»„çš„ç»“æ„ï¼ŒåŒæ—¶è§¦å‘è¿™ä¸ªäº‹ä»¶çš„æ‰‹æŒ‡æœ‰å‡ ä¸ªï¼Œåˆ™æ•°ç»„ä¸­å°±æœ‰å‡ ä¸ªå…ƒç´ ã€‚è§¦æ‘¸ç‚¹çš„ç›¸å…³åæ ‡æ•°æ®å°±å­˜åœ¨è¿™äº›å¯¹è±¡ä¸­ã€‚\n- **pageX\\pageY:**åæ ‡ç³»åŸç‚¹åœ¨é¡µé¢çš„å·¦ä¸Šè§’ï¼›\n- **screenX\\screenY:**åæ ‡ç³»çš„åŸç‚¹åœ¨å±å¹•çš„å·¦ä¸Šè§’ç‚¹ï¼ˆä¸åŒ…å«æ“ä½œç³»ç»Ÿåœ¨å·¦ä¸Šè§’çš„ç»„ä»¶ï¼‰ï¼›\n- **clientX\\clientY:**è§¦æ‘¸ç›®æ ‡åœ¨è§†å£ä¸­çš„åæ ‡ï¼ŒåŸç‚¹åœ¨è§†å£å·¦ä¸Šè§’(é€‚å£è§†ç”¨æ¥å±•ç¤º html ä»£ç çš„å®¹å™¨)ï¼›\n- **targer:**ä¿å­˜çš„æ˜¯è§¦å‘äº‹ä»¶çš„æ ‡ç­¾ï¼Œä½¿ç”¨äº‹ä»¶å§”æ‰˜æ—¶å¯ä»¥é€šè¿‡è¯¥å±æ€§è·å–åˆ°è§¦å‘è¯¥äº‹ä»¶çš„æ ‡ç­¾å¯¹è±¡ï¼›\n- **identifier:**ID å€¼ï¼Œå”¯ä¸€æ ‡ç¤ºäº†æ‰‹æŒ‡è§¦æ‘¸ç‚¹ï¼Œå¦‚æœæ‰‹æŒ‡åœ¨å±å¹•ä¸Šäº§ç”Ÿç§»åŠ¨ï¼ˆå¦‚æœæœ‰å¤šä¸ªè§¦æ‘¸ç‚¹ï¼Œåˆ™å¯ä»¥æ ¹æ®è¿™ä¸ª id å€¼è·Ÿè¸ªå¯¹åº”çš„è§¦æ‘¸ç‚¹ï¼‰ï¼›\n\n### event å¯¹è±¡ï¼š\n\nç”±äºæ‰‹æœºç«¯çš„æ‰‹æŒ‡è§¦å‘ä¸æ˜¯å•ä¸ªçš„ï¼Œæ‰€ä»¥åœ¨ event é‡Œé¢ç”Ÿæˆçš„ä¸è§¦æ‘¸æœ‰å…³çš„æ•°æ®éƒ½æ˜¯ä»¥æ•°ç»„çš„å½¢å¼åˆ—å‡ºæ¥çš„ï¼Œæœ‰ä»¥ä¸‹ä¸‰ä¸ªï¼š\n\n- touchesï¼šè¡¨ç¤ºå½“å‰è·Ÿè¸ªçš„è§¦æ‘¸æ“ä½œçš„ touch å¯¹è±¡çš„æ•°ç»„ã€‚å½“å‰å±å¹•ä¸Šæ‰€æœ‰è§¦æ‘¸ç‚¹çš„é›†åˆåˆ—è¡¨\n- targetTouchesï¼šç‰¹å®šäºäº‹ä»¶ç›®æ ‡çš„ Touch å¯¹è±¡çš„æ•°ç»„ã€‚ç»‘å®šäº‹ä»¶çš„é‚£ä¸ªç»“ç‚¹ä¸Šçš„è§¦æ‘¸ç‚¹çš„é›†åˆåˆ—è¡¨\n- changedTouchesï¼šè¡¨ç¤ºè‡ªä¸Šæ¬¡è§¦æ‘¸ä»¥æ¥å‘ç”Ÿäº†ä»€ä¹ˆæ”¹å˜çš„ Touch å¯¹è±¡çš„æ•°ç»„ã€‚è§¦å‘äº‹ä»¶æ—¶æ”¹å˜çš„è§¦æ‘¸ç‚¹çš„é›†åˆ\n\n## 2.è§¦ç¢°äº‹ä»¶ï¼ˆtap ç±»äº‹ä»¶ï¼‰\n\nè§¦ç¢°äº‹ä»¶ï¼Œæˆ‘ç›®å‰è¿˜ä¸çŸ¥é“å®ƒå’Œ touch çš„åŒºåˆ«ï¼Œä¸€èˆ¬ç”¨äºä»£æ›¿ click äº‹ä»¶\n\n- tap: æ‰‹æŒ‡ç¢°ä¸€ä¸‹å±å¹•ä¼šè§¦å‘\n- longTap: æ‰‹æŒ‡é•¿æŒ‰å±å¹•ä¼šè§¦å‘\n- singleTap: æ‰‹æŒ‡ç¢°ä¸€ä¸‹å±å¹•ä¼šè§¦å‘\n- doubleTap: æ‰‹æŒ‡åŒå‡»å±å¹•ä¼šè§¦å‘\n\n## 3.æ»‘åŠ¨äº‹ä»¶ï¼ˆswipe ç±»äº‹ä»¶ï¼‰\n\næ»‘åŠ¨äº‹ä»¶\n\n- swipeï¼šæ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨æ—¶ä¼šè§¦å‘\n- swipeLeftï¼šæ‰‹æŒ‡åœ¨å±å¹•ä¸Šå‘å·¦æ»‘åŠ¨æ—¶ä¼šè§¦å‘\n- swipeRightï¼šæ‰‹æŒ‡åœ¨å±å¹•ä¸Šå‘å³æ»‘åŠ¨æ—¶ä¼šè§¦å‘\n- swipeUpï¼šæ‰‹æŒ‡åœ¨å±å¹•ä¸Šå‘ä¸Šæ»‘åŠ¨æ—¶ä¼šè§¦å‘\n- swipeDownï¼šæ‰‹æŒ‡åœ¨å±å¹•ä¸Šå‘ä¸‹æ»‘åŠ¨æ—¶ä¼šè§¦å‘\n\n## 4.**è‡ªå®šä¹‰æ‰‹åŠ¿äº‹ä»¶ gesture**\n\næ‰‹åŠ¿äº‹ä»¶åªæ˜¯æ¦‚å¿µå‹ï¼Œç›®å‰è¿˜æ²¡æœ‰æµè§ˆå™¨åŸç”Ÿæ”¯æŒï¼ŒæŒ‰ç…§æ¦‚å¿µå¯åˆ†ä¸º gesturestart gesturechange gestureend ä¸‰ç§äº‹ä»¶\n\n- gesturestartï¼šå½“æœ‰ä¸¤æ ¹æˆ–å¤šæ ¹æ‰‹æŒ‡æ”¾åˆ°å±å¹•ä¸Šçš„æ—¶å€™è§¦å‘\n- gesturechangeï¼šå½“æœ‰ä¸¤æ ¹æˆ–å¤šæ ¹æ‰‹æŒ‡åœ¨å±å¹•ä¸Šï¼Œå¹¶ä¸”æœ‰æ‰‹æŒ‡ç§»åŠ¨çš„æ—¶å€™è§¦å‘\n- gestureendï¼šå½“å€’æ•°ç¬¬äºŒæ ¹æ‰‹æŒ‡æèµ·çš„æ—¶å€™è§¦å‘ï¼Œç»“æŸ gesture\n\næŒ‰ç…§å®šä¹‰ï¼Œå½“åˆ†åˆ«å°†ä¸¤æ ¹æ‰‹æŒ‡æ”¾åˆ°å±å¹•ä¸Šçš„æ—¶å€™ï¼Œä¼šæœ‰å¦‚ä¸‹é¡ºåºçš„äº‹ä»¶è§¦å‘ï¼š\n\n1ã€ç¬¬ä¸€æ ¹æ‰‹æŒ‡æ”¾ä¸‹ï¼Œè§¦å‘ touchstart\n\n2ã€ç¬¬äºŒæ ¹æ‰‹æŒ‡æ”¾ä¸‹ï¼Œè§¦å‘ gesturestart\n\n3ã€è§¦å‘ç¬¬äºŒæ ¹æ‰‹æŒ‡çš„ touchstart\n\n4ã€ç«‹å³è§¦å‘ gesturechange\n\n5ã€æ‰‹æŒ‡ç§»åŠ¨ï¼ŒæŒç»­è§¦å‘ gesturechange\n\n6ã€ç¬¬äºŒæ ¹æ‰‹æŒ‡æèµ·ï¼Œè§¦å‘ gestureendï¼Œä»¥åå°†ä¸ä¼šå†è§¦å‘ gesturechange\n\n7ã€è§¦å‘ç¬¬äºŒæ ¹æ‰‹æŒ‡çš„ touchend\n\n8ã€è§¦å‘ touchstartï¼ˆå¤šæ ¹æ‰‹æŒ‡åœ¨å±å¹•ä¸Šï¼Œæèµ·ä¸€æ ¹ï¼Œä¼šåˆ·æ–°ä¸€æ¬¡å…¨å±€ touchï¼Œé‡æ–°è§¦å‘ç¬¬ä¸€æ ¹æ‰‹æŒ‡çš„ touchstartï¼‰\n\n9ã€æèµ·ç¬¬ä¸€æ ¹æ‰‹æŒ‡ï¼Œè§¦å‘ touchend\n\n## 5.Zepto.js åº“å¯ä»¥æ›´å¥½çš„æ”¯æŒï¼ŒåŸºäº CSS3\n","tags":["ç§»åŠ¨ç«¯","è§¦å±"],"categories":["ç§»åŠ¨ç«¯"]},{"title":"åŒå‘æ•°æ®ç»‘å®šProxyå’ŒObject.definePropertyå¯¹æ¯”","url":"/2019/03/11/åŒå‘æ•°æ®ç»‘å®šProxyå’ŒObject.definePropertyå¯¹æ¯”/","content":"\n# åŒå‘æ•°æ®ç»‘å®š`Proxy`å’Œ`Object.defineProperty`å¯¹æ¯”\n\n## æ•°æ®åŠ«æŒçš„ä¼˜åŠ¿æ‰€åœ¨ã€‚\n\nå¯¹æ¯”å…¶ä»–åŒå‘ç»‘å®šçš„å®ç°æ–¹æ³•,æ•°æ®åŠ«æŒçš„ä¼˜åŠ¿æ‰€åœ¨ï¼š\n\n1. æ— éœ€æ˜¾ç¤ºè°ƒç”¨: ä¾‹å¦‚ Vue è¿ç”¨æ•°æ®åŠ«æŒ+å‘å¸ƒè®¢é˜…,ç›´æ¥å¯ä»¥é€šçŸ¥å˜åŒ–å¹¶é©±åŠ¨è§†å›¾,ä¸Šé¢çš„ä¾‹å­ä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„å®ç°`data.name = 'æ¸£æ¸£è¾‰'`åç›´æ¥è§¦å‘å˜æ›´,è€Œæ¯”å¦‚ Angular çš„è„æ£€æµ‹åˆ™éœ€è¦æ˜¾ç¤ºè°ƒç”¨`markForCheck`(å¯ä»¥ç”¨ zone.js é¿å…æ˜¾ç¤ºè°ƒç”¨,ä¸å±•å¼€),react éœ€è¦æ˜¾ç¤ºè°ƒç”¨`setState`ã€‚\n2. å¯ç²¾ç¡®å¾—çŸ¥å˜åŒ–æ•°æ®ï¼šè¿˜æ˜¯ä¸Šé¢çš„å°ä¾‹å­ï¼Œæˆ‘ä»¬åŠ«æŒäº†å±æ€§çš„ setter,å½“å±æ€§å€¼æ”¹å˜,æˆ‘ä»¬å¯ä»¥ç²¾ç¡®è·çŸ¥å˜åŒ–çš„å†…å®¹`newVal`,å› æ­¤åœ¨è¿™éƒ¨åˆ†ä¸éœ€è¦é¢å¤–çš„ diff æ“ä½œ,å¦åˆ™æˆ‘ä»¬åªçŸ¥é“æ•°æ®å‘ç”Ÿäº†å˜åŒ–è€Œä¸çŸ¥é“å…·ä½“å“ªäº›æ•°æ®å˜åŒ–äº†,è¿™ä¸ªæ—¶å€™éœ€è¦å¤§é‡ diff æ¥æ‰¾å‡ºå˜åŒ–å€¼,è¿™æ˜¯é¢å¤–æ€§èƒ½æŸè€—ã€‚\n   <!-- more -->\n\n## åŸºäºæ•°æ®åŠ«æŒåŒå‘ç»‘å®šçš„å®ç°æ€è·¯\n\n**æ•°æ®åŠ«æŒ**æ˜¯åŒå‘ç»‘å®šå„ç§æ–¹æ¡ˆä¸­æ¯”è¾ƒæµè¡Œçš„ä¸€ç§,æœ€è‘—åçš„å®ç°å°±æ˜¯ Vueã€‚\n\nåŸºäºæ•°æ®åŠ«æŒçš„åŒå‘ç»‘å®šç¦»ä¸å¼€`Proxy`ä¸`Object.defineProperty`ç­‰æ–¹æ³•å¯¹å¯¹è±¡/å¯¹è±¡å±æ€§çš„\"åŠ«æŒ\",æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªå®Œæ•´çš„åŒå‘ç»‘å®šéœ€è¦ä»¥ä¸‹å‡ ä¸ªè¦ç‚¹ã€‚\n\n1. åˆ©ç”¨`Proxy`æˆ–`Object.defineProperty`ç”Ÿæˆçš„ Observer é’ˆå¯¹å¯¹è±¡/å¯¹è±¡çš„å±æ€§è¿›è¡Œ\"åŠ«æŒ\",åœ¨å±æ€§å‘ç”Ÿå˜åŒ–åé€šçŸ¥è®¢é˜…è€…\n2. è§£æå™¨ Compile è§£ææ¨¡æ¿ä¸­çš„`Directive`(æŒ‡ä»¤)ï¼Œæ”¶é›†æŒ‡ä»¤æ‰€ä¾èµ–çš„æ–¹æ³•å’Œæ•°æ®,ç­‰å¾…æ•°æ®å˜åŒ–ç„¶åè¿›è¡Œæ¸²æŸ“\n3. Watcher å±äº Observer å’Œ Compile æ¡¥æ¢,å®ƒå°†æ¥æ”¶åˆ°çš„ Observer äº§ç”Ÿçš„æ•°æ®å˜åŒ–,å¹¶æ ¹æ® Compile æä¾›çš„æŒ‡ä»¤è¿›è¡Œè§†å›¾æ¸²æŸ“,ä½¿å¾—æ•°æ®å˜åŒ–ä¿ƒä½¿è§†å›¾å˜åŒ–\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy2rxn2jj310q0jugn4.jpg)\n\n- åœ¨ `new Vue()` åï¼Œ Vue ä¼šè°ƒç”¨`_init` å‡½æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯ init è¿‡ç¨‹ï¼Œåœ¨ è¿™ä¸ªè¿‡ç¨‹ Data é€šè¿‡ Observer è½¬æ¢æˆäº† getter/setter çš„å½¢å¼ï¼Œæ¥å¯¹æ•°æ®è¿½è¸ªå˜åŒ–ï¼Œå½“è¢«è®¾ç½®çš„å¯¹è±¡è¢«è¯»å–çš„æ—¶å€™ä¼šæ‰§è¡Œ`getter` å‡½æ•°ï¼Œè€Œåœ¨å½“è¢«èµ‹å€¼çš„æ—¶å€™ä¼šæ‰§è¡Œ `setter`å‡½æ•°ã€‚\n- å½“ render function æ‰§è¡Œçš„æ—¶å€™ï¼Œå› ä¸ºä¼šè¯»å–æ‰€éœ€å¯¹è±¡çš„å€¼ï¼Œæ‰€ä»¥ä¼šè§¦å‘`getter`å‡½æ•°ä»è€Œå°† Watcher æ·»åŠ åˆ°ä¾èµ–ä¸­è¿›è¡Œä¾èµ–æ”¶é›†ã€‚\n- åœ¨ä¿®æ”¹å¯¹è±¡çš„å€¼çš„æ—¶å€™ï¼Œä¼šè§¦å‘å¯¹åº”çš„`setter`ï¼Œ `setter`é€šçŸ¥ä¹‹å‰**ä¾èµ–æ”¶é›†**å¾—åˆ°çš„ Dep ä¸­çš„æ¯ä¸€ä¸ª Watcherï¼Œå‘Šè¯‰å®ƒä»¬è‡ªå·±çš„å€¼æ”¹å˜äº†ï¼Œéœ€è¦é‡æ–°æ¸²æŸ“è§†å›¾ã€‚è¿™æ—¶å€™è¿™äº› Watcher å°±ä¼šå¼€å§‹è°ƒç”¨ `update` æ¥æ›´æ–°è§†å›¾ã€‚\n\n## åŸºäº Object.defineProperty åŒå‘ç»‘å®šçš„ç‰¹ç‚¹\n\nVue é€šè¿‡è®¾å®šå¯¹è±¡å±æ€§çš„ setter/getter æ–¹æ³•æ¥ç›‘å¬æ•°æ®çš„å˜åŒ–ï¼Œé€šè¿‡ getter è¿›è¡Œä¾èµ–æ”¶é›†ï¼Œè€Œæ¯ä¸ª setter æ–¹æ³•å°±æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œåœ¨æ•°æ®å˜æ›´çš„æ—¶å€™é€šçŸ¥è®¢é˜…è€…æ›´æ–°è§†å›¾ã€‚\n\n**åœ¨ getter ä¸­æ”¶é›†ä¾èµ–ï¼Œåœ¨ setter ä¸­è§¦å‘ä¾èµ–ã€‚**\n\nå½“å¤–ç•Œé€šè¿‡ Watcher è¯»å–æ•°æ®æ—¶ï¼Œä¾¿ä¼šè§¦å‘ getter ä»è€Œå°† Watcher æ·»åŠ åˆ°ä¾èµ–ä¸­ï¼Œå“ªä¸ª Watcher è§¦å‘äº† getterï¼Œå°±æŠŠå“ªä¸ª Watcher æ”¶é›†åˆ° Dep ä¸­ã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå¾ªç¯ä¾èµ–åˆ—è¡¨ï¼ŒæŠŠæ‰€æœ‰çš„ Watcher éƒ½é€šçŸ¥ä¸€éã€‚\n\n### æç®€ç‰ˆçš„åŒå‘ç»‘å®š\n\n`Object.defineProperty`çš„ä½œç”¨å°±æ˜¯åŠ«æŒä¸€ä¸ªå¯¹è±¡çš„å±æ€§,é€šå¸¸æˆ‘ä»¬å¯¹å±æ€§çš„`getter`å’Œ`setter`æ–¹æ³•è¿›è¡ŒåŠ«æŒ,åœ¨å¯¹è±¡çš„å±æ€§å‘ç”Ÿå˜åŒ–æ—¶è¿›è¡Œç‰¹å®šçš„æ“ä½œã€‚\n\næˆ‘ä»¬å°±å¯¹å¯¹è±¡`obj`çš„`text`å±æ€§è¿›è¡ŒåŠ«æŒ,åœ¨è·å–æ­¤å±æ€§çš„å€¼æ—¶æ‰“å°`'get val'`,åœ¨æ›´æ”¹å±æ€§å€¼çš„æ—¶å€™å¯¹ DOM è¿›è¡Œæ“ä½œ,è¿™å°±æ˜¯ä¸€ä¸ªæç®€çš„åŒå‘ç»‘å®šã€‚\n\n```javascript\nconst obj = {};\nObject.defineProperty(obj, \"text\", {\n  get: function() {\n    console.log(\"get val\");\n  },\n  set: function(newVal) {\n    console.log(\"set val:\" + newVal);\n    document.getElementById(\"input\").value = newVal;\n    document.getElementById(\"span\").innerHTML = newVal;\n  }\n});\n\nconst input = document.getElementById(\"input\");\ninput.addEventListener(\"keyup\", function(e) {\n  obj.text = e.target.value;\n});\n```\n\n### å‡çº§æ”¹é€ \n\næˆ‘ä»¬å¾ˆå¿«ä¼šå‘ç°ï¼Œè¿™ä¸ªæ‰€è°“çš„*åŒå‘ç»‘å®š*è²Œä¼¼å¹¶æ²¡æœ‰ä»€ä¹ˆä¹±ç”¨ã€‚ã€‚ã€‚\n\nåŸå› å¦‚ä¸‹:\n\n1. æˆ‘ä»¬åªç›‘å¬äº†ä¸€ä¸ªå±æ€§,ä¸€ä¸ªå¯¹è±¡ä¸å¯èƒ½åªæœ‰ä¸€ä¸ªå±æ€§,æˆ‘ä»¬éœ€è¦å¯¹å¯¹è±¡æ¯ä¸ªå±æ€§è¿›è¡Œç›‘å¬ã€‚\n2. è¿åå¼€æ”¾å°é—­åŸåˆ™,æˆ‘ä»¬å¦‚æœäº†è§£[å¼€æ”¾å°é—­åŸåˆ™](https://link.juejin.im?target=https%3A%2F%2Fzh.wikipedia.org%2Fzh-hans%2F%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99)çš„è¯,ä¸Šè¿°ä»£ç æ˜¯æ˜æ˜¾è¿åæ­¤åŸåˆ™,æˆ‘ä»¬æ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦è¿›å…¥æ–¹æ³•å†…éƒ¨,è¿™æ˜¯éœ€è¦åšå†³æœç»çš„ã€‚\n3. ä»£ç è€¦åˆä¸¥é‡,æˆ‘ä»¬çš„æ•°æ®ã€æ–¹æ³•å’Œ DOM éƒ½æ˜¯è€¦åˆåœ¨ä¸€èµ·çš„ï¼Œå°±æ˜¯ä¼ è¯´ä¸­çš„é¢æ¡ä»£ç ã€‚\n\né‚£ä¹ˆå¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜ï¼Ÿ\n\nVue çš„æ“ä½œå°±æ˜¯åŠ å…¥äº†**å‘å¸ƒè®¢é˜…**æ¨¡å¼ï¼Œç»“åˆ`Object.defineProperty`çš„åŠ«æŒèƒ½åŠ›ï¼Œå®ç°äº†å¯ç”¨æ€§å¾ˆé«˜çš„åŒå‘ç»‘å®šã€‚\n\né¦–å…ˆï¼Œæˆ‘ä»¬ä»¥**å‘å¸ƒè®¢é˜…**çš„è§’åº¦çœ‹æˆ‘ä»¬ç¬¬ä¸€éƒ¨åˆ†å†™çš„é‚£ä¸€å¨ä»£ç ,ä¼šå‘ç°å®ƒçš„*ç›‘å¬*ã€*å‘å¸ƒ*å’Œ*è®¢é˜…*éƒ½æ˜¯å†™åœ¨ä¸€èµ·çš„,æˆ‘ä»¬é¦–å…ˆè¦åšçš„å°±æ˜¯è§£è€¦ã€‚\n\næˆ‘ä»¬å…ˆå®ç°**ä¸€ä¸ªè®¢é˜…å‘å¸ƒä¸­å¿ƒï¼Œå³æ¶ˆæ¯ç®¡ç†å‘˜ï¼ˆDepï¼‰,å®ƒè´Ÿè´£å‚¨å­˜è®¢é˜…è€…å’Œæ¶ˆæ¯çš„åˆ†å‘,ä¸ç®¡æ˜¯è®¢é˜…è€…è¿˜æ˜¯å‘å¸ƒè€…éƒ½éœ€è¦ä¾èµ–äºå®ƒ**ã€‚\n\n```javascript\nlet uid = 0;\n// ç”¨äºå‚¨å­˜è®¢é˜…è€…å¹¶å‘å¸ƒæ¶ˆæ¯\nclass Dep {\n  constructor() {\n    // è®¾ç½®id,ç”¨äºåŒºåˆ†æ–°Watcherå’Œåªæ”¹å˜å±æ€§å€¼åæ–°äº§ç”Ÿçš„Watcher\n    this.id = uid++;\n    // å‚¨å­˜è®¢é˜…è€…çš„æ•°ç»„\n    this.subs = [];\n  }\n  // è§¦å‘targetä¸Šçš„Watcherä¸­çš„addDepæ–¹æ³•,å‚æ•°ä¸ºdepçš„å®ä¾‹æœ¬èº«\n  depend() {\n    Dep.target.addDep(this);\n  }\n  // æ·»åŠ è®¢é˜…è€…\n  addSub(sub) {\n    this.subs.push(sub);\n  }\n  notify() {\n    // é€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…(Watcher)ï¼Œè§¦å‘è®¢é˜…è€…çš„ç›¸åº”é€»è¾‘å¤„ç†\n    this.subs.forEach(sub => sub.update());\n  }\n}\n// ä¸ºDepç±»è®¾ç½®ä¸€ä¸ªé™æ€å±æ€§,é»˜è®¤ä¸ºnull,å·¥ä½œæ—¶æŒ‡å‘å½“å‰çš„Watcher\nDep.target = null;\n```\n\nç°åœ¨æˆ‘ä»¬éœ€è¦å®ç°ç›‘å¬è€…(Observer),ç”¨äºç›‘å¬å±æ€§å€¼çš„å˜åŒ–ã€‚\n\n```javascript\n// ç›‘å¬è€…,ç›‘å¬å¯¹è±¡å±æ€§å€¼çš„å˜åŒ–\nclass Observer {\n  constructor(value) {\n    this.value = value;\n    this.walk(value);\n  }\n  // éå†å±æ€§å€¼å¹¶ç›‘å¬\n  walk(value) {\n    Object.keys(value).forEach(key => this.convert(key, value[key]));\n  }\n  // æ‰§è¡Œç›‘å¬çš„å…·ä½“æ–¹æ³•\n  convert(key, val) {\n    defineReactive(this.value, key, val);\n  }\n}\n\nfunction defineReactive(obj, key, val) {\n  const dep = new Dep();\n  // ç»™å½“å‰å±æ€§çš„å€¼æ·»åŠ ç›‘å¬\n  let chlidOb = observe(val);\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: () => {\n      // å¦‚æœDepç±»å­˜åœ¨targetå±æ€§ï¼Œå°†å…¶æ·»åŠ åˆ°depå®ä¾‹çš„subsæ•°ç»„ä¸­\n      // targetæŒ‡å‘ä¸€ä¸ªWatcherå®ä¾‹ï¼Œæ¯ä¸ªWatcheréƒ½æ˜¯ä¸€ä¸ªè®¢é˜…è€…\n      // Watcherå®ä¾‹åœ¨å®ä¾‹åŒ–è¿‡ç¨‹ä¸­ï¼Œä¼šè¯»å–dataä¸­çš„æŸä¸ªå±æ€§ï¼Œä»è€Œè§¦å‘å½“å‰getæ–¹æ³•\n      if (Dep.target) {\n        dep.depend();\n      }\n      return val;\n    },\n    set: newVal => {\n      if (val === newVal) return;\n      val = newVal;\n      // å¯¹æ–°å€¼è¿›è¡Œç›‘å¬\n      chlidOb = observe(newVal);\n      // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ï¼Œæ•°å€¼è¢«æ”¹å˜äº†\n      dep.notify();\n    }\n  });\n}\n\nfunction observe(value) {\n  // å½“å€¼ä¸å­˜åœ¨ï¼Œæˆ–è€…ä¸æ˜¯å¤æ‚æ•°æ®ç±»å‹æ—¶ï¼Œä¸å†éœ€è¦ç»§ç»­æ·±å…¥ç›‘å¬\n  if (!value || typeof value !== \"object\") {\n    return;\n  }\n  return new Observer(value);\n}\n```\n\né‚£ä¹ˆæ¥ä¸‹æ¥å°±ç®€å•äº†,æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªè®¢é˜…è€…(Watcher)ã€‚\n\n```javascript\nclass Watcher {\n  constructor(vm, expOrFn, cb) {\n    this.depIds = {}; // hashå‚¨å­˜è®¢é˜…è€…çš„id,é¿å…é‡å¤çš„è®¢é˜…è€…\n    this.vm = vm; // è¢«è®¢é˜…çš„æ•°æ®ä¸€å®šæ¥è‡ªäºå½“å‰Vueå®ä¾‹\n    this.cb = cb; // å½“æ•°æ®æ›´æ–°æ—¶æƒ³è¦åšçš„äº‹æƒ…\n    this.expOrFn = expOrFn; // è¢«è®¢é˜…çš„æ•°æ®\n    this.val = this.get(); // ç»´æŠ¤æ›´æ–°ä¹‹å‰çš„æ•°æ®\n  }\n  // å¯¹å¤–æš´éœ²çš„æ¥å£ï¼Œç”¨äºåœ¨è®¢é˜…çš„æ•°æ®è¢«æ›´æ–°æ—¶ï¼Œç”±è®¢é˜…è€…ç®¡ç†å‘˜(Dep)è°ƒç”¨\n  update() {\n    this.run();\n  }\n  addDep(dep) {\n    // å¦‚æœåœ¨depIdsçš„hashä¸­æ²¡æœ‰å½“å‰çš„id,å¯ä»¥åˆ¤æ–­æ˜¯æ–°Watcher,å› æ­¤å¯ä»¥æ·»åŠ åˆ°depçš„æ•°ç»„ä¸­å‚¨å­˜\n    // æ­¤åˆ¤æ–­æ˜¯é¿å…åŒidçš„Watcherè¢«å¤šæ¬¡å‚¨å­˜\n    if (!this.depIds.hasOwnProperty(dep.id)) {\n      dep.addSub(this);\n      this.depIds[dep.id] = dep;\n    }\n  }\n  run() {\n    const val = this.get();\n    console.log(val);\n    if (val !== this.val) {\n      this.val = val;\n      this.cb.call(this.vm, val);\n    }\n  }\n  get() {\n    // å½“å‰è®¢é˜…è€…(Watcher)è¯»å–è¢«è®¢é˜…æ•°æ®çš„æœ€æ–°æ›´æ–°åçš„å€¼æ—¶ï¼Œé€šçŸ¥è®¢é˜…è€…ç®¡ç†å‘˜æ”¶é›†å½“å‰è®¢é˜…è€…\n    Dep.target = this;\n    const val = this.vm._data[this.expOrFn];\n    // ç½®ç©ºï¼Œç”¨äºä¸‹ä¸€ä¸ªWatcherä½¿ç”¨\n    Dep.target = null;\n    return val;\n  }\n}\n```\n\né‚£ä¹ˆæˆ‘ä»¬æœ€åå®Œæˆ Vue,å°†ä¸Šè¿°æ–¹æ³•æŒ‚è½½åœ¨ Vue ä¸Šã€‚\n\n```javascript\nclass Vue {\n    constructor(options = {}) {\n      // ç®€åŒ–äº†$optionsçš„å¤„ç†\n      this.$options = options;\n      // ç®€åŒ–äº†å¯¹dataçš„å¤„ç†\n      let data = (this._data = this.$options.data);\n      // å°†æ‰€æœ‰dataæœ€å¤–å±‚å±æ€§ä»£ç†åˆ°Vueå®ä¾‹ä¸Š\n      Object.keys(data).forEach(key => this._proxy(key));\n      // ç›‘å¬æ•°æ®\n      observe(data);\n    }\n    // å¯¹å¤–æš´éœ²è°ƒç”¨è®¢é˜…è€…çš„æ¥å£ï¼Œå†…éƒ¨ä¸»è¦åœ¨æŒ‡ä»¤ä¸­ä½¿ç”¨è®¢é˜…è€…\n    $watch(expOrFn, cb) {\n      new Watcher(this, expOrFn, cb);\n    }\n    _proxy(key) {\n      Object.defineProperty(this, key, {\n        configurable: true,\n        enumerable: true,\n        get: () => this._data[key],\n        set: val => {\n          this._data[key] = val;\n        },\n      });\n    }\n  }\n]\n```\n\nè‡³æ­¤,ä¸€ä¸ªç®€å•çš„åŒå‘ç»‘å®šç®—æ˜¯è¢«æˆ‘ä»¬å®ç°äº†ã€‚\n\n### Object.defineProperty çš„ç¼ºé™·\n\n- `Object.defineProperty`çš„ç¬¬ä¸€ä¸ªç¼ºé™·,æ— æ³•ç›‘å¬æ•°ç»„å˜åŒ–ã€‚[Vue çš„æ–‡æ¡£](https://link.juejin.im/?target=https%3A%2F%2Fcn.vuejs.org%2Fv2%2Fguide%2Flist.html%23%E6%95%B0%E7%BB%84%E6%9B%B4%E6%96%B0%E6%A3%80%E6%B5%8B)æåˆ°äº† Vue æ˜¯å¯ä»¥æ£€æµ‹åˆ°æ•°ç»„å˜åŒ–çš„ï¼Œä½†æ˜¯åªæœ‰ä»¥ä¸‹å…«ç§æ–¹æ³•,`vm.items[indexOfItem] = newValue`è¿™ç§æ˜¯æ— æ³•æ£€æµ‹çš„ã€‚`push()`ã€`pop()`ã€`shift()`ã€`unshift()`ã€`splice()`ã€`sort()`ã€`reverse()`\n\n- `Object.defineProperty`çš„ç¬¬äºŒä¸ªç¼ºé™·,åªèƒ½åŠ«æŒå¯¹è±¡çš„å±æ€§,å› æ­¤æˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªå¯¹è±¡çš„æ¯ä¸ªå±æ€§è¿›è¡Œéå†ï¼Œå¦‚æœå±æ€§å€¼ä¹Ÿæ˜¯å¯¹è±¡é‚£ä¹ˆéœ€è¦æ·±åº¦éå†,æ˜¾ç„¶èƒ½åŠ«æŒä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚\n\n  `Object.keys(value).forEach(key => **this**.convert(key, value[key]));`\n\n- **æ— æ³•æ£€æµ‹åˆ°å¯¹è±¡å±æ€§çš„æ·»åŠ æˆ–åˆ é™¤**(å¦‚`data.location.a=1`)ã€‚\n\n  è¿™æ˜¯å› ä¸º Vue é€šè¿‡`Object.defineProperty`æ¥å°†å¯¹è±¡çš„ key è½¬æ¢æˆ`getter/setter`çš„å½¢å¼æ¥è¿½è¸ªå˜åŒ–ï¼Œä½†`getter/setter`åªèƒ½è¿½è¸ªä¸€ä¸ªæ•°æ®æ˜¯å¦è¢«ä¿®æ”¹ï¼Œæ— æ³•è¿½è¸ªæ–°å¢å±æ€§å’Œåˆ é™¤å±æ€§ã€‚å¦‚æœæ˜¯åˆ é™¤å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨`vm.$delete`å®ç°ï¼Œé‚£å¦‚æœæ˜¯æ–°å¢å±æ€§ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\n  1ï¼‰å¯ä»¥ä½¿ç”¨ `Vue.set(location, a, 1)` æ–¹æ³•å‘åµŒå¥—å¯¹è±¡æ·»åŠ å“åº”å¼å±æ€§;\n  2ï¼‰ä¹Ÿå¯ä»¥ç»™è¿™ä¸ªå¯¹è±¡é‡æ–°èµ‹å€¼ï¼Œæ¯”å¦‚`data.location = {...data.location,a:1}`\n\n## Proxy å®ç°çš„åŒå‘ç»‘å®šçš„ç‰¹ç‚¹\n\nProxy åœ¨ ES2015 è§„èŒƒä¸­è¢«æ­£å¼å‘å¸ƒ,å®ƒåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚â€œæ‹¦æˆªâ€ï¼Œå¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®ï¼Œéƒ½å¿…é¡»å…ˆé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¯¹å¤–ç•Œçš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œæ”¹å†™,æˆ‘ä»¬å¯ä»¥è¿™æ ·è®¤ä¸º,Proxy æ˜¯`Object.defineProperty`çš„å…¨æ–¹ä½åŠ å¼ºç‰ˆ\n\n### Proxy å¯ä»¥ç›´æ¥ç›‘å¬å¯¹è±¡è€Œéå±æ€§\n\næˆ‘ä»¬è¿˜æ˜¯ä»¥ä¸Šæ–‡ä¸­ç”¨`Object.defineProperty`å®ç°çš„æç®€ç‰ˆåŒå‘ç»‘å®šä¸ºä¾‹,ç”¨ Proxy è¿›è¡Œæ”¹å†™ã€‚\n\n```javascript\nconst input = document.getElementById(\"input\");\nconst p = document.getElementById(\"p\");\nconst obj = {};\n\nconst newObj = new Proxy(obj, {\n  get: function(target, key, receiver) {\n    console.log(`getting ${key}!`);\n    return Reflect.get(target, key, receiver);\n  },\n  set: function(target, key, value, receiver) {\n    console.log(target, key, value, receiver);\n    if (key === \"text\") {\n      input.value = value;\n      p.innerHTML = value;\n    }\n    return Reflect.set(target, key, value, receiver);\n  }\n});\n\ninput.addEventListener(\"keyup\", function(e) {\n  newObj.text = e.target.value;\n});\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°,Proxy ç›´æ¥å¯ä»¥åŠ«æŒæ•´ä¸ªå¯¹è±¡,å¹¶è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡,ä¸ç®¡æ˜¯æ“ä½œä¾¿åˆ©ç¨‹åº¦è¿˜æ˜¯åº•å±‚åŠŸèƒ½ä¸Šéƒ½è¿œå¼ºäº`Object.defineProperty`ã€‚\n\n### Proxy å¯ä»¥ç›´æ¥ç›‘å¬æ•°ç»„çš„å˜åŒ–\n\nå½“æˆ‘ä»¬å¯¹æ•°ç»„è¿›è¡Œæ“ä½œ(pushã€shiftã€splice ç­‰)æ—¶ï¼Œä¼šè§¦å‘å¯¹åº”çš„æ–¹æ³•åç§°å’Œ*length*çš„å˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿæ­¤è¿›è¡Œæ“ä½œ,ä»¥ä¸Šæ–‡ä¸­`Object.defineProperty`æ— æ³•ç”Ÿæ•ˆçš„åˆ—è¡¨æ¸²æŸ“ä¸ºä¾‹ã€‚\n\n```javascript\nconst list = document.getElementById(\"list\");\nconst btn = document.getElementById(\"btn\");\n\n// æ¸²æŸ“åˆ—è¡¨\nconst Render = {\n  // åˆå§‹åŒ–\n  init: function(arr) {\n    const fragment = document.createDocumentFragment();\n    for (let i = 0; i < arr.length; i++) {\n      const li = document.createElement(\"li\");\n      li.textContent = arr[i];\n      fragment.appendChild(li);\n    }\n    list.appendChild(fragment);\n  },\n  // æˆ‘ä»¬åªè€ƒè™‘äº†å¢åŠ çš„æƒ…å†µ,ä»…ä½œä¸ºç¤ºä¾‹\n  change: function(val) {\n    const li = document.createElement(\"li\");\n    li.textContent = val;\n    list.appendChild(li);\n  }\n};\n\n// åˆå§‹æ•°ç»„\nconst arr = [1, 2, 3, 4];\n\n// ç›‘å¬æ•°ç»„\nconst newArr = new Proxy(arr, {\n  get: function(target, key, receiver) {\n    console.log(key);\n    return Reflect.get(target, key, receiver);\n  },\n  set: function(target, key, value, receiver) {\n    console.log(target, key, value, receiver);\n    if (key !== \"length\") {\n      Render.change(value);\n    }\n    return Reflect.set(target, key, value, receiver);\n  }\n});\n\n// åˆå§‹åŒ–\nwindow.onload = function() {\n  Render.init(arr);\n};\n\n// pushæ•°å­—\nbtn.addEventListener(\"click\", function() {\n  newArr.push(6);\n});\n```\n\nå¾ˆæ˜¾ç„¶,Proxy ä¸éœ€è¦é‚£ä¹ˆå¤š hackï¼ˆå³ä½¿ hack ä¹Ÿæ— æ³•å®Œç¾å®ç°ç›‘å¬ï¼‰å°±å¯ä»¥æ— å‹åŠ›ç›‘å¬æ•°ç»„çš„å˜åŒ–,æˆ‘ä»¬éƒ½çŸ¥é“,æ ‡å‡†æ°¸è¿œä¼˜å…ˆäº hackã€‚\n\n### Proxy çš„å…¶ä»–ä¼˜åŠ¿\n\nProxy æœ‰å¤šè¾¾ 13 ç§æ‹¦æˆªæ–¹æ³•,ä¸é™äº applyã€ownKeysã€deletePropertyã€has ç­‰ç­‰æ˜¯`Object.defineProperty`ä¸å…·å¤‡çš„ã€‚\n\nProxy è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°å¯¹è±¡,æˆ‘ä»¬å¯ä»¥åªæ“ä½œæ–°çš„å¯¹è±¡è¾¾åˆ°ç›®çš„,è€Œ`Object.defineProperty`åªèƒ½éå†å¯¹è±¡å±æ€§ç›´æ¥ä¿®æ”¹ã€‚\n\nProxy ä½œä¸ºæ–°æ ‡å‡†å°†å—åˆ°æµè§ˆå™¨å‚å•†é‡ç‚¹æŒç»­çš„æ€§èƒ½ä¼˜åŒ–ï¼Œä¹Ÿå°±æ˜¯ä¼ è¯´ä¸­çš„æ–°æ ‡å‡†çš„æ€§èƒ½çº¢åˆ©ã€‚\n\nå½“ç„¶,Proxy çš„åŠ£åŠ¿å°±æ˜¯å…¼å®¹æ€§é—®é¢˜,è€Œä¸”æ— æ³•ç”¨ polyfill ç£¨å¹³,å› æ­¤ Vue çš„ä½œè€…æ‰å£°æ˜éœ€è¦ç­‰åˆ°ä¸‹ä¸ªå¤§ç‰ˆæœ¬(3.0)æ‰èƒ½ç”¨ Proxy é‡å†™ã€‚\n\n### åŸºç¡€ proxy çš„åŒå‘æ•°æ®ç»‘å®šçš„å®ç°\n\n#### å‘å¸ƒè®¢é˜…ä¸­å¿ƒ(Dep)\n\n`Dep`ä¿å­˜è®¢é˜…è€…,å¹¶åœ¨ Observer å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥ä¿å­˜åœ¨ Dep ä¸­çš„è®¢é˜…è€…,è®©è®¢é˜…è€…å¾—çŸ¥å˜åŒ–å¹¶æ›´æ–°è§†å›¾,è¿™æ ·æ‰èƒ½ä¿è¯è§†å›¾ä¸çŠ¶æ€çš„åŒæ­¥ã€‚\n\n```javascript\n/**\n * [subs description] è®¢é˜…å™¨,å‚¨å­˜è®¢é˜…è€…,é€šçŸ¥è®¢é˜…è€…\n * @type {Map}\n */\nexport default class Dep {\n  constructor() {\n    // æˆ‘ä»¬ç”¨ hash å‚¨å­˜è®¢é˜…è€…\n    this.subs = new Map();\n  }\n  // æ·»åŠ è®¢é˜…è€…\n  addSub(key, sub) {\n    // å–å‡ºé”®ä¸º key çš„è®¢é˜…è€…\n    const currentSub = this.subs.get(key);\n    // å¦‚æœèƒ½å–å‡ºè¯´æ˜æœ‰ç›¸åŒçš„ key çš„è®¢é˜…è€…å·²ç»å­˜åœ¨,ç›´æ¥æ·»åŠ \n    if (currentSub) {\n      currentSub.add(sub);\n    } else {\n      // ç”¨ Set æ•°æ®ç»“æ„å‚¨å­˜,ä¿è¯å”¯ä¸€å€¼\n      this.subs.set(key, new Set([sub]));\n    }\n  }\n  // é€šçŸ¥\n  notify(key) {\n    // è§¦å‘é”®ä¸º key çš„è®¢é˜…è€…ä»¬\n    if (this.subs.get(key)) {\n      this.subs.get(key).forEach(sub => {\n        sub.update();\n      });\n    }\n  }\n}\n```\n\n#### ç›‘å¬è€…çš„å®ç°(Observer)\n\næˆ‘ä»¬åœ¨è®¢é˜…å™¨ `Dep` ä¸­å®ç°äº†ä¸€ä¸ª`notify`æ–¹æ³•æ¥é€šçŸ¥ç›¸åº”çš„è®¢é˜…è¿™ä»¬,ç„¶è€Œ`notify`æ–¹æ³•åˆ°åº•ä»€ä¹ˆæ—¶å€™è¢«è§¦å‘å‘¢?\n\nå½“ç„¶æ˜¯å½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶,å³ MVVM ä¸­çš„ Modal å˜åŒ–æ—¶è§¦å‘é€šçŸ¥,ç„¶è€Œ`Dep` æ˜¾ç„¶æ— æ³•å¾—çŸ¥ Modal æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–,å› æ­¤æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç›‘å¬è€…`Observer`æ¥ç›‘å¬ Modal, å½“ Modal å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æˆ‘ä»¬å°±æ‰§è¡Œé€šçŸ¥æ“ä½œã€‚\n\nä¸`Object.defineProperty`ç›‘å¬å±æ€§ä¸åŒ, Proxy å¯ä»¥ç›‘å¬(å®é™…æ˜¯ä»£ç†)æ•´ä¸ªå¯¹è±¡,å› æ­¤å°±ä¸éœ€è¦éå†å¯¹è±¡çš„å±æ€§ä¾æ¬¡ç›‘å¬äº†,ä½†æ˜¯å¦‚æœå¯¹è±¡çš„å±æ€§ä¾ç„¶æ˜¯ä¸ªå¯¹è±¡,é‚£ä¹ˆ Proxy ä¹Ÿæ— æ³•ç›‘å¬,æ‰€ä»¥æˆ‘ä»¬å®ç°äº†ä¸€ä¸ª`observify`è¿›è¡Œé€’å½’ç›‘å¬å³å¯ã€‚\n\n```javascript\n/**\n * [Observer description] ç›‘å¬å™¨,ç›‘å¬å¯¹è±¡,è§¦å‘åé€šçŸ¥è®¢é˜…\n * @param {[type]}   obj [description] éœ€è¦è¢«ç›‘å¬çš„å¯¹è±¡\n */\nconst Observer = obj => {\n  const dep = new Dep();\n  return new Proxy(obj, {\n    get: function(target, key, receiver) {\n      // å¦‚æœè®¢é˜…è€…å­˜åœ¨ï¼Œç›´æ¥æ·»åŠ è®¢é˜…\n      if (Dep.target) {\n        dep.addSub(key, Dep.target);\n      }\n      return Reflect.get(target, key, receiver);\n    },\n    set: function(target, key, value, receiver) {\n      // å¦‚æœå¯¹è±¡å€¼æ²¡æœ‰å˜,é‚£ä¹ˆä¸è§¦å‘ä¸‹é¢çš„æ“ä½œç›´æ¥è¿”å›\n      if (Reflect.get(receiver, key) === value) {\n        return;\n      }\n      const res = Reflect.set(target, key, observify(value), receiver);\n      // å½“å€¼è¢«è§¦å‘æ›´æ”¹çš„æ—¶å€™,è§¦å‘ Dep çš„é€šçŸ¥æ–¹æ³•\n      dep.notify(key);\n      return res;\n    }\n  });\n};\n\n/**\n * å°†å¯¹è±¡è½¬ä¸ºç›‘å¬å¯¹è±¡\n * @param {*} obj è¦ç›‘å¬çš„å¯¹è±¡\n */\nexport default function observify(obj) {\n  if (!isObject(obj)) {\n    return obj;\n  }\n\n  // æ·±åº¦ç›‘å¬\n  Object.keys(obj).forEach(key => {\n    obj[key] = observify(obj[key]);\n  });\n\n  return Observer(obj);\n}\n```\n\n#### è®¢é˜…è€…çš„å®ç°(watcher)\n\næˆ‘ä»¬ç›®å‰å·²ç»è§£å†³äº†ä¸¤ä¸ªé—®é¢˜,ä¸€ä¸ªæ˜¯å¦‚ä½•å¾—çŸ¥ Modal å‘ç”Ÿäº†æ”¹å˜(åˆ©ç”¨ç›‘å¬è€… Observer ç›‘å¬ Modal å¯¹è±¡),ä¸€ä¸ªæ˜¯å¦‚ä½•æ”¶é›†è®¢é˜…è€…å¹¶é€šçŸ¥å…¶å˜åŒ–(åˆ©ç”¨è®¢é˜…å™¨æ”¶é›†è®¢é˜…è€…,å¹¶ç”¨ notify é€šçŸ¥è®¢é˜…è€…)ã€‚\n\næˆ‘ä»¬ç›®å‰è¿˜å·®ä¸€ä¸ªè®¢é˜…è€…ï¼ˆWatcherï¼‰\n\n```javascript\n// è®¢é˜…è€…\nexport default class Watcher {\n  constructor(vm, exp, cb) {\n    this.vm = vm; // vm æ˜¯ vue çš„å®ä¾‹\n    this.exp = exp; // è¢«è®¢é˜…çš„æ•°æ®\n    this.cb = cb; // è§¦å‘æ›´æ–°åçš„å›è°ƒ\n    this.value = this.get(); // è·å–è€æ•°æ®\n  }\n  get() {\n    const exp = this.exp;\n    let value;\n    Dep.target = this;\n    if (typeof exp === \"function\") {\n      value = exp.call(this.vm);\n    } else if (typeof exp === \"string\") {\n      value = this.vm[exp];\n    }\n    Dep.target = null;\n    return value;\n  }\n  // å°†è®¢é˜…è€…æ”¾å…¥å¾…æ›´æ–°é˜Ÿåˆ—ç­‰å¾…æ‰¹é‡æ›´æ–°\n  update() {\n    pushQueue(this);\n  }\n  // è§¦å‘çœŸæ­£çš„æ›´æ–°æ“ä½œ\n  run() {\n    const val = this.get(); // è·å–æ–°æ•°æ®\n    this.cb.call(this.vm, val, this.value);\n    this.value = val;\n  }\n}\n```\n\n#### æ‰¹é‡æ›´æ–°çš„å®ç°\n\næˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­å®ç°äº†è®¢é˜…è€…( Watcher),ä½†æ˜¯å…¶ä¸­çš„`update`æ–¹æ³•æ˜¯å°†è®¢é˜…è€…æ”¾å…¥äº†ä¸€ä¸ªå¾…æ›´æ–°çš„é˜Ÿåˆ—ä¸­,è€Œä¸æ˜¯ç›´æ¥è§¦å‘,åŸå› å¦‚ä¸‹:\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy4crpf3j31260l6qbp.jpg)\n\nå› æ­¤è¿™ä¸ªé˜Ÿåˆ—éœ€è¦åšçš„æ˜¯**å¼‚æ­¥**ä¸”**å»é‡**,å› æ­¤æˆ‘ä»¬ç”¨ `Set`ä½œä¸ºæ•°æ®ç»“æ„å‚¨å­˜ Watcher æ¥å»é‡,åŒæ—¶ç”¨`Promise`æ¨¡æ‹Ÿå¼‚æ­¥æ›´æ–°ã€‚\n\n```javascript\n// åˆ›å»ºå¼‚æ­¥æ›´æ–°é˜Ÿåˆ—\nlet queue = new Set();\n\n// ç”¨Promiseæ¨¡æ‹ŸnextTick\nfunction nextTick(cb) {\n  Promise.resolve().then(cb);\n}\n\n// æ‰§è¡Œåˆ·æ–°é˜Ÿåˆ—\nfunction flushQueue(args) {\n  queue.forEach(watcher => {\n    watcher.run();\n  });\n  // æ¸…ç©º\n  queue = new Set();\n}\n\n// æ·»åŠ åˆ°é˜Ÿåˆ—\nexport default function pushQueue(watcher) {\n  queue.add(watcher);\n  // ä¸‹ä¸€ä¸ªå¾ªç¯è°ƒç”¨\n  nextTick(flushQueue);\n}\n```\n","tags":["VUE"],"categories":["VUE"]},{"title":"ä¹ç§å®ç°è·¨åŸŸçš„æ–¹å¼","url":"/2019/03/07/ä¹ç§å®ç°è·¨åŸŸçš„æ–¹å¼/","content":"\n# åŸºæœ¬æ¦‚å¿µ\n\nåŒæºç­–ç•¥æ˜¯çº¦å®šï¼Œå®ƒæ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒä¹Ÿæœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ã€‚\nåŒæºï¼š\"åè®®+åŸŸå+ç«¯å£\"\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j62z4nj1j30o805s0ta.jpg)\n\nåŒæºç­–ç•¥é™åˆ¶å†…å®¹æœ‰ï¼š\n\n1. Cookieã€LocalStorageã€IndexedDB ç­‰å­˜å‚¨æ€§å†…å®¹\n2. DOM èŠ‚ç‚¹\n3. AJAX è¯·æ±‚å‘é€åï¼Œç»“æœè¢«æµè§ˆå™¨æ‹¦æˆªäº†\n\n<!-- more -->\n\næœ‰ä¸‰ä¸ªæ ‡ç­¾æ˜¯å…è®¸è·¨åŸŸåŠ è½½èµ„æºï¼š\n\n```html\n <img src=XXX>\n <link href=XXX>\n <script src=XXX>\n```\n\n# è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼š\n\n## JSONP\n\n### JSONP åŸç†\n\nåˆ©ç”¨ script æ ‡ç­¾æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„æ¼æ´ï¼Œç½‘é¡µå¯ä»¥å¾—åˆ°ä»å…¶ä»–æ¥æºåŠ¨æ€äº§ç”Ÿçš„ JSON æ•°æ®ã€‚JSONP è¯·æ±‚ä¸€å®šéœ€è¦å¯¹æ–¹çš„æœåŠ¡å™¨åšæ”¯æŒæ‰å¯ä»¥ã€‚\n\n### JSONP ä¼˜ç¼ºç‚¹\n\nJSONP ä¼˜ç‚¹æ˜¯ç®€å•å…¼å®¹æ€§å¥½ï¼Œå¯ç”¨äºè§£å†³ä¸»æµæµè§ˆå™¨çš„è·¨åŸŸæ•°æ®è®¿é—®çš„é—®é¢˜ã€‚ç¼ºç‚¹æ˜¯ä»…æ”¯æŒ get æ–¹æ³•å…·æœ‰å±€é™æ€§,ä¸å®‰å…¨å¯èƒ½ä¼šé­å— XSS æ”»å‡»ã€‚\n\n### JSONP çš„å®ç°æµç¨‹\n\n1. å£°æ˜ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå…¶å‡½æ•°å(å¦‚ show)å½“åšå‚æ•°å€¼ï¼Œè¦ä¼ é€’ç»™è·¨åŸŸè¯·æ±‚æ•°æ®çš„æœåŠ¡å™¨ï¼Œå‡½æ•°å½¢å‚ä¸ºè¦è·å–ç›®æ ‡æ•°æ®(æœåŠ¡å™¨è¿”å›çš„ data)ã€‚\n2. åˆ›å»ºä¸€ä¸ª script æ ‡ç­¾ï¼ŒæŠŠé‚£ä¸ªè·¨åŸŸçš„ API æ•°æ®æ¥å£åœ°å€ï¼Œèµ‹å€¼ç»™ script çš„ src,è¿˜è¦åœ¨è¿™ä¸ªåœ°å€ä¸­å‘æœåŠ¡å™¨ä¼ é€’è¯¥å‡½æ•°åï¼ˆå¯ä»¥é€šè¿‡é—®å·ä¼ å‚:?callback=showï¼‰ã€‚\n3. æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œéœ€è¦è¿›è¡Œç‰¹æ®Šçš„å¤„ç†ï¼šæŠŠä¼ é€’è¿›æ¥çš„å‡½æ•°åå’Œå®ƒéœ€è¦ç»™ä½ çš„æ•°æ®æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²,ä¾‹å¦‚ï¼šä¼ é€’è¿›å»çš„å‡½æ•°åæ˜¯ showï¼Œå®ƒå‡†å¤‡å¥½çš„æ•°æ®æ˜¯ show('æˆ‘ä¸çˆ±ä½ ')ã€‚\n4. æœ€åæœåŠ¡å™¨æŠŠå‡†å¤‡çš„æ•°æ®é€šè¿‡ HTTP åè®®è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å†è°ƒç”¨æ‰§è¡Œä¹‹å‰å£°æ˜çš„å›è°ƒå‡½æ•°ï¼ˆshowï¼‰ï¼Œå¯¹è¿”å›çš„æ•°æ®è¿›è¡Œæ“ä½œã€‚\n\n```javascript\n// index.html\nfunction jsonp({ url, params, callback }) {\n  return new Promise((resolve, reject) => {\n    let script = document.createElement(\"script\");\n    window[callback] = function(data) {\n      resolve(data);\n      document.body.removeChild(script);\n    };\n    params = { ...params, callback }; // wd=b&callback=show\n    let arrs = [];\n    for (let key in params) {\n      arrs.push(`${key}=${params[key]}`);\n    }\n    script.src = `${url}?${arrs.join(\"&\")}`;\n    document.body.appendChild(script);\n  });\n}\njsonp({\n  url: \"http://localhost:3000/say\",\n  params: { wd: \"Iloveyou\" },\n  callback: \"show\"\n}).then(data => {\n  console.log(data);\n});\n```\n\nä¸Šé¢è¿™æ®µä»£ç ç›¸å½“äºå‘http://localhost:3000/say?wd=Iloveyou&callback=show è¿™ä¸ªåœ°å€è¯·æ±‚æ•°æ®ï¼Œç„¶ååå°è¿”å› show('æˆ‘ä¸çˆ±ä½ ')ï¼Œæœ€åä¼šè¿è¡Œ show()è¿™ä¸ªå‡½æ•°ï¼Œæ‰“å°å‡º'æˆ‘ä¸çˆ±ä½ '\n\n```javascript\n// server.js\nlet express = require(\"express\");\nlet app = express();\napp.get(\"/say\", function(req, res) {\n  let { wd, callback } = req.query;\n  console.log(wd); // Iloveyou\n  console.log(callback); // show\n  res.end(`${callback}('æˆ‘ä¸çˆ±ä½ ')`);\n});\napp.listen(3000);\n```\n\n## cors\n\nCORS éœ€è¦æµè§ˆå™¨å’Œåç«¯åŒæ—¶æ”¯æŒã€‚IE 8 å’Œ 9 éœ€è¦é€šè¿‡ XDomainRequest æ¥å®ç°ã€‚\næµè§ˆå™¨ä¼šè‡ªåŠ¨è¿›è¡Œ CORS é€šä¿¡ï¼Œå®ç° CORS é€šä¿¡çš„å…³é”®æ˜¯åç«¯ã€‚\n\næœåŠ¡ç«¯è®¾ç½® Access-Control-Allow-Origin å°±å¯ä»¥å¼€å¯ CORSã€‚ è¯¥å±æ€§è¡¨ç¤ºå“ªäº›åŸŸåå¯ä»¥è®¿é—®èµ„æºï¼Œå¦‚æœè®¾ç½®é€šé…ç¬¦åˆ™è¡¨ç¤ºæ‰€æœ‰ç½‘ç«™éƒ½å¯ä»¥è®¿é—®èµ„æºã€‚\n\n### ç®€å•è¯·æ±‚\n\nä½¿ç”¨æ–¹æ³•ä¸º GETã€HEADã€POST ä¹‹ä¸€\nContent-Type çš„å€¼ä»…é™äº text/plainã€multipart/form-dataã€application/x-www-form-urlencoded ä¸‰è€…ä¹‹ä¸€\nåŒæ—¶æ»¡è¶³è¿™ä¸¤å¤§æ¡ä»¶ï¼Œä¸ºç®€å•è¯·æ±‚\n\n### å¤æ‚è¯·æ±‚\n\nå¤æ‚è¯·æ±‚çš„ CORS è¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡ HTTP æŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸º\"é¢„æ£€\"è¯·æ±‚,è¯¥è¯·æ±‚æ˜¯ option æ–¹æ³•çš„ï¼Œé€šè¿‡è¯¥è¯·æ±‚æ¥çŸ¥é“æœåŠ¡ç«¯æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚ã€‚\n\n```javascript\n// index.html\nlet xhr = new XMLHttpRequest();\ndocument.cookie = \"name=xiamen\"; // cookieä¸èƒ½è·¨åŸŸ\nxhr.withCredentials = true; // å‰ç«¯è®¾ç½®æ˜¯å¦å¸¦cookie\nxhr.open(\"PUT\", \"http://localhost:4000/getData\", true);\nxhr.setRequestHeader(\"name\", \"xiamen\");\nxhr.onreadystatechange = function() {\n  if (xhr.readyState === 4) {\n    if ((xhr.status >= 200 && xhr.status < 300) || xhr.status === 304) {\n      console.log(xhr.response);\n      //å¾—åˆ°å“åº”å¤´ï¼Œåå°éœ€è®¾ç½®Access-Control-Expose-Headers\n      console.log(xhr.getResponseHeader(\"name\"));\n    }\n  }\n};\nxhr.send();\n```\n\n```javascript\n//server1.js\nlet express = require(\"express\");\nlet app = express();\napp.use(express.static(__dirname));\napp.listen(3000);\n```\n\n```javascript\n//server2.js\nlet express = require(\"express\");\nlet app = express();\nlet whitList = [\"http://localhost:3000\"]; //è®¾ç½®ç™½åå•\napp.use(function(req, res, next) {\n  let origin = req.headers.origin;\n  if (whitList.includes(origin)) {\n    // è®¾ç½®å“ªä¸ªæºå¯ä»¥è®¿é—®æˆ‘\n    res.setHeader(\"Access-Control-Allow-Origin\", origin);\n    // å…è®¸æºå¸¦å“ªä¸ªå¤´è®¿é—®æˆ‘\n    res.setHeader(\"Access-Control-Allow-Headers\", \"name\");\n    // å…è®¸å“ªä¸ªæ–¹æ³•è®¿é—®æˆ‘\n    res.setHeader(\"Access-Control-Allow-Methods\", \"PUT\");\n    // å…è®¸æºå¸¦cookie\n    res.setHeader(\"Access-Control-Allow-Credentials\", true);\n    // é¢„æ£€çš„å­˜æ´»æ—¶é—´\n    res.setHeader(\"Access-Control-Max-Age\", 6);\n    // å…è®¸è¿”å›çš„å¤´\n    res.setHeader(\"Access-Control-Expose-Headers\", \"name\");\n    if (req.method === \"OPTIONS\") {\n      res.end(); // OPTIONSè¯·æ±‚ä¸åšä»»ä½•å¤„ç†\n    }\n  }\n  next();\n});\napp.put(\"/getData\", function(req, res) {\n  console.log(req.headers);\n  res.setHeader(\"name\", \"jw\"); //è¿”å›ä¸€ä¸ªå“åº”å¤´ï¼Œåå°éœ€è®¾ç½®\n  res.end(\"æˆ‘ä¸çˆ±ä½ \");\n});\napp.get(\"/getData\", function(req, res) {\n  console.log(req.headers);\n  res.end(\"æˆ‘ä¸çˆ±ä½ \");\n});\napp.use(express.static(__dirname));\napp.listen(4000);\n```\n\n## postMessage\n\næ˜¯ä¸ºæ•°ä¸å¤šå¯ä»¥è·¨åŸŸæ“ä½œçš„ window å±æ€§ï¼Œå¯ç”¨äºè§£å†³ä»¥ä¸‹æ–¹é¢çš„é—®é¢˜ï¼š\n\n1. é¡µé¢å’Œå…¶æ‰“å¼€çš„æ–°çª—å£çš„æ•°æ®ä¼ é€’\n2. å¤šçª—å£ä¹‹é—´æ¶ˆæ¯ä¼ é€’\n3. é¡µé¢ä¸åµŒå¥—çš„ iframe æ¶ˆæ¯ä¼ é€’\n4. ä¸Šé¢ä¸‰ä¸ªåœºæ™¯çš„è·¨åŸŸæ•°æ®ä¼ é€’\n   postMessage()æ–¹æ³•å…è®¸æ¥è‡ªä¸åŒæºçš„è„šæœ¬é‡‡ç”¨å¼‚æ­¥æ–¹å¼è¿›è¡Œæœ‰é™çš„é€šä¿¡ï¼Œå¯ä»¥å®ç°è·¨æ–‡æœ¬æ¡£ã€å¤šçª—å£ã€è·¨åŸŸæ¶ˆæ¯ä¼ é€’ã€‚\n\n```javascript\notherWindow.postMessage(message, targetOrigin, [transfer]);\n```\n\nä¾‹å­ï¼š\n\n```html\n// a.html\n<iframe\n  src=\"http://localhost:4000/b.html\"\n  frameborder=\"0\"\n  id=\"frame\"\n  onload=\"load()\"\n></iframe>\n//ç­‰å®ƒåŠ è½½å®Œè§¦å‘ä¸€ä¸ªäº‹ä»¶ //å†…åµŒåœ¨http://localhost:3000/a.html\n<script>\n  function load() {\n    let frame = document.getElementById(\"frame\");\n    frame.contentWindow.postMessage(\"æˆ‘çˆ±ä½ \", \"http://localhost:4000\"); //å‘é€æ•°æ®\n    window.onmessage = function(e) {\n      //æ¥å—è¿”å›æ•°æ®\n      console.log(e.data); //æˆ‘ä¸çˆ±ä½ \n    };\n  }\n</script>\n```\n\n```javascript\n// b.html\nwindow.onmessage = function(e) {\n  console.log(e.data); //æˆ‘çˆ±ä½ \n  e.source.postMessage(\"æˆ‘ä¸çˆ±ä½ \", e.origin);\n};\n```\n\n## websocket\n\nWebsocket æ˜¯ HTML5 çš„ WebSocket å’Œ HTTP éƒ½æ˜¯åº”ç”¨å±‚åè®®ï¼Œéƒ½åŸºäº TCP åè®®ã€‚ä½†æ˜¯ WebSocket æ˜¯ä¸€ç§åŒå‘é€šä¿¡åè®®ï¼Œåœ¨å»ºç«‹è¿æ¥ä¹‹åï¼ŒWebSocket çš„ server ä¸ client éƒ½èƒ½ä¸»åŠ¨å‘å¯¹æ–¹å‘é€æˆ–æ¥æ”¶æ•°æ®ã€‚ä¸€ä¸ªæŒä¹…åŒ–çš„åè®®ï¼Œå®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨çš„å…¨åŒå·¥é€šä¿¡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯è·¨åŸŸçš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚åŒæ—¶ï¼ŒWebSocket åœ¨å»ºç«‹è¿æ¥æ—¶éœ€è¦å€ŸåŠ© HTTP åè®®ï¼Œè¿æ¥å»ºç«‹å¥½äº†ä¹‹å client ä¸ server ä¹‹é—´çš„åŒå‘é€šä¿¡å°±ä¸ HTTP æ— å…³äº†ã€‚\n\n```html\n// socket.html\n<script>\n  let socket = new WebSocket(\"ws://localhost:3000\");\n  socket.onopen = function() {\n    socket.send(\"æˆ‘çˆ±ä½ \"); //å‘æœåŠ¡å™¨å‘é€æ•°æ®\n  };\n  socket.onmessage = function(e) {\n    console.log(e.data); //æ¥æ”¶æœåŠ¡å™¨è¿”å›çš„æ•°æ®\n  };\n</script>\n```\n\n```javascript\n// server.js\nlet express = require(\"express\");\nlet app = express();\nlet WebSocket = require(\"ws\"); //è®°å¾—å®‰è£…ws\nlet wss = new WebSocket.Server({ port: 3000 });\nwss.on(\"connection\", function(ws) {\n  ws.on(\"message\", function(data) {\n    console.log(data);\n    ws.send(\"æˆ‘ä¸çˆ±ä½ \");\n  });\n});\n```\n\n## Node ä¸­é—´ä»¶ä»£ç†(ä¸¤æ¬¡è·¨åŸŸ)\n\nå®ç°åŸç†ï¼šåŒæºç­–ç•¥æ˜¯æµè§ˆå™¨éœ€è¦éµå¾ªçš„æ ‡å‡†ï¼Œè€Œå¦‚æœæ˜¯æœåŠ¡å™¨å‘æœåŠ¡å™¨è¯·æ±‚å°±æ— éœ€éµå¾ªåŒæºç­–ç•¥ã€‚\n\nä»£ç†æœåŠ¡å™¨ï¼Œéœ€è¦åšä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\n\n1. æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ ã€‚\n2. å°†è¯·æ±‚ è½¬å‘ç»™æœåŠ¡å™¨ã€‚\n3. æ‹¿åˆ°æœåŠ¡å™¨ å“åº” æ•°æ®ã€‚\n4. å°† å“åº” è½¬å‘ç»™å®¢æˆ·ç«¯ã€‚\n\næœ¬åœ°æ–‡ä»¶ index.html æ–‡ä»¶ï¼Œé€šè¿‡ä»£ç†æœåŠ¡å™¨http://localhost:3000å‘ç›®æ ‡æœåŠ¡å™¨http://localhost:4000è¯·æ±‚æ•°æ®ï¼š\n\n```html\n// index.html(http://127.0.0.1:5500)\n<script src=\"https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js\"></script>\n<script>\n  $.ajax({\n    url: \"http://localhost:3000\",\n    type: \"post\",\n    data: { name: \"xiamen\", password: \"123456\" },\n    contentType: \"application/json;charset=utf-8\",\n    success: function(result) {\n      console.log(result); // {\"title\":\"fontend\",\"password\":\"123456\"}\n    },\n    error: function(msg) {\n      console.log(msg);\n    }\n  });\n</script>\n```\n\n```javascript\n// server1.js ä»£ç†æœåŠ¡å™¨(http://localhost:3000)\nconst http = require(\"http\");\n// ç¬¬ä¸€æ­¥ï¼šæ¥å—å®¢æˆ·ç«¯è¯·æ±‚\nconst server = http.createServer((request, response) => {\n  // ä»£ç†æœåŠ¡å™¨ï¼Œç›´æ¥å’Œæµè§ˆå™¨ç›´æ¥äº¤äº’ï¼Œéœ€è¦è®¾ç½®CORS çš„é¦–éƒ¨å­—æ®µ\n  response.writeHead(200, {\n    \"Access-Control-Allow-Origin\": \"*\",\n    \"Access-Control-Allow-Methods\": \"*\",\n    \"Access-Control-Allow-Headers\": \"Content-Type\"\n  });\n  // ç¬¬äºŒæ­¥ï¼šå°†è¯·æ±‚è½¬å‘ç»™æœåŠ¡å™¨\n  const proxyRequest = http\n    .request(\n      {\n        host: \"127.0.0.1\",\n        port: 4000,\n        url: \"/\",\n        method: request.method,\n        headers: request.headers\n      },\n      serverResponse => {\n        // ç¬¬ä¸‰æ­¥ï¼šæ”¶åˆ°æœåŠ¡å™¨çš„å“åº”\n        var body = \"\";\n        serverResponse.on(\"data\", chunk => {\n          body += chunk;\n        });\n        serverResponse.on(\"end\", () => {\n          console.log(\"The data is \" + body);\n          // ç¬¬å››æ­¥ï¼šå°†å“åº”ç»“æœè½¬å‘ç»™æµè§ˆå™¨\n          response.end(body);\n        });\n      }\n    )\n    .end();\n});\nserver.listen(3000, () => {\n  console.log(\"The proxyServer is running at http://localhost:3000\");\n});\n```\n\n```javascript\n// server2.js(http://localhost:4000)\nconst http = require(\"http\");\nconst data = { title: \"fontend\", password: \"123456\" };\nconst server = http.createServer((request, response) => {\n  if (request.url === \"/\") {\n    response.end(JSON.stringify(data));\n  }\n});\nserver.listen(4000, () => {\n  console.log(\"The server is running at http://localhost:4000\");\n});\n```\n\n## nginx åå‘ä»£ç†\n\nå®ç°åŸç†ç±»ä¼¼äº Node ä¸­é—´ä»¶ä»£ç†ï¼Œéœ€è¦ä½ æ­å»ºä¸€ä¸ªä¸­è½¬ nginx æœåŠ¡å™¨ï¼Œç”¨äºè½¬å‘è¯·æ±‚ã€‚\n\nä½¿ç”¨ nginx åå‘ä»£ç†å®ç°è·¨åŸŸï¼Œæ˜¯æœ€ç®€å•çš„è·¨åŸŸæ–¹å¼ã€‚åªéœ€è¦ä¿®æ”¹ nginx çš„é…ç½®å³å¯è§£å†³è·¨åŸŸé—®é¢˜ï¼Œæ”¯æŒæ‰€æœ‰æµè§ˆå™¨ï¼Œæ”¯æŒ sessionï¼Œä¸éœ€è¦ä¿®æ”¹ä»»ä½•ä»£ç ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“æœåŠ¡å™¨æ€§èƒ½ã€‚\n\nå®ç°æ€è·¯ï¼šé€šè¿‡ nginx é…ç½®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼ˆåŸŸåä¸ domain1 ç›¸åŒï¼Œç«¯å£ä¸åŒï¼‰åšè·³æ¿æœºï¼Œåå‘ä»£ç†è®¿é—® domain2 æ¥å£ï¼Œå¹¶ä¸”å¯ä»¥é¡ºä¾¿ä¿®æ”¹ cookie ä¸­ domain ä¿¡æ¯ï¼Œæ–¹ä¾¿å½“å‰åŸŸ cookie å†™å…¥ï¼Œå®ç°è·¨åŸŸç™»å½•ã€‚\n\nå…ˆä¸‹è½½ nginxï¼Œç„¶åå°† nginx ç›®å½•ä¸‹çš„ nginx.conf ä¿®æ”¹ï¼Œæœ€åé€šè¿‡å‘½ä»¤è¡Œ nginx -s reload å¯åŠ¨ nginx\n\n## window.name + iframe\n\nwindow.name å±æ€§çš„ç‹¬ç‰¹ä¹‹å¤„ï¼šname å€¼åœ¨ä¸åŒçš„é¡µé¢ï¼ˆç”šè‡³ä¸åŒåŸŸåï¼‰åŠ è½½åä¾æ—§å­˜åœ¨ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒéå¸¸é•¿çš„ name å€¼ï¼ˆ2MBï¼‰ã€‚\nå…¶ä¸­ a.html å’Œ b.html æ˜¯åŒåŸŸçš„ï¼Œéƒ½æ˜¯http://localhost:3000;è€Œc.htmlæ˜¯http://localhost:4000\n\n```html\n// a.html(http://localhost:3000/b.html)\n<iframe\n  src=\"http://localhost:4000/c.html\"\n  frameborder=\"0\"\n  onload=\"load()\"\n  id=\"iframe\"\n></iframe>\n<script>\n  let first = true;\n  // onloadäº‹ä»¶ä¼šè§¦å‘2æ¬¡ï¼Œç¬¬1æ¬¡åŠ è½½è·¨åŸŸé¡µï¼Œå¹¶ç•™å­˜æ•°æ®äºwindow.name\n  function load() {\n    if (first) {\n      // ç¬¬1æ¬¡onload(è·¨åŸŸé¡µ)æˆåŠŸåï¼Œåˆ‡æ¢åˆ°åŒåŸŸä»£ç†é¡µé¢\n      let iframe = document.getElementById(\"iframe\");\n      iframe.src = \"http://localhost:3000/b.html\";\n      first = false;\n    } else {\n      // ç¬¬2æ¬¡onload(åŒåŸŸb.htmlé¡µ)æˆåŠŸåï¼Œè¯»å–åŒåŸŸwindow.nameä¸­æ•°æ®\n      console.log(iframe.contentWindow.name);\n    }\n  }\n</script>\n```\n\nb.html ä¸ºä¸­é—´ä»£ç†é¡µï¼Œä¸ a.html åŒåŸŸï¼Œå†…å®¹ä¸ºç©ºã€‚\n\n```html\n// c.html(http://localhost:4000/c.html)\n<script>\n  window.name = \"æˆ‘ä¸çˆ±ä½ \";\n</script>\n```\n\né€šè¿‡ iframe çš„ src å±æ€§ç”±å¤–åŸŸè½¬å‘æœ¬åœ°åŸŸï¼Œè·¨åŸŸæ•°æ®å³ç”± iframe çš„ window.name ä»å¤–åŸŸä¼ é€’åˆ°æœ¬åœ°åŸŸã€‚è¿™ä¸ªå°±å·§å¦™åœ°ç»•è¿‡äº†æµè§ˆå™¨çš„è·¨åŸŸè®¿é—®é™åˆ¶ï¼Œä½†åŒæ—¶å®ƒåˆæ˜¯å®‰å…¨æ“ä½œã€‚\n\n## location.hash + iframe\n\nå®ç°åŸç†ï¼š a.html æ¬²ä¸ c.html è·¨åŸŸç›¸äº’é€šä¿¡ï¼Œé€šè¿‡ä¸­é—´é¡µ b.html æ¥å®ç°ã€‚ ä¸‰ä¸ªé¡µé¢ï¼Œä¸åŒåŸŸä¹‹é—´åˆ©ç”¨ iframe çš„ location.hash ä¼ å€¼ï¼Œç›¸åŒåŸŸä¹‹é—´ç›´æ¥ js è®¿é—®æ¥é€šä¿¡ã€‚\n\nå…·ä½“å®ç°æ­¥éª¤ï¼šä¸€å¼€å§‹ a.html ç»™ c.html ä¼ ä¸€ä¸ª hash å€¼ï¼Œç„¶å c.html æ”¶åˆ° hash å€¼åï¼Œå†æŠŠ hash å€¼ä¼ é€’ç»™ b.htmlï¼Œæœ€å b.html å°†ç»“æœæ”¾åˆ° a.html çš„ hash å€¼ä¸­ã€‚\n\n```html\n// a.html\n<iframe src=\"http://localhost:4000/c.html#iloveyou\"></iframe>\n<script>\n  window.onhashchange = function() {\n    //æ£€æµ‹hashçš„å˜åŒ–\n    console.log(location.hash);\n  };\n</script>\n```\n\n```html\n// b.html\n<script>\n  window.parent.parent.location.hash = location.hash;\n  //b.htmlå°†ç»“æœæ”¾åˆ°a.htmlçš„hashå€¼ä¸­ï¼Œb.htmlå¯é€šè¿‡parent.parentè®¿é—®a.htmlé¡µé¢\n</script>\n```\n\n```javascript\n// c.html\nconsole.log(location.hash);\nlet iframe = document.createElement(\"iframe\");\niframe.src = \"http://localhost:3000/b.html#idontloveyou\";\ndocument.body.appendChild(iframe);\n```\n\n## document.domain + iframe\n\nè¯¥æ–¹å¼åªèƒ½ç”¨äºäºŒçº§åŸŸåç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ a.test.com å’Œ b.test.com é€‚ç”¨äºè¯¥æ–¹å¼ã€‚\nåªéœ€è¦ç»™é¡µé¢æ·»åŠ  document.domain ='test.com' è¡¨ç¤ºäºŒçº§åŸŸåéƒ½ç›¸åŒå°±å¯ä»¥å®ç°è·¨åŸŸã€‚\nå®ç°åŸç†ï¼šä¸¤ä¸ªé¡µé¢éƒ½é€šè¿‡ js å¼ºåˆ¶è®¾ç½® document.domain ä¸ºåŸºç¡€ä¸»åŸŸï¼Œå°±å®ç°äº†åŒåŸŸã€‚\n\n```html\n// a.zf1.cn:3000/a.html\n<body>\n  helloa\n  <iframe\n    src=\"http://b.zf1.cn:3000/b.html\"\n    frameborder=\"0\"\n    onload=\"load()\"\n    id=\"frame\"\n  ></iframe>\n  <script>\n    document.domain = \"zf1.cn\";\n    function load() {\n      console.log(frame.contentWindow.a);\n    }\n  </script>\n</body>\n```\n\n```html\n// b.zf1.cn:3000/b.html\n<body>\n  hellob\n  <script>\n    document.domain = \"zf1.cn\";\n    var a = 100;\n  </script>\n</body>\n```\n","tags":["JavaScript","æµè§ˆå™¨","è·¨åŸŸ"],"categories":["JavaScript"]},{"title":"æ ‘çš„diffç®—æ³•ï¼ˆvue 2.0ï¼‰","url":"/2019/02/26/æ ‘çš„diffç®—æ³•ï¼ˆvue 2.0ï¼‰/","content":"\n# æ ‘çš„ diff ç®—æ³•ï¼ˆvue 2.0ï¼‰\n\n## æ¨¡æ¿è½¬æ¢æˆè§†å›¾çš„è¿‡ç¨‹\n\n- Vue.js é€šè¿‡ç¼–è¯‘å°† template æ¨¡æ¿è½¬æ¢æˆæ¸²æŸ“å‡½æ•°(render ) ï¼Œæ‰§è¡Œæ¸²æŸ“å‡½æ•°å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹æ ‘\n- åœ¨å¯¹ Model è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼Œä¼šè§¦å‘å¯¹åº” Dep ä¸­çš„ Watcher å¯¹è±¡ã€‚Watcher å¯¹è±¡ä¼šè°ƒç”¨å¯¹åº”çš„ update æ¥ä¿®æ”¹è§†å›¾ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ˜¯å°†æ–°æ—§è™šæ‹ŸèŠ‚ç‚¹è¿›è¡Œå·®å¼‚å¯¹æ¯”ï¼Œç„¶åæ ¹æ®å¯¹æ¯”ç»“æœè¿›è¡Œ DOM æ“ä½œæ¥æ›´æ–°è§†å›¾ã€‚\n\nç®€å•ç‚¹è®²ï¼Œåœ¨ Vue çš„åº•å±‚å®ç°ä¸Šï¼ŒVue å°†æ¨¡æ¿ç¼–è¯‘æˆè™šæ‹Ÿ DOM æ¸²æŸ“å‡½æ•°ã€‚ç»“åˆ Vue è‡ªå¸¦çš„å“åº”ç³»ç»Ÿï¼Œåœ¨çŠ¶æ€æ”¹å˜æ—¶ï¼ŒVue èƒ½å¤Ÿæ™ºèƒ½åœ°è®¡ç®—å‡ºé‡æ–°æ¸²æŸ“ç»„ä»¶çš„æœ€å°ä»£ä»·å¹¶åº”åˆ° DOM æ“ä½œä¸Šã€‚\n\n<!-- more -->\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6ixrpspcuj30qd07hdge.jpg)\n\n- **æ¸²æŸ“å‡½æ•°**ï¼šæ¸²æŸ“å‡½æ•°æ˜¯ç”¨æ¥ç”Ÿæˆ Virtual DOM çš„ã€‚Vue æ¨èä½¿ç”¨æ¨¡æ¿æ¥æ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç•Œé¢ï¼Œåœ¨åº•å±‚å®ç°ä¸­ Vue ä¼šå°†æ¨¡æ¿ç¼–è¯‘æˆæ¸²æŸ“å‡½æ•°ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸å†™æ¨¡æ¿ï¼Œç›´æ¥å†™æ¸²æŸ“å‡½æ•°ï¼Œä»¥è·å¾—æ›´å¥½çš„æ§åˆ¶ã€‚\n- **VNode è™šæ‹ŸèŠ‚ç‚¹**ï¼šå®ƒå¯ä»¥ä»£è¡¨ä¸€ä¸ªçœŸå®çš„ dom èŠ‚ç‚¹ã€‚é€šè¿‡ createElement æ–¹æ³•èƒ½å°† VNode æ¸²æŸ“æˆ dom èŠ‚ç‚¹ã€‚ç®€å•åœ°è¯´ï¼Œvnode å¯ä»¥ç†è§£æˆ**èŠ‚ç‚¹æè¿°å¯¹è±¡**ï¼Œå®ƒæè¿°äº†åº”è¯¥æ€æ ·å»åˆ›å»ºçœŸå®çš„ DOM èŠ‚ç‚¹ã€‚\n- **patch(ä¹Ÿå«åš patching ç®—æ³•)**ï¼šè™šæ‹Ÿ DOM æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå®ƒå¯ä»¥å°† vnode æ¸²æŸ“æˆçœŸå®çš„ DOMï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¯¹æ¯”æ–°æ—§è™šæ‹ŸèŠ‚ç‚¹ä¹‹é—´æœ‰å“ªäº›ä¸åŒï¼Œç„¶åæ ¹æ®å¯¹æ¯”ç»“æœæ‰¾å‡ºéœ€è¦æ›´æ–°çš„çš„èŠ‚ç‚¹è¿›è¡Œæ›´æ–°ã€‚è¿™ç‚¹æˆ‘ä»¬ä»å•è¯å«ä¹‰å°±å¯ä»¥çœ‹å‡ºï¼Œ patch æœ¬èº«å°±æœ‰è¡¥ä¸ã€ä¿®è¡¥çš„æ„æ€ï¼Œå…¶å®é™…ä½œç”¨æ˜¯åœ¨ç°æœ‰ DOM ä¸Šè¿›è¡Œä¿®æ”¹æ¥å®ç°æ›´æ–°è§†å›¾çš„ç›®çš„ã€‚Vue çš„ Virtual DOM Patching ç®—æ³•æ˜¯åŸºäº[Snabbdom](https://github.com/snabbdom/snabbdom)çš„å®ç°ï¼Œå¹¶åœ¨äº›åŸºç¡€ä¸Šä½œäº†å¾ˆå¤šçš„è°ƒæ•´å’Œæ”¹è¿›ã€‚\n\n## Virtual DOM æ˜¯ä»€ä¹ˆï¼Ÿ\n\nVirtual DOM å…¶å®å°±æ˜¯ä¸€æ£µä»¥ JavaScript å¯¹è±¡( VNode èŠ‚ç‚¹)ä½œä¸ºåŸºç¡€çš„æ ‘ï¼Œç”¨å¯¹è±¡å±æ€§æ¥æè¿°èŠ‚ç‚¹ï¼Œå®é™…ä¸Šå®ƒåªæ˜¯ä¸€å±‚å¯¹çœŸå® DOM çš„æŠ½è±¡ã€‚æœ€ç»ˆå¯ä»¥é€šè¿‡ä¸€ç³»åˆ—æ“ä½œä½¿è¿™æ£µæ ‘æ˜ å°„åˆ°çœŸå®ç¯å¢ƒä¸Šã€‚\n\nç®€å•æ¥è¯´ï¼Œå¯ä»¥æŠŠ Virtual DOM ç†è§£ä¸ºä¸€ä¸ªç®€å•çš„ JS å¯¹è±¡ï¼Œå¹¶ä¸”æœ€å°‘åŒ…å«æ ‡ç­¾å( tag)ã€å±æ€§(attrs)å’Œå­å…ƒç´ å¯¹è±¡( children)ä¸‰ä¸ªå±æ€§ã€‚ä¸åŒçš„æ¡†æ¶å¯¹è¿™ä¸‰ä¸ªå±æ€§çš„å‘½åä¼šæœ‰ç‚¹å·®åˆ«ã€‚\n\nå¯¹äºè™šæ‹Ÿ DOMï¼Œå’±ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„å®ä¾‹ï¼Œå°±æ˜¯ä¸‹å›¾æ‰€ç¤ºçš„è¿™ä¸ªï¼Œè¯¦ç»†çš„é˜è¿°äº†`æ¨¡æ¿ â†’ æ¸²æŸ“å‡½æ•° â†’ è™šæ‹ŸDOMæ ‘ â†’ çœŸå®DOM`çš„ä¸€ä¸ªè¿‡ç¨‹\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6ixs748iqj30yg06emxd.jpg)\n\n## Virtual DOM ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\n\n**è™šæ‹Ÿ DOM çš„æœ€ç»ˆç›®æ ‡æ˜¯å°†è™šæ‹ŸèŠ‚ç‚¹æ¸²æŸ“åˆ°è§†å›¾ä¸Š**ã€‚ä½†æ˜¯å¦‚æœç›´æ¥ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹è¦†ç›–æ—§èŠ‚ç‚¹çš„è¯ï¼Œä¼šæœ‰å¾ˆå¤šä¸å¿…è¦çš„ DOM æ“ä½œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª ul æ ‡ç­¾ä¸‹å¾ˆå¤šä¸ª li æ ‡ç­¾ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ª li æœ‰å˜åŒ–ï¼Œè¿™ç§æƒ…å†µä¸‹å¦‚æœä½¿ç”¨æ–°çš„ ul å»æ›¿ä»£æ—§çš„ ul,å› ä¸ºè¿™äº›ä¸å¿…è¦çš„ DOM æ“ä½œè€Œé€ æˆäº†æ€§èƒ½ä¸Šçš„æµªè´¹ã€‚\n\nä¸ºäº†é¿å…ä¸å¿…è¦çš„ DOM æ“ä½œï¼Œè™šæ‹Ÿ DOM åœ¨è™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°è§†å›¾çš„è¿‡ç¨‹ä¸­ï¼Œå°†è™šæ‹ŸèŠ‚ç‚¹ä¸ä¸Šä¸€æ¬¡æ¸²æŸ“è§†å›¾æ‰€ä½¿ç”¨çš„æ—§è™šæ‹ŸèŠ‚ç‚¹ï¼ˆoldVnodeï¼‰åšå¯¹æ¯”ï¼Œæ‰¾å‡ºçœŸæ­£éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹æ¥è¿›è¡Œ DOM æ“ä½œï¼Œä»è€Œé¿å…æ“ä½œå…¶ä»–æ— éœ€æ”¹åŠ¨çš„ DOMã€‚\n\nå…¶å®è™šæ‹Ÿ DOM åœ¨ Vue.js ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š\n\n- æä¾›ä¸çœŸå® DOM èŠ‚ç‚¹æ‰€å¯¹åº”çš„è™šæ‹ŸèŠ‚ç‚¹ vnode\n- å°†è™šæ‹ŸèŠ‚ç‚¹ vnode å’Œæ—§è™šæ‹ŸèŠ‚ç‚¹ oldVnode è¿›è¡Œå¯¹æ¯”ï¼Œç„¶åæ›´æ–°è§†å›¾\n\n## ä¸ºä½•éœ€è¦ Virtual DOMï¼Ÿ\n\n- å…·å¤‡è·¨å¹³å°çš„ä¼˜åŠ¿\n\nç”±äº Virtual DOM æ˜¯ä»¥ JavaScript å¯¹è±¡ä¸ºåŸºç¡€è€Œä¸ä¾èµ–çœŸå®å¹³å°ç¯å¢ƒï¼Œæ‰€ä»¥ä½¿å®ƒå…·æœ‰äº†è·¨å¹³å°çš„èƒ½åŠ›ï¼Œæ¯”å¦‚è¯´æµè§ˆå™¨å¹³å°ã€Weexã€Node ç­‰ã€‚\n\n- æ“ä½œ DOM æ…¢ï¼Œjs è¿è¡Œæ•ˆç‡é«˜ã€‚æˆ‘ä»¬å¯ä»¥å°† DOM å¯¹æ¯”æ“ä½œæ”¾åœ¨ JS å±‚ï¼Œæé«˜æ•ˆç‡ã€‚\n\nå› ä¸º DOM æ“ä½œçš„æ‰§è¡Œé€Ÿåº¦è¿œä¸å¦‚ Javascript çš„è¿ç®—é€Ÿåº¦å¿«ï¼Œå› æ­¤ï¼ŒæŠŠå¤§é‡çš„ DOM æ“ä½œæ¬è¿åˆ° Javascript ä¸­ï¼Œè¿ç”¨ patching ç®—æ³•æ¥è®¡ç®—å‡ºçœŸæ­£éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘ DOM æ“ä½œï¼Œä»è€Œæ˜¾è‘—æé«˜æ€§èƒ½ã€‚\n\nVirtual DOM æœ¬è´¨ä¸Šå°±æ˜¯åœ¨ JS å’Œ DOM ä¹‹é—´åšäº†ä¸€ä¸ªç¼“å­˜ã€‚å¯ä»¥ç±»æ¯” CPU å’Œç¡¬ç›˜ï¼Œæ—¢ç„¶ç¡¬ç›˜è¿™ä¹ˆæ…¢ï¼Œæˆ‘ä»¬å°±åœ¨å®ƒä»¬ä¹‹é—´åŠ ä¸ªç¼“å­˜ï¼šæ—¢ç„¶ DOM è¿™ä¹ˆæ…¢ï¼Œæˆ‘ä»¬å°±åœ¨å®ƒä»¬ JS å’Œ DOM ä¹‹é—´åŠ ä¸ªç¼“å­˜ã€‚CPUï¼ˆJSï¼‰åªæ“ä½œå†…å­˜ï¼ˆVirtual DOMï¼‰ï¼Œæœ€åçš„æ—¶å€™å†æŠŠå˜æ›´å†™å…¥ç¡¬ç›˜ï¼ˆDOMï¼‰\n\n- æå‡æ¸²æŸ“æ€§èƒ½\n\nVirtual DOM çš„ä¼˜åŠ¿ä¸åœ¨äºå•æ¬¡çš„æ“ä½œï¼Œè€Œæ˜¯åœ¨å¤§é‡ã€é¢‘ç¹çš„æ•°æ®æ›´æ–°ä¸‹ï¼Œèƒ½å¤Ÿå¯¹è§†å›¾è¿›è¡Œåˆç†ã€é«˜æ•ˆçš„æ›´æ–°ã€‚\n\nä¸ºäº†å®ç°é«˜æ•ˆçš„ DOM æ“ä½œï¼Œä¸€å¥—é«˜æ•ˆçš„è™šæ‹Ÿ DOM diff ç®—æ³•æ˜¾å¾—å¾ˆæœ‰å¿…è¦ã€‚**æˆ‘ä»¬é€šè¿‡ patch çš„æ ¸å¿ƒ----diff ç®—æ³•ï¼Œæ‰¾å‡ºæœ¬æ¬¡ DOM éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹æ¥æ›´æ–°ï¼Œå…¶ä»–çš„ä¸æ›´æ–°**ã€‚\n\n## VNode\n\n### æŠ½è±¡ Dom æ ‘\n\næŠŠçœŸå® Dom æ ‘æŠ½è±¡æˆä¸€æ£µä»¥ javascript å¯¹è±¡æ„æˆçš„æŠ½è±¡æ ‘ï¼Œåœ¨ä¿®æ”¹æŠ½è±¡æ ‘æ•°æ®åå°†æŠ½è±¡æ ‘è½¬åŒ–æˆçœŸå® Dom é‡ç»˜åˆ°é¡µé¢ä¸Šå‘¢ï¼Ÿäºæ˜¯è™šæ‹Ÿ Dom å‡ºç°äº†ï¼Œå®ƒæ˜¯çœŸå® Dom çš„ä¸€å±‚æŠ½è±¡ï¼Œç”¨å±æ€§æè¿°çœŸå® Dom çš„å„ä¸ªç‰¹æ€§ã€‚å½“å®ƒå‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå°±ä¼šå»ä¿®æ”¹è§†å›¾ã€‚\n\nä½†æ˜¯è¿™æ ·çš„ javascript æ“ä½œ Dom è¿›è¡Œé‡ç»˜æ•´ä¸ªè§†å›¾å±‚æ˜¯ç›¸å½“æ¶ˆè€—æ€§èƒ½çš„ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æ¯æ¬¡åªæ›´æ–°å®ƒçš„ä¿®æ”¹å‘¢ï¼Ÿæ‰€ä»¥ Vue.js å°† Dom æŠ½è±¡æˆä¸€ä¸ªä»¥ javascript å¯¹è±¡ä¸ºèŠ‚ç‚¹çš„è™šæ‹Ÿ Dom æ ‘ï¼Œä»¥ VNode èŠ‚ç‚¹æ¨¡æ‹ŸçœŸå® Domï¼Œå¯ä»¥å¯¹è¿™é¢—æŠ½è±¡æ ‘è¿›è¡Œåˆ›å»ºèŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ä»¥åŠä¿®æ”¹èŠ‚ç‚¹ç­‰æ“ä½œï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­éƒ½ä¸éœ€è¦æ“ä½œçœŸå® Domï¼Œåªéœ€è¦æ“ä½œ javascript å¯¹è±¡ï¼Œå¤§å¤§æå‡äº†æ€§èƒ½ã€‚ä¿®æ”¹ä»¥åç»è¿‡ diff ç®—æ³•å¾—å‡ºä¸€äº›éœ€è¦ä¿®æ”¹çš„æœ€å°å•ä½ï¼Œå†å°†è¿™äº›å°å•ä½çš„è§†å›¾è¿›è¡Œæ›´æ–°ã€‚è¿™æ ·åšå‡å°‘äº†å¾ˆå¤šä¸éœ€è¦çš„ Dom æ“ä½œï¼Œå¤§å¤§æé«˜äº†æ€§èƒ½ã€‚\n\nVue å°±ä½¿ç”¨äº†è¿™æ ·çš„æŠ½è±¡èŠ‚ç‚¹ VNodeï¼Œå®ƒæ˜¯å¯¹çœŸå® Dom çš„ä¸€å±‚æŠ½è±¡ï¼Œè€Œä¸ä¾èµ–æŸä¸ªå¹³å°ï¼Œå®ƒå¯ä»¥æ˜¯æµè§ˆå™¨å¹³å°ï¼Œä¹Ÿå¯ä»¥æ˜¯ weexï¼Œç”šè‡³æ˜¯ node å¹³å°ä¹Ÿå¯ä»¥å¯¹è¿™æ ·ä¸€æ£µæŠ½è±¡ Dom æ ‘è¿›è¡Œåˆ›å»ºåˆ é™¤ä¿®æ”¹ç­‰æ“ä½œï¼Œè¿™ä¹Ÿä¸ºå‰åç«¯åŒæ„æä¾›äº†å¯èƒ½ã€‚\n\n### VNode åŸºç±»\n\nå…ˆæ¥çœ‹ä¸€ä¸‹ Vue.js æºç ä¸­å¯¹ VNode ç±»çš„å®šä¹‰ã€‚\n\n```javascript\nexport default class VNode {\n  tag: string | void;\n  data: VNodeData | void;\n  children: ?Array<VNode>;\n  text: string | void;\n  elm: Node | void;\n  ns: string | void;\n  context: Component | void; // rendered in this component's scope\n  functionalContext: Component | void; // only for functional component root nodes\n  key: string | number | void;\n  componentOptions: VNodeComponentOptions | void;\n  componentInstance: Component | void; // component instance\n  parent: VNode | void; // component placeholder node\n  raw: boolean; // contains raw HTML? (server only)\n  isStatic: boolean; // hoisted static node\n  isRootInsert: boolean; // necessary for enter transition check\n  isComment: boolean; // empty comment placeholder?\n  isCloned: boolean; // is a cloned node?\n  isOnce: boolean; // is a v-once node?\n\n  constructor(\n    tag?: string,\n    data?: VNodeData,\n    children?: ?Array<VNode>,\n    text?: string,\n    elm?: Node,\n    context?: Component,\n    componentOptions?: VNodeComponentOptions\n  ) {\n    /*å½“å‰èŠ‚ç‚¹çš„æ ‡ç­¾å*/\n    this.tag = tag;\n    /*å½“å‰èŠ‚ç‚¹å¯¹åº”çš„å¯¹è±¡ï¼ŒåŒ…å«äº†å…·ä½“çš„ä¸€äº›æ•°æ®ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªVNodeDataç±»å‹ï¼Œå¯ä»¥å‚è€ƒVNodeDataç±»å‹ä¸­çš„æ•°æ®ä¿¡æ¯*/\n    this.data = data;\n    /*å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„*/\n    this.children = children;\n    /*å½“å‰èŠ‚ç‚¹çš„æ–‡æœ¬*/\n    this.text = text;\n    /*å½“å‰è™šæ‹ŸèŠ‚ç‚¹å¯¹åº”çš„çœŸå®domèŠ‚ç‚¹*/\n    this.elm = elm;\n    /*å½“å‰èŠ‚ç‚¹çš„åå­—ç©ºé—´*/\n    this.ns = undefined;\n    /*ç¼–è¯‘ä½œç”¨åŸŸ*/\n    this.context = context;\n    /*å‡½æ•°åŒ–ç»„ä»¶ä½œç”¨åŸŸ*/\n    this.functionalContext = undefined;\n    /*èŠ‚ç‚¹çš„keyå±æ€§ï¼Œè¢«å½“ä½œèŠ‚ç‚¹çš„æ ‡å¿—ï¼Œç”¨ä»¥ä¼˜åŒ–*/\n    this.key = data && data.key;\n    /*ç»„ä»¶çš„optioné€‰é¡¹*/\n    this.componentOptions = componentOptions;\n    /*å½“å‰èŠ‚ç‚¹å¯¹åº”çš„ç»„ä»¶çš„å®ä¾‹*/\n    this.componentInstance = undefined;\n    /*å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹*/\n    this.parent = undefined;\n    /*ç®€è€Œè¨€ä¹‹å°±æ˜¯æ˜¯å¦ä¸ºåŸç”ŸHTMLæˆ–åªæ˜¯æ™®é€šæ–‡æœ¬ï¼ŒinnerHTMLçš„æ—¶å€™ä¸ºtrueï¼ŒtextContentçš„æ—¶å€™ä¸ºfalse*/\n    this.raw = false;\n    /*é™æ€èŠ‚ç‚¹æ ‡å¿—*/\n    this.isStatic = false;\n    /*æ˜¯å¦ä½œä¸ºè·ŸèŠ‚ç‚¹æ’å…¥*/\n    this.isRootInsert = true;\n    /*æ˜¯å¦ä¸ºæ³¨é‡ŠèŠ‚ç‚¹*/\n    this.isComment = false;\n    /*æ˜¯å¦ä¸ºå…‹éš†èŠ‚ç‚¹*/\n    this.isCloned = false;\n    /*æ˜¯å¦æœ‰v-onceæŒ‡ä»¤*/\n    this.isOnce = false;\n  }\n\n  // DEPRECATED: alias for componentInstance for backwards compat.\n  /* istanbul ignore next https://github.com/answershuto/learnVue*/\n  get child(): Component | void {\n    return this.componentInstance;\n  }\n}\n```\n\nè¿™æ˜¯ä¸€ä¸ªæœ€åŸºç¡€çš„ VNode èŠ‚ç‚¹ï¼Œä½œä¸ºå…¶ä»–æ´¾ç”Ÿ VNode ç±»çš„åŸºç±»ï¼Œé‡Œé¢å®šä¹‰äº†ä¸‹é¢è¿™äº›æ•°æ®ã€‚\n\n- tag: å½“å‰èŠ‚ç‚¹çš„æ ‡ç­¾å\n- data: å½“å‰èŠ‚ç‚¹å¯¹åº”çš„å¯¹è±¡ï¼ŒåŒ…å«äº†å…·ä½“çš„ä¸€äº›æ•°æ®ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ª VNodeData ç±»å‹ï¼Œå¯ä»¥å‚è€ƒ VNodeData ç±»å‹ä¸­çš„æ•°æ®ä¿¡æ¯\n- children: å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„\n- text: å½“å‰èŠ‚ç‚¹çš„æ–‡æœ¬\n- elm: å½“å‰è™šæ‹ŸèŠ‚ç‚¹å¯¹åº”çš„çœŸå® dom èŠ‚ç‚¹\n- ns: å½“å‰èŠ‚ç‚¹çš„åå­—ç©ºé—´\n- context: å½“å‰èŠ‚ç‚¹çš„ç¼–è¯‘ä½œç”¨åŸŸ\n- functionalContext: å‡½æ•°åŒ–ç»„ä»¶ä½œç”¨åŸŸ\n- key: èŠ‚ç‚¹çš„ key å±æ€§ï¼Œè¢«å½“ä½œèŠ‚ç‚¹çš„æ ‡å¿—ï¼Œç”¨ä»¥ä¼˜åŒ–\n- componentOptions: ç»„ä»¶çš„ option é€‰é¡¹\n- componentInstance: å½“å‰èŠ‚ç‚¹å¯¹åº”çš„ç»„ä»¶çš„å®ä¾‹\n- parent: å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹\n- raw: ç®€è€Œè¨€ä¹‹å°±æ˜¯æ˜¯å¦ä¸ºåŸç”Ÿ HTML æˆ–åªæ˜¯æ™®é€šæ–‡æœ¬ï¼ŒinnerHTML çš„æ—¶å€™ä¸º trueï¼ŒtextContent çš„æ—¶å€™ä¸º false\n- isStatic: æ˜¯å¦ä¸ºé™æ€èŠ‚ç‚¹\n- isRootInsert: æ˜¯å¦ä½œä¸ºè·ŸèŠ‚ç‚¹æ’å…¥\n- isComment: æ˜¯å¦ä¸ºæ³¨é‡ŠèŠ‚ç‚¹\n- isCloned: æ˜¯å¦ä¸ºå…‹éš†èŠ‚ç‚¹\n- isOnce: æ˜¯å¦æœ‰ v-once æŒ‡ä»¤\n\næ‰“ä¸ªæ¯”æ–¹ï¼Œæ¯”å¦‚è¯´æˆ‘ç°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ª VNode æ ‘\n\n```json\n{\n    tag: 'div'\n    data: {\n        class: 'test'\n    },\n    children: [\n        {\n            tag: 'span',\n            data: {\n                class: 'demo'\n            }\n            text: 'hello,VNode'\n        }\n    ]\n}\n```\n\næ¸²æŸ“ä¹‹åçš„ç»“æœå°±æ˜¯è¿™æ ·çš„\n\n```html\n<div class=\"test\">\n  <span class=\"demo\">hello,VNode</span>\n</div>\n```\n\n### ç”Ÿæˆä¸€ä¸ªæ–°çš„ VNode çš„æ–¹æ³•\n\nä¸‹é¢è¿™äº›æ–¹æ³•éƒ½æ˜¯ä¸€äº›å¸¸ç”¨çš„æ„é€  VNode çš„æ–¹æ³•ã€‚\n\n- **createEmptyVNode åˆ›å»ºä¸€ä¸ªç©º VNode èŠ‚ç‚¹**\n\n```javascript\n/*åˆ›å»ºä¸€ä¸ªç©ºVNodeèŠ‚ç‚¹*/\nexport const createEmptyVNode = () => {\n  const node = new VNode();\n  node.text = \"\";\n  node.isComment = true;\n  return node;\n};\n```\n\n- **createTextVNode åˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹**\n\n```javascript\n/*åˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹*/\nexport function createTextVNode(val: string | number) {\n  return new VNode(undefined, undefined, undefined, String(val));\n}\n```\n\n- **createComponent åˆ›å»ºä¸€ä¸ªç»„ä»¶èŠ‚ç‚¹**\n\n```javascript\n // plain options object: turn it into a constructor https://github.com/answershuto/learnVue\n  if (isObject(Ctor)) {\n    Ctor = baseCtor.extend(Ctor)\n  }\n\n  // if at this stage it's not a constructor or an async component factory,\n  // reject.\n  /*Github:https://github.com/answershuto*/\n  /*å¦‚æœåœ¨è¯¥é˜¶æ®µCtorä¾ç„¶ä¸æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°æˆ–è€…æ˜¯ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶å·¥å‚åˆ™ç›´æ¥è¿”å›*/\n  if (typeof Ctor !== 'function') {\n    if (process.env.NODE_ENV !== 'production') {\n      warn(`Invalid Component definition: ${String(Ctor)}`, context)\n    }\n    return\n  }\n\n  // async component\n  /*å¤„ç†å¼‚æ­¥ç»„ä»¶*/\n  if (isUndef(Ctor.cid)) {\n    Ctor = resolveAsyncComponent(Ctor, baseCtor, context)\n    if (Ctor === undefined) {\n      // return nothing if this is indeed an async component\n      // wait for the callback to trigger parent update.\n      /*å¦‚æœè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶åˆ™ä¼šä¸ä¼šè¿”å›ä»»ä½•ä¸œè¥¿ï¼ˆundifienedï¼‰ï¼Œç›´æ¥returnæ‰ï¼Œç­‰å¾…å›è°ƒå‡½æ•°å»è§¦å‘çˆ¶ç»„ä»¶æ›´æ–°ã€‚s*/\n      return\n    }\n  }\n\n  // resolve constructor options in case global mixins are applied after\n  // component constructor creation\n  resolveConstructorOptions(Ctor)\n\n  data = data || {}\n\n  // transform component v-model data into props & events\n  if (isDef(data.model)) {\n    transformModel(Ctor.options, data)\n  }\n\n  // extract props\n  const propsData = extractPropsFromVNodeData(data, Ctor, tag)\n\n  // functional component\n  if (isTrue(Ctor.options.functional)) {\n    return createFunctionalComponent(Ctor, propsData, data, context, children)\n  }\n\n  // extract listeners, since these needs to be treated as\n  // child component listeners instead of DOM listeners\n  const listeners = data.on\n  // replace with listeners with .native modifier\n  data.on = data.nativeOn\n\n  if (isTrue(Ctor.options.abstract)) {\n    // abstract components do not keep anything\n    // other than props & listeners\n    data = {}\n  }\n\n  // merge component management hooks onto the placeholder node\n  mergeHooks(data)\n\n  // return a placeholder vnode\n  const name = Ctor.options.name || tag\n  const vnode = new VNode(\n    `vue-component-${Ctor.cid}${name ? `-${name}` : ''}`,\n    data, undefined, undefined, undefined, context,\n    { Ctor, propsData, listeners, tag, children }\n  )\n  return vnode\n}\n```\n\n- **cloneVNode å…‹éš†ä¸€ä¸ª VNode èŠ‚ç‚¹**\n\n```javascript\nexport function cloneVNode(vnode: VNode): VNode {\n  const cloned = new VNode(\n    vnode.tag,\n    vnode.data,\n    vnode.children,\n    vnode.text,\n    vnode.elm,\n    vnode.context,\n    vnode.componentOptions\n  );\n  cloned.ns = vnode.ns;\n  cloned.isStatic = vnode.isStatic;\n  cloned.key = vnode.key;\n  cloned.isCloned = true;\n  return cloned;\n}\n```\n\n### createElement\n\ncreateElement ç”¨æ¥åˆ›å»ºä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ã€‚å½“ data ä¸Šå·²ç»ç»‘å®š**ob**çš„æ—¶å€™ï¼Œä»£è¡¨è¯¥å¯¹è±¡å·²ç»è¢« Oberver è¿‡äº†ï¼Œæ‰€ä»¥åˆ›å»ºä¸€ä¸ªç©ºèŠ‚ç‚¹ã€‚tag ä¸å­˜åœ¨çš„æ—¶å€™åŒæ ·åˆ›å»ºä¸€ä¸ªç©ºèŠ‚ç‚¹ã€‚å½“ tag ä¸æ˜¯ä¸€ä¸ª String ç±»å‹çš„æ—¶å€™ä»£è¡¨ tag æ˜¯ä¸€ä¸ªç»„ä»¶çš„æ„é€ ç±»ï¼Œç›´æ¥ç”¨ new VNode åˆ›å»ºã€‚å½“ tag æ˜¯ String ç±»å‹çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯ä¿ç•™æ ‡ç­¾ï¼Œåˆ™ç”¨ new VNode åˆ›å»ºä¸€ä¸ª VNode å®ä¾‹ï¼Œå¦‚æœåœ¨ vm çš„ option çš„ components æ‰¾å¾—åˆ°è¯¥ tagï¼Œä»£è¡¨è¿™æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå¦åˆ™ç»Ÿä¸€ç”¨ new VNode åˆ›å»ºã€‚\n\n```javascript\n// wrapper function for providing a more flexible interface\n// without getting yelled at by flow\nexport function createElement(\n  context: Component,\n  tag: any,\n  data: any,\n  children: any,\n  normalizationType: any,\n  alwaysNormalize: boolean\n): VNode {\n  /*å…¼å®¹ä¸ä¼ dataçš„æƒ…å†µ*/\n  if (Array.isArray(data) || isPrimitive(data)) {\n    normalizationType = children;\n    children = data;\n    data = undefined;\n  }\n  /*å¦‚æœalwaysNormalizeä¸ºtrueï¼Œåˆ™normalizationTypeæ ‡è®°ä¸ºALWAYS_NORMALIZE*/\n  if (isTrue(alwaysNormalize)) {\n    normalizationType = ALWAYS_NORMALIZE;\n  }\n  /*Github:https://github.com/answershuto*/\n  /*åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹*/\n  return _createElement(context, tag, data, children, normalizationType);\n}\n\n/*åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹*/\nexport function _createElement(\n  context: Component,\n  tag?: string | Class<Component> | Function | Object,\n  data?: VNodeData,\n  children?: any,\n  normalizationType?: number\n): VNode {\n  /*\n    å¦‚æœdataæœªå®šä¹‰ï¼ˆundefinedæˆ–è€…nullï¼‰æˆ–è€…æ˜¯dataçš„__ob__å·²ç»å®šä¹‰ï¼ˆä»£è¡¨å·²ç»è¢«observedï¼Œä¸Šé¢ç»‘å®šäº†Oberverå¯¹è±¡ï¼‰ï¼Œ\n    https://cn.vuejs.org/v2/guide/render-function.html#çº¦æŸ\n    é‚£ä¹ˆåˆ›å»ºä¸€ä¸ªç©ºèŠ‚ç‚¹\n  */\n  if (isDef(data) && isDef((data: any).__ob__)) {\n    process.env.NODE_ENV !== \"production\" &&\n      warn(\n        `Avoid using observed data object as vnode data: ${JSON.stringify(\n          data\n        )}\\n` + \"Always create fresh vnode data objects in each render!\",\n        context\n      );\n    return createEmptyVNode();\n  }\n  /*å¦‚æœtagä¸å­˜åœ¨ä¹Ÿæ˜¯åˆ›å»ºä¸€ä¸ªç©ºèŠ‚ç‚¹*/\n  if (!tag) {\n    // in case of component :is set to falsy value\n    return createEmptyVNode();\n  }\n  // support single function children as default scoped slot\n  /*é»˜è®¤é»˜è®¤ä½œç”¨åŸŸæ’æ§½*/\n  if (Array.isArray(children) && typeof children[0] === \"function\") {\n    data = data || {};\n    data.scopedSlots = { default: children[0] };\n    children.length = 0;\n  }\n  if (normalizationType === ALWAYS_NORMALIZE) {\n    children = normalizeChildren(children);\n  } else if (normalizationType === SIMPLE_NORMALIZE) {\n    children = simpleNormalizeChildren(children);\n  }\n  let vnode, ns;\n  if (typeof tag === \"string\") {\n    let Ctor;\n    /*è·å–tagçš„åå­—ç©ºé—´*/\n    ns = config.getTagNamespace(tag);\n    /*åˆ¤æ–­æ˜¯å¦æ˜¯ä¿ç•™çš„æ ‡ç­¾*/\n    if (config.isReservedTag(tag)) {\n      // platform built-in elements\n      /*å¦‚æœæ˜¯ä¿ç•™çš„æ ‡ç­¾åˆ™åˆ›å»ºä¸€ä¸ªç›¸åº”èŠ‚ç‚¹*/\n      vnode = new VNode(\n        config.parsePlatformTagName(tag),\n        data,\n        children,\n        undefined,\n        undefined,\n        context\n      );\n    } else if (\n      isDef((Ctor = resolveAsset(context.$options, \"components\", tag)))\n    ) {\n      // component\n      /*ä»vmå®ä¾‹çš„optionçš„componentsä¸­å¯»æ‰¾è¯¥tagï¼Œå­˜åœ¨åˆ™å°±æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œåˆ›å»ºç›¸åº”èŠ‚ç‚¹ï¼ŒCtorä¸ºç»„ä»¶çš„æ„é€ ç±»*/\n      vnode = createComponent(Ctor, data, context, children, tag);\n    } else {\n      // unknown or unlisted namespaced elements\n      // check at runtime because it may get assigned a namespace when its\n      // parent normalizes children\n      /*æœªçŸ¥çš„å…ƒç´ ï¼Œåœ¨è¿è¡Œæ—¶æ£€æŸ¥ï¼Œå› ä¸ºçˆ¶ç»„ä»¶å¯èƒ½åœ¨åºåˆ—åŒ–å­ç»„ä»¶çš„æ—¶å€™åˆ†é…ä¸€ä¸ªåå­—ç©ºé—´*/\n      vnode = new VNode(tag, data, children, undefined, undefined, context);\n    }\n  } else {\n    // direct component options / constructor\n    /*tagä¸æ˜¯å­—ç¬¦ä¸²çš„æ—¶å€™åˆ™æ˜¯ç»„ä»¶çš„æ„é€ ç±»*/\n    vnode = createComponent(tag, data, context, children);\n  }\n  if (isDef(vnode)) {\n    /*å¦‚æœæœ‰åå­—ç©ºé—´ï¼Œåˆ™é€’å½’æ‰€æœ‰å­èŠ‚ç‚¹åº”ç”¨è¯¥åå­—ç©ºé—´*/\n    if (ns) applyNS(vnode, ns);\n    return vnode;\n  } else {\n    /*å¦‚æœvnodeæ²¡æœ‰æˆåŠŸåˆ›å»ºåˆ™åˆ›å»ºç©ºèŠ‚ç‚¹*/\n    return createEmptyVNode();\n  }\n}\n```\n\n## diff æ¦‚è§£\n\n### 1.å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œvue æ˜¯æ€ä¹ˆæ›´æ–°èŠ‚ç‚¹çš„ï¼Ÿ\n\nå‘¨æ‰€å‘¨çŸ¥ï¼ŒVue é€šè¿‡æ•°æ®ç»‘å®šæ¥ä¿®æ”¹è§†å›¾ï¼Œå½“æŸä¸ªæ•°æ®è¢«ä¿®æ”¹çš„æ—¶å€™ï¼Œset æ–¹æ³•ä¼šè®©é—­åŒ…ä¸­çš„ Dep è°ƒç”¨ notify é€šçŸ¥æ‰€æœ‰è®¢é˜…è€… Watcherï¼ŒWatcher é€šè¿‡ get æ–¹æ³•æ‰§è¡Œ vm.\\_update(vm.\\_render(), hydrating)ã€‚\n\nè¿™é‡Œçœ‹ä¸€ä¸‹\\_update æ–¹æ³•\n\n```javascript\nVue.prototype._update = function (vnode: VNode, hydrating?: boolean) {\n    const vm: Component = this\n    /*å¦‚æœå·²ç»è¯¥ç»„ä»¶å·²ç»æŒ‚è½½è¿‡äº†åˆ™ä»£è¡¨è¿›å…¥è¿™ä¸ªæ­¥éª¤æ˜¯ä¸ªæ›´æ–°çš„è¿‡ç¨‹ï¼Œè§¦å‘beforeUpdateé’©å­*/\n    if (vm._isMounted) {\n      callHook(vm, 'beforeUpdate')\n    }\n    const prevEl = vm.$el\n    const prevVnode = vm._vnode\n    const prevActiveInstance = activeInstance\n    activeInstance = vm\n    vm._vnode = vnode\n    // Vue.prototype.__patch__ is injected in entry points\n    // based on the rendering backend used.\n    /*åŸºäºåç«¯æ¸²æŸ“Vue.prototype.__patch__è¢«ç”¨æ¥ä½œä¸ºä¸€ä¸ªå…¥å£*/\n    if (!prevVnode) {\n      // initial render\n      vm.$el = vm.__patch__(\n        vm.$el, vnode, hydrating, false /* removeOnly */,\n        vm.$options._parentElm,\n        vm.$options._refElm\n      )\n    } else {\n      // updates\n      vm.$el = vm.__patch__(prevVnode, vnode)\n    }\n    activeInstance = prevActiveInstance\n    // update __vue__ reference\n    /*æ›´æ–°æ–°çš„å®ä¾‹å¯¹è±¡çš„__vue__*/\n    if (prevEl) {\n      prevEl.__vue__ = null\n    }\n    if (vm.$el) {\n      vm.$el.__vue__ = vm\n    }\n    // if parent is an HOC, update its $el as well\n    if (vm.$vnode && vm.$parent && vm.$vnode === vm.$parent._vnode) {\n      vm.$parent.$el = vm.$el\n    }\n    // updated hook is called by the scheduler to ensure that children are\n    // updated in a parent's updated hook.\n  }å¤åˆ¶ä»£ç \n```\n\n\\_update æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª VNode å¯¹è±¡ï¼Œåœ¨å†…éƒ¨ä¼šå°†è¯¥ VNode å¯¹è±¡ä¸ä¹‹å‰æ—§çš„ VNode å¯¹è±¡è¿›è¡Œ**patch**ã€‚\n\nè¦çŸ¥é“æ¸²æŸ“çœŸå® DOM çš„å¼€é”€æ˜¯å¾ˆå¤§çš„ï¼Œæ¯”å¦‚æœ‰æ—¶å€™æˆ‘ä»¬ä¿®æ”¹äº†æŸä¸ªæ•°æ®ï¼Œå¦‚æœç›´æ¥æ¸²æŸ“åˆ°çœŸå® dom ä¸Šä¼šå¼•èµ·æ•´ä¸ª dom æ ‘çš„é‡ç»˜å’Œé‡æ’ï¼Œæœ‰æ²¡æœ‰å¯èƒ½æˆ‘ä»¬åªæ›´æ–°æˆ‘ä»¬ä¿®æ”¹çš„é‚£ä¸€å°å— dom è€Œä¸è¦æ›´æ–°æ•´ä¸ª dom å‘¢ï¼Ÿdiff ç®—æ³•èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ã€‚\n\næˆ‘ä»¬å…ˆæ ¹æ®çœŸå® DOM ç”Ÿæˆä¸€é¢—`virtual DOM`ï¼Œå½“`virtual DOM`æŸä¸ªèŠ‚ç‚¹çš„æ•°æ®æ”¹å˜åä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„`Vnode`ï¼Œç„¶å`Vnode`å’Œ`oldVnode`ä½œå¯¹æ¯”ï¼Œå‘ç°æœ‰ä¸ä¸€æ ·çš„åœ°æ–¹å°±ç›´æ¥ä¿®æ”¹åœ¨çœŸå®çš„ DOM ä¸Šï¼Œç„¶åä½¿`oldVnode`çš„å€¼ä¸º`Vnode`ã€‚\n\ndiff çš„è¿‡ç¨‹å°±æ˜¯è°ƒç”¨åä¸º`patch`çš„å‡½æ•°ï¼Œæ¯”è¾ƒæ–°æ—§èŠ‚ç‚¹ï¼Œä¸€è¾¹æ¯”è¾ƒä¸€è¾¹ç»™**çœŸå®çš„ DOM**æ‰“è¡¥ä¸ã€‚\n\n### 2. virtual DOM å’ŒçœŸå® DOM çš„åŒºåˆ«ï¼Ÿ\n\nè™šæ‹Ÿ dom å¯¹åº”çš„æ˜¯çœŸå® domï¼Œ ä½¿ç”¨`document.CreateElement` å’Œ `document.CreateTextNode`åˆ›å»ºçš„å°±æ˜¯çœŸå®èŠ‚ç‚¹ã€‚\n\nvirtual DOM æ˜¯å°†çœŸå®çš„ DOM çš„æ•°æ®æŠ½å–å‡ºæ¥ï¼Œä»¥å¯¹è±¡çš„å½¢å¼æ¨¡æ‹Ÿæ ‘å½¢ç»“æ„ã€‚æ¯”å¦‚ dom æ˜¯è¿™æ ·çš„ï¼š\n\n```html\n<div>\n  <p>123</p>\n</div>\n```\n\nå¯¹åº”çš„ virtual DOMï¼ˆä¼ªä»£ç ï¼‰ï¼š\n\n```javascript\nvar Vnode = {\n  tag: \"div\",\n  children: [{ tag: \"p\", text: \"123\" }]\n};\n```\n\n**ï¼ˆæ¸©é¦¨æç¤ºï¼š`VNode`å’Œ`oldVNode`éƒ½æ˜¯å¯¹è±¡ï¼Œä¸€å®šè¦è®°ä½ï¼‰**\n\n**virtual dom å¾ˆå¤šæ—¶å€™éƒ½ä¸æ˜¯æœ€ä¼˜çš„æ“ä½œï¼Œä½†å®ƒå…·æœ‰æ™®é€‚æ€§ï¼Œåœ¨æ•ˆç‡ã€å¯ç»´æŠ¤æ€§ä¹‹é—´è¾¾å¹³è¡¡ã€‚**\n\n### 3. diff çš„æ¯”è¾ƒæ–¹å¼ï¼Ÿ\n\nåœ¨é‡‡å– diff ç®—æ³•æ¯”è¾ƒæ–°æ—§èŠ‚ç‚¹çš„æ—¶å€™ï¼Œæ¯”è¾ƒåªä¼šåœ¨åŒå±‚çº§è¿›è¡Œ, ä¸ä¼šè·¨å±‚çº§æ¯”è¾ƒã€‚\n\n```javascript\n<div>\n    <p>123</p>\n</div>\n\n<div>\n    <span>456</span>\n</div>\n```\n\nä¸Šé¢çš„ä»£ç ä¼šåˆ†åˆ«æ¯”è¾ƒåŒä¸€å±‚çš„ä¸¤ä¸ª div ä»¥åŠç¬¬äºŒå±‚çš„ p å’Œ spanï¼Œä½†æ˜¯ä¸ä¼šæ‹¿ div å’Œ span ä½œæ¯”è¾ƒã€‚åœ¨åˆ«å¤„çœ‹åˆ°çš„ä¸€å¼ å¾ˆå½¢è±¡çš„å›¾ï¼š\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6ixvc151vj30ah05j3yl.jpg)\n\n## diff æµç¨‹å›¾\n\nå½“æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œset æ–¹æ³•ä¼šè®©è°ƒç”¨`Dep.notify`é€šçŸ¥æ‰€æœ‰è®¢é˜…è€… Watcherï¼Œè®¢é˜…è€…å°±ä¼šè°ƒç”¨`patch`ç»™çœŸå®çš„ DOM æ‰“è¡¥ä¸ï¼Œæ›´æ–°ç›¸åº”çš„è§†å›¾ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy0rlxm3j310c0syq4w.jpg)\n\ndiff ç®—æ³•åŒ…æ‹¬å‡ ä¸ªæ­¥éª¤ï¼š\n\n- ç”¨ JavaScript å¯¹è±¡ç»“æ„è¡¨ç¤º DOM æ ‘çš„ç»“æ„ï¼›ç„¶åç”¨è¿™ä¸ªæ ‘æ„å»ºä¸€ä¸ªçœŸæ­£çš„ DOM æ ‘ï¼Œæ’åˆ°æ–‡æ¡£å½“ä¸­\n- å½“çŠ¶æ€å˜æ›´çš„æ—¶å€™ï¼Œé‡æ–°æ„é€ ä¸€æ£µæ–°çš„å¯¹è±¡æ ‘ã€‚ç„¶åç”¨æ–°çš„æ ‘å’Œæ—§çš„æ ‘è¿›è¡Œæ¯”è¾ƒï¼Œè®°å½•ä¸¤æ£µæ ‘å·®å¼‚\n- æŠŠæ‰€è®°å½•çš„å·®å¼‚åº”ç”¨åˆ°æ‰€æ„å»ºçš„çœŸæ­£çš„ DOM æ ‘ä¸Šï¼Œè§†å›¾å°±æ›´æ–°äº†\n\n## diff ç®—æ³•å…·ä½“åˆ†æ\n\n### 1. patch\n\næ¥çœ‹çœ‹`patch`æ˜¯æ€ä¹ˆæ‰“è¡¥ä¸çš„ï¼ˆä»£ç åªä¿ç•™æ ¸å¿ƒéƒ¨åˆ†ï¼‰\n\n```javascript\nfunction patch(oldVnode, vnode) {\n  // some code\n  if (sameVnode(oldVnode, vnode)) {\n    patchVnode(oldVnode, vnode);\n  } else {\n    const oEl = oldVnode.el; // å½“å‰oldVnodeå¯¹åº”çš„çœŸå®å…ƒç´ èŠ‚ç‚¹\n    let parentEle = api.parentNode(oEl); // çˆ¶å…ƒç´ \n    createEle(vnode); // æ ¹æ®Vnodeç”Ÿæˆæ–°å…ƒç´ \n    if (parentEle !== null) {\n      api.insertBefore(parentEle, vnode.el, api.nextSibling(oEl)); // å°†æ–°å…ƒç´ æ·»åŠ è¿›çˆ¶å…ƒç´ \n      api.removeChild(parentEle, oldVnode.el); // ç§»é™¤ä»¥å‰çš„æ—§å…ƒç´ èŠ‚ç‚¹\n      oldVnode = null;\n    }\n  }\n  // some code\n  return vnode;\n}\nå¤åˆ¶ä»£ç ;\n```\n\npatch å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°`oldVnode`å’Œ`Vnode`åˆ†åˆ«ä»£è¡¨æ–°çš„èŠ‚ç‚¹å’Œä¹‹å‰çš„æ—§èŠ‚ç‚¹\n\n- åˆ¤æ–­ä¸¤èŠ‚ç‚¹æ˜¯å¦å€¼å¾—æ¯”è¾ƒï¼Œå€¼å¾—æ¯”è¾ƒåˆ™æ‰§è¡Œ`patchVnode`\n\n```javascript\nfunction sameVnode(a, b) {\n  return (\n    a.key === b.key && // keyå€¼\n    a.tag === b.tag && // æ ‡ç­¾å\n    a.isComment === b.isComment && // æ˜¯å¦ä¸ºæ³¨é‡ŠèŠ‚ç‚¹\n    // æ˜¯å¦éƒ½å®šä¹‰äº†dataï¼ŒdataåŒ…å«ä¸€äº›å…·ä½“ä¿¡æ¯ï¼Œä¾‹å¦‚onclick , style\n    isDef(a.data) === isDef(b.data) &&\n    sameInputType(a, b) // å½“æ ‡ç­¾æ˜¯<input>çš„æ—¶å€™ï¼Œtypeå¿…é¡»ç›¸åŒ\n  );\n}\nå¤åˆ¶ä»£ç ;\n```\n\n- ä¸å€¼å¾—æ¯”è¾ƒåˆ™ç”¨`Vnode`æ›¿æ¢`oldVnode`\n\nå¦‚æœä¸¤ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå°±æ·±å…¥æ£€æŸ¥ä»–ä»¬çš„å­èŠ‚ç‚¹ã€‚å¦‚æœä¸¤ä¸ªèŠ‚ç‚¹ä¸ä¸€æ ·é‚£å°±è¯´æ˜`Vnode`å®Œå…¨è¢«æ”¹å˜äº†ï¼Œå°±å¯ä»¥ç›´æ¥æ›¿æ¢`oldVnode`ã€‚\n\nè™½ç„¶è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¸ä¸€æ ·ä½†æ˜¯ä»–ä»¬çš„å­èŠ‚ç‚¹ä¸€æ ·æ€ä¹ˆåŠï¼Ÿåˆ«å¿˜äº†ï¼Œdiff å¯æ˜¯é€å±‚æ¯”è¾ƒçš„ï¼Œå¦‚æœç¬¬ä¸€å±‚ä¸ä¸€æ ·é‚£ä¹ˆå°±ä¸ä¼šç»§ç»­æ·±å…¥æ¯”è¾ƒç¬¬äºŒå±‚äº†ã€‚ï¼ˆæˆ‘åœ¨æƒ³è¿™ç®—æ˜¯ä¸€ä¸ªç¼ºç‚¹å—ï¼Ÿç›¸åŒå­èŠ‚ç‚¹ä¸èƒ½é‡å¤åˆ©ç”¨äº†...ï¼‰\n\n### 2. patchVnode\n\nå½“æˆ‘ä»¬ç¡®å®šä¸¤ä¸ªèŠ‚ç‚¹å€¼å¾—æ¯”è¾ƒä¹‹åæˆ‘ä»¬ä¼šå¯¹ä¸¤ä¸ªèŠ‚ç‚¹æŒ‡å®š`patchVnode`æ–¹æ³•ã€‚é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ\n\n```javascript\npatchVnode (oldVnode, vnode) {\n    const el = vnode.el = oldVnode.el\n    let i, oldCh = oldVnode.children, ch = vnode.children\n    if (oldVnode === vnode) return\n    if (oldVnode.text !== null && vnode.text !== null && oldVnode.text !== vnode.text) {\n        api.setTextContent(el, vnode.text)\n    }else {\n        updateEle(el, vnode, oldVnode)\n    \tif (oldCh && ch && oldCh !== ch) {\n            updateChildren(el, oldCh, ch)\n    \t}else if (ch){\n            createEle(vnode) //create el's children dom\n    \t}else if (oldCh){\n            api.removeChildren(el)\n    \t}\n    }\n}\nå¤åˆ¶ä»£ç \n```\n\nè¿™ä¸ªå‡½æ•°åšäº†ä»¥ä¸‹äº‹æƒ…ï¼š\n\n- æ‰¾åˆ°å¯¹åº”çš„çœŸå® domï¼Œç§°ä¸º`el`\n- åˆ¤æ–­`Vnode`å’Œ`oldVnode`æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ˜¯ï¼Œé‚£ä¹ˆç›´æ¥`return`\n- å¦‚æœä»–ä»¬éƒ½æœ‰æ–‡æœ¬èŠ‚ç‚¹å¹¶ä¸”ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆå°†`el`çš„æ–‡æœ¬èŠ‚ç‚¹è®¾ç½®ä¸º`Vnode`çš„æ–‡æœ¬èŠ‚ç‚¹ã€‚\n- å¦‚æœ`oldVnode`æœ‰å­èŠ‚ç‚¹è€Œ`Vnode`æ²¡æœ‰ï¼Œåˆ™åˆ é™¤`el`çš„å­èŠ‚ç‚¹\n- å¦‚æœ`oldVnode`æ²¡æœ‰å­èŠ‚ç‚¹è€Œ`Vnode`æœ‰ï¼Œåˆ™å°†`Vnode`çš„å­èŠ‚ç‚¹çœŸå®åŒ–ä¹‹åæ·»åŠ åˆ°`el`\n- å¦‚æœä¸¤è€…éƒ½æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™æ‰§è¡Œ`updateChildren`å‡½æ•°æ¯”è¾ƒå­èŠ‚ç‚¹ï¼Œè¿™ä¸€æ­¥å¾ˆé‡è¦\n\nå…¶ä»–å‡ ä¸ªç‚¹éƒ½å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬è¯¦ç»†æ¥è®²ä¸€ä¸‹ updateChildren\n\n### 3. updateChildren\n\nä»£ç é‡å¾ˆå¤§ï¼Œä¸æ–¹ä¾¿ä¸€è¡Œä¸€è¡Œçš„è®²è§£ï¼Œæ‰€ä»¥ä¸‹é¢ç»“åˆä¸€äº›ç¤ºä¾‹å›¾æ¥æè¿°ä¸€ä¸‹ã€‚\n\n```javascript\nupdateChildren (parentElm, oldCh, newCh) {\n    let oldStartIdx = 0, newStartIdx = 0\n    let oldEndIdx = oldCh.length - 1\n    let oldStartVnode = oldCh[0]\n    let oldEndVnode = oldCh[oldEndIdx]\n    let newEndIdx = newCh.length - 1\n    let newStartVnode = newCh[0]\n    let newEndVnode = newCh[newEndIdx]\n    let oldKeyToIdx\n    let idxInOld\n    let elmToMove\n    let before\n    while (oldStartIdx <= oldEndIdx && newStartIdx <= newEndIdx) {\n        if (oldStartVnode == null) {   // å¯¹äºvnode.keyçš„æ¯”è¾ƒï¼Œä¼šæŠŠoldVnode = null\n            oldStartVnode = oldCh[++oldStartIdx]\n        }else if (oldEndVnode == null) {\n            oldEndVnode = oldCh[--oldEndIdx]\n        }else if (newStartVnode == null) {\n            newStartVnode = newCh[++newStartIdx]\n        }else if (newEndVnode == null) {\n            newEndVnode = newCh[--newEndIdx]\n        }else if (sameVnode(oldStartVnode, newStartVnode)) {\n            patchVnode(oldStartVnode, newStartVnode)\n            oldStartVnode = oldCh[++oldStartIdx]\n            newStartVnode = newCh[++newStartIdx]\n        }else if (sameVnode(oldEndVnode, newEndVnode)) {\n            patchVnode(oldEndVnode, newEndVnode)\n            oldEndVnode = oldCh[--oldEndIdx]\n            newEndVnode = newCh[--newEndIdx]\n        }else if (sameVnode(oldStartVnode, newEndVnode)) {\n            patchVnode(oldStartVnode, newEndVnode)\n            api.insertBefore(parentElm, oldStartVnode.el, api.nextSibling(oldEndVnode.el))\n            oldStartVnode = oldCh[++oldStartIdx]\n            newEndVnode = newCh[--newEndIdx]\n        }else if (sameVnode(oldEndVnode, newStartVnode)) {\n            patchVnode(oldEndVnode, newStartVnode)\n            api.insertBefore(parentElm, oldEndVnode.el, oldStartVnode.el)\n            oldEndVnode = oldCh[--oldEndIdx]\n            newStartVnode = newCh[++newStartIdx]\n        }else {\n           // ä½¿ç”¨keyæ—¶çš„æ¯”è¾ƒ\n            if (oldKeyToIdx === undefined) {\n                oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx) // æœ‰keyç”Ÿæˆindexè¡¨\n            }\n            idxInOld = oldKeyToIdx[newStartVnode.key]\n            if (!idxInOld) {\n                api.insertBefore(parentElm, createEle(newStartVnode).el, oldStartVnode.el)\n                newStartVnode = newCh[++newStartIdx]\n            }\n            else {\n                elmToMove = oldCh[idxInOld]\n                if (elmToMove.sel !== newStartVnode.sel) {\n                    api.insertBefore(parentElm, createEle(newStartVnode).el, oldStartVnode.el)\n                }else {\n                    patchVnode(elmToMove, newStartVnode)\n                    oldCh[idxInOld] = null\n                    api.insertBefore(parentElm, elmToMove.el, oldStartVnode.el)\n                }\n                newStartVnode = newCh[++newStartIdx]\n            }\n        }\n    }\n    if (oldStartIdx > oldEndIdx) {\n        before = newCh[newEndIdx + 1] == null ? null : newCh[newEndIdx + 1].el\n        addVnodes(parentElm, before, newCh, newStartIdx, newEndIdx)\n    }else if (newStartIdx > newEndIdx) {\n        removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx)\n    }\n}\nå¤åˆ¶ä»£ç \n```\n\nå…ˆè¯´ä¸€ä¸‹è¿™ä¸ªå‡½æ•°åšäº†ä»€ä¹ˆ\n\n- å°†`Vnode`çš„å­èŠ‚ç‚¹`Vch`å’Œ`oldVnode`çš„å­èŠ‚ç‚¹`oldCh`æå–å‡ºæ¥\n- `oldCh`å’Œ`vCh`å„æœ‰ä¸¤ä¸ªå¤´å°¾çš„å˜é‡`StartIdx`å’Œ`EndIdx`ï¼Œå®ƒä»¬çš„ 2 ä¸ªå˜é‡ç›¸äº’æ¯”è¾ƒï¼Œä¸€å…±æœ‰ 4 ç§æ¯”è¾ƒæ–¹å¼ã€‚å¦‚æœ 4 ç§æ¯”è¾ƒéƒ½æ²¡åŒ¹é…ï¼Œå¦‚æœè®¾ç½®äº†`key`ï¼Œå°±ä¼šç”¨`key`è¿›è¡Œæ¯”è¾ƒï¼Œåœ¨æ¯”è¾ƒçš„è¿‡ç¨‹ä¸­ï¼Œå˜é‡ä¼šå¾€ä¸­é—´é ï¼Œä¸€æ—¦`StartIdx>EndIdx`è¡¨æ˜`oldCh`å’Œ`vCh`è‡³å°‘æœ‰ä¸€ä¸ªå·²ç»éå†å®Œäº†ï¼Œå°±ä¼šç»“æŸæ¯”è¾ƒã€‚\n\n#### å›¾è§£ updateChildren\n\nç»ˆäºæ¥åˆ°äº†è¿™ä¸€éƒ¨åˆ†ï¼Œä¸Šé¢çš„æ€»ç»“ç›¸ä¿¡å¾ˆå¤šäººä¹Ÿçœ‹å¾—ä¸€è„¸æ‡µé€¼ï¼Œä¸‹é¢æˆ‘ä»¬å¥½å¥½è¯´é“è¯´é“ã€‚\n\nç²‰çº¢è‰²çš„éƒ¨åˆ†ä¸º oldChã€é»„è‰²çš„éƒ¨åˆ†ä¸º vCh\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy0sb71dj311i0ccmyf.jpg)\n\næˆ‘ä»¬å°†å®ƒä»¬å–å‡ºæ¥å¹¶åˆ†åˆ«ç”¨ s å’Œ e æŒ‡é’ˆæŒ‡å‘å®ƒä»¬çš„å¤´ child å’Œå°¾ child\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy0tc3qkj31100h8gnl.jpg)\n\nç°åœ¨åˆ†åˆ«å¯¹`oldSã€oldEã€Sã€E`ä¸¤ä¸¤åš`sameVnode`æ¯”è¾ƒï¼Œæœ‰å››ç§æ¯”è¾ƒæ–¹å¼ï¼Œå½“å…¶ä¸­ä¸¤ä¸ªèƒ½åŒ¹é…ä¸Šé‚£ä¹ˆçœŸå® dom ä¸­çš„ç›¸åº”èŠ‚ç‚¹ä¼šç§»åˆ° Vnode ç›¸åº”çš„ä½ç½®ï¼Œè¿™å¥è¯æœ‰ç‚¹ç»•ï¼Œæ‰“ä¸ªæ¯”æ–¹\n\n- å¦‚æœæ˜¯ oldS å’Œ E åŒ¹é…ä¸Šäº†ï¼Œé‚£ä¹ˆçœŸå® dom ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¼šç§»åˆ°æœ€å\n- å¦‚æœæ˜¯ oldE å’Œ S åŒ¹é…ä¸Šäº†ï¼Œé‚£ä¹ˆçœŸå® dom ä¸­çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¼šç§»åˆ°æœ€å‰ï¼ŒåŒ¹é…ä¸Šçš„ä¸¤ä¸ªæŒ‡é’ˆå‘ä¸­é—´ç§»åŠ¨\n- å¦‚æœå››ç§åŒ¹é…æ²¡æœ‰ä¸€å¯¹æ˜¯æˆåŠŸçš„ï¼Œåˆ†ä¸ºä¸¤ç§æƒ…å†µ\n  - å¦‚æœæ–°æ—§å­èŠ‚ç‚¹éƒ½å­˜åœ¨ keyï¼Œé‚£ä¹ˆä¼šæ ¹æ®`oldChild`çš„ key ç”Ÿæˆä¸€å¼  hash è¡¨ï¼Œç”¨`S`çš„ key ä¸ hash è¡¨åšåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸå°±åˆ¤æ–­`S`å’ŒåŒ¹é…èŠ‚ç‚¹æ˜¯å¦ä¸º`sameNode`ï¼Œå¦‚æœæ˜¯ï¼Œå°±åœ¨çœŸå® dom ä¸­å°†æˆåŠŸçš„èŠ‚ç‚¹ç§»åˆ°æœ€å‰é¢ï¼Œå¦åˆ™ï¼Œå°†`S`ç”Ÿæˆå¯¹åº”çš„èŠ‚ç‚¹æ’å…¥åˆ° dom ä¸­å¯¹åº”çš„`oldS`ä½ç½®ï¼Œ`oldS`å’Œ`S`æŒ‡é’ˆå‘ä¸­é—´ç§»åŠ¨ã€‚\n  - å¦‚æœæ²¡æœ‰ key,åˆ™ç›´æ¥å°†`S`ç”Ÿæˆæ–°çš„èŠ‚ç‚¹æ’å…¥`çœŸå®DOM`ï¼ˆpsï¼šè¿™ä¸‹å¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆ v-for çš„æ—¶å€™éœ€è¦è®¾ç½® key äº†ï¼Œå¦‚æœæ²¡æœ‰ key é‚£ä¹ˆå°±åªä¼šåšå››ç§åŒ¹é…ï¼Œå°±ç®—æŒ‡é’ˆä¸­é—´æœ‰å¯å¤ç”¨çš„èŠ‚ç‚¹éƒ½ä¸èƒ½è¢«å¤ç”¨äº†ï¼‰\n\nå†é…ä¸ªå›¾ï¼ˆå‡è®¾ä¸‹å›¾ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯æœ‰ key çš„ï¼Œä¸” key ä¸ºè‡ªèº«çš„å€¼ï¼‰\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy0ulelpj311u0oy41x.jpg)\n\n- ç¬¬ä¸€æ­¥\n\n```json\noldS = a, oldE = dï¼›\nS = a, E = b;\n```\n\n`oldS`å’Œ`S`åŒ¹é…ï¼Œåˆ™å°† dom ä¸­çš„ a èŠ‚ç‚¹æ”¾åˆ°ç¬¬ä¸€ä¸ªï¼Œå·²ç»æ˜¯ç¬¬ä¸€ä¸ªäº†å°±ä¸ç®¡äº†ï¼Œæ­¤æ—¶ dom çš„ä½ç½®ä¸ºï¼ša b d\n\n- ç¬¬äºŒæ­¥\n\n```json\noldS = b, oldE = dï¼›\nS = c, E = b;\n```\n\n`oldS`å’Œ`E`åŒ¹é…ï¼Œå°±å°†åŸæœ¬çš„ b èŠ‚ç‚¹ç§»åŠ¨åˆ°æœ€åï¼Œå› ä¸º`E`æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»–ä»¬ä½ç½®è¦ä¸€è‡´ï¼Œè¿™å°±æ˜¯ä¸Šé¢è¯´çš„ï¼š**å½“å…¶ä¸­ä¸¤ä¸ªèƒ½åŒ¹é…ä¸Šé‚£ä¹ˆçœŸå® dom ä¸­çš„ç›¸åº”èŠ‚ç‚¹ä¼šç§»åˆ° Vnode ç›¸åº”çš„ä½ç½®**ï¼Œæ­¤æ—¶ dom çš„ä½ç½®ä¸ºï¼ša d b\n\n- ç¬¬ä¸‰æ­¥\n\n```json\noldS = d, oldE = dï¼›\nS = c, E = d;\n\n```\n\n`oldE`å’Œ`E`åŒ¹é…ï¼Œä½ç½®ä¸å˜æ­¤æ—¶ dom çš„ä½ç½®ä¸ºï¼ša d b\n\n- ç¬¬å››æ­¥\n\n```json\noldS++;\noldE--;\noldS > oldE;\n\n```\n\néå†ç»“æŸï¼Œè¯´æ˜`oldCh`å…ˆéå†å®Œã€‚å°±å°†å‰©ä½™çš„`vCh`èŠ‚ç‚¹æ ¹æ®è‡ªå·±çš„çš„ index æ’å…¥åˆ°çœŸå® dom ä¸­å»ï¼Œæ­¤æ—¶ dom ä½ç½®ä¸ºï¼ša c d b\n\nä¸€æ¬¡æ¨¡æ‹Ÿå®Œæˆã€‚\n\nè¿™ä¸ªåŒ¹é…è¿‡ç¨‹çš„ç»“æŸæœ‰ä¸¤ä¸ªæ¡ä»¶ï¼š\n\n- `oldS > oldE`è¡¨ç¤º`oldCh`å…ˆéå†å®Œï¼Œé‚£ä¹ˆå°±å°†å¤šä½™çš„`vCh`æ ¹æ® index æ·»åŠ åˆ° dom ä¸­å»ï¼ˆå¦‚ä¸Šå›¾ï¼‰\n- `S > E`è¡¨ç¤º vCh å…ˆéå†å®Œï¼Œé‚£ä¹ˆå°±åœ¨çœŸå® dom ä¸­å°†åŒºé—´ä¸º`[oldS, oldE]`çš„å¤šä½™èŠ‚ç‚¹åˆ æ‰\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy0vmjjqj311m0ik75k.jpg)\n\nä¸‹é¢å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥åƒä¸Šé¢é‚£æ ·è‡ªå·±è¯•ç€æ¨¡æ‹Ÿä¸€ä¸‹\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6iy0wmkh1j31180kmq5k.jpg)\n\nå½“è¿™äº›èŠ‚ç‚¹`sameVnode`æˆåŠŸåå°±ä¼šç´§æ¥ç€æ‰§è¡Œ`patchVnode`äº†ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä¸Šé¢çš„ä»£ç \n\n```javascript\nif (sameVnode(oldStartVnode, newStartVnode)) {\n  patchVnode(oldStartVnode, newStartVnode);\n}\n```\n\nå°±è¿™æ ·å±‚å±‚é€’å½’ä¸‹å»ï¼Œç›´åˆ°å°† oldVnode å’Œ Vnode ä¸­çš„æ‰€æœ‰å­èŠ‚ç‚¹æ¯”å¯¹å®Œã€‚ä¹Ÿå°† dom çš„æ‰€æœ‰è¡¥ä¸éƒ½æ‰“å¥½å•¦ã€‚é‚£ä¹ˆç°åœ¨å†å›è¿‡å»çœ‹ updateChildren çš„ä»£ç ä¼šä¸ä¼šå®¹æ˜“å¾ˆå¤šå‘¢ï¼Ÿ\n\n### 4. æ“ä½œ dom\n\nè¿™é‡Œæˆ‘ä»¬åªæ˜¯å°†è™šæ‹Ÿ DOM æ˜ å°„æˆäº†çœŸå®çš„ DOMã€‚é‚£å¦‚ä½•ç»™è¿™äº› DOM åŠ å…¥ attrã€classã€style ç­‰ DOM å±æ€§å‘¢ï¼Ÿ\n\nè¿™è¦ä¾èµ–äºè™šæ‹Ÿ DOM çš„ç”Ÿå‘½é’©å­ã€‚è™šæ‹Ÿ DOM æä¾›äº†å¦‚ä¸‹çš„é’©å­å‡½æ•°ï¼Œåˆ†åˆ«åœ¨ä¸åŒçš„æ—¶æœŸä¼šè¿›è¡Œè°ƒç”¨ã€‚\n\n```javascript\nconst hooks = [\"create\", \"activate\", \"update\", \"remove\", \"destroy\"];\n\n/*æ„å»ºcbså›è°ƒå‡½æ•°ï¼Œwebå¹³å°ä¸Šè§/platforms/web/runtime/modules*/\nfor (i = 0; i < hooks.length; ++i) {\n  cbs[hooks[i]] = [];\n  for (j = 0; j < modules.length; ++j) {\n    if (isDef(modules[j][hooks[i]])) {\n      cbs[hooks[i]].push(modules[j][hooks[i]]);\n    }\n  }\n}\n```\n\nåŒç†ï¼Œä¹Ÿä¼šæ ¹æ®ä¸åŒå¹³å°æœ‰è‡ªå·±ä¸åŒçš„å®ç°ï¼Œæˆ‘ä»¬è¿™é‡Œä»¥ Web å¹³å°ä¸ºä¾‹ã€‚Web å¹³å°çš„é’©å­å‡½æ•°è§[/platforms/web/runtime/modules](https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fanswershuto%2FlearnVue%2Ftree%2Fmaster%2Fvue-src%2Fplatforms%2Fweb%2Fruntime%2Fmodules)ã€‚é‡Œé¢æœ‰å¯¹ attrã€classã€propsã€eventsã€style ä»¥åŠ transitionï¼ˆè¿‡æ¸¡çŠ¶æ€ï¼‰çš„ DOM å±æ€§è¿›è¡Œæ“ä½œã€‚\n\nä»¥ attr ä¸ºä¾‹ï¼Œä»£ç å¾ˆç®€å•ã€‚\n\n```javascript\n/* @flow */\n\nimport { isIE9 } from \"core/util/env\";\n\nimport { extend, isDef, isUndef } from \"shared/util\";\n\nimport {\n  isXlink,\n  xlinkNS,\n  getXlinkProp,\n  isBooleanAttr,\n  isEnumeratedAttr,\n  isFalsyAttrValue\n} from \"web/util/index\";\n\n/*æ›´æ–°attr*/\nfunction updateAttrs(oldVnode: VNodeWithData, vnode: VNodeWithData) {\n  /*å¦‚æœæ—§çš„ä»¥åŠæ–°çš„VNodeèŠ‚ç‚¹å‡æ²¡æœ‰attrå±æ€§ï¼Œåˆ™ç›´æ¥è¿”å›*/\n  if (isUndef(oldVnode.data.attrs) && isUndef(vnode.data.attrs)) {\n    return;\n  }\n  let key, cur, old;\n  /*VNodeèŠ‚ç‚¹å¯¹åº”çš„Domå®ä¾‹*/\n  const elm = vnode.elm;\n  /*æ—§VNodeèŠ‚ç‚¹çš„attr*/\n  const oldAttrs = oldVnode.data.attrs || {};\n  /*æ–°VNodeèŠ‚ç‚¹çš„attr*/\n  let attrs: any = vnode.data.attrs || {};\n  // clone observed objects, as the user probably wants to mutate it\n  /*å¦‚æœæ–°çš„VNodeçš„attrå·²ç»æœ‰__ob__ï¼ˆä»£è¡¨å·²ç»è¢«Observeå¤„ç†è¿‡äº†ï¼‰ï¼Œ è¿›è¡Œæ·±æ‹·è´*/\n  if (isDef(attrs.__ob__)) {\n    attrs = vnode.data.attrs = extend({}, attrs);\n  }\n\n  /*éå†attrï¼Œä¸ä¸€è‡´åˆ™æ›¿æ¢*/\n  for (key in attrs) {\n    cur = attrs[key];\n    old = oldAttrs[key];\n    if (old !== cur) {\n      setAttr(elm, key, cur);\n    }\n  }\n  // #4391: in IE9, setting type can reset value for input[type=radio]\n  /* istanbul ignore if */\n  if (isIE9 && attrs.value !== oldAttrs.value) {\n    setAttr(elm, \"value\", attrs.value);\n  }\n  for (key in oldAttrs) {\n    if (isUndef(attrs[key])) {\n      if (isXlink(key)) {\n        elm.removeAttributeNS(xlinkNS, getXlinkProp(key));\n      } else if (!isEnumeratedAttr(key)) {\n        elm.removeAttribute(key);\n      }\n    }\n  }\n}\n\n/*è®¾ç½®attr*/\nfunction setAttr(el: Element, key: string, value: any) {\n  if (isBooleanAttr(key)) {\n    // set attribute for blank value\n    // e.g. <option disabled>Select one</option>\n    if (isFalsyAttrValue(value)) {\n      el.removeAttribute(key);\n    } else {\n      el.setAttribute(key, key);\n    }\n  } else if (isEnumeratedAttr(key)) {\n    el.setAttribute(\n      key,\n      isFalsyAttrValue(value) || value === \"false\" ? \"false\" : \"true\"\n    );\n  } else if (isXlink(key)) {\n    if (isFalsyAttrValue(value)) {\n      el.removeAttributeNS(xlinkNS, getXlinkProp(key));\n    } else {\n      el.setAttributeNS(xlinkNS, key, value);\n    }\n  } else {\n    if (isFalsyAttrValue(value)) {\n      el.removeAttribute(key);\n    } else {\n      el.setAttribute(key, value);\n    }\n  }\n}\n\nexport default {\n  create: updateAttrs,\n  update: updateAttrs\n};\n```\n\nattr åªéœ€è¦åœ¨ create ä»¥åŠ update é’©å­è¢«è°ƒç”¨æ—¶æ›´æ–° DOM çš„ attr å±æ€§å³å¯ã€‚\n","tags":["VUE"],"categories":["VUE"]},{"title":"leetcodeç®—æ³•åˆ·é¢˜ç¬”è®°ï¼ˆä¸‰ï¼‰â€”â€”æ’åº","url":"/2019/02/22/leetcodeç®—æ³•åˆ·é¢˜ç¬”è®°ï¼ˆä¸‰ï¼‰â€”â€”æ’åº/","content":"\n_è¯¥ç¬”è®°åªä¸ºä¸ªäººæ‰€å†™ç®—æ³•ï¼Œä¸ä¸€å®šæ˜¯æœ€ä¼˜è§£æ³•ï¼Œä»…ä¾›å‚è€ƒ_\n\n# [56] Merge Intervals\n\nGiven a collection of intervals, merge all overlapping intervals.\néš¾åº¦ï¼šMedium (34.95%)\næ€è·¯ï¼š\n\n1. é¦–å…ˆæŒ‰ start å‡åºæˆ–æŒ‰ end å‡åºæ’åˆ—\n2. å¦‚æœå‰ä¸€é¡¹çš„ end å¤§äºåä¸€é¡¹çš„ startï¼Œè¯´æ˜è¦ merge\n3. å› ä¸ºå·²ç»åšäº†å‡åºæ’åˆ—ï¼Œæ‰€ä»¥è¦ push è¿›ç»“æœçš„é‚£ä¸€é¡¹çš„ start ä¸€å®šä¸ºå‰ä¸€é¡¹çš„ startï¼Œè€Œ end ä¸ºä¸¤é¡¹ä¸­ end è¾ƒå¤§çš„é‚£ä¸ªå€¼ã€‚\n\n<!-- more -->\n\n```javascript\nvar merge = function(intervals) {\n  var res = [];\n  if (intervals.length == 0) {\n    return res;\n  }\n  intervals.sort(function(a, b) {\n    return a.start !== b.start ? a.start - b.start : a.end - b.end;\n  });\n  var pre = intervals[0];\n  res.push(pre);\n  for (var cur of intervals) {\n    if (pre.end >= cur.start) {\n      if (cur.end > pre.end) {\n        pre.end = cur.end;\n      }\n    } else {\n      res.push(cur);\n      pre = cur;\n    }\n  }\n  return res;\n};\n```\n\n# [75] Sort Colors\n\nGiven an array with n objects colored red, white or blue, sort them in-place so that objects of the same color are adjacent, with the colors in the order red, white and blue.\nHere, we will use the integers 0, 1, and 2 to represent the color red, white, and blue respectively.\nNote:Â You are not suppose to use the library's sort function for this problem.\néš¾åº¦ï¼šMedium (41.44%)\næ€è·¯ï¼šé‡åˆ° 0 æ”¾åœ¨æœ€å‰é¢ï¼Œé‡åˆ° 2 æ”¾åœ¨æœ€åé¢ï¼Œ1 ä¸åŠ¨\n\n1. i ä» 0 å¼€å§‹ï¼Œå¦‚æœ nums[i]ç­‰äº 1ï¼Œåˆ™ i++ã€‚\n2. å¦‚æœ nums[i]ç­‰äº 0ï¼Œåˆ™æŠŠ nums[i]æ”¾åˆ°æœ€å‰é¢\n3. å¦‚æœ nums[i]ç­‰äº 2ï¼Œåˆ™æŠŠ nums[i]æ”¾åˆ°æœ€åé¢\n\n```javascript\nvar sortColors = function(nums) {\n  if (nums.length == 0) {\n    return -1;\n  }\n  var i = 0;\n  var m = 0;\n  var n = nums.length - 1;\n  var temp;\n  while (i <= n) {\n    if (nums[i] == 1) {\n      i++;\n    } else if (nums[i] == 0) {\n      temp = nums[m];\n      nums[m] = nums[i];\n      nums[i] = temp;\n      m++;\n      i++;\n    } else {\n      temp = nums[n];\n      nums[n] = nums[i];\n      nums[i] = temp;\n      n--;\n    }\n  }\n  return nums;\n};\n```\n\n# [147] Insertion Sort List\n\nSort a linked list using insertion sort.\nA graphical example of insertion sort. The partial sorted list (black) initially contains only the first element in the list.With each iteration one element (red) is removed from the input data and inserted in-place into the sorted list.\nAlgorithm of Insertion Sort:\nInsertion sort iterates, consuming one input element each repetition, and growing a sorted output list. At each iteration, insertion sort removes one element from the input data, finds the location it belongs within the sorted list, and inserts it there. It repeats until no input elements remain.\néš¾åº¦ï¼šMedium (36.50%)\næ€è·¯ï¼šæ–°å¼€è¾Ÿä¸€ä¸ªç©ºé“¾è¡¨ï¼Œä½œä¸ºä»¥æ’åºåŒºåŸŸï¼Œæ¯æ¬¡æ‹¿å‡º head æ¥ï¼Œä¸ä»¥æ’åºåŒºåŸŸçš„é“¾è¡¨çš„ val è¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾åˆ°æ’å…¥ä½ç½®ï¼Œæ’å…¥ã€‚åˆ™æœªæ’åºåŒºåŸŸçš„äº†é“¾è¡¨é•¿åº¦å‡ä¸€ã€‚\n\n```javascript\nvar insertionSortList = function(head) {\n  var current = { val: -Number.MAX_VALUE, next: null };\n  while (head) {\n    var prev = current;\n    while (prev.next && prev.next.val < head.val) {\n      prev = prev.next;\n    }\n    var next = head.next;\n    head.next = prev.next;\n    prev.next = head;\n\n    head = next;\n  }\n  return current.next;\n};\n```\n\n# [148] Sort List\n\nSort a linked list in O(n log n) time using constant space complexity.\néš¾åº¦ï¼šMedium (34.12%)\næ€è·¯ï¼šå½’å¹¶æ’åºçš„é“¾è¡¨å®ç°\n\n```javascript\nvar sortList = function(head) {\n  if (head == null || head.next == null) {\n    return head;\n  }\n  var fast = head;\n  var slow = head;\n  var pre = null;\n  while (fast && fast.next != null) {\n    pre = slow;\n    slow = slow.next;\n    fast = fast.next.next;\n  }\n  pre.next = null;\n  return merge(sortList(head), sortList(slow));\n};\n\nfunction merge(left, right) {\n  var result = {};\n  var pre = result;\n  while (left && right) {\n    if (left.val < right.val) {\n      pre.next = left;\n      pre = pre.next;\n      left = left.next;\n    } else {\n      pre.next = right;\n      pre = pre.next;\n      right = right.next;\n    }\n  }\n  while (left) {\n    pre.next = left;\n    pre = pre.next;\n    left = left.next;\n  }\n  while (right) {\n    pre.next = right;\n    pre = pre.next;\n    right = right.next;\n  }\n  return result.next;\n}\n```\n\n# [179] Largest Number\n\nGiven a list of non negative integers, arrange them such that they form the largest number.\néš¾åº¦ï¼šMedium (25.32%)\n\n```javascript\nvar largestNumber = function(nums) {\n  nums.sort(function(a, b) {\n    var ab = a.toString() + b.toString();\n    var ba = b.toString() + a.toString();\n    return ba - ab;\n  });\n  var result = nums.join(\"\");\n  if (parseInt(result) == 0) {\n    return \"0\";\n  } else {\n    return result;\n  }\n};\n```\n\n# [242] Valid Anagram\n\nGiven two strings s and tÂ , write a function to determine if t is an anagram of s.\nNote: You may assume the string contains only lowercase alphabets.\néš¾åº¦ï¼šEasy (51.12%)\n\n```javascript\nvar isAnagram = function(s, t) {\n  if (s.length != = t.length) {\n    return false;\n  }\n  var res = new Array(26);\n  res.fill(0);\n  for (var i = 0; i < s.length; i++) {\n    res[s.codePointAt(i) - 97]++;\n    res[t.codePointAt(i) - 97]--;\n  }\n  for (var i = 0; i < res.length; i++) {\n    if (res[i] !== 0) {\n      return false;\n    }\n  }\n  return true;\n};\n```\n\n# [274] H-Index\n\nGiven an array of citations (each citation is a non-negative integer) of a researcher, write a function to compute the researcher's h-index.\nAccording to the definition of h-index on Wikipedia: \"A scientist has index h if h of his/her N papers have at least h citations each, and the other N âˆ’ h papers have no more than h citations each.\"\néš¾åº¦ï¼šMedium (34.43%)\næ€è·¯ï¼šä¸€ä¸ªäººåœ¨å…¶æ‰€æœ‰å­¦æœ¯æ–‡ç« ä¸­æœ‰ N ç¯‡è®ºæ–‡åˆ†åˆ«è¢«å¼•ç”¨äº†è‡³å°‘ N æ¬¡ï¼Œä»–çš„ H æŒ‡æ•°å°±æ˜¯ Nã€‚æ ¹æ®è¿™ä¸ªè§„åˆ™ï¼Œé¦–å…ˆè®²æ•°ç»„å€’åºæ’åˆ—ï¼Œåˆ¤æ–­æ•°ç»„ä¸­çš„ç¬¬ i ä¸ªï¼Œæ˜¯å¦å¤§äºç­‰äº i+1ï¼Œå¦‚æœæˆç«‹ï¼Œåˆ™ä»£è¡¨ï¼Œè‡³å°‘æœ‰ i+1 ç¯‡æ–‡ç« ï¼Œè¢«å¼•ç”¨äº† i+1 æ¬¡ï¼Œåˆ™ä»–çš„ h-index å°±æ˜¯ i+1.\n\n```javascript\nvar hIndex = function(citations) {\n  if (citations.length == 0) {\n    return 0;\n  }\n  citations.sort((a, b) => b - a);\n  var res = citations.length;\n  for (var i = citations.length - 1; i >= 0; i--) {\n    if (citations[i] >= res) {\n      return res;\n    }\n    res--;\n  }\n  if (res == 0) {\n    return 0;\n  }\n};\n```\n\n# [324] Wiggle Sort II\n\nGiven an unsorted array nums, reorder it such that nums[0] < nums[1] > nums[2] < nums[3]....\néš¾åº¦ï¼šMedium (27.54%)\næ€è·¯ï¼šå°†æ•°ç»„æ­£åºæ’åºä¹‹åï¼Œä»ä¸­é—´åˆ†ä¸ºä¸¤ä¸ªæ•°ç»„ï¼Œæ¯æ¬¡ä»å°æ•°ç»„é‡Œæ‹¿ä¸€ä¸ªæ•°ï¼Œä»å¤§æ•°ç»„é‡Œæ‹¿ä¸€ä¸ªæ•°ï¼Œç»„æˆçš„ æ–°æ•°ç»„å°±æ˜¯ä¸€ä¸ªæ•°å¤§ä¸€ä¸ªæ•°å°çš„çŠ¶æ€ã€‚\n\n```javascript\nvar wiggleSort = function(nums) {\n  if (nums.length <= 1) {\n    return nums;\n  }\n  nums = nums.sort((a, b) => a - b);\n  var mid = Math.floor((nums.length + 1) / 2);\n  var small = nums.slice(0, mid);\n  var big = nums.slice(mid);\n  if (big.length > small.length) {\n    return [];\n  }\n  var i = 0;\n  var j = small.length - 1;\n  var k = big.length - 1;\n  while (i < nums.length && j >= 0 && k >= 0) {\n    nums[i] = small[j];\n    nums[i + 1] = big[k];\n    i = i + 2;\n    j--;\n    k--;\n  }\n  while (i < nums.length && j >= 0) {\n    nums[i] = small[j];\n    i++;\n    j--;\n  }\n  return nums;\n};\n```\n","tags":["JavaScript","ç®—æ³•","LeetCode","æ’åº"],"categories":["ç®—æ³•"]},{"title":"å‰ç«¯è·¯ç”±","url":"/2019/01/28/å‰ç«¯è·¯ç”±/","content":"\n# å‰ç«¯è·¯ç”±\n\n## 1.ä»€ä¹ˆæ˜¯å‰ç«¯è·¯ç”±\n\nå¯¹äºç”¨æˆ·æ¥è¯´ï¼Œè·¯ç”±å°±æ˜¯æµè§ˆå™¨åœ°å€æ ä¸­çš„ url ä¸æ‰€è§ç½‘é¡µçš„å¯¹åº”å…³ç³»ã€‚è€Œå¯¹äº web å¼€å‘äººå‘˜æ¥è¯´ï¼Œè·¯ç”±æ›´åƒæ˜¯ url ä¸å¤„ç†å‡½æ•°çš„å¯¹åº”å…³ç³»ã€‚\n\nä¼ ç»Ÿçš„æœåŠ¡ç«¯è·¯ç”±ï¼Œæ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚çš„ä¸åŒç½‘å€ï¼Œè¿”å›ä¸åŒçš„ç½‘é¡µå†…å®¹ï¼Œè¿™ç§æƒ…å†µä¸€æ˜¯ä¼šé€ æˆæœåŠ¡å™¨å‹åŠ›å¢åŠ ï¼ŒäºŒæ˜¯æ¯æ¬¡éƒ½é‡æ–°è¯·æ±‚ï¼Œå“åº”è¾ƒæ…¢ã€ç”¨æˆ·ä½“éªŒä¸‹é™ã€‚äºæ˜¯ï¼Œå•é¡µåº”ç”¨ï¼ˆspa,single page applicationï¼‰åº”è¿è€Œç”Ÿã€‚åœ¨ url åœ°å€æ”¹å˜çš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ js æ¥å®ç°ä¸åŒ UI ä¹‹é—´çš„åˆ‡æ¢ï¼ˆjs å¯¹ DOM çš„æ“ä½œï¼‰ï¼Œè€Œä¸å†å‘æœåŠ¡å™¨é‡æ–°è¯·æ±‚é¡µé¢ï¼Œåªé€šè¿‡ ajax å‘æœåŠ¡ç«¯è¯·æ±‚æ•°æ®ï¼Œå¯¹ç”¨æˆ·æ¥è¯´è¿™ç§æ— åˆ·æ–°çš„ã€å³æ—¶å“åº”æ˜¯æ›´å¥½çš„ä½“éªŒã€‚å…¶ä¸­ï¼Œæ ¹æ® url åœ°å€æ çš„å˜åŒ–è€Œå±•ç¤ºä¸åŒçš„ UIï¼Œå°±æ˜¯é€šè¿‡å‰ç«¯è·¯ç”±æ¥å®ç°çš„ã€‚ç›®å‰ä¸»æµçš„æ”¯æŒå•é¡µåº”ç”¨çš„å‰ç«¯æ¡†æ¶ï¼ŒåŸºæœ¬éƒ½æœ‰é…å¥—çš„æˆ–ç¬¬ä¸‰æ–¹çš„è·¯ç”±ç³»ç»Ÿã€‚\n\n<!-- more -->\n\n## 2.å‰ç«¯è·¯ç”±çš„å®ç°æ–¹å¼\n\nåœ¨ HTML5 çš„ history API å‡ºç°ä¹‹å‰ï¼Œå‰ç«¯è·¯ç”±ä¸»è¦æ˜¯é€šè¿‡ hash æ¥å®ç°çš„ï¼Œhash èƒ½å…¼å®¹ä½ç‰ˆæœ¬çš„æµè§ˆå™¨ã€‚ä¸‹é¢åˆ†åˆ«æ¥ä»‹ç»è¿™ 2 ç§æ–¹å¼ã€‚\n\n- ### æ–¹æ³•ä¸€ï¼šåŸºäº hashï¼ˆlocation.hash+hashchange äº‹ä»¶ï¼‰\n\næˆ‘ä»¬çŸ¥é“ location.hash çš„å€¼æ˜¯ url ä¸­`#`åé¢çš„å†…å®¹ï¼Œå¦‚`http://www.163.com#netease`æ­¤ç½‘å€ä¸­ï¼Œlocation.hash='#netease'ã€‚\n\n#### hash æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªç‰¹æ€§ï¼Œæ‰ä½¿å¾—å…¶å¯ä»¥å®ç°å‰ç«¯è·¯ç”±ï¼š\n\n1. url ä¸­ hash å€¼çš„å˜åŒ–å¹¶ä¸ä¼šé‡æ–°åŠ è½½é¡µé¢ï¼Œå› ä¸º hash æ˜¯**ç”¨æ¥æŒ‡å¯¼æµè§ˆå™¨è¡Œä¸ºçš„**ï¼Œå¯¹æœåŠ¡ç«¯æ˜¯æ— ç”¨çš„ï¼Œæ‰€ä»¥ä¸ä¼šåŒ…æ‹¬åœ¨ http è¯·æ±‚ä¸­ã€‚\n2. hash å€¼çš„æ”¹å˜ï¼Œéƒ½ä¼šåœ¨æµè§ˆå™¨çš„è®¿é—®å†å²ä¸­å¢åŠ ä¸€ä¸ªè®°å½•ï¼Œä¹Ÿå°±æ˜¯èƒ½é€šè¿‡æµè§ˆå™¨çš„å›é€€ã€å‰è¿›æŒ‰é’®æ§åˆ¶ hash çš„åˆ‡æ¢\n3. æˆ‘ä»¬å¯ä»¥é€šè¿‡ hashchange äº‹ä»¶ï¼Œç›‘å¬åˆ° hash å€¼çš„å˜åŒ–ï¼Œä»è€Œå“åº”ä¸åŒè·¯å¾„çš„é€»è¾‘å¤„ç†ã€‚\n\n```javascript\nwindow.addEventListener(\"hashchange\", funcRef, false);\n```\n\nå¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ hashchange äº‹ä»¶é‡Œï¼Œæ ¹æ® hash å€¼æ¥æ›´æ–°å¯¹åº”çš„è§†å›¾ï¼Œä½†ä¸ä¼šå»é‡æ–°è¯·æ±‚é¡µé¢ï¼ŒåŒæ—¶å‘¢ï¼Œä¹Ÿåœ¨ history é‡Œå¢åŠ äº†ä¸€æ¡è®¿é—®è®°å½•ï¼Œç”¨æˆ·ä¹Ÿä»ç„¶å¯ä»¥é€šè¿‡å‰è¿›åé€€é”®å®ç° UI çš„åˆ‡æ¢ã€‚\n\n#### **è§¦å‘ hash å€¼çš„å˜åŒ–æœ‰ 2 ç§æ–¹æ³•:**\n\nä¸€ç§æ˜¯é€šè¿‡ a æ ‡ç­¾ï¼Œè®¾ç½® href å±æ€§ï¼Œå½“æ ‡ç­¾ç‚¹å‡»ä¹‹åï¼Œåœ°å€æ ä¼šæ”¹å˜ï¼ŒåŒæ—¶ä¼šè§¦å‘ hashchange äº‹ä»¶\n\n```html\n<a href=\"#kaola\">to KAOLA</a>\n```\n\nå¦ä¸€ç§æ˜¯é€šè¿‡ js ç›´æ¥èµ‹å€¼ç»™ location.hashï¼Œä¹Ÿä¼šæ”¹å˜ urlï¼Œè§¦å‘ hashchange äº‹ä»¶ã€‚\n\n```javascript\nlocation.hash = \"#kaola\";\n```\n\n#### ä¸‹é¢å±•ç¤ºä¸€ä¸ªé€šè¿‡ hash å®ç°çš„ç®€æ˜“ Routerï¼š\n\n```javascript\nfunction Router() {\n  this.routes = {};\n  this.currentUrl = \"\";\n}\nRouter.prototype.route = function(path, callback) {\n  this.routes[path] = callback || function() {};\n};\nRouter.prototype.refresh = function() {\n  this.currentUrl = location.hash.slice(1) || \"/\";\n  this.routes[this.currentUrl]();\n};\nRouter.prototype.init = function() {\n  window.addEventListener(\"load\", this.refresh.bind(this), false);\n  window.addEventListener(\"hashchange\", this.refresh.bind(this), false);\n};\nwindow.Router = new Router();\nwindow.Router.init();\n// æ·»åŠ è·¯ç”±è§„åˆ™\nRouter.route(\"/\", function() {\n  // è®¾ç½®å“åº”å†…å®¹\n});\nRouter.route(\"/blue\", function() {\n  // è®¾ç½®å“åº”å†…å®¹\n});\n```\n\n#### ã€route vs routerã€‘\n\nroute æ˜¯ä¸€æ¡è·¯ç”±ï¼Œæ˜¯å°†ä¸€ä¸ª URL è·¯å¾„å’Œä¸€ä¸ªå¤„ç†å‡½æ•°ç›¸å…³è”ï¼Œæ˜¯ä¸€æ¡ url å’Œå‡½æ•°çš„æ˜ å°„è§„åˆ™ï¼Œå¦‚ä¸Šé¢ä»£ç ä¸­é€šè¿‡åŸå‹ä¸Šçš„ route å¯ä»¥è®¾ç½®ä¸€æ¡è·¯ç”±è§„åˆ™ï¼Œå°†ä¸€ä¸ª path å’Œå…¶ callback å…³è”èµ·æ¥ã€‚\n\nè€Œ router åˆ™æ›´åƒæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œæˆ–è€…è¯´ä¸€ç§æœºåˆ¶ï¼Œå®ƒç®¡ç†äº†ä¸€ç»„ routeã€‚ç®€å•æ¥è¯´ï¼Œroute åªæ˜¯è¿›è¡Œäº† URL å’Œå‡½æ•°çš„æ˜ å°„ï¼Œè€Œåœ¨å½“æ¥æ”¶åˆ°ä¸€ä¸ª URL ä¹‹åï¼Œå»è·¯ç”±æ˜ å°„è¡¨ä¸­æŸ¥æ‰¾ç›¸åº”çš„å‡½æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ç”± router æ¥å¤„ç†çš„ï¼Œå¦‚ä¸Šé¢ä»£ç ï¼ŒRouter ç®¡ç†ä¼ å…¥çš„ routeï¼Œå¹¶ä¸”åœ¨ hash æ”¹å˜çš„æ—¶å€™ï¼Œæ ¹æ®å½“å‰çš„ url å“åº”å…¶å¯¹åº”çš„å‡½æ•°ã€‚\n\n- ### æ–¹æ³•äºŒï¼šåŸºäº History æ–° APIï¼ˆhistory.pushState()+popState äº‹ä»¶ï¼‰\n\nHTML5 ä¸­ history å¯¹è±¡ä¸Šæ–°çš„ APIï¼ŒåŒæ ·èƒ½å®ç°å‰ç«¯çš„è·¯ç”±ã€‚é€šè¿‡ pushState()æ–¹æ³•æˆ– replaceState()æ–¹æ³•å¯ä»¥ä¿®æ”¹ url çš„åœ°å€ï¼Œå¹¶åœ¨ popstate äº‹ä»¶ä¸­èƒ½ç›‘å¬åœ°å€çš„æ”¹å˜ï¼Œä¸åŒçš„æ˜¯ï¼Œæ‰‹åŠ¨çš„è¿›è¡Œ pushState()å¹¶ä¸ä¼šè§¦å‘ popstate äº‹ä»¶ã€‚\n\n#### ä¸¤ä¸ªæ–°å¢çš„ APIï¼šhistory.pushState å’Œ history.replaceState\n\nè¿™ä¸¤ä¸ª API éƒ½æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š\n\n```javascript\nwindow.history.pushState(null, null, \"http://www.163.com\");\n```\n\n- çŠ¶æ€å¯¹è±¡ï¼ˆstate objectï¼‰ï¼Œä¸€ä¸ª JavaScript å¯¹è±¡ï¼Œä¸ç”¨ pushState()æ–¹æ³•åˆ›å»ºçš„æ–°å†å²è®°å½•æ¡ç›®å…³è”ã€‚æ— è®ºä½•æ—¶ç”¨æˆ·å¯¼èˆªåˆ°æ–°åˆ›å»ºçš„çŠ¶æ€ï¼Œä¼šè§¦å‘ popstate äº‹ä»¶ï¼Œå¹¶èƒ½åœ¨äº‹ä»¶ä¸­ä½¿ç”¨è¯¥å¯¹è±¡ã€‚\n- æ ‡é¢˜ï¼ˆtitleï¼‰ ï¼šä¼ å…¥ä¸€ä¸ªçŸ­æ ‡é¢˜ç»™å½“å‰ stateã€‚ç°åœ¨å¤§å¤šæ•°æµè§ˆå™¨ä¸æ”¯æŒæˆ–è€…ä¼šå¿½ç•¥æ­¤å‚æ•°ï¼Œæœ€å¥½ä¼ å…¥ null ä»£æ›¿ï¼›\n- åœ°å€ï¼ˆURLï¼‰ï¼šæ–°çš„å†å²è®°å½•æ¡ç›®çš„åœ°å€ã€‚æµè§ˆå™¨ä¸ä¼šåœ¨è°ƒç”¨ pushState()æ–¹æ³•ååŠ è½½è¯¥åœ°å€ï¼Œä½†ä¹‹åï¼Œå¯èƒ½ä¼šè¯•å›¾åŠ è½½ï¼Œä¾‹å¦‚ç”¨æˆ·é‡å¯æµè§ˆå™¨ã€‚æ–°çš„ URL ä¸ä¸€å®šæ˜¯ç»å¯¹è·¯å¾„ï¼›å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå®ƒå°†ä»¥å½“å‰ URL ä¸ºåŸºå‡†ï¼›ä¼ å…¥çš„ URL ä¸å½“å‰ URL åº”è¯¥æ˜¯**åŒæº**çš„ï¼Œå¦åˆ™ï¼ŒpushState()ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚è¯¥å‚æ•°æ˜¯å¯é€‰çš„ï¼›ä¸æŒ‡å®šçš„è¯åˆ™ä¸ºæ–‡æ¡£å½“å‰ URLã€‚\n\nè¿™ä¸¤ä¸ª API çš„ç›¸åŒä¹‹å¤„æ˜¯éƒ½ä¼šæ“ä½œæµè§ˆå™¨çš„å†å²è®°å½•ï¼Œè€Œä¸ä¼šå¼•èµ·é¡µé¢çš„åˆ·æ–°ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼ŒpushState ä¼šå¢åŠ ä¸€æ¡æ–°çš„å†å²è®°å½•ï¼Œè€Œ replaceState åˆ™ä¼šæ›¿æ¢å½“å‰çš„å†å²è®°å½•ã€‚è¿™ä¸¤ä¸ª apiï¼ŒåŠ ä¸Š state æ”¹å˜è§¦å‘çš„ popstate äº‹ä»¶ï¼Œæä¾›äº†å•é¡µåº”è¯¥çš„å¦ä¸€ç§è·¯ç”±æ–¹å¼ã€‚\n\n#### ä¸‹é¢å±•ç¤ºä¸€ä¸ªä½¿ç”¨è¿™ç§æ–¹å¼çš„ç®€å• demoï¼š\n\n```html\n<p id=\"menu\">\n  <a href=\"/profile\" title=\"profile\">profile</a>\n  <a href=\"/account\" title=\"account\">account</a>?\n</p>\n<div class=\"main\" id=\"main\"></div>\n<script>\n  (function() {\n    var menubox = document.getElementById(\"menu\");\n    var mainbox = document.getElementById(\"main\");\n\n    menubox.addEventListener(\"click\", function(e) {\n      e.preventDefault();\n      var elm = e.target;\n      var uri = elm.href;\n      var tlt = elm.title;\n      history.pushState({ path: uri, title: tlt }, null, uri);\n      mainbox.innerHTML = \"current page is \" + tlt;\n    });\n    window.addEventListener(\"popstate\", function(e) {\n      var state = e.state;\n      console.log(state);\n      mainbox.innerHTML = \"current page is \" + state.title; // è¿˜åŸUI\n    });\n  })();\n</script>\n```\n\nå½“æˆ‘ä»¬åœ¨å†å²è®°å½•ä¸­åˆ‡æ¢æ—¶å°±ä¼šè§¦å‘ popstate äº‹ä»¶ï¼Œå¯ä»¥åœ¨äº‹ä»¶ä¸­è¿˜åŸå½“å‰ state å¯¹åº”çš„ UIã€‚å¯¹äºè§¦å‘ popstate äº‹ä»¶çš„æ–¹å¼ï¼Œå„æµè§ˆå™¨å®ç°ä¹Ÿæœ‰å·®å¼‚ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒæµè§ˆå™¨åšå…¼å®¹å¤„ç†ã€‚\n\n- ### ä¸¤ç§æ–¹å¼å¯¹æ¯”ï¼ˆHistory&&hashï¼‰\n\nä¸¤ç§æ–¹å¼å¯¹æ¯”ï¼ŒåŸºäº Hash çš„è·¯ç”±ï¼Œå…¼å®¹æ€§æ›´å¥½ï¼›åŸºäº History API çš„è·¯ç”±ï¼Œåˆ™æ›´æ­£å¼ï¼Œå¯ä»¥è®¾ç½®ä¸å½“å‰ URL åŒæºçš„ä»»æ„ URLï¼Œè·¯å¾„æ›´ç›´è§‚ã€‚å¦å¤–ï¼ŒåŸºäº Hash çš„è·¯ç”±ä¸éœ€è¦å¯¹æœåŠ¡å™¨åšæ”¹åŠ¨ï¼ŒåŸºäº History API çš„è·¯ç”±éœ€è¦å¯¹æœåŠ¡å™¨åšä¸€äº›æ”¹é€ ï¼Œé…ç½®ä¸åŒçš„è·¯ç”±éƒ½è¿”å›ç›¸åŒçš„é¡µé¢ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6ixnv47e0j31320kwq3v.jpg)\n\n1. å½“ç›´æ¥è®¿é—®http://example.com/çš„æ—¶å€™ï¼Œä¸¤è€…çš„è¡Œä¸ºæ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯è¿”å›äº†index.htmlæ–‡ä»¶ã€‚å½“ä»http://example.com/è·³è½¬åˆ°http://example.com/#/foobaræˆ–è€…http://example.com/foobarçš„æ—¶å€™ï¼Œä¹Ÿéƒ½æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæ­¤æ—¶å·²ç»åŠ è½½äº†é¡µé¢ä»¥åŠè„šæœ¬æ–‡ä»¶ï¼Œæ‰€ä»¥è·¯ç”±è·³è½¬æ­£å¸¸ã€‚\n2. å½“ç›´æ¥è®¿é—®http://example.com/#/foobarçš„æ—¶å€™ï¼Œå®é™…ä¸Šå‘æœåŠ¡å™¨å‘èµ·çš„è¯·æ±‚æ˜¯http://example.com/ï¼Œå› æ­¤ä¼šé¦–å…ˆåŠ è½½é¡µé¢åŠè„šæœ¬æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥è„šæœ¬æ‰§è¡Œè·¯ç”±è·³è½¬ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚\n3. å½“ç›´æ¥è®¿é—®http://example.com/foobarçš„æ—¶å€™ï¼Œå®é™…ä¸Šå‘æœåŠ¡å™¨å‘èµ·çš„è¯·æ±‚ä¹Ÿæ˜¯http://example.com/foobarï¼Œç„¶è€ŒæœåŠ¡å™¨ç«¯åªèƒ½åŒ¹é…/è€Œæ— æ³•åŒ¹é…/foobarï¼Œå› æ­¤ä¼šå‡ºç°404é”™è¯¯ã€‚\n\nå› æ­¤å¦‚æœä½¿ç”¨äº†åŸºäº History API çš„è·¯ç”±ï¼Œéœ€è¦æ”¹é€ æœåŠ¡å™¨ç«¯ï¼Œä½¿å¾—è®¿é—®/foobar çš„æ—¶å€™ä¹Ÿèƒ½è¿”å› index.html æ–‡ä»¶ï¼Œè¿™æ ·å½“æµè§ˆå™¨åŠ è½½äº†é¡µé¢åŠè„šæœ¬ä¹‹åï¼Œå°±èƒ½è¿›è¡Œè·¯ç”±è·³è½¬äº†ã€‚\n\n# Vue Router\n\nvue-router åŸºæœ¬çš„è·¯ç”±é…ç½®å¦‚ä¸‹ï¼š\n\n```javascript\nimport Router from 'vue-router'\nimport Index from 'pages/index'\nimport Error from 'pages/error'\n\nVue.use(Router)\n\nexport default new Router({\n mode: 'history', // è®¾ç½®è·¯ç”±æ–¹å¼\n routes: [\n   {\n     path: '/',\n     name: 'index',\n     component: Index\n   },\n   {\n     path: '*',\n     name: '404',\n     component: Error\n   }\n ]\n})\n\n// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨routerè§†å›¾ç»„ä»¶\n<router-view></router-view>\n```\n\nå¯ä»¥é€šè¿‡ vue-router å®ä¾‹æ¥é…ç½®è·¯ç”±è§„åˆ™åˆ—è¡¨ï¼ŒæŒ‡å®šè·¯å¾„ path ä¸ç»„ä»¶ component çš„å¯¹åº”å…³ç³»ã€‚\n\n## 1.æ¨¡å¼å‚æ•°\n\nåœ¨ vue-router ä¸­æ˜¯é€šè¿‡ mode è¿™ä¸€å‚æ•°æ§åˆ¶è·¯ç”±çš„å®ç°æ¨¡å¼çš„ï¼š\n\n```javascript\nconst router = new VueRouter({\n  mode: 'history',\n  routes: [...]\n})\n```\n\nåˆ›å»º VueRouter çš„å®ä¾‹å¯¹è±¡æ—¶ï¼Œmode ä»¥æ„é€ å‡½æ•°å‚æ•°çš„å½¢å¼ä¼ å…¥ã€‚ä» VueRouter ç±»çš„å®šä¹‰å…¥æ‰‹ã€‚ä¸€èˆ¬æ’ä»¶å¯¹å¤–æš´éœ²çš„ç±»éƒ½æ˜¯å®šä¹‰åœ¨æºç  src æ ¹ç›®å½•ä¸‹çš„ index.js æ–‡ä»¶ä¸­ï¼Œæ‰“å¼€è¯¥æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ° VueRouter ç±»çš„å®šä¹‰ï¼Œæ‘˜å½•ä¸ mode å‚æ•°æœ‰å…³çš„éƒ¨åˆ†å¦‚ä¸‹ï¼š\n\n```javascript\nexport default class VueRouter {\n  mode: string; // ä¼ å…¥çš„å­—ç¬¦ä¸²å‚æ•°ï¼ŒæŒ‡ç¤ºhistoryç±»åˆ«\n  history: HashHistory | HTML5History | AbstractHistory; // å®é™…èµ·ä½œç”¨çš„å¯¹è±¡å±æ€§ï¼Œå¿…é¡»æ˜¯ä»¥ä¸Šä¸‰ä¸ªç±»çš„æšä¸¾\n  fallback: boolean; // å¦‚æµè§ˆå™¨ä¸æ”¯æŒï¼Œ'history'æ¨¡å¼éœ€å›æ»šä¸º'hash'æ¨¡å¼\n\n  constructor(options: RouterOptions = {}) {\n    let mode = options.mode || \"hash\"; // é»˜è®¤ä¸º'hash'æ¨¡å¼\n    this.fallback = mode === \"history\" && !supportsPushState; // é€šè¿‡supportsPushStateåˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒ'history'æ¨¡å¼\n    if (this.fallback) {\n      mode = \"hash\";\n    }\n    if (!inBrowser) {\n      mode = \"abstract\"; // ä¸åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹è¿è¡Œéœ€å¼ºåˆ¶ä¸º'abstract'æ¨¡å¼\n    }\n    this.mode = mode;\n\n    // æ ¹æ®modeç¡®å®šhistoryå®é™…çš„ç±»å¹¶å®ä¾‹åŒ–\n    switch (mode) {\n      case \"history\":\n        this.history = new HTML5History(this, options.base);\n        break;\n      case \"hash\":\n        this.history = new HashHistory(this, options.base, this.fallback);\n        break;\n      case \"abstract\":\n        this.history = new AbstractHistory(this, options.base);\n        break;\n      default:\n        if (process.env.NODE_ENV !== \"production\") {\n          assert(false, `invalid mode: ${mode}`);\n        }\n    }\n  }\n\n  init(app: any /* Vue component instance */) {\n    const history = this.history;\n\n    // æ ¹æ®historyçš„ç±»åˆ«æ‰§è¡Œç›¸åº”çš„åˆå§‹åŒ–æ“ä½œå’Œç›‘å¬\n    if (history instanceof HTML5History) {\n      history.transitionTo(history.getCurrentLocation());\n    } else if (history instanceof HashHistory) {\n      const setupHashListener = () => {\n        history.setupListeners();\n      };\n      history.transitionTo(\n        history.getCurrentLocation(),\n        setupHashListener,\n        setupHashListener\n      );\n    }\n\n    history.listen(route => {\n      this.apps.forEach(app => {\n        app._route = route;\n      });\n    });\n  }\n\n  // VueRouterç±»æš´éœ²çš„ä»¥ä¸‹æ–¹æ³•å®é™…æ˜¯è°ƒç”¨å…·ä½“historyå¯¹è±¡çš„æ–¹æ³•\n  push(location: RawLocation, onComplete?: Function, onAbort?: Function) {\n    this.history.push(location, onComplete, onAbort);\n  }\n\n  replace(location: RawLocation, onComplete?: Function, onAbort?: Function) {\n    this.history.replace(location, onComplete, onAbort);\n  }\n}\n```\n\nå¯ä»¥çœ‹å‡ºï¼š\n\n1. ä½œä¸ºå‚æ•°ä¼ å…¥çš„å­—ç¬¦ä¸²å±æ€§ mode åªæ˜¯ä¸€ä¸ªæ ‡è®°ï¼Œç”¨æ¥æŒ‡ç¤ºå®é™…èµ·ä½œç”¨çš„å¯¹è±¡å±æ€§ history çš„å®ç°ç±»ï¼Œä¸¤è€…å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š\n\n   modehistoryï¼š\n\n   - 'history'â€”â€”HTML5History\n   - 'hash'â€”â€”HashHistory\n   - 'abstract'â€”â€”AbstractHistory\n\n2. åœ¨åˆå§‹åŒ–å¯¹åº”çš„ history ä¹‹å‰ï¼Œä¼šå¯¹ mode åšä¸€äº›æ ¡éªŒï¼šè‹¥æµè§ˆå™¨ä¸æ”¯æŒ HTML5History æ–¹å¼ï¼ˆé€šè¿‡ supportsPushState å˜é‡åˆ¤æ–­ï¼‰ï¼Œåˆ™ mode å¼ºåˆ¶è®¾ä¸º'hash'ï¼›è‹¥ä¸æ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹è¿è¡Œï¼Œåˆ™ mode å¼ºåˆ¶è®¾ä¸º'abstract'\n\n3. VueRouter ç±»ä¸­çš„ onReady(), push()ç­‰æ–¹æ³•åªæ˜¯ä¸€ä¸ªä»£ç†ï¼Œå®é™…æ˜¯è°ƒç”¨çš„å…·ä½“ history å¯¹è±¡çš„å¯¹åº”æ–¹æ³•ï¼Œåœ¨ init()æ–¹æ³•ä¸­åˆå§‹åŒ–æ—¶ï¼Œä¹Ÿæ˜¯æ ¹æ® history å¯¹è±¡å…·ä½“çš„ç±»åˆ«æ‰§è¡Œä¸åŒæ“ä½œ\n\nåœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹çš„ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«å°±æ˜¯åœ¨ HTML5Historyï¼ŒHashHistory ä¸¤ä¸ªç±»ä¸­å®ç°çš„ã€‚ä»–ä»¬éƒ½å®šä¹‰åœ¨ src/history æ–‡ä»¶å¤¹ä¸‹ï¼Œç»§æ‰¿è‡ªåŒç›®å½•ä¸‹ base.js æ–‡ä»¶ä¸­å®šä¹‰çš„ History ç±»ã€‚History ä¸­å®šä¹‰çš„æ˜¯å…¬ç”¨å’ŒåŸºç¡€çš„æ–¹æ³•ï¼Œç›´æ¥çœ‹ä¼šä¸€å¤´é›¾æ°´ï¼Œæˆ‘ä»¬å…ˆä» HTML5Historyï¼ŒHashHistory ä¸¤ä¸ªç±»ä¸­çœ‹ç€äº²åˆ‡çš„ push(), replace()æ–¹æ³•çš„è¯´èµ·ã€‚\n\n## 2.HashHistory\n\nçœ‹æºç å‰å…ˆå›é¡¾ä¸€ä¸‹åŸç†ï¼š\n\nhashï¼ˆâ€œ#â€ï¼‰ç¬¦å·çš„æœ¬æ¥ä½œç”¨æ˜¯åŠ åœ¨ URL ä¸­æŒ‡ç¤ºç½‘é¡µä¸­çš„ä½ç½®ï¼š\n\n> http://www.example.com/index.html#print\n\n\\#ç¬¦å·æœ¬èº«ä»¥åŠå®ƒåé¢çš„å­—ç¬¦ç§°ä¹‹ä¸º hashï¼Œå¯é€šè¿‡ window.location.hash å±æ€§è¯»å–ã€‚å®ƒå…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š\n\n- hash è™½ç„¶å‡ºç°åœ¨ URL ä¸­ï¼Œä½†ä¸ä¼šè¢«åŒ…æ‹¬åœ¨ HTTP è¯·æ±‚ä¸­ã€‚å®ƒæ˜¯ç”¨æ¥æŒ‡å¯¼æµè§ˆå™¨åŠ¨ä½œçš„ï¼Œå¯¹æœåŠ¡å™¨ç«¯å®Œå…¨æ— ç”¨ï¼Œå› æ­¤ï¼Œæ”¹å˜ hash ä¸ä¼šé‡æ–°åŠ è½½é¡µé¢\n\n- å¯ä»¥ä¸º hash çš„æ”¹å˜æ·»åŠ ç›‘å¬äº‹ä»¶ï¼š\n\n  ```javascript\n  window.addEventListener(\"hashchange\", funcRef, false);\n  ```\n\n- æ¯ä¸€æ¬¡æ”¹å˜ hashï¼ˆwindow.location.hashï¼‰ï¼Œéƒ½ä¼šåœ¨æµè§ˆå™¨çš„è®¿é—®å†å²ä¸­å¢åŠ ä¸€ä¸ªè®°å½•\n\nåˆ©ç”¨ hash çš„ä»¥ä¸Šç‰¹ç‚¹ï¼Œå°±å¯ä»¥æ¥å®ç°å‰ç«¯è·¯ç”±â€œæ›´æ–°è§†å›¾ä½†ä¸é‡æ–°è¯·æ±‚é¡µé¢â€çš„åŠŸèƒ½äº†ã€‚\n\n### **HashHistory.push()**\n\næˆ‘ä»¬æ¥çœ‹ HashHistory ä¸­çš„ push()æ–¹æ³•ï¼š\n\n```javascript\npush (location: RawLocation, onComplete?: Function, onAbort?: Function) {\n  this.transitionTo(location, route => {\n    pushHash(route.fullPath)\n    onComplete && onComplete(route)\n  }, onAbort)\n}\n\nfunction pushHash (path) {\n  window.location.hash = path\n}\n```\n\ntransitionTo()æ–¹æ³•æ˜¯çˆ¶ç±»ä¸­å®šä¹‰çš„æ˜¯ç”¨æ¥å¤„ç†è·¯ç”±å˜åŒ–ä¸­çš„åŸºç¡€é€»è¾‘çš„ï¼Œ**push()æ–¹æ³•æœ€ä¸»è¦çš„æ˜¯å¯¹ window çš„ hash è¿›è¡Œäº†ç›´æ¥èµ‹å€¼ï¼š**\n\n```javascript\nwindow.location.hash = route.fullPath;\n```\n\n**hash çš„æ”¹å˜ä¼šè‡ªåŠ¨æ·»åŠ åˆ°æµè§ˆå™¨çš„è®¿é—®å†å²è®°å½•ä¸­ã€‚**\n\né‚£ä¹ˆè§†å›¾çš„æ›´æ–°æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Œæˆ‘ä»¬æ¥çœ‹çˆ¶ç±» History ä¸­ transitionTo()æ–¹æ³•çš„è¿™ä¹ˆä¸€æ®µï¼š\n\n```javascript\ntransitionTo (location: RawLocation, onComplete?: Function, onAbort?: Function) {\n  const route = this.router.match(location, this.current)\n  this.confirmTransition(route, () => {\n    this.updateRoute(route)\n    ...\n  })\n}\n\nupdateRoute (route: Route) {\n  this.cb && this.cb(route)\n}\n\nlisten (cb: Function) {\n  this.cb = cb\n}\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œå½“è·¯ç”±å˜åŒ–æ—¶ï¼Œè°ƒç”¨äº† History ä¸­çš„ this.cb æ–¹æ³•ï¼Œè€Œ this.cb æ–¹æ³•æ˜¯é€šè¿‡ History.listen(cb)è¿›è¡Œè®¾ç½®çš„ã€‚å›åˆ° VueRouter ç±»å®šä¹‰ä¸­ï¼Œæ‰¾åˆ°äº†åœ¨ init()æ–¹æ³•ä¸­å¯¹å…¶è¿›è¡Œäº†è®¾ç½®ï¼š\n\n```javascript\ninit (app: any /* Vue component instance */) {\n\n  this.apps.push(app)\n\n  history.listen(route => {\n    this.apps.forEach((app) => {\n      app._route = route\n    })\n  })\n}\n\n```\n\næ ¹æ®æ³¨é‡Šï¼Œapp ä¸º Vue ç»„ä»¶å®ä¾‹ï¼Œä½†æˆ‘ä»¬çŸ¥é“ Vue ä½œä¸ºæ¸è¿›å¼çš„å‰ç«¯æ¡†æ¶ï¼Œæœ¬èº«çš„ç»„ä»¶å®šä¹‰ä¸­åº”è¯¥æ˜¯æ²¡æœ‰æœ‰å…³è·¯ç”±å†…ç½®å±æ€§\\_routeï¼Œå¦‚æœç»„ä»¶ä¸­è¦æœ‰è¿™ä¸ªå±æ€§ï¼Œåº”è¯¥æ˜¯åœ¨æ’ä»¶åŠ è½½çš„åœ°æ–¹ï¼Œå³ VueRouter çš„ install()æ–¹æ³•ä¸­æ··åˆå…¥ Vue å¯¹è±¡çš„ï¼ŒæŸ¥çœ‹ install.js æºç ï¼Œæœ‰å¦‚ä¸‹ä¸€æ®µï¼š\n\n```javascript\nexport function install(Vue) {\n  Vue.mixin({\n    beforeCreate() {\n      if (isDef(this.$options.router)) {\n        this._router = this.$options.router;\n        this._router.init(this);\n        Vue.util.defineReactive(this, \"_route\", this._router.history.current);\n      }\n      registerInstance(this, this);\n    }\n  });\n}\n```\n\né€šè¿‡ Vue.mixin()æ–¹æ³•ï¼Œå…¨å±€æ³¨å†Œä¸€ä¸ªæ··åˆï¼Œå½±å“æ³¨å†Œä¹‹åæ‰€æœ‰åˆ›å»ºçš„æ¯ä¸ª Vue å®ä¾‹ï¼Œè¯¥æ··åˆåœ¨ beforeCreate é’©å­ä¸­é€šè¿‡ Vue.util.defineReactive()å®šä¹‰äº†å“åº”å¼çš„\\_route å±æ€§ã€‚æ‰€è°“å“åº”å¼å±æ€§ï¼Œå³å½“\\_route å€¼æ”¹å˜æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ Vue å®ä¾‹çš„ render()æ–¹æ³•ï¼Œæ›´æ–°è§†å›¾ã€‚\n\n#### **æ€»ç»“ä¸€ä¸‹ï¼Œä»è®¾ç½®è·¯ç”±æ”¹å˜åˆ°è§†å›¾æ›´æ–°çš„æµç¨‹å¦‚ä¸‹ï¼š**\n\n```javascript\n$router.push() --> HashHistory.push() --> History.transitionTo() --> History.updateRoute() --> {app._route = route} --> vm.render()\n```\n\n### **HashHistory.replace()**\n\nreplace()æ–¹æ³•ä¸ push()æ–¹æ³•ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒå¹¶ä¸æ˜¯å°†æ–°è·¯ç”±æ·»åŠ åˆ°æµè§ˆå™¨è®¿é—®å†å²çš„æ ˆé¡¶ï¼Œè€Œæ˜¯æ›¿æ¢æ‰å½“å‰çš„è·¯ç”±ï¼š\n\n```javascript\nreplace (location: RawLocation, onComplete?: Function, onAbort?: Function) {\n  this.transitionTo(location, route => {\n    replaceHash(route.fullPath)\n    onComplete && onComplete(route)\n  }, onAbort)\n}\n\nfunction replaceHash (path) {\n  const i = window.location.href.indexOf('#')\n  window.location.replace(\n    window.location.href.slice(0, i >= 0 ? i : 0) + '#' + path\n  )\n}\n```\n\nå¯ä»¥çœ‹å‡ºï¼Œå®ƒä¸ push()çš„å®ç°ç»“æ„ä¸ŠåŸºæœ¬ç›¸ä¼¼ï¼Œ**ä¸åŒç‚¹åœ¨äºå®ƒä¸æ˜¯ç›´æ¥å¯¹ window.location.hash è¿›è¡Œèµ‹å€¼ï¼Œè€Œæ˜¯è°ƒç”¨ window.location.replace æ–¹æ³•å°†è·¯ç”±è¿›è¡Œæ›¿æ¢ã€‚**\n\n### **ç›‘å¬åœ°å€æ **\n\nä»¥ä¸Šè®¨è®ºçš„ VueRouter.push()å’Œ VueRouter.replace()æ˜¯å¯ä»¥åœ¨ vue ç»„ä»¶çš„é€»è¾‘ä»£ç ä¸­ç›´æ¥è°ƒç”¨çš„ï¼Œé™¤æ­¤ä¹‹å¤–åœ¨æµè§ˆå™¨ä¸­ï¼Œç”¨æˆ·è¿˜å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥æ”¹å˜è·¯ç”±ï¼Œå› æ­¤ VueRouter è¿˜éœ€è¦èƒ½ç›‘å¬æµè§ˆå™¨åœ°å€æ ä¸­è·¯ç”±çš„å˜åŒ–ï¼Œå¹¶å…·æœ‰ä¸é€šè¿‡ä»£ç è°ƒç”¨ç›¸åŒçš„å“åº”è¡Œä¸ºã€‚åœ¨ HashHistory ä¸­è¿™ä¸€åŠŸèƒ½é€šè¿‡ setupListeners å®ç°ï¼š\n\n```javascript\nsetupListeners () {\n  window.addEventListener('hashchange', () => {\n    if (!ensureSlash()) {\n      return\n    }\n    this.transitionTo(getHash(), route => {\n      replaceHash(route.fullPath)\n    })\n  })\n}\n\n```\n\nè¯¥æ–¹æ³•è®¾ç½®ç›‘å¬äº†æµè§ˆå™¨äº‹ä»¶ hashchangeï¼Œè°ƒç”¨çš„å‡½æ•°ä¸º replaceHashï¼Œå³åœ¨æµè§ˆå™¨åœ°å€æ ä¸­ç›´æ¥è¾“å…¥è·¯ç”±ç›¸å½“äºä»£ç è°ƒç”¨äº† replace()æ–¹æ³•\n\n## 3.HTML5History\n\nHistory interface æ˜¯æµè§ˆå™¨å†å²è®°å½•æ ˆæä¾›çš„æ¥å£ï¼Œé€šè¿‡ back(), forward(), go()ç­‰æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–æµè§ˆå™¨å†å²è®°å½•æ ˆçš„ä¿¡æ¯ï¼Œè¿›è¡Œå„ç§è·³è½¬æ“ä½œã€‚\n\n### ä» HTML5 å¼€å§‹ï¼ŒHistory interface æä¾›äº†ä¸¤ä¸ªæ–°çš„æ–¹æ³•ï¼špushState(), replaceState()ä½¿å¾—æˆ‘ä»¬å¯ä»¥å¯¹æµè§ˆå™¨å†å²è®°å½•æ ˆè¿›è¡Œä¿®æ”¹ï¼š\n\n```javascript\nwindow.history.pushState(stateObject, title, URL);\nwindow.history.replaceState(stateObject, title, URL);\n```\n\n- stateObject: å½“æµè§ˆå™¨è·³è½¬åˆ°æ–°çš„çŠ¶æ€æ—¶ï¼Œå°†è§¦å‘ popState äº‹ä»¶ï¼Œè¯¥äº‹ä»¶å°†æºå¸¦è¿™ä¸ª stateObject å‚æ•°çš„å‰¯æœ¬\n- title: æ‰€æ·»åŠ è®°å½•çš„æ ‡é¢˜\n- URL: æ‰€æ·»åŠ è®°å½•çš„ URL\n\nè¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼šå½“è°ƒç”¨ä»–ä»¬ä¿®æ”¹æµè§ˆå™¨å†å²è®°å½•æ ˆåï¼Œè™½ç„¶å½“å‰ URL æ”¹å˜äº†ï¼Œä½†æµè§ˆå™¨ä¸ä¼šç«‹å³å‘é€è¯·æ±‚è¯¥ URLï¼ˆthe browser won't attempt to load this URL after a call to pushState()ï¼‰ï¼Œè¿™å°±ä¸ºå•é¡µåº”ç”¨å‰ç«¯è·¯ç”±â€œæ›´æ–°è§†å›¾ä½†ä¸é‡æ–°è¯·æ±‚é¡µé¢â€æä¾›äº†åŸºç¡€ã€‚\n\næˆ‘ä»¬æ¥çœ‹ vue-router ä¸­çš„æºç ï¼š\n\n```javascript\npush (location: RawLocation, onComplete?: Function, onAbort?: Function) {\n  const { current: fromRoute } = this\n  this.transitionTo(location, route => {\n    pushState(cleanPath(this.base + route.fullPath))\n    handleScroll(this.router, route, fromRoute, false)\n    onComplete && onComplete(route)\n  }, onAbort)\n}\n\nreplace (location: RawLocation, onComplete?: Function, onAbort?: Function) {\n  const { current: fromRoute } = this\n  this.transitionTo(location, route => {\n    replaceState(cleanPath(this.base + route.fullPath))\n    handleScroll(this.router, route, fromRoute, false)\n    onComplete && onComplete(route)\n  }, onAbort)\n}\n\n// src/util/push-state.js\nexport function pushState (url?: string, replace?: boolean) {\n  saveScrollPosition()\n  // try...catch the pushState call to get around Safari\n  // DOM Exception 18 where it limits to 100 pushState calls\n  const history = window.history\n  try {\n    if (replace) {\n      history.replaceState({ key: _key }, '', url)\n    } else {\n      _key = genKey()\n      history.pushState({ key: _key }, '', url)\n    }\n  } catch (e) {\n    window.location[replace ? 'replace' : 'assign'](url)\n  }\n}\n\nexport function replaceState (url?: string) {\n  pushState(url, true)\n}\n\n```\n\nä»£ç ç»“æ„ä»¥åŠæ›´æ–°è§†å›¾çš„é€»è¾‘ä¸ hash æ¨¡å¼åŸºæœ¬ç±»ä¼¼ï¼Œåªä¸è¿‡**å°†å¯¹ window.location.hash ç›´æ¥è¿›è¡Œèµ‹å€¼ window.location.replace()æ”¹ä¸ºäº†è°ƒç”¨ history.pushState()å’Œ history.replaceState()æ–¹æ³•ã€‚**\n\n### åœ¨ HTML5History ä¸­æ·»åŠ å¯¹ä¿®æ”¹æµè§ˆå™¨åœ°å€æ  URL çš„ç›‘å¬æ˜¯ç›´æ¥åœ¨æ„é€ å‡½æ•°ä¸­æ‰§è¡Œçš„ï¼š\n\n```javascript\nconstructor (router: Router, base: ?string) {\n\n  window.addEventListener('popstate', e => {\n    const current = this.current\n    this.transitionTo(getLocation(this.base), route => {\n      if (expectScroll) {\n        handleScroll(router, route, current, true)\n      }\n    })\n  })\n}\n\n```\n\nå½“ç„¶äº† HTML5History ç”¨åˆ°äº† HTML5 çš„æ–°ç‰¹ç‰¹æ€§ï¼Œæ˜¯éœ€è¦ç‰¹å®šæµè§ˆå™¨ç‰ˆæœ¬çš„æ”¯æŒçš„ï¼Œå‰æ–‡å·²ç»çŸ¥é“ï¼Œæµè§ˆå™¨æ˜¯å¦æ”¯æŒæ˜¯é€šè¿‡å˜é‡ supportsPushState æ¥æ£€æŸ¥çš„ï¼š\n\n```javascript\n// src/util/push-state.js\nexport const supportsPushState =\n  inBrowser &&\n  (function() {\n    const ua = window.navigator.userAgent;\n\n    if (\n      (ua.indexOf(\"Android 2.\") !== -1 || ua.indexOf(\"Android 4.0\") !== -1) &&\n      ua.indexOf(\"Mobile Safari\") !== -1 &&\n      ua.indexOf(\"Chrome\") === -1 &&\n      ua.indexOf(\"Windows Phone\") === -1\n    ) {\n      return false;\n    }\n\n    return window.history && \"pushState\" in window.history;\n  })();\n```\n\nè¿™ä¸¤ç§æ¨¡å¼éƒ½æ˜¯é€šè¿‡æµè§ˆå™¨æ¥å£å®ç°çš„ï¼Œé™¤æ­¤ä¹‹å¤– vue-router è¿˜ä¸ºéæµè§ˆå™¨ç¯å¢ƒå‡†å¤‡äº†ä¸€ä¸ª abstract æ¨¡å¼ï¼Œå…¶åŸç†ä¸ºç”¨ä¸€ä¸ªæ•°ç»„ stack æ¨¡æ‹Ÿå‡ºæµè§ˆå™¨å†å²è®°å½•æ ˆçš„åŠŸèƒ½ã€‚\n\n## 4.vue ä¸­ä¸¤ç§æ¨¡å¼æ¯”è¾ƒ\n\nåœ¨ä¸€èˆ¬çš„éœ€æ±‚åœºæ™¯ä¸­ï¼Œhash æ¨¡å¼ä¸ history æ¨¡å¼æ˜¯å·®ä¸å¤šçš„ï¼Œä½†å‡ ä¹æ‰€æœ‰çš„æ–‡ç« éƒ½æ¨èä½¿ç”¨ history æ¨¡å¼ï¼Œç†ç”±ç«Ÿç„¶æ˜¯ï¼š\"#\" ç¬¦å·å¤ªä¸‘...0_0 \"\n\n> å¦‚æœä¸æƒ³è¦å¾ˆä¸‘çš„ hashï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è·¯ç”±çš„ history æ¨¡å¼ â€”â€”å®˜æ–¹æ–‡æ¡£\n\nå½“ç„¶ï¼Œä¸¥è°¨çš„æˆ‘ä»¬è‚¯å®šä¸åº”è¯¥ç”¨é¢œå€¼è¯„ä»·æŠ€æœ¯çš„å¥½åã€‚**æ ¹æ® MDN çš„ä»‹ç»ï¼Œè°ƒç”¨ history.pushState()ç›¸æ¯”äºç›´æ¥ä¿®æ”¹ hash ä¸»è¦æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š**\n\n- pushState è®¾ç½®çš„æ–° URL å¯ä»¥æ˜¯ä¸å½“å‰ URL åŒæºçš„ä»»æ„ URLï¼›è€Œ hash åªå¯ä¿®æ”¹#åé¢çš„éƒ¨åˆ†ï¼Œæ•…åªå¯è®¾ç½®ä¸å½“å‰åŒæ–‡æ¡£çš„ URL\n- pushState è®¾ç½®çš„æ–° URL å¯ä»¥ä¸å½“å‰ URL ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™æ ·ä¹Ÿä¼šæŠŠè®°å½•æ·»åŠ åˆ°æ ˆä¸­ï¼›è€Œ hash è®¾ç½®çš„æ–°å€¼å¿…é¡»ä¸åŸæ¥ä¸ä¸€æ ·æ‰ä¼šè§¦å‘è®°å½•æ·»åŠ åˆ°æ ˆä¸­\n- pushState é€šè¿‡ stateObject å¯ä»¥æ·»åŠ ä»»æ„ç±»å‹çš„æ•°æ®åˆ°è®°å½•ä¸­ï¼›è€Œ hash åªå¯æ·»åŠ çŸ­å­—ç¬¦ä¸²\n- pushState å¯é¢å¤–è®¾ç½® title å±æ€§ä¾›åç»­ä½¿ç”¨\n\n_a æ ‡ç­¾ hash è·³è½¬ï¼Œä¼šæ”¹å˜é¡µé¢è·¯å¾„çš„ hash å€¼ï¼Œä½†ä¸ä¼šé‡è½½_\n\n**history æ¨¡å¼çš„ä¸€ä¸ªé—®é¢˜**\n\næˆ‘ä»¬çŸ¥é“å¯¹äºå•é¡µåº”ç”¨æ¥è®²ï¼Œç†æƒ³çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»…åœ¨è¿›å…¥åº”ç”¨æ—¶åŠ è½½ index.htmlï¼Œåç»­åœ¨çš„ç½‘ç»œæ“ä½œé€šè¿‡ Ajax å®Œæˆï¼Œä¸ä¼šæ ¹æ® URL é‡æ–°è¯·æ±‚é¡µé¢ï¼Œä½†æ˜¯éš¾å…é‡åˆ°ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ç”¨æˆ·ç›´æ¥åœ¨åœ°å€æ ä¸­è¾“å…¥å¹¶å›è½¦ï¼Œæµè§ˆå™¨é‡å¯é‡æ–°åŠ è½½åº”ç”¨ç­‰ã€‚\n\nhash æ¨¡å¼ä»…æ”¹å˜ hash éƒ¨åˆ†çš„å†…å®¹ï¼Œè€Œ hash éƒ¨åˆ†æ˜¯ä¸ä¼šåŒ…å«åœ¨ HTTP è¯·æ±‚ä¸­çš„ï¼š\n\n```http\nhttp://oursite.com/#/user/id   // å¦‚é‡æ–°è¯·æ±‚åªä¼šå‘é€http://oursite.com/\n\n```\n\næ•…åœ¨ hash æ¨¡å¼ä¸‹é‡åˆ°æ ¹æ® URL è¯·æ±‚é¡µé¢çš„æƒ…å†µä¸ä¼šæœ‰é—®é¢˜ã€‚\n\nè€Œ history æ¨¡å¼åˆ™ä¼šå°† URL ä¿®æ”¹å¾—å°±å’Œæ­£å¸¸è¯·æ±‚åç«¯çš„ URL ä¸€æ ·\n\n```http\nhttp://oursite.com/user/id\n\n```\n\nåœ¨æ­¤æƒ…å†µä¸‹é‡æ–°å‘åç«¯å‘é€è¯·æ±‚ï¼Œå¦‚åç«¯æ²¡æœ‰é…ç½®å¯¹åº”/user/id çš„è·¯ç”±å¤„ç†ï¼Œåˆ™ä¼šè¿”å› 404 é”™è¯¯ã€‚å®˜æ–¹æ¨èçš„è§£å†³åŠæ³•æ˜¯åœ¨æœåŠ¡ç«¯å¢åŠ ä¸€ä¸ªè¦†ç›–æ‰€æœ‰æƒ…å†µçš„å€™é€‰èµ„æºï¼šå¦‚æœ URL åŒ¹é…ä¸åˆ°ä»»ä½•é™æ€èµ„æºï¼Œåˆ™åº”è¯¥è¿”å›åŒä¸€ä¸ª index.html é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢å°±æ˜¯ä½  app ä¾èµ–çš„é¡µé¢ã€‚åŒæ—¶è¿™ä¹ˆåšä»¥åï¼ŒæœåŠ¡å™¨å°±ä¸å†è¿”å› 404 é”™è¯¯é¡µé¢ï¼Œå› ä¸ºå¯¹äºæ‰€æœ‰è·¯å¾„éƒ½ä¼šè¿”å› index.html æ–‡ä»¶ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåœ¨ Vue åº”ç”¨é‡Œé¢è¦†ç›–æ‰€æœ‰çš„è·¯ç”±æƒ…å†µï¼Œç„¶ååœ¨ç»™å‡ºä¸€ä¸ª 404 é¡µé¢ã€‚æˆ–è€…ï¼Œå¦‚æœæ˜¯ç”¨ Node.js ä½œåå°ï¼Œå¯ä»¥ä½¿ç”¨æœåŠ¡ç«¯çš„è·¯ç”±æ¥åŒ¹é… URLï¼Œå½“æ²¡æœ‰åŒ¹é…åˆ°è·¯ç”±çš„æ—¶å€™è¿”å› 404ï¼Œä»è€Œå®ç° fallbackã€‚\n\n## 5.AbstractHistory\n\n'abstract'æ¨¡å¼ï¼Œä¸æ¶‰åŠå’Œæµè§ˆå™¨åœ°å€çš„ç›¸å…³è®°å½•ï¼Œæµç¨‹è·Ÿ'HashHistory'æ˜¯ä¸€æ ·çš„ï¼Œå…¶åŸç†æ˜¯é€šè¿‡æ•°ç»„æ¨¡æ‹Ÿæµè§ˆå™¨å†å²è®°å½•æ ˆçš„åŠŸèƒ½\n\n```javascript\n// å¯¹äº go çš„æ¨¡æ‹Ÿ\n    go (n: number) {\n        // æ–°çš„å†å²è®°å½•ä½ç½®\n        const targetIndex = this.index + n\n        // è¶…å‡ºè¿”å›äº†\n        if (targetIndex < 0 || targetIndex >= this.stack.length) {\n            return\n        }\n        // å–å¾—æ–°çš„ route å¯¹è±¡\n        // å› ä¸ºæ˜¯å’Œæµè§ˆå™¨æ— å…³çš„ è¿™é‡Œå¾—åˆ°çš„ä¸€å®šæ˜¯å·²ç»è®¿é—®è¿‡çš„\n        const route = this.stack[targetIndex]\n        // æ‰€ä»¥è¿™é‡Œç›´æ¥è°ƒç”¨ confirmTransition äº†\n        // è€Œä¸æ˜¯è°ƒç”¨ transitionTo è¿˜è¦èµ°ä¸€é match é€»è¾‘\n        this.confirmTransition(route, () => {\n            // æ›´æ–°\n            this.index = targetIndex\n            this.updateRoute(route)\n        })\n    }\n\n```\n\n## 6.ç›´æ¥åŠ è½½åº”ç”¨æ–‡ä»¶\n\n> Tip: built files are meant to be served over an HTTP server.\n>\n> Opening index.html over file:// won't work.\n\nVue é¡¹ç›®é€šè¿‡ vue-cli çš„ webpack æ‰“åŒ…å®Œæˆåï¼Œå‘½ä»¤è¡Œä¼šæœ‰è¿™ä¹ˆä¸€æ®µæç¤ºã€‚é€šå¸¸æƒ…å†µï¼Œæ— è®ºæ˜¯å¼€å‘è¿˜æ˜¯çº¿ä¸Šï¼Œå‰ç«¯é¡¹ç›®éƒ½æ˜¯é€šè¿‡æœåŠ¡å™¨è®¿é—®ï¼Œä¸å­˜åœ¨ \"Opening index.html over file://\" ï¼Œä½†ç¨‹åºå‘˜éƒ½çŸ¥é“ï¼Œéœ€æ±‚å’Œåœºæ™¯æ°¸è¿œæ˜¯åƒå¥‡ç™¾æ€ªçš„ï¼Œåªæœ‰ä½ æƒ³ä¸åˆ°çš„ï¼Œæ²¡æœ‰äº§å“ç»ç†æƒ³ä¸åˆ°çš„ã€‚\n\næœ¬æ–‡å†™ä½œçš„åˆè¡·å°±æ˜¯é‡åˆ°äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šéœ€è¦å¿«é€Ÿå¼€å‘ä¸€ä¸ªç§»åŠ¨ç«¯çš„å±•ç¤ºé¡¹ç›®ï¼Œå†³å®šé‡‡ç”¨ WebView åŠ è½½ Vue å•é¡µåº”ç”¨çš„å½¢å¼ï¼Œä½†æ²¡æœ‰åç«¯æœåŠ¡å™¨æä¾›ï¼Œæ‰€ä»¥æ‰€æœ‰èµ„æºéœ€ä»æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½ï¼š\n\n```javascript\n// AndroidAppWrapper\npublic class MainActivity extends AppCompatActivity {\n\n    private WebView webView;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        webView = new WebView(this);\n        webView.getSettings().setJavaScriptEnabled(true);\n        webView.loadUrl(\"file:///android_asset/index.html\");\n        setContentView(webView);\n    }\n\n    @Override\n    public boolean onKeyDown(int keyCode, KeyEvent event) {\n        if ((keyCode == KeyEvent.KEYCODE_BACK) && webView.canGoBack()) {\n            webView.goBack();\n            return true;\n        }\n        return false;\n    }\n}\n\n```\n\næ­¤æƒ…æ­¤æ™¯çœ‹æ¥æ˜¯å¿…é¡» \"Opening index.html over file://\" äº†ï¼Œä¸ºæ­¤ï¼Œæˆ‘é¦–å…ˆè¦è¿›è¡Œäº†ä¸€äº›è®¾ç½®\n\n- åœ¨é¡¹ç›® config.js æ–‡ä»¶ä¸­å°† assetsPublicPath å­—æ®µçš„å€¼æ”¹ä¸ºç›¸å¯¹è·¯å¾„ './'\n- è°ƒæ•´ç”Ÿæˆçš„ static æ–‡ä»¶å¤¹ä¸­å›¾ç‰‡ç­‰é™æ€èµ„æºçš„ä½ç½®ä¸ä»£ç ä¸­çš„å¼•ç”¨åœ°å€ä¸€è‡´\n\nè¿™æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„éœ€è¦æ”¹åŠ¨ä¹‹å¤„ï¼Œä½†æ”¹å®Œåä¾æ—§æ— æ³•é¡ºåˆ©åŠ è½½ï¼Œç»è¿‡åå¤æ’æŸ¥å‘ç°ï¼Œé¡¹ç›®åœ¨å¼€å‘æ—¶ï¼Œrouter è®¾ç½®ä¸ºäº† history æ¨¡å¼ï¼ˆä¸ºäº†ç¾è§‚...0_0\"ï¼‰ï¼Œå½“æ”¹ä¸º hash æ¨¡å¼åå°±å¯æ­£å¸¸åŠ è½½äº†ã€‚\n\nä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿæˆ‘åˆ†æåŸå› å¯èƒ½å¦‚ä¸‹ï¼š\n\nå½“ä»æ–‡ä»¶ç³»ç»Ÿä¸­ç›´æ¥åŠ è½½ index.html æ—¶ï¼ŒURL ä¸ºï¼š\n\n```text\nfile:///android_asset/index.html\n\n```\n\nè€Œé¦–é¡µè§†å›¾éœ€åŒ¹é…çš„è·¯å¾„ä¸º path: '/' :\n\n```javascript\nexport default new Router({\n  mode: \"history\",\n  routes: [\n    {\n      path: \"/\",\n      name: \"index\",\n      component: IndexView\n    }\n  ]\n});\n```\n\næˆ‘ä»¬å…ˆæ¥çœ‹ history æ¨¡å¼ï¼Œåœ¨ HTML5History ä¸­ï¼š\n\n```javascript\nensureURL (push?: boolean) {\n  if (getLocation(this.base) !== this.current.fullPath) {\n    const current = cleanPath(this.base + this.current.fullPath)\n    push ? pushState(current) : replaceState(current)\n  }\n}\n\nexport function getLocation (base: string): string {\n  let path = window.location.pathname\n  if (base && path.indexOf(base) === 0) {\n    path = path.slice(base.length)\n  }\n  return (path || '/') + window.location.search + window.location.hash\n}\n\n```\n\né€»è¾‘åªä¼šç¡®ä¿å­˜åœ¨ URLï¼Œpath æ˜¯é€šè¿‡å‰ªåˆ‡çš„æ–¹å¼ç›´æ¥ä» window.location.pathname è·å–åˆ°çš„ï¼Œå®ƒçš„ç»“å°¾æ˜¯ index.htmlï¼Œå› æ­¤åŒ¹é…ä¸åˆ° '/' ï¼Œæ•… \"Opening index.html over file:// won't work\" ã€‚\n\nå†çœ‹ hash æ¨¡å¼ï¼Œåœ¨ HashHistory ä¸­ï¼š\n\n```javascript\nexport class HashHistory extends History {\n  constructor (router: Router, base: ?string, fallback: boolean) {\n    ...\n    ensureSlash()\n  }\n\n  // this is delayed until the app mounts\n  // to avoid the hashchange listener being fired too early\n  setupListeners () {\n    window.addEventListener('hashchange', () => {\n      if (!ensureSlash()) {\n        return\n      }\n      ...\n    })\n  }\n\n  getCurrentLocation () {\n    return getHash()\n  }\n}\n\nfunction ensureSlash (): boolean {\n  const path = getHash()\n  if (path.charAt(0) === '/') {\n    return true\n  }\n  replaceHash('/' + path)\n  return false\n}\n\nexport function getHash (): string {\n  const href = window.location.href\n  const index = href.indexOf('#')\n  return index === -1 ? '' : href.slice(index + 1)\n}\n```\n\næˆ‘ä»¬çœ‹åˆ°åœ¨ä»£ç é€»è¾‘ä¸­ï¼Œå¤šæ¬¡å‡ºç°ä¸€ä¸ªå‡½æ•° ensureSlash()ï¼Œå½“#ç¬¦å·åç´§è·Ÿç€çš„æ˜¯'/'ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™å¼ºè¡Œæ’å…¥è¿™ä¸ª'/'ï¼Œæ•…æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿æ˜¯ä»æ–‡ä»¶ç³»ç»Ÿæ‰“å¼€ index.htmlï¼ŒURL ä¾æ—§ä¼šå˜ä¸ºä»¥ä¸‹å½¢å¼ï¼š\n\n```text\nfile:///C:/Users/dist/index.html#/\n```\n\ngetHash()æ–¹æ³•è¿”å›çš„ path ä¸º '/' ï¼Œå¯ä¸é¦–é¡µè§†å›¾çš„è·¯ç”±åŒ¹é…ã€‚\n\n**æ•…è¦æƒ³ä»æ–‡ä»¶ç³»ç»Ÿç›´æ¥åŠ è½½ Vue å•é¡µåº”ç”¨è€Œä¸å€ŸåŠ©åç«¯æœåŠ¡å™¨ï¼Œé™¤äº†æ‰“åŒ…åçš„ä¸€äº›è·¯å¾„è®¾ç½®å¤–ï¼Œè¿˜éœ€ç¡®ä¿ vue-router ä½¿ç”¨çš„æ˜¯ hash æ¨¡å¼ã€‚**\n\n# React Router\n\nreact-router æ˜¯åŸºäº history æ¨¡å—æä¾›çš„ api è¿›è¡Œå¼€å‘çš„ã€‚å…¶è·¯ç”±é…ç½®æ˜¯é€šè¿‡ react component æ–¹å¼è¿›è¡Œçš„ï¼Œè·¯ç”±æ›´æ”¹è§¦å‘çš„å›è°ƒå‡½æ•°æ˜¯**æˆ‘ä»¬è‡ªå·±å†™çš„æ“ä½œ DOM çš„å‡½æ•°**ï¼›åœ¨ react ä¸­æˆ‘ä»¬ä¸ç›´æ¥æ“ä½œ DOMï¼Œè€Œæ˜¯ç®¡ç†æŠ½è±¡å‡ºæ¥çš„ VDOM æˆ–è€…è¯´ JSXï¼Œå¯¹ react çš„æ¥è¯´**è·¯ç”±éœ€è¦ç®¡ç†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯¹ä¸åŒçš„è·¯ç”±æ¸²æŸ“ä¸åŒçš„ç»„ä»¶**ã€‚\n\nå¦‚ä¸‹ï¼š\n\n```react\nrender((\n  <Router history={browserHistory}>\n    <Route path=\"/\" component={App}>\n      <Route path=\"about\" component={About}/>\n      <Route path=\"users\" component={Users}>\n        <Route path=\"/user/:userId\" component={User}/>\n      </Route>\n      <Route path=\"*\" component={NoMatch}/>\n    </Route>\n  </Router>\n), document.body)\n\n// link è§¦å‘è·¯ç”±\n<Link to={`/user/89757`}>'joey'</Link>\n```\n\nä»¥ä¸Šå£°æ˜äº†ä¸€ä»½å«æœ‰ path to component çš„å„ä¸ªæ˜ å°„çš„è·¯ç”±è¡¨ã€‚Router åœ¨ react ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„é’©å­ componentWillMount ï¼ˆç»„ä»¶è¢«æŒ‚è½½å‰ï¼‰ä¸­ï¼Œä½¿ç”¨ this.history.listen å»æ³¨å†Œäº† url æ›´æ–°çš„å›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°å°†åœ¨ url æ›´æ–°æ—¶è§¦å‘ï¼Œå›è°ƒä¸­çš„ setState ä¼šå» render æ–°çš„ componentã€‚\n\n## 1.history\n\n[history](https://github.com/ReactTraining/history#readme) åº“ï¼Œæ˜¯ rr4 ä¾èµ–çš„ä¸€ä¸ªå¯¹ `window.history` åŠ å¼ºç‰ˆçš„ history åº“ã€‚\n\n### match\n\næºè‡ª history åº“ï¼Œè¡¨ç¤ºå½“å‰çš„ URL ä¸ path çš„åŒ¹é…çš„ç»“æœ\n\n```react\nmatch: {\n    path: \"/\", // ç”¨æ¥åŒ¹é…çš„ path\n\turl: \"/\", // å½“å‰çš„ URL\n\tparams: {}, // è·¯å¾„ä¸­çš„å‚æ•°\n\tisExact: pathname === \"/\" // æ˜¯å¦ä¸ºä¸¥æ ¼åŒ¹é…\n}\n\n```\n\n### location\n\nè¿˜æ˜¯æºè‡ª history åº“ï¼Œæ˜¯ history åº“åŸºäº window.location çš„ä¸€ä¸ªè¡ç”Ÿã€‚\n\n```react\nhash: \"\" // hash\nkey: \"nyi4ea\" // ä¸€ä¸ª uuid\npathname: \"/explore\" // URL ä¸­è·¯å¾„éƒ¨åˆ†\nsearch: \"\" // URL å‚æ•°\nstate: undefined // è·¯ç”±è·³è½¬æ—¶ä¼ é€’çš„ state\n\n```\n\næˆ‘ä»¬å¸¦ç€é—®é¢˜å»åˆ†ææºç ï¼Œå…ˆé€ä¸ªåˆ†ææ¯ä¸ªç»„ä»¶çš„ä½œç”¨ï¼Œåœ¨æœ€åä¼šæœ‰å›ç­”ï¼Œåœ¨è¿™é‡Œå…ˆä¸¾ä¸€ä¸ª rr4 çš„å° [DEMO](https://codesandbox.io/)\n\n1. é¡µé¢åˆå§‹åŒ–æ—¶çš„æ¸²æŸ“è¿‡ç¨‹ï¼Ÿ\n2. ç‚¹å‡»ä¸€ä¸ª Link è·³è½¬åŠæ¸²æŸ“æ›´æ–°çš„è¿‡ç¨‹ï¼Ÿ\n\n## 2.packages\n\nrr4 å°†è·¯ç”±æ‹†æˆäº†å‡ ä¸ªåŒ…ï¼š\n\n- react-router è´Ÿè´£é€šç”¨çš„è·¯ç”±é€»è¾‘\n- react-router-dom è´Ÿè´£æµè§ˆå™¨çš„è·¯ç”±ç®¡ç†\n- react-router-native è´Ÿè´£ react-native çš„è·¯ç”±ç®¡ç†\n\né€šç”¨çš„éƒ¨åˆ†ç›´æ¥ä» react-router ä¸­å¯¼å…¥ï¼Œç”¨æˆ·åªéœ€å¼•å…¥ react-router-dom æˆ– react-router-native å³å¯ï¼Œreact-router ä½œä¸ºä¾èµ–å­˜åœ¨ä¸å†éœ€è¦å•ç‹¬å¼•å…¥ã€‚\n\n### Router\n\n```react\nimport React from 'react'\nimport { render } from 'react-dom'\nimport { BrowserRouter } from 'react-router-dom'\nimport App from './components/App';\n\nrender(){\n    return(\n\t\t<BrowserRouter>\n\t\t\t<App />\n\t\t</BrowserRouter>\n\t)\n)}\n\n```\n\nè¿™æ˜¯æˆ‘ä»¬è°ƒç”¨ Router çš„æ–¹å¼ï¼Œè¿™é‡Œæ‹¿ BrowserRouter æ¥ä¸¾ä¾‹ã€‚\n\nBrowserRouter çš„æºç åœ¨ react-router-dom ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œ**åœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªå…¨å±€çš„ history å¯¹è±¡ï¼ˆå¯ä»¥ç›‘å¬æ•´ä¸ªè·¯ç”±çš„å˜åŒ–ï¼‰ï¼Œå¹¶å°† history ä½œä¸º props ä¼ é€’ç»™ react-router çš„ Router ç»„ä»¶ï¼ˆRouter ç»„ä»¶å†ä¼šå°†è¿™ä¸ª history çš„å±æ€§ä½œä¸º context ä¼ é€’ç»™å­ç»„ä»¶ï¼‰**\n\n```react\n  render() {\n    return <Router history={this.history} children={this.props.children} />;\n  }\n\n```\n\n**æ•´ä¸ª Router çš„æ ¸å¿ƒæ˜¯åœ¨ react-router çš„ Router ç»„ä»¶ä¸­**ï¼Œå¦‚ä¸‹ï¼Œ**å€ŸåŠ© context å‘ Route ä¼ é€’ç»„ä»¶**ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆ Router è¦åœ¨æ‰€æœ‰ Route çš„å¤–é¢ã€‚\n\n```react\n  getChildContext() {\n    return {\n      router: {\n        ...this.context.router,\n        history: this.props.history,\n        route: {\n          location: this.props.history.location,\n          match: this.state.match\n        }\n      }\n    };\n  }\n\n```\n\nè¿™æ˜¯ Router ä¼ é€’ç»™å­ç»„ä»¶çš„ contextï¼Œäº‹å®ä¸Š Route ä¹Ÿä¼šå°† router ä½œä¸º context å‘ä¸‹ä¼ é€’ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ Route æ¸²æŸ“çš„ç»„ä»¶ä¸­åŠ å…¥\n\n```react\n  static contextTypes = {\n    router: PropTypes.shape({\n      history: PropTypes.object.isRequired,\n      route: PropTypes.object.isRequired,\n      staticContext: PropTypes.object\n    })\n  };\n\n```\n\næ¥é€šè¿‡ context è®¿é—® routerï¼Œä¸è¿‡ rr4 ä¸€èˆ¬é€šè¿‡ props ä¼ é€’ï¼Œå°† history, location, match ä½œä¸ºä¸‰ä¸ªç‹¬ç«‹çš„ props ä¼ é€’ç»™è¦æ¸²æŸ“çš„ç»„ä»¶ï¼Œè¿™æ ·è®¿é—®èµ·æ¥æ–¹ä¾¿ä¸€ç‚¹ï¼ˆå®é™…ä¸Šå·²ç»å®Œå…¨å°† router å¯¹è±¡çš„å±æ€§å®Œå…¨ä¼ é€’äº†ï¼‰ã€‚\n\nåœ¨ Router çš„ componentWillMount ä¸­ï¼Œ æ·»åŠ äº†\n\n```react\n  componentWillMount() {\n    const { children, history } = this.props;\n\n    invariant(\n      children == null || React.Children.count(children) === 1,\n      \"A <Router> may have only one child element\"\n    );\n\n    // Do this here so we can setState when a <Redirect> changes the\n    // location in componentWillMount. This happens e.g. when doing\n    // server rendering using a <sStaticRouter>.\n    this.unlisten = history.listen(() => {\n      this.setState({\n        match: this.computeMatch(history.location.pathname)\n      });\n    });\n  }\n\n```\n\n`history.listen` èƒ½å¤Ÿç›‘å¬è·¯ç”±çš„å˜åŒ–å¹¶æ‰§è¡Œå›è°ƒäº‹ä»¶ã€‚\n\nåœ¨è¿™é‡Œæ¯æ¬¡è·¯ç”±çš„å˜åŒ–æ‰§è¡Œçš„å›è°ƒäº‹ä»¶ä¸º\n\n```react\nthis.setState({\n    match: this.computeMatch(history.location.pathname)\n});\n\n```\n\nç›¸æ¯”äºåœ¨ setState é‡Œåšçš„æ“ä½œï¼ŒsetState æœ¬èº«çš„æ„ä¹‰æ›´å¤§ â€”â€” **æ¯æ¬¡è·¯ç”±å˜åŒ– -> è§¦å‘é¡¶å±‚ Router çš„å›è°ƒäº‹ä»¶ -> Router è¿›è¡Œ setState -> å‘ä¸‹ä¼ é€’ nextContextï¼ˆcontext ä¸­å«æœ‰æœ€æ–°çš„ locationï¼‰-> ä¸‹é¢çš„ Route è·å–æ–°çš„ nextContext åˆ¤æ–­æ˜¯å¦è¿›è¡Œæ¸²æŸ“ã€‚**\n\nä¹‹æ‰€ä»¥æŠŠè¿™ä¸ª subscribe çš„å‡½æ•°å†™åœ¨ componentWillMount é‡Œï¼Œå°±åƒæºç ä¸­ç»™å‡ºçš„æ³¨é‡Šï¼šæ˜¯ä¸ºäº† SSR çš„æ—¶å€™ï¼Œèƒ½å¤Ÿä½¿ç”¨ Redirectã€‚\n\n### Route\n\n**Route çš„ä½œç”¨æ˜¯åŒ¹é…è·¯ç”±ï¼Œå¹¶ä¼ é€’ç»™è¦æ¸²æŸ“çš„ç»„ä»¶ propsã€‚**\n\nåœ¨ Route çš„ componentWillReceiveProps ä¸­\n\n```react\n  componentWillReceiveProps(nextProps, nextContext) {\n    ...\n    this.setState({\n      match: this.computeMatch(nextProps, nextContext.router)\n    });\n  }\n\n```\n\n**Route æ¥å—ä¸Šå±‚çš„ Router ä¼ å…¥çš„ contextï¼ŒRouter ä¸­çš„ history ç›‘å¬ç€æ•´ä¸ªé¡µé¢çš„è·¯ç”±å˜åŒ–ï¼Œå½“é¡µé¢å‘ç”Ÿè·³è½¬æ—¶ï¼Œhistory è§¦å‘ç›‘å¬äº‹ä»¶ï¼ŒRouter å‘ä¸‹ä¼ é€’ nextContextï¼Œå°±ä¼šæ›´æ–° Route çš„ props å’Œ context æ¥åˆ¤æ–­å½“å‰ Route çš„ path æ˜¯å¦åŒ¹é… locationï¼Œå¦‚æœåŒ¹é…åˆ™æ¸²æŸ“ï¼Œå¦åˆ™ä¸æ¸²æŸ“ã€‚**\n\næ˜¯å¦åŒ¹é…çš„ä¾æ®å°±æ˜¯ computeMatch è¿™ä¸ªå‡½æ•°ï¼Œåœ¨ä¸‹æ–‡ä¼šæœ‰åˆ†æï¼Œè¿™é‡Œåªéœ€è¦çŸ¥é“åŒ¹é…å¤±è´¥åˆ™ match ä¸º `null`ï¼Œå¦‚æœåŒ¹é…æˆåŠŸåˆ™å°† match çš„ç»“æœä½œä¸º props çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ render ä¸­ä¼ é€’ç»™ä¼ è¿›æ¥çš„è¦æ¸²æŸ“çš„ç»„ä»¶ã€‚\n\næ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ Route çš„ render éƒ¨åˆ†ã€‚\n\n```react\n  render() {\n    const { match } = this.state; // å¸ƒå°”å€¼ï¼Œè¡¨ç¤º location æ˜¯å¦åŒ¹é…å½“å‰ Route çš„ path\n    const { children, component, render } = this.props; // Route æä¾›çš„ä¸‰ç§å¯é€‰çš„æ¸²æŸ“æ–¹å¼\n    const { history, route, staticContext } = this.context.router; // Router ä¼ å…¥çš„ context\n    const location = this.props.location || route.location;\n    const props = { match, location, history, staticContext };\n\n    if (component) return match ? React.createElement(component, props) : null; // Component åˆ›å»º\n\n    if (render) return match ? render(props) : null; // render åˆ›å»º\n\n    if (typeof children === \"function\") return children(props); // å›è°ƒ children åˆ›å»º\n\n    if (children && !isEmptyChildren(children)) // æ™®é€š children åˆ›å»º\n      return React.Children.only(children);\n\n    return null;\n  }\n\n```\n\nrr4 æä¾›äº†ä¸‰ç§æ¸²æŸ“ç»„ä»¶çš„æ–¹æ³•ï¼šcomponent propsï¼Œrender props å’Œ children propsï¼Œæ¸²æŸ“çš„ä¼˜å…ˆçº§ä¹Ÿæ˜¯ä¾æ¬¡æŒ‰ç…§é¡ºåºï¼Œå¦‚æœå‰é¢çš„å·²ç»æ¸²æŸ“åäº†ï¼Œå°†ä¼šç›´æ¥ returnã€‚\n\n- component (props) â€”â€” ç”±äºä½¿ç”¨ React.createElement åˆ›å»ºï¼Œæ‰€ä»¥å¯ä»¥ä¼ å…¥ä¸€ä¸ª class componentã€‚\n- render (props) â€”â€” ç›´æ¥è°ƒç”¨ render() å±•å¼€å­å…ƒç´ ï¼Œæ‰€ä»¥éœ€è¦ä¼ å…¥ stateless function componentã€‚\n- children (props) â€”â€” å…¶å®å’Œ render å·®ä¸å¤šï¼ŒåŒºåˆ«æ˜¯ä¸åˆ¤æ–­ matchï¼Œæ€»æ˜¯ä¼šè¢«æ¸²æŸ“ã€‚\n- childrenï¼ˆå­å…ƒç´ ï¼‰â€”â€” å¦‚æœä»¥ä¸Šéƒ½æ²¡æœ‰ï¼Œé‚£ä¹ˆä¼šé»˜è®¤æ¸²æŸ“å­å…ƒç´ ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªå­å…ƒç´ ã€‚\n\nè¿™é‡Œè§£é‡Šä¸€ä¸‹å®˜ç½‘çš„ [tips](https://github.com/ReactTraining/react-router/blob/a27bc562ce49b22019d380d28fa9a534111614b2/packages/react-router/docs/api/Route.md#component)ï¼Œcomponent æ˜¯ä½¿ç”¨ React.createElement æ¥åˆ›å»ºæ–°çš„å…ƒç´ ï¼Œæ‰€ä»¥å¦‚æœä¼ å…¥ä¸€ä¸ªå†…è”å‡½æ•°ï¼Œæ¯”å¦‚\n\n```react\n<Route path='/' component={()=>(<div>hello world</div>)}\n\n```\n\nçš„è¯ï¼Œç”±äºæ¯æ¬¡çš„ props.component éƒ½æ˜¯æ–°åˆ›å»ºçš„ï¼Œæ‰€ä»¥ React åœ¨ diff çš„æ—¶å€™ä¼šè®¤ä¸ºè¿›æ¥äº†ä¸€ä¸ªå…¨æ–°çš„ç»„ä»¶ï¼Œæ‰€ä»¥ä¼šå°†æ—§çš„ç»„ä»¶ unmountï¼Œå† re-mountã€‚è¿™æ—¶å€™å°±è¦ä½¿ç”¨ renderï¼Œå°‘äº†ä¸€å±‚åŒ…è£¹çš„ component å…ƒç´ ï¼Œrender å±•å¼€åçš„å…ƒç´ ç±»å‹æ¯æ¬¡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±ä¸ä¼šå‘ç”Ÿ re-mount äº†ï¼ˆchildren ä¹Ÿä¸ä¼šå‘ç”Ÿ re-mountï¼‰ã€‚\n\n### Switch\n\næˆ‘ä»¬ç´§æ¥ç€ Route æ¥çœ‹ Switchï¼Œ**Switch æ˜¯ç”¨æ¥åµŒå¥—åœ¨ Route çš„å¤–é¢ï¼Œå½“ Switch ä¸­çš„ç¬¬ä¸€ä¸ª Route åŒ¹é…ä¹‹åå°±ä¸ä¼šå†æ¸²æŸ“å…¶ä»–çš„ Route äº†ã€‚**\n\n```react\n  render() {\n    const { route } = this.context.router;\n    const { children } = this.props;\n    const location = this.props.location || route.location;\n\n    let match, child;\n    React.Children.forEach(children, element => {\n      if (match == null && React.isValidElement(element)) {\n        const {\n          path: pathProp,\n          exact,\n          strict,\n          sensitive,\n          from\n        } = element.props;\n        const path = pathProp || from;\n\n        child = element;\n        match = matchPath(\n          location.pathname,\n          { path, exact, strict, sensitive },\n          route.match\n        );\n      }\n    });\n\n    return match\n      ? React.cloneElement(child, { location, computedMatch: match })\n      : null;\n  }\n\n```\n\n**Switch ä¹Ÿæ˜¯é€šè¿‡ matchPath è¿™ä¸ªå‡½æ•°æ¥åˆ¤æ–­æ˜¯å¦åŒ¹é…æˆåŠŸï¼Œä¸€ç›´æŒ‰ç…§ Switch ä¸­ children çš„é¡ºåºä¾æ¬¡éå†å­å…ƒç´ ï¼Œå¦‚æœåŒ¹é…å¤±è´¥åˆ™ match ä¸º nullï¼Œå¦‚æœåŒ¹é…æˆåŠŸåˆ™æ ‡è®°è¿™ä¸ªå­å…ƒç´ å’Œå®ƒå¯¹åº”çš„ locationã€computedMatchã€‚åœ¨æœ€åçš„æ—¶å€™ä½¿ç”¨ React.cloneElement æ¸²æŸ“ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°çš„å­å…ƒç´ åˆ™è¿”å› `null`ã€‚**\n\næ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹ matchPath æ˜¯å¦‚ä½•åˆ¤æ–­ location æ˜¯å¦ç¬¦åˆ path çš„ã€‚\n\n### matchPath\n\nmatchPath è¿”å›çš„æ˜¯ä¸€ä¸ªå¦‚ä¸‹ç»“æ„çš„å¯¹è±¡\n\n```react\n{\n    path, // ç”¨æ¥è¿›è¡ŒåŒ¹é…çš„è·¯å¾„ï¼Œå…¶å®æ˜¯ç›´æ¥å¯¼å‡ºçš„ä¼ å…¥ matchPath çš„ options ä¸­çš„ path\n    url: path === \"/\" && url === \"\" ? \"/\" : url, // æ•´ä¸ªçš„ URL\n    isExact, // url ä¸ path æ˜¯å¦æ˜¯ exact çš„åŒ¹é…\n    // è¿”å›çš„æ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„æ˜ å°„\n    // æ¯”å¦‚ä½ çš„ path æ˜¯ /users/:idï¼Œç„¶ååŒ¹é…çš„ pathname æ˜¯ /user/123\n    // é‚£ä¹ˆ params çš„è¿”å›å€¼å°±æ˜¯ {id: '123'}\n    params: keys.reduce((memo, key, index) => {\n      memo[key.name] = values[index];\n      return memo;\n    }, {})\n  }\n\n```\n\nè¿™äº›ä¿¡æ¯å°†ä½œä¸ºåŒ¹é…çš„å‚æ•°ä¼ é€’ç»™ Route å’Œ Switchï¼ˆSwitch åªæ˜¯ä¸€ä¸ªä»£ç†ï¼Œå®ƒçš„ä½œç”¨è¿˜æ˜¯æ¸²æŸ“ Routeï¼ŒSwitch è®¡ç®—å¾—åˆ°çš„ computedMatch ä¼šä¼ é€’ç»™è¦æ¸²æŸ“çš„ Routeï¼Œæ­¤æ—¶ Route å°†ç›´æ¥ä½¿ç”¨è¿™ä¸ª computedMatch è€Œä¸éœ€è¦å†è‡ªå·±æ¥è®¡ç®—ï¼‰ã€‚\n\nåœ¨ matchPath å†…éƒ¨ compilePath æ—¶ï¼Œæœ‰ä¸ª\n\n```react\nconst patternCache = {};\nconst cacheLimit = 10000;\nlet cacheCount = 0;\n\n```\n\nä½œä¸º pathToRegexp çš„ç¼“å­˜ï¼Œå› ä¸º ES6 çš„ import æ¨¡å—å¯¼å‡ºçš„æ˜¯å€¼çš„**å¼•ç”¨**ï¼Œæ‰€ä»¥å°† patternCache å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå…¨å±€å˜é‡ç¼“å­˜ï¼Œç¼“å­˜ä»¥ `{option:{pattern: }}` çš„å½¢å¼å­˜å‚¨ï¼Œä¹‹åå¦‚æœéœ€è¦åŒ¹é…ç›¸åŒ pattern å’Œ option çš„ pathï¼Œåˆ™å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å¾—æ­£åˆ™è¡¨è¾¾å¼å’Œ keysã€‚\n\nåŠ ç¼“å­˜çš„åŸå› æ˜¯è·¯ç”±é¡µé¢å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯ç›¸ä¼¼çš„ï¼Œæ¯”å¦‚è¦è®¿é—® `/user/123` æˆ– `/users/234`ï¼Œéƒ½ä¼šä½¿ç”¨ `/user/:id` è¿™ä¸ª path å»åŒ¹é…ï¼Œæ²¡æœ‰å¿…è¦æ¯æ¬¡éƒ½ç”Ÿæˆä¸€ä¸ªæ–°çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚SPA åœ¨é¡µé¢æ•´ä¸ªè®¿é—®çš„è¿‡ç¨‹ä¸­éƒ½ç»´æŠ¤ç€è¿™ä»½ç¼“å­˜ã€‚\n\n### Link\n\nå®é™…ä¸Šæˆ‘ä»¬å¯èƒ½å†™çš„æœ€å¤šçš„å°±æ˜¯ Link è¿™ä¸ªæ ‡ç­¾äº†ï¼Œæˆ‘ä»¬ä»å®ƒçš„ render å‡½æ•°å¼€å§‹çœ‹\n\n```react\nrender() {\n    const { replace, to, innerRef, ...props } = this.props; // eslint-disable-line no-unused-vars\n\n    invariant(\n      this.context.router,\n      \"You should not use <Link> outside a <Router>\"\n    );\n\n    invariant(to !== undefined, 'You must specify the \"to\" property');\n\n    const { history } = this.context.router;\n    const location =\n      typeof to === \"string\"\n        ? createLocation(to, null, null, history.location)\n        : to;\n\n    const href = history.createHref(location);\n    // æœ€ç»ˆåˆ›å»ºçš„æ˜¯ä¸€ä¸ª a æ ‡ç­¾\n    return (\n      <a {...props} onClick={this.handleClick} href={href} ref={innerRef} />\n    );\n  }\n\n```\n\nå¯ä»¥çœ‹åˆ°**Link æœ€ç»ˆè¿˜æ˜¯åˆ›å»ºä¸€ä¸ª a æ ‡ç­¾æ¥åŒ…è£¹ä½è¦è·³è½¬çš„å…ƒç´ **ï¼Œä½†æ˜¯å¦‚æœåªæ˜¯ä¸€ä¸ªæ™®é€šçš„å¸¦ href çš„ a æ ‡ç­¾ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è·³è½¬åˆ°ä¸€ä¸ªæ–°çš„é¡µé¢è€Œä¸æ˜¯ SPA äº†ï¼Œæ‰€ä»¥åœ¨**è¿™ä¸ª a æ ‡ç­¾çš„ handleClick ä¸­ä¼š preventDefault ç¦æ­¢é»˜è®¤çš„è·³è½¬ï¼Œæ‰€ä»¥è¿™é‡Œçš„ href å¹¶æ²¡æœ‰å®é™…çš„ä½œç”¨**ï¼Œä½†ä»ç„¶å¯ä»¥æ ‡ç¤ºå‡ºè¦è·³è½¬åˆ°çš„é¡µé¢çš„ URL å¹¶ä¸”æœ‰æ›´å¥½çš„ html è¯­ä¹‰ã€‚\n\nåœ¨ handleClick ä¸­ï¼Œå¯¹æ²¡æœ‰è¢« â€œpreventDefault çš„ && é¼ æ ‡å·¦é”®ç‚¹å‡»çš„ && é `_blank` è·³è½¬ çš„&& æ²¡æœ‰æŒ‰ä½å…¶ä»–åŠŸèƒ½é”®çš„â€œ å•å‡»è¿›è¡Œ preventDefaultï¼Œç„¶å push è¿› history ä¸­ï¼Œè¿™ä¹Ÿæ˜¯å‰é¢è®²è¿‡çš„ â€”â€” **è·¯ç”±çš„å˜åŒ– ä¸ é¡µé¢çš„è·³è½¬ æ˜¯ä¸äº’ç›¸å…³è”çš„**ï¼Œrr4 **åœ¨ Link ä¸­é€šè¿‡ history åº“çš„ push è°ƒç”¨äº† HTML5 history çš„ `pushState`ï¼Œä½†æ˜¯è¿™ä»…ä»…ä¼šè®©è·¯ç”±å˜åŒ–ï¼Œå…¶ä»–ä»€ä¹ˆéƒ½æ²¡æœ‰æ”¹å˜**ã€‚è¿˜è®°ä¸è®°å¾— Router ä¸­çš„ listenï¼Œå®ƒä¼šç›‘å¬è·¯ç”±çš„å˜åŒ–ï¼Œç„¶åé€šè¿‡ context æ›´æ–° props å’Œ nextContext è®©ä¸‹å±‚çš„ Route å»é‡æ–°åŒ¹é…ï¼Œå®Œæˆéœ€è¦æ¸²æŸ“éƒ¨åˆ†çš„æ›´æ–°ã€‚\n\n```react\n  handleClick = event => {\n    if (this.props.onClick) this.props.onClick(event);\n\n    if (\n      !event.defaultPrevented && // onClick prevented default\n      event.button === 0 && // ignore everything but left clicks\n      !this.props.target && // let browser handle \"target=_blank\" etc.\n      !isModifiedEvent(event) // ignore clicks with modifier keys\n    ) {\n      event.preventDefault();\n\n      const { history } = this.context.router;\n      const { replace, to } = this.props;\n\n      if (replace) {\n        history.replace(to);\n      } else {\n        history.push(to);\n      }\n    }\n  };\n```\n\n### withRouter\n\n```react\nconst withRouter = Component => {\n  const C = props => {\n    const { wrappedComponentRef, ...remainingProps } = props;\n    return (\n      <Route\n        children={routeComponentProps => (\n          <Component\n            {...remainingProps}\n            {...routeComponentProps}\n            ref={wrappedComponentRef}\n          />\n        )}\n      />\n    );\n  };\n\n  C.displayName = `withRouter(${Component.displayName || Component.name})`;\n  C.WrappedComponent = Component;\n  C.propTypes = {\n    wrappedComponentRef: PropTypes.func\n  };\n\n  return hoistStatics(C, Component);\n};\n\nexport default withRouter;\n```\n\nwithRouter çš„ä½œç”¨æ˜¯è®©æˆ‘ä»¬åœ¨æ™®é€šçš„éç›´æ¥åµŒå¥—åœ¨ Route ä¸­çš„ç»„ä»¶ä¹Ÿèƒ½è·å¾—è·¯ç”±çš„ä¿¡æ¯ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±è¦ `WithRouter(wrappedComponent)` æ¥åˆ›å»ºä¸€ä¸ª HOC ä¼ é€’ propsï¼ŒWithRouter çš„å…¶å®å°±æ˜¯ç”¨ Route åŒ…è£¹äº† SomeComponent çš„ä¸€ä¸ª HOCã€‚\n\nåˆ›å»º Route æœ‰ä¸‰ç§æ–¹æ³•ï¼Œè¿™é‡Œç›´æ¥é‡‡ç”¨äº†ä¼ é€’ `children` props çš„æ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸ª HOC è¦åŸå°ä¸åŠ¨çš„æ¸²æŸ“ wrappedComponentï¼ˆ`children` props æ¯”è¾ƒå°‘ç”¨å¾—åˆ°ï¼ŒæŸç§ç¨‹åº¦ä¸Šæ˜¯ä¸€ä¸ªå†…éƒ¨æ–¹æ³•ï¼‰ã€‚\n\nåœ¨æœ€åè¿”å› HOC æ—¶ï¼Œä½¿ç”¨äº† hoistStatics è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ä¿ç•™ SomeComponent ç±»çš„é™æ€æ–¹æ³•ï¼Œå› ä¸º HOC æ˜¯åœ¨ wrappedComponent çš„å¤–å±‚åˆåŒ…äº†ä¸€å±‚ Routeï¼Œæ‰€ä»¥è¦å°† wrappedComponent ç±»çš„é™æ€æ–¹æ³•è½¬ç§»ç»™æ–°çš„ Routeï¼Œå…·ä½“å‚è§ [Static Methods Must Be Copied Over](https://reactjs.org/docs/higher-order-components.html#static-methods-must-be-copied-over)ã€‚\n\n## 3.ç†è§£\n\nç°åœ¨å›åˆ°ä¸€å¼€å§‹çš„é—®é¢˜ï¼Œé‡æ–°ç†è§£ä¸€ä¸‹ç‚¹å‡»ä¸€ä¸ª Link è·³è½¬çš„è¿‡ç¨‹ã€‚\n\næœ‰ä¸¤ä»¶äº‹éœ€è¦å®Œæˆï¼š\n\n1. è·¯ç”±çš„æ”¹å˜\n2. é¡µé¢çš„æ¸²æŸ“éƒ¨åˆ†çš„æ”¹å˜\n\nè¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n1. åœ¨æœ€ä¸€å¼€å§‹ mount Router çš„æ—¶å€™ï¼ŒRouter åœ¨ componentWillMount ä¸­ listen äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç”± history åº“ç®¡ç†ï¼Œè·¯ç”±æ¯æ¬¡æ”¹å˜çš„æ—¶å€™è§¦å‘è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°ä¼šè§¦å‘ setStateã€‚\n2. å½“ç‚¹å‡» Link æ ‡ç­¾çš„æ—¶å€™ï¼Œå®é™…ä¸Šç‚¹å‡»çš„æ˜¯é¡µé¢ä¸Šæ¸²æŸ“å‡ºæ¥çš„ a æ ‡ç­¾ï¼Œç„¶åé€šè¿‡ preventDefault é˜»æ­¢ a æ ‡ç­¾çš„é¡µé¢è·³è½¬ã€‚\n3. Link ä¸­ä¹Ÿèƒ½æ‹¿åˆ° Router -> Route ä¸­é€šè¿‡ context ä¼ é€’çš„ historyï¼Œæ‰§è¡Œ `hitsory.push(to)`ï¼Œè¿™ä¸ªå‡½æ•°å®é™…ä¸Šå°±æ˜¯åŒ…è£…äº†ä¸€ä¸‹ `window.history.pushState()`ï¼Œæ˜¯ HTML5 history çš„ APIï¼Œä½†æ˜¯ pushState ä¹‹åé™¤äº†åœ°å€æ æœ‰å˜åŒ–å…¶ä»–æ²¡æœ‰ä»»ä½•å½±å“ï¼Œåˆ°è¿™ä¸€æ­¥å·²ç»å®Œæˆäº†ç›®æ ‡ 1ï¼šè·¯ç”±çš„æ”¹å˜ã€‚\n4. ç¬¬ 1 æ­¥ä¸­ï¼Œè·¯ç”±æ”¹å˜æ˜¯ä¼šè§¦å‘ Router çš„ setState çš„ï¼Œåœ¨ Router é‚£ç« æœ‰å†™é“ï¼šæ¯æ¬¡è·¯ç”±å˜åŒ– -> è§¦å‘é¡¶å±‚ Router çš„ç›‘å¬äº‹ä»¶ -> Router è§¦å‘ setState -> å‘ä¸‹ä¼ é€’æ–°çš„ nextContextï¼ˆnextContext ä¸­å«æœ‰æœ€æ–°çš„ locationï¼‰\n5. ä¸‹å±‚çš„ Route æ‹¿åˆ°æ–°çš„ nextContext é€šè¿‡ matchPath å‡½æ•°æ¥åˆ¤æ–­ path æ˜¯å¦ä¸ location åŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ™æ¸²æŸ“ï¼Œä¸åŒ¹é…åˆ™ä¸æ¸²æŸ“ï¼Œå®Œæˆç›®æ ‡ 2ï¼šé¡µé¢çš„æ¸²æŸ“éƒ¨åˆ†çš„æ”¹å˜ã€‚\n","tags":["React","VUE","è·¯ç”±"],"categories":["å‰ç«¯"]},{"title":"leetcodeç®—æ³•åˆ·é¢˜ç¬”è®°ï¼ˆäºŒï¼‰â€”â€”å›æº¯é—®é¢˜","url":"/2019/01/15/leetcodeç®—æ³•åˆ·é¢˜ç¬”è®°ï¼ˆäºŒï¼‰â€”â€”å›æº¯é—®é¢˜/","content":"\n_è¯¥ç¬”è®°åªä¸ºä¸ªäººæ‰€å†™ç®—æ³•ï¼Œä¸ä¸€å®šæ˜¯æœ€ä¼˜è§£æ³•ï¼Œä»…ä¾›å‚è€ƒ_\n\n# [17] Letter Combinations of a Phone Number\n\nGiven a string containing digits from 2-9 inclusive, return all possible letter combinations that the number could represent.\nA mapping of digit to letters (just like on the telephone buttons) is given below. Note that 1 does not map to any letters.\nNote:Although the above answer is in lexicographical order, your answer could be in any order you want.\néš¾åº¦ï¼šMedium (40.58%)\nè€ƒç‚¹ï¼šå›æº¯\n\n<!-- more -->\n\n```javascript\nvar letterCombinations = function(digits) {\n  var res = [];\n  var sort = [];\n  if (digits.length == 0) {\n    return res;\n  }\n  var phone = [\n    \"0\",\n    \"1\",\n    [\"a\", \"b\", \"c\"],\n    [\"d\", \"e\", \"f\"],\n    [\"g\", \"h\", \"i\"],\n    [\"j\", \"k\", \"l\"],\n    [\"m\", \"n\", \"o\"],\n    [\"p\", \"q\", \"r\", \"s\"],\n    [\"t\", \"u\", \"v\"],\n    [\"w\", \"x\", \"y\", \"z\"]\n  ];\n  finger(0);\n  return res;\n\n  function finger(index) {\n    if (index == digits.length) {\n      return res.push(sort.join(\"\"));\n    }\n    var temp = phone[digits[index]];\n    for (var i = 0; i < temp.length; i++) {\n      sort.push(temp[i]);\n      finger(index + 1);\n      sort.pop();\n    }\n  }\n};\n```\n\n# [22] Generate Parentheses\n\nGiven n pairs of parentheses, write a function to generate all combinations of well-formed parentheses.\néš¾åº¦ï¼šMedium (53.42%)\nè€ƒç‚¹ï¼šå›æº¯\næ€è·¯ï¼š\n\n1. ç»™å®š n å€¼ï¼Œåˆ™æ€»å…±æœ‰ n ä¸ªå·¦æ‹¬å·ï¼Œn ä¸ªå³æ‹¬å·ã€‚\n2. ç¬¬ä¸€ä¸ªæ·»åŠ çš„ä¸€å®šæ˜¯å·¦æ‹¬å·ã€‚\n3. å½“æ·»åŠ äº†ä¸€ä¸ªå·¦æ‹¬å·ä¹‹åï¼Œæ‰ä¼šæœ‰ä¸€ä¸ªå³æ‹¬å·å¯ä»¥æ·»åŠ ã€‚æ‰€ä»¥å›æº¯æ—¶ï¼Œleft-1 çš„åŒæ—¶ right+1\n4. å½“å·²æ·»åŠ äº† n ä¸ªå·¦æ‹¬å·åï¼Œå‰©ä¸‹çš„éƒ½åº”è¯¥æ·»åŠ å³æ‹¬å·\n\n```javascript\nvar generateParenthesis = function(n) {\n  var res = [];\n  var left = n - 1;\n  var right = 1;\n  function quote(left, right, str) {\n    if (left <= 0) {\n      if (right) {\n        for (var i = 0; i < right; i++) {\n          str = str + \")\";\n        }\n      }\n      return res.push(str);\n    }\n    quote(left - 1, right + 1, str + \"(\");\n    if (right > 0) {\n      quote(left, right - 1, str + \")\");\n    }\n  }\n  quote(left, right, \"(\");\n  return res;\n};\n```\n\n# [46] Permutations\n\nGiven a collection of distinct integers, return all possible permutations.\néš¾åº¦ï¼šMedium (53.67%)\nè€ƒç‚¹ï¼šå›æº¯\næ€è·¯ï¼šé€‰æ‹©ä¸€ä¸ªå…ƒç´ ä¹‹åï¼Œåˆ™ä¸‹æ¬¡å¯é€‰æ‹©çš„å…ƒç´ å°±å°‘ä¸€ä¸ªã€‚\n\n```javascript\nvar permute = function(nums) {\n  var res = [];\n  var sort = [];\n  if (nums.length == 0) {\n    return res;\n  }\n  select(nums);\n  return res;\n\n  function select(nums) {\n    if (nums.length < 1) {\n      return res.push(sort.slice());\n    }\n    for (var i = 0; i < nums.length; i++) {\n      var nextNums = nums.slice();\n      sort.push(nextNums[i]);\n      nextNums.splice(i, 1);\n      select(nextNums);\n      sort.pop();\n    }\n  }\n};\n```\n\n# [47] Permutations II\n\nGiven a collection of numbers that might contain duplicates, return all possible unique permutations.\néš¾åº¦ï¼šMedium (39.35%)\nè€ƒç‚¹ï¼šå›æº¯\næ€è·¯ï¼šæ€è·¯åŒä¸Šé¢˜ã€‚æ³¨æ„ç­›é€‰æ¡ä»¶ã€‚\n\n```javascript\nvar permuteUnique = function(nums) {\n  var res = [];\n  var sort = [];\n  if (nums.length == 0) {\n    return res;\n  }\n  nums = nums.sort((a, b) => {\n    return a - b;\n  });\n  select(nums);\n  return res;\n\n  function select(nums) {\n    if (nums.length < 1) {\n      return res.push(sort.slice());\n    }\n    for (var i = 0; i < nums.length; i++) {\n      if (nums[i] == nums[i - 1]) {\n        continue;\n      }\n      var nextNums = nums.slice();\n      sort.push(nextNums[i]);\n      nextNums.splice(i, 1);\n      select(nextNums);\n      sort.pop();\n    }\n  }\n};\n```\n\n# [60] Permutations II â˜†â˜†\n\nThe set [1,2,3,...,n] contains a total of n! unique permutations.By listing and labeling all of the permutations in order, we get the following sequence for n = 3:\n\"123\"\n\"132\"\n\"213\"\n\"231\"\n\"312\"\n\"321\"\nGiven n and k, return the k^th permutation sequence.\nNote:Given n will be between 1 and 9 inclusive. GivenÂ kÂ will be between 1 and n! inclusive.\néš¾åº¦ï¼šMedium (32.42%)\nè€ƒç‚¹ï¼šå›æº¯\n\n```javascript\nvar getPermutation = function(n, k) {\n  (res = []), (pos = k - 1);\n  var nums = [];\n  if (n == 0) {\n    return \"error\";\n  }\n  for (var i = 0; i < n; i++) {\n    nums[i] = i + 1;\n  }\n  var numsSort = nums.reduce((a, b) => a * b);\n  if (k < 1 || k > numsSort) {\n    return \"error\";\n  }\n\n  for (var j = n; j >= 1; --j) {\n    numsSort /= j;\n    res.push(nums.splice(parseInt(pos / numsSort), 1)[0]);\n    pos %= numsSort;\n  }\n  return res.join(\"\");\n};\n```\n\n# [77] ombinations â˜†â˜†\n\nGiven two integers n and k, return all possible combinations of k numbers out of 1 ... n.\néš¾åº¦ï¼šMedium (46.23%)\nè€ƒç‚¹ï¼šå›æº¯\néš¾ç‚¹ï¼šä¸‹ä¸€æ¬¡é€‰æ‹©ä¸èƒ½é€‰æ‹©æ¯”ä¸Šä¸€æ¬¡å°çš„æ•°ï¼Œæ‰€ä»¥éœ€æ³¨æ„ push è¿›å»çš„æ¡ä»¶\n\n```javascript\nvar combine = function(n, k) {\n  var nums = [];\n  var res = [];\n  var temp = [];\n  if (n == 0 || k <= 0 || k > n) {\n    return \"error\";\n  }\n  for (var i = 0; i < n; i++) {\n    nums[i] = i + 1;\n  }\n\n  select(0, nums);\n  return res;\n\n  function select(start, nums) {\n    if (temp.length == k) {\n      return res.push(temp.slice());\n    }\n    for (var i = start; i < n; i++) {\n      if (temp.length >= 1 && temp[temp.length - 1] > i) {\n        continue;\n      }\n      temp.push(nums[i]);\n      select(start + 1, nums);\n      temp.pop();\n    }\n  }\n};\n```\n\n# [78] Subsets\n\nGiven a set of distinct integers, nums, return all possible subsets (the power set).\nNote: The solution set must not contain duplicate subsets.\néš¾åº¦ï¼šMedium (51.26%)\nè€ƒç‚¹ï¼šå›æº¯\néš¾ç‚¹ï¼šä¸‹ä¸€æ¬¡é€‰æ‹©ä¸èƒ½é€‰æ‹©æ¯”ä¸Šä¸€æ¬¡å°çš„æ•°ï¼Œæ‰€ä»¥éœ€æ³¨æ„ push è¿›å»çš„æ¡ä»¶ã€‚\n\n```javascript\nvar subsets = function(nums) {\n  var res = [];\n  var subsets = [];\n  var used = [];\n  res.push(subsets.slice());\n  if (nums.length == 0) {\n    return res;\n  }\n  nums = nums.sort((a, b) => a - b);\n  for (var j = 1; j <= nums.length; j++) {\n    findSubsets(0, j);\n  }\n  return res;\n\n  function findSubsets(start, k) {\n    for (var i = 0; i < nums.length; i++) {\n      if (subsets.length == k) {\n        return res.push(subsets.slice());\n      }\n      if (used[i]) {\n        continue;\n      }\n      if (start > 0 && nums[i] < subsets[subsets.length - 1]) {\n        continue;\n      }\n      subsets.push(nums[i]);\n      used[i] = true;\n      findSubsets(start + 1, k);\n      subsets.pop();\n      used[i] = false;\n    }\n  }\n};\n```\n\n# [79] Word Search\n\nGiven a 2D board and a word, find if the word exists in the grid.\nThe word can be constructed from letters of sequentially adjacent cell, where \"adjacent\" cells are those horizontally or vertically neighboring. The same letter cell may not be used more than once.\néš¾åº¦ï¼šMedium (30.52%)\nè€ƒç‚¹ï¼šå›æº¯\næ€è·¯ï¼šè¦åˆ†å››ä¸ªæ–¹å‘åˆ†åˆ«å›æº¯ã€‚\n\n```javascript\nvar exist = function(board, word) {\n  var row = board.length;\n  var col = board[0].length;\n  if (word.length > row * col) {\n    return false;\n  }\n  function search(i, j, n) {\n    if (\n      i >= row ||\n      j >= col ||\n      i < 0 ||\n      j < 0 ||\n      board[i][j] != word[n] ||\n      n > word.length\n    ) {\n      return false;\n    }\n    if (n == word.length - 1) {\n      return true;\n    }\n    board[i][j] = true;\n    if (search(i + 1, j, n + 1)) {\n      return true;\n    }\n    if (search(i - 1, j, n + 1)) {\n      return true;\n    }\n    if (search(i, j + 1, n + 1)) {\n      return true;\n    }\n    if (search(i, j - 1, n + 1)) {\n      return true;\n    }\n    board[i][j] = word[n];\n    return false;\n  }\n  for (var i = 0; i < row; i++) {\n    for (var j = 0; j < col; j++) {\n      if (search(i, j, 0)) {\n        return true;\n      }\n    }\n  }\n  return false;\n};\n```\n\n# [89] Gray Code â˜†â˜†\n\nThe gray code is a binary numeral system where two successive values differ in only one bit.\nGiven a non-negative integer n representing the total number of bits in the code, print the sequence of gray code. A gray code sequence must begin with 0.\néš¾åº¦ï¼šMedium (45.03%)\nè€ƒç‚¹ï¼šå›æº¯\næ€è·¯ï¼šå¯æ ¹æ®æ ¼é›·ç çš„ç‰¹æ€§è€ƒè™‘\nè§£æ³•ä¸€ï¼ˆæ™®é€šè§£æ³•ï¼‰ï¼š\n\n```javascript\nvar grayCode = function(n) {\n  var result = [];\n\n  var graycodeFn = function(n) {\n    var graycode = [];\n\n    if (n == 1) {\n      graycode[0] = \"0\";\n      graycode[1] = \"1\";\n      return graycode;\n    }\n\n    var last = arguments.callee(n - 1); // arguments.callee(n-1) == graycodeFn(n-1)\n\n    for (var i = last.length - 1; i >= 0; --i) {\n      graycode.unshift(\"0\" + last[i]);\n      graycode.push(\"1\" + last[i]);\n    }\n\n    return graycode;\n  };\n\n  var graycode = n == 0 ? [\"0\"] : graycodeFn(n);\n\n  for (var i = 0; i < graycode.length; ++i) {\n    result.push(parseInt(parseInt(graycode[i], 2), 10)); // String To Number\n  }\n\n  return result;\n};\n```\n\nè§£æ³•äºŒï¼ˆå¤§ç¥è§£æ³•ï¼‰ï¼š\n\n```javascript\nvar grayCode = function(n) {\n  let nums = [0],\n    c = -1;\n  while (c++ < n - 1)\n    nums = [...nums, ...nums.map(num => num + Math.pow(2, c)).reverse()];\n  return nums;\n};\n```\n\n# [90] Subsets II\n\nGiven a collection of integers that might contain duplicates, nums, return all possible subsets (the power set).\nNote: The solution set must not contain duplicate subsets.\néš¾åº¦ï¼šMedium (41.57%)\nè€ƒç‚¹ï¼šå›æº¯\n\n```javascript\nvar subsetsWithDup = function(nums) {\n  var sub = [];\n  var res = [];\n  res.push(sub.slice());\n  if (nums.length == 0) {\n    return res;\n  }\n  nums = nums.sort((a, b) => a - b);\n\n  for (var i = 1; i <= nums.length; i++) {\n    findSub(0, i);\n  }\n  return res;\n\n  function findSub(start, k) {\n    if (sub.length == k) {\n      return res.push(sub.slice());\n    }\n    for (var j = start; j < nums.length; j++) {\n      if (j > start && nums[j] == nums[j - 1]) {\n        continue;\n      }\n      sub.push(nums[j]);\n      findSub(j + 1, k);\n      sub.pop();\n    }\n  }\n};\n```\n","tags":["JavaScript","ç®—æ³•","LeetCode","å›æº¯"],"categories":["ç®—æ³•"]},{"title":"æµè§ˆå™¨å†…æ ¸","url":"/2019/01/07/æµè§ˆå™¨å†…æ ¸/","content":"\n# æµè§ˆå™¨å†…æ ¸\n\n## æµè§ˆå™¨å†…æ ¸æœ‰å“ªå‡ ç§ï¼Ÿ\n\n### Tridentï¼š\n\nIEï¼ˆInternet Explorerï¼‰ï¼Œç”±äºå…¶è¢«åŒ…å«åœ¨å…¨ä¸–ç•Œä½¿ç”¨ç‡æœ€é«˜çš„æ“ä½œç³»ç»Ÿ **Windows** ä¸­ï¼Œå¾—åˆ°äº†æé«˜çš„å¸‚åœºå æœ‰ç‡ï¼Œä»è€Œä½¿å¾— Trident å†…æ ¸ï¼ˆä¹Ÿè¢«ç§°ä¸º **IE å†…æ ¸**ï¼‰é•¿æœŸä¸€å®¶ç‹¬å¤§ã€‚\n\nä½†æ˜¯ç”±äºå¾®è½¯é•¿æ—¶é—´æ²¡æœ‰æ›´æ–° Trident å†…æ ¸ï¼Œåˆ™å¯¼è‡´äº†ä¸¤ä¸ªåæœï¼šä¸€æ˜¯ Trident å†…æ ¸æ›¾ç»**å‡ ä¹ä¸ W3C æ ‡å‡†è„±èŠ‚**ï¼ˆ2005 å¹´ï¼‰ï¼ŒäºŒæ˜¯ Trident å†…æ ¸çš„**å¤§é‡ Bug** ç­‰å®‰å…¨æ€§é—®é¢˜æ²¡æœ‰å¾—åˆ°åŠæ—¶è§£å†³ï¼Œç„¶ååŠ ä¸Šä¸€äº›è‡´åŠ›äºå¼€æºçš„å¼€å‘è€…å’Œä¸€äº›å­¦è€…ä»¬å…¬å¼€è‡ªå·±è®¤ä¸º IE æµè§ˆå™¨ä¸å®‰å…¨çš„è§‚ç‚¹ï¼Œä¹Ÿæœ‰å¾ˆå¤šç”¨æˆ·è½¬å‘äº†å…¶ä»–æµè§ˆå™¨ã€‚\n\n<!-- more -->\n\n#### Trident å†…æ ¸å¸¸è§æµè§ˆå™¨\n\nï¼ˆ1ï¼‰IE6ã€IE7ã€IE8ï¼ˆTrident 4.0ï¼‰ã€IE9ï¼ˆTrident 5.0ï¼‰ã€IE10ï¼ˆTrident 6.0ï¼‰ï¼›\n\nï¼ˆ2ï¼‰çŒè±¹å®‰å…¨æµè§ˆå™¨ï¼š1.0-4.2 ç‰ˆæœ¬ä¸º Trident+Webkitï¼Œ4.3 ç‰ˆæœ¬ä¸º Trident+Blinkï¼›\n\nï¼ˆ3ï¼‰360 å®‰å…¨æµè§ˆå™¨ ï¼š1.0-5.0 ä¸º Tridentï¼Œ6.0 ä¸º Trident+Webkitï¼Œ7.0 ä¸º Trident+Blinkï¼›\n\nï¼ˆ4ï¼‰360 æé€Ÿæµè§ˆå™¨ï¼š7.5 ä¹‹å‰ä¸º Trident+Webkit,7.5 ä¸º Trident+Blinkï¼›\n\nï¼ˆ5ï¼‰å‚²æ¸¸æµè§ˆå™¨ ï¼šå‚²æ¸¸ 1.xã€2.x ä¸º IE å†…æ ¸ï¼Œ3.x ä¸º IE ä¸ Webkit åŒæ ¸ï¼›\n\nï¼ˆ6ï¼‰æœç‹—é«˜é€Ÿæµè§ˆå™¨ï¼š1.x ä¸º Tridentï¼Œ2.0 åŠä»¥åç‰ˆæœ¬ä¸º Trident+Webkitï¼›\n\n#### å…¼å®¹æ¨¡å¼\n\nå›½å†…å¾ˆå¤šçš„åŒæ ¸æµè§ˆå™¨çš„å…¶ä¸­ä¸€æ ¸ä¾¿æ˜¯ **Trident**ï¼Œç¾å…¶åæ›° â€œå…¼å®¹æ¨¡å¼â€ã€‚\n\n#### EdgeHTML å†…æ ¸\n\nWindow10 å‘å¸ƒåï¼ŒIE å°†å…¶å†…ç½®æµè§ˆå™¨å‘½åä¸º **Edge**ï¼ŒEdge æœ€æ˜¾è‘—çš„ç‰¹ç‚¹å°±æ˜¯æ–°å†…æ ¸ EdgeHTMLã€‚\n\n### Gecko ([â€˜gekÉ™ÊŠ])\n\n#### å¼€æºå†…æ ¸\n\nGecko(Firefox å†…æ ¸)ï¼šNetscape6 å¼€å§‹é‡‡ç”¨çš„å†…æ ¸ï¼Œåæ¥çš„ **Mozilla FireFox(ç«ç‹æµè§ˆå™¨)** ä¹Ÿé‡‡ç”¨äº†è¯¥å†…æ ¸ï¼ŒGecko çš„ç‰¹ç‚¹æ˜¯ä»£ç å®Œå…¨å…¬å¼€ï¼Œå› æ­¤ï¼Œå…¶å¯å¼€å‘ç¨‹åº¦å¾ˆé«˜ï¼Œå…¨ä¸–ç•Œçš„ç¨‹åºå‘˜éƒ½å¯ä»¥ä¸ºå…¶ç¼–å†™ä»£ç ï¼Œå¢åŠ åŠŸèƒ½ã€‚å› ä¸ºè¿™æ˜¯ä¸ª**å¼€æºå†…æ ¸**ï¼Œå› æ­¤å—åˆ°è®¸å¤šäººçš„é’çï¼ŒGecko å†…æ ¸çš„æµè§ˆå™¨ä¹Ÿå¾ˆå¤šï¼Œè¿™ä¹Ÿæ˜¯ Gecko å†…æ ¸è™½ç„¶å¹´è½»ä½†å¸‚åœºå æœ‰ç‡èƒ½å¤Ÿè¿…é€Ÿæé«˜çš„é‡è¦åŸå› ã€‚\n\n#### Firefox å†…æ ¸\n\näº‹å®ä¸Šï¼ŒGecko å¼•æ“çš„ç”±æ¥è·Ÿ IE ä¸æ— å…³ç³»ï¼Œå‰é¢è¯´è¿‡ IE æ²¡æœ‰ä½¿ç”¨ W3C çš„æ ‡å‡†ï¼Œè¿™å¯¼è‡´äº†å¾®è½¯å†…éƒ¨ä¸€äº›å¼€å‘äººå‘˜çš„ä¸æ»¡ï¼›ä»–ä»¬ä¸å½“æ—¶å·²ç»åœæ­¢æ›´æ–°äº†çš„ Netscape çš„ä¸€äº›å‘˜å·¥ä¸€èµ·åˆ›åŠäº† **Mozilla**ï¼Œä»¥å½“æ—¶çš„ Mosaic å†…æ ¸ä¸ºåŸºç¡€é‡æ–°ç¼–å†™å†…æ ¸ï¼Œäºæ˜¯å¼€å‘å‡ºäº† Geckoã€‚ä¸è¿‡äº‹å®ä¸Šï¼ŒGecko å†…æ ¸çš„æµè§ˆå™¨ä»ç„¶è¿˜æ˜¯ **Firefox (ç«ç‹) ç”¨æˆ·æœ€å¤š**ï¼Œæ‰€ä»¥æœ‰æ—¶ä¹Ÿä¼šè¢«ç§°ä¸º **Firefox å†…æ ¸**ã€‚æ­¤å¤– Gecko ä¹Ÿæ˜¯ä¸€ä¸ª**è·¨å¹³å°å†…æ ¸**ï¼Œå¯ä»¥åœ¨ Windowsã€ BSDã€Linux å’Œ Mac OS X ä¸­ä½¿ç”¨ã€‚\n\n### Webkit\n\n#### Safari æµè§ˆå™¨\n\nåªè¦æåˆ° Webkitï¼Œå¤§å¤šæ•°äººç«‹é©¬æƒ³åˆ°çš„å¿…ç„¶æ˜¯ Chromeï¼Œç»“æœå¯¼è‡´å¦‚ä»Šæœ‰äº†æŠŠ webkit ç§°ä¸º chrome å†…æ ¸çš„é”™è¯¯è¯´æ³•ï¼Œå³ä½¿ chrome çš„å†…æ ¸å·²ç»æ˜¯ blinkï¼Œå…¶å® **Webkit çš„ç¥–å…ˆæ˜¯ Safari**ï¼Œä¹Ÿå°±æ˜¯è‹¹æœç³»åˆ—äº§å“çš„ä¸“å±æµè§ˆå™¨ã€‚\n\n#### WebKit æ˜¯ KHTML çš„åˆ†æ”¯\n\nWebKit çš„å‰èº«æ˜¯è‹¹æœå…¬å¸ä½¿ç”¨ KDEï¼ˆLinux æ¡Œé¢ç³»ç»Ÿï¼‰å¼€å‘çš„ **KHTML** å¼€æºå¼•æ“ï¼Œå¯ä»¥è¯´ WebKit æ˜¯ KHTML çš„ä¸€ä¸ªå¼€æºåˆ†æ”¯ã€‚\n\n### Chromium/Blink\n\n#### Chromium Fork webkit\n\n2008 å¹´ï¼Œè°·æ­Œå…¬å¸å‘å¸ƒäº† chrome æµè§ˆå™¨ï¼Œæµè§ˆå™¨ä½¿ç”¨çš„å†…æ ¸è¢«å‘½åä¸º **chromium**ã€‚chromium **fork è‡ªå¼€æºå¼•æ“ webkit**ï¼Œå¹¶æé«˜äº† WebKit çš„ä»£ç å¯è¯»æ€§å’Œç¼–è¯‘é€Ÿåº¦ã€‚\n\n#### V8 å¼•æ“\n\nè°·æ­Œå…¬å¸è¿˜ç ”å‘äº†è‡ªå·±çš„ Javascript å¼•æ“ï¼ŒV8ï¼Œæå¤§åœ°**æé«˜äº† Javascript çš„è¿ç®—é€Ÿåº¦**ã€‚\n\n#### Blink æ˜¯ WebKit çš„åˆ†æ”¯\n\nGoogle çš„ Chromium é¡¹ç›®**æœ€åˆ**ä¸€ç›´ä½¿ç”¨ WebKit(WebCore) ä½œä¸ºæ¸²æŸ“å¼•æ“ï¼Œä½†ç”±äºåæ¥è‹¹æœæ¨å‡ºçš„ **WebKit2** ä¸ Chromium çš„æ²™ç®±è®¾è®¡å­˜åœ¨å†²çªï¼Œæ‰€ä»¥ Google å†³å®šä» WebKit è¡ç”Ÿå‡ºè‡ªå·±çš„ **Blink** å¼•æ“ï¼ˆåç”± Google å’Œ Opera Software å…±åŒç ”å‘ï¼‰ã€‚\n\nBlink å…¶å®æ˜¯ WebKit çš„åˆ†æ”¯ï¼Œå¦‚åŒ WebKit æ˜¯ KHTML çš„åˆ†æ”¯ã€‚Google çš„ Chromium é¡¹ç›®æ­¤å‰ä¸€ç›´ä½¿ç”¨ WebKit(WebCore) ä½œä¸ºæ¸²æŸ“å¼•æ“ï¼Œä½†å‡ºäºæŸç§åŸå› ï¼Œå¹¶æ²¡æœ‰å°†å…¶å¤šè¿›ç¨‹æ¶æ„ç§»æ¤å…¥ Webkitã€‚\n\nåæ¥ï¼Œç”±äºè‹¹æœæ¨å‡ºçš„ WebKit2 ä¸ Chromium çš„æ²™ç®±è®¾è®¡å­˜åœ¨å†²çªï¼Œæ‰€ä»¥ Chromium ä¸€ç›´åœç•™åœ¨ WebKitï¼Œå¹¶ä½¿ç”¨ç§»æ¤çš„æ–¹å¼æ¥å®ç°å’Œä¸»çº¿ WebKit2 çš„å¯¹æ¥ã€‚è¿™å¢åŠ äº† Chromium çš„å¤æ‚æ€§ï¼Œä¸”åœ¨ä¸€å®šç¨‹åº¦ä¸Šå½±å“äº† Chromium çš„æ¶æ„ç§»æ¤å·¥ä½œã€‚\n\nåŸºäºä»¥ä¸ŠåŸå› ï¼ŒGoogle å†³å®šä» WebKit è¡ç”Ÿå‡ºè‡ªå·±çš„ Blink å¼•æ“ï¼ˆåç”± Google å’Œ Opera Software å…±åŒç ”å‘ï¼‰ï¼Œå°†åœ¨ WebKit ä»£ç çš„åŸºç¡€ä¸Šç ”å‘æ›´åŠ å¿«é€Ÿå’Œç®€çº¦çš„æ¸²æŸ“å¼•æ“ï¼Œå¹¶é€æ­¥è„±ç¦» WebKit çš„å½±å“ï¼Œåˆ›é€ ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ Blink å¼•æ“ã€‚è¿™æ ·ä»¥æ¥ï¼Œå”¯ä¸€ä¸€æ¡ç»´ç³» Google å’Œè‹¹æœä¹‹é—´æŠ€æœ¯å…³ç³»çš„çº½å¸¦å°±è¿™æ ·è¢«åˆ‡æ–­äº†ã€‚\n\n### Presto ([â€˜prestÉ™ÊŠ])\n\n#### Opera æµè§ˆå™¨\n\nPresto æ˜¯ Opera **è‡ªä¸»ç ”å‘**çš„æ¸²æŸ“å¼•æ“ï¼Œç„¶è€Œä¸ºäº†å‡å°‘ç ”å‘æˆæœ¬ï¼ŒOpera åœ¨ 2013 å¹´ 2 æœˆå®£å¸ƒæ”¾å¼ƒ Prestoï¼Œè½¬è€Œè·Ÿéš Chrome ä½¿ç”¨ WebKit åˆ†æ”¯çš„ Chromium å¼•æ“ä½œä¸ºè‡ªå®¶æµè§ˆå™¨æ ¸å¿ƒå¼•æ“ã€‚\n\nåœ¨ Chrome äº 2013 å¹´æ¨å‡º Blink å¼•æ“ä¹‹åï¼ŒOpera ä¹Ÿç´§è·Ÿå…¶è„šæ­¥è¡¨ç¤ºå°†è½¬è€Œä½¿ç”¨ Blink ä½œä¸ºæµè§ˆå™¨æ ¸å¿ƒå¼•æ“ã€‚\n\n### ç§»åŠ¨ç«¯\n\nç§»åŠ¨ç«¯çš„æµè§ˆå™¨å†…æ ¸ä¸»è¦è¯´çš„æ˜¯**ç³»ç»Ÿå†…ç½®æµè§ˆå™¨çš„å†…æ ¸**ã€‚\n\nç›®å‰ç§»åŠ¨è®¾å¤‡æµè§ˆå™¨ä¸Šå¸¸ç”¨çš„å†…æ ¸æœ‰ **Webkit**ï¼Œ**Blink**ï¼Œ**Trident**ï¼Œ**Gecko** ã€‚\n\n1ã€iPhone å’Œ iPad ç­‰è‹¹æœ iOS å¹³å°ä¸»è¦æ˜¯ **WebKit**ã€‚\n\n2ã€**Android 4.4 ä¹‹å‰**çš„ Android ç³»ç»Ÿæµè§ˆå™¨å†…æ ¸æ˜¯ **WebKit**ï¼Œ**Android 4.4** ç³»ç»Ÿæµè§ˆå™¨åˆ‡æ¢åˆ°äº† Chromiumï¼Œå†…æ ¸æ˜¯ Webkit çš„åˆ†æ”¯ **Blink**ã€‚\n\n3ã€Windows Phone 8 ç³»ç»Ÿæµè§ˆå™¨å†…æ ¸æ˜¯ **Trident**ã€‚\n\n## webkit å†…æ ¸äº†è§£å¤šå°‘ï¼Ÿï¼ˆchrome å†…æ ¸æ˜¯ b-linkï¼‰\n\n[æ·±å…¥å‰–æ webkit](https://ming1016.github.io/2017/10/11/deeply-analyse-webkit/)\n\n## å¾®ä¿¡ x5 å†…æ ¸å’Œåˆ«çš„å†…æ ¸æœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿï¼ˆx5 æ˜¯åŸºäº webkit çš„ï¼‰\n\n### è®¤è¯† X5\n\n- è…¾è®¯åŸºäºä¼˜ç§€å¼€æº Webkit æ·±åº¦ä¼˜åŒ–çš„æµè§ˆå™¨æ¸²æŸ“å¼•æ“\n- ä¸ºæŠ¹å¹³ä¸åŒ Android ç‰ˆæœ¬ä¸åŒ Webview çš„å‘è€Œç”Ÿã€‚ä½†æœ¬èº«ä¹Ÿå¸¦æ¥äº†è®¸å¤šå‘ã€‚\n- è™½ç„¶å®˜æ–¹ä¸æ‰¿è®¤ï¼Œä½†å®é™…ä¸Šå®ƒæ˜¯åŸºäº Chromuim å¼€æºé¡¹ç›®çš„ã€‚\n\n  webkit å†…æ ¸ä»¥åŠ blink å†…æ ¸åœ¨ x5 çš„ä½¿ç”¨æƒ…å†µ\n\n- QQ æµè§ˆå™¨ï¼š6.2 ç‰ˆæœ¬åŠä»¥åä½¿ç”¨ blink å†…æ ¸ã€‚\n- X5 tbs 1.xï¼šç‰ˆæœ¬å·ä¸º 02xxxxï¼Œä½¿ç”¨ webkit å†…æ ¸ã€‚\n- X5 tbs 2.xï¼šç‰ˆæœ¬å·ä¸º 03xxxxã€‚ä½¿ç”¨ blink å†…æ ¸ã€‚\n\n#### æ‹“å±•ï¼šWebkit & Chromuim &Chrome & Blink\n\n- **WebKit**æ˜¯ä¸€ä¸ªå¼€æºçš„é¡¹ç›®ï¼Œå…¶å‰èº«æ˜¯æ¥æºäº KDE çš„ KHTML å’Œ KJSã€‚è¯¥é¡¹ç›®ä¸“æ³¨äºç½‘é¡µå†…å®¹çš„å±•ç¤ºï¼Œå¼€å‘å‡ºä¸€æµçš„ç½‘é¡µæ¸²æŸ“å¼•æ“ã€‚\n- **Chromium**æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨ WebKit ä¹‹ä¸Šçš„æµè§ˆå™¨å¼€æºé¡¹ç›®ï¼Œç”± Google å‘èµ·çš„ã€‚\n- ** Chrome**æ˜¯ Google å…¬å¸çš„æµè§ˆå™¨äº§å“ï¼Œå®ƒåŸºäº chromium å¼€æºé¡¹ç›®ã€‚å¯ä»¥ç†è§£ä¸ºï¼Œå†…æ ¸æ˜¯å¼€æºçš„ï¼ŒUI æ˜¯é—­æºçš„ã€‚\n- **Blink**æ˜¯ Google é€€å‡º WebKit é¡¹ç›®ï¼Œä»è€Œè‡ªå·±åˆ›å»ºçš„æ¸²æŸ“å¼•æ“ã€‚ä½†å¹¶ä¸æ˜¯å…¨æ–°çš„å¼•æ“ï¼ŒBlink ç›®å‰å°±æ˜¯ä» WebKit ç›´æ¥å¤åˆ¶å‡ºä¸€ä¸ªç‰ˆæœ¬å‡ºæ¥ï¼Œç„¶åå°†ä¸ chromium æ— å…³çš„ Ports å…¨éƒ¨ç§»é™¤æ‰ï¼Œå°†ä»£ç ç»“æ„é‡æ–°æ•´ç†ï¼Œå°±ç›®å‰è€Œè¨€ï¼ŒBlink çš„æ¸²æŸ“å’Œ WebKit æ˜¯ä¸€æ ·ï¼Œä½†æ˜¯ï¼Œä»¥åä¸¤è€…å°†å„è‡ªèµ°ä¸åŒçš„è·¯ã€‚\n\n### X5 å‡çº§äº†\n\næˆªè‡³ 16 å¹´ 4 æœˆä»½ï¼Œx5 å‡çº§å…¨é‡å‘å¸ƒã€‚\nTBS2.0 åŸºäº Android 5.0 WebView Blink å†…æ ¸ï¼ˆM37 ç‰ˆæœ¬ï¼‰é€‚é…å®šåˆ¶ä¼˜åŒ–ï¼Œé€‚é… Android å…¨éƒ¨ä¸»æµå¹³å°ï¼Œå¯ä»¥åœ¨æ‰€æœ‰ Android æ‰‹æœºä¸Šä½¿ç”¨ Blink çš„æŠ€æœ¯èƒ½åŠ›ã€‚å…·æœ‰æ›´å¥½çš„ H5/CSS3 æ”¯æŒå’Œæ€§èƒ½ã€‚TBS2.0 å·²ç»å‘å¸ƒï¼Œå°†é€æ­¥åœ¨å„å®¢æˆ·ç«¯ä¸­é™é»˜å‡çº§ï¼Œæ— éœ€æ›´æ–°å¾®ä¿¡ã€æ‰‹æœº QQã€QQ ç©ºé—´å³å¯ä½¿ç”¨æœ€æ–°çš„ TBS2.0 Blink å†…æ ¸ã€‚\n\næ›´ç®€æ´åœ°è¯´ï¼Œå³æ˜¯ï¼š\n\n- åŸºäº Blink å†…æ ¸ï¼ˆchrome 37 ç‰ˆæœ¬ï¼‰\n- é€‚ç”¨äº Android å…¨éƒ¨ä¸»æµå¹³å°\n- é™é»˜å‡çº§\n\nPSï¼šiOS ç‰ˆæœ¬çš„å¾®ä¿¡ Web View ä¸€ç›´æ˜¯ WKWebView å†…æ ¸ï¼ŒWKWebView çš„ç‰ˆæœ¬ä¾èµ–äº iOS çš„ç³»ç»Ÿç‰ˆæœ¬ã€‚\n\nTBS2.0 å†…æ ¸è¯¦æƒ…\n\n- BLINK ç‰ˆæœ¬: åŸºäº Chrome 37\n- HTML ç‰ˆæœ¬: HTML5.0\n- XHTML ç‰ˆæœ¬: xHTML Basic 1.0 | xHTML1.1\n- SVG ç‰ˆæœ¬: SVG1.2\n- WML ç‰ˆæœ¬: Wml 1.0\n- CSS ç‰ˆæœ¬: CSS3\n- Spdy ç‰ˆæœ¬: 3.1\n- æ”¯æŒçš„ JavaScript ç‰ˆæœ¬: Ecma5\n\n### Changelog ä»¥åŠ è§£è¯»\n\n1.å†…æ ¸ä» Webkit å‡çº§è‡³ Blinkï¼Œæ‹¥æœ‰æ›´å¥½çš„æ”¯æŒ\n\né‚£ä¹ˆå“ªé‡Œå¯ä»¥æŸ¥é˜…å…¼å®¹æ€§å‘¢ï¼Ÿ\n\n[X5 CanIUse](http://res.imtt.qq.com/tbs/incoming20160419/home.html)\n\n2.å†…æ ¸ç‰ˆæœ¬å·å‡çº§åˆ° 362xx ç‰ˆæœ¬ã€‚**å¯ä»¥æ ¹æ® UserAgent**åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯å¦å·²å‡çº§åˆ° TBS2.0 ç‰ˆæœ¬,åŒ…å«ï¼ˆTBS/03xxxxï¼‰å­—æ®µã€‚\n\né‚£ä¹ˆæ€ä¹ˆæŸ¥çœ‹è‡ªå·±å¾®ä¿¡é‡Œçš„ TBS ç‰ˆæœ¬ï¼Ÿ\n\nç”¨å¾®ä¿¡æ‰“å¼€[è¿™ä¸ªé¡µé¢](http://motool.github.io/ua/)ï¼Œæ£€æŸ¥ TBS çš„ç‰ˆæœ¬å·ï¼Œ0362xx è¡¨ç¤ºå·²æ›´æ–°ã€‚\né¡µé¢çš„ä»£ç åªæœ‰ä¸¤å¥ï¼Œä¸ºï¼š\n\n```javascript\n// æ£€æµ‹é¡µé¢çš„æ ¸å¿ƒä»£ç \nvar resultDiv = document.getElementById(\"result\");\nresultDiv.innerHTML = window.navigator.userAgent;\n```\n\n3.CSS3 å±æ€§æ”¯æŒå¢å¼ºï¼š\n\n- å®Œæ•´æ”¯æŒ flex\n- ä¼ªå…ƒç´ æ”¯æŒåŠ¨ç”»æ•ˆæœ\n- filter: blur æœ‰æ¨¡ç³Šæ•ˆæœ\n\nPSï¼šæ›´å¤šæ›´å…·ä½“çš„æ”¯æŒæƒ…å†µå¯æŸ¥é˜…[è¿™é‡Œ](http://x5.tencent.com/guide?id=4000)\n\n4.autoplay å±æ€§æœ‰æ•ˆï¼Œå¯è‡ªåŠ¨æ’­æ”¾\n\n5.canvas æ”¯æŒè®¾ç½®èƒŒæ™¯è‰²\n\n6.æ ‡å‡†çš„ç¼“å­˜ç­–ç•¥ï¼Œæ”¯æŒ Spdy 3.1\n\n7.åŠ¨ç”»æ€§èƒ½æå‡\n\n8.æ›´å¥½çš„ inspector æ”¯æŒ\n\n- [å¾®ä¿¡è¿œç¨‹è°ƒè¯•è§£å†³æ–¹æ¡ˆâ€”â€”å¾®ä¿¡ web å¼€å‘è€…å·¥å…·](https://mp.weixin.qq.com/wiki/10/e5f772f4521da17fa0d7304f68b97d7e.html#.E7.A7.BB.E5.8A.A8.E8.B0.83.E8.AF.95)\n- [æ‰‹æœº QQ æµè§ˆå™¨çš„è¿œç¨‹è°ƒè¯•è§£å†³æ–¹æ¡ˆ](http://bbs.mb.qq.com/thread-227056-1-1.html?fid=93)\n\nå‚è€ƒèµ„æ–™ï¼š\n\n- [è§£è¯»å¾®ä¿¡å…¨é¢å‡çº§ X5 Blink å†…æ ¸ï¼ŒH5 æ¸¸æˆè¡Œä¸šé‡å¤§åˆ©å¥½](https://zhuanlan.zhihu.com/p/20812900)\n- [å®˜æ–¹ç½‘ç«™ï¼šè…¾è®¯æµè§ˆæœåŠ¡ï¼æŠ€æœ¯æŒ‡å—](http://x5.tencent.com/guide?id=4000)\n\n### æ€»ç»“\n\n#### å¸¸ç”¨å·¥å…·\n\n- [æ£€æµ‹æ˜¯å¦ä¸º x5ï¼TBS/03xxxx](http://motool.github.io/ua/)\n- [x5 çš„å„é¡¹æ”¯æŒæƒ…å†µï¼X5 CanIUse](http://res.imtt.qq.com/tbs/incoming20160419/home.html)\n- [Android ä¸‹å¾®ä¿¡è¿œç¨‹è°ƒè¯•å·¥å…·-å¾®ä¿¡ web å¼€å‘è€…å·¥å…·](https://mp.weixin.qq.com/wiki/10/e5f772f4521da17fa0d7304f68b97d7e.html#.E7.A7.BB.E5.8A.A8.E8.B0.83.E8.AF.95)ï¼ˆPS:iOS ä¸‹ä½¿ç”¨ Safari è¿œç¨‹è°ƒè¯•å³å¯ï¼‰\n\n#### æˆ‘ä»¬å¯ä»¥ä»ä¸­äº†è§£åˆ°ä»€ä¹ˆ\n\nä¸€ã€å·¥å…·æ–¹é¢ï¼š\n\n- å¯ä»¥é€šè¿‡æŸ¥è¯¢ UA æ¥æ£€æµ‹æ˜¯å¦ä¸º X5ï¼TBS/03xxxxï¼Œ[åœ¨çº¿æ£€æµ‹åœ°å€](http://motool.github.io/ua/)\n- æƒ³çŸ¥é“æŸä¸ª CSS3 å±æ€§ï¼Œæˆ–è€…å…¶ä»– API åœ¨ X5 æ˜¯å¦æ”¯æŒçš„æ—¶å€™ï¼Œå¯ä»¥æŸ¥è¯¢[X5 CanIUse](http://res.imtt.qq.com/tbs/incoming20160419/home.html)\n- è¿œç¨‹è°ƒè¯•å¾®ä¿¡å†…é¡µé¢æ—¶ï¼Œåœ¨ Android ä¸‹å¯ä»¥ä½¿ç”¨å¾®ä¿¡è¿œç¨‹è°ƒè¯•å·¥å…·-å¾®ä¿¡ web å¼€å‘è€…å·¥å…·ï¼Œåœ¨ iOS ä¸‹ä½¿ç”¨ Safari è¿œç¨‹è°ƒè¯•å³å¯ã€‚\n\näºŒã€å¯¹äºå¼€å‘è°ƒè¯•é¡µé¢\n\n- ç›®å‰ï¼Œæš‚æ—¶è¿˜æ²¡æœ‰æŸ¥æ‰¾åˆ° X5 åœ¨å¾®ä¿¡ android å®¢æˆ·ç«¯çš„ç‰ˆæœ¬åˆ†å¸ƒæƒ…å†µçš„æ•°æ®(å¯èƒ½æ˜¯ç”±äº X5 tbs2.0 æ˜¯ä»Šå¹´ 4 æœˆä»½åˆæ‰å¼€å§‹å…¨é‡å‘å¸ƒçš„)ã€‚\n- è™½ç„¶è¯´ï¼ŒX5 æ˜¯é™é»˜å‡çº§ï¼Œæ— éœ€ç”¨æˆ·æ‰‹åŠ¨æ›´æ–°ï¼ŒåŸºæœ¬ä¸Šéƒ½å®ç°å‡çº§ä¸ºæœ€æ–°ç‰ˆæœ¬(ä¸šç•Œè¯´æ³•)ï¼Œä½†**ä»å­˜åœ¨ X5 å†…æ ¸æ˜¯æ—§ç‰ˆæœ¬çš„æƒ…å†µ**(æ ¹æ®æ˜¯éƒ¨åˆ†æµ‹è¯•çš„æ£€æµ‹ UA ç»“æœ)ã€‚å¸Œæœ›èƒ½å¤Ÿåœ¨åç»­çš„æ—¥å­å¯ä»¥è·å–åˆ°ç›¸å…³çš„æ•°æ®ã€‚\n- æ‰‹æœºåŒæ—¶å®‰è£…äº† QQ æµè§ˆå™¨å’Œå¾®ä¿¡ï¼Œä½† QQ æµè§ˆå™¨å†…æ ¸ç‰ˆæœ¬**ä¸ç­‰äº**å¾®ä¿¡å†…æ ¸ç‰ˆæœ¬ï¼Œ**åªæœ‰åœ¨ QQ æµè§ˆå™¨å†…æ ¸ä¸ºå¤§äºç­‰äº 6.2 ç‰ˆæœ¬æ‰æ˜¯ Blink å†…æ ¸ï¼Œè°ƒè¯•é¡µé¢çš„ç»“æœæ‰å¯ä»¥æ›¿ä»£åœ¨å¾®ä¿¡å†…é¡µé¢è°ƒè¯•çš„ç»“æœ**ï¼ˆæƒ³è¦ä¸ç™»é™†å¾®ä¿¡ç”¨ QQ æµè§ˆå™¨æ¥æ›¿ä»£è°ƒè¯•çš„éœ€è¦æ³¨æ„ä¸‹\n\n### X5 çš„ç‰ˆæœ¬åˆ†å¸ƒæƒ…å†µ\n\næ®è…¾è®¯å†…éƒ¨çš„å°ä¼™ä¼´å‘ŠçŸ¥ï¼Œx5 å†…æ ¸åŸºæœ¬è¦†ç›–ç†è®ºä¸Šè¾¾åˆ° 100%ï¼Œä½†éš¾å…ä¼šæœ‰æ¼ç½‘ä¹‹é±¼ã€‚è€Œæ ¹æ®å®é™…æ•°æ®æŠ½æ ·æ•´ç†æ˜¾ç¤ºï¼Œæˆªè‡³ 2016 å¹´ 5 æœˆ 19 æ—¥ï¼Œx5 å†…æ ¸åŸºæœ¬è¦†ç›–ç‡è¾¾åˆ° 91.47%ã€‚\n\n### [X5 é—®é¢˜æ±‡æ€»](https://www.qianduan.net/qqliu-lan-qi-x5nei-he-wen-ti-hui-zong/)\n","tags":["æµè§ˆå™¨"],"categories":["æµè§ˆå™¨"]},{"title":"leetcodeç®—æ³•åˆ·é¢˜ç¬”è®°ï¼ˆä¸€ï¼‰â€”â€”æ•°ç»„","url":"/2018/12/19/leetcodeç®—æ³•åˆ·é¢˜ç¬”è®°ï¼ˆä¸€ï¼‰â€”â€”æ•°ç»„/","content":"\n_è¯¥ç¬”è®°åªä¸ºä¸ªäººæ‰€å†™ç®—æ³•ï¼Œä¸ä¸€å®šæ˜¯æœ€ä¼˜è§£æ³•ï¼Œä»…ä¾›å‚è€ƒ_\n\n# [1] Two Sum\n\nGiven an array of integers, return indices of the two numbers such that they add up to a specific target.\néš¾åº¦ï¼šEasy (42.36%)\nè€ƒç‚¹ï¼šå“ˆå¸Œè¡¨\næ€è·¯ï¼šç”¨ä¸€éå¾ªç¯ ä¸€è¾¹å‘å“ˆå¸Œè¡¨ä¸­å­˜å€¼ï¼Œä¸€è¾¹æ¯”è¾ƒåˆ¤æ–­\n\n<!-- more -->\n\n```javascript\nvar twoSum = function(nums, target) {\n  var map = {};\n  for (i = 0; i < nums.length; i++) {\n    const complement = target - nums[i];\n    if (complement in map) {\n      return [i, map[complement]];\n    }\n    map[nums[i]] = i;\n  }\n  return -1;\n};\n```\n\n# [11] Container With Most Water\n\nGiven n non-negative integers a1, a2, ..., anÂ , where each represents a point at coordinate (i, ai). n vertical lines are drawn such that the two endpoints of line i is at (i, ai) and (i, 0). Find two lines, which together with x-axis forms a container, such that the container contains the most water.\nNote:Â You may not slant the container and n is at least 2.\néš¾åº¦ï¼šMedium (42.93%)\nè€ƒç‚¹ï¼šåŠ¨æ€è§„åˆ’\næ€è·¯ï¼š\n\n1. è®¾å®š iï¼Œj åˆ†åˆ«æŒ‡å‘æ•°ç»„çš„å¤´å’Œå°¾\n2. æ¯”è¾ƒ iï¼Œj æ‰€å¯¹åº”çš„ä½ç½®çš„å€¼ï¼Œå€¼è¾ƒå°çš„é‚£ä¸€ä¸ªç§»åŠ¨ï¼ˆi++æˆ– j--ï¼‰\n\n```javascript\nvar maxArea = function(height) {\n  var maxArea = 0;\n  var i = 0;\n  var j = height.length - 1;\n  while (i < j) {\n    const long = Math.min(height[i], height[j]);\n    const area = long * (j - i);\n    if (area > maxArea) {\n      maxArea = area;\n    }\n    if (height[i] < height[j]) {\n      i++;\n    } else {\n      j--;\n    }\n  }\n  return maxArea;\n};\n```\n\n# [15] 3Sum\n\nGiven an array nums of n integers, are there elements a, b, c in nums such that a + b + c = 0? Find all unique triplets in the array which gives the sum of zero.\nNote:Â The solution set must not contain duplicate triplets.\néš¾åº¦ï¼šMedium (23.55%)\næ€è·¯ï¼š\n\n1. æ•°ç»„æ’åºï¼ˆå‡åºï¼‰\n2. è®¾å®šä¸‰ä¸ªæŒ‡é’ˆï¼Œæœ€å¤–å±‚å¾ªç¯ä» 0 å¼€å§‹ï¼Œåˆ°æ•°ç»„çš„å°¾ç»“æŸï¼ˆi=0ï¼‰\n3. ç¬¬äºŒå±‚å¾ªç¯ï¼Œä¸€ä¸ªæŒ‡å‘ä¸Šä¸€ä¸ªæŒ‡é’ˆçš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼ˆj=i+1ï¼‰ï¼Œå¦ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„å°¾éƒ¨(k=nums.length-1)\n4. å¦‚æœä¸‰ä¸ªå…ƒç´ ä¹‹å’Œç­‰äº 0ï¼Œåˆ™ push è¿›è¦è¿”å›çš„æ•°ç»„ä¸­ï¼›å¦‚æœä¸‰ä¸ªå…ƒç´ ä¹‹å’Œå¤§äº 0ï¼Œè¯´æ˜ç¬¬ä¸‰ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ è¿‡å¤§ï¼Œåˆ™ç¬¬ä¸‰ä¸ªæŒ‡é’ˆå‘å‰ç§»(k--);å¦‚æœä¸‰ä¸ªå…ƒç´ ä¹‹å’Œå°äº 0ï¼Œè¯´æ˜ç¬¬äºŒä¸ªæŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ è¿‡å°ï¼Œåˆ™ç¬¬äºŒä¸ªæŒ‡é’ˆå‘åç§»(j++);\n\n```javascript\nvar threeSum = function(nums) {\n  var rtn = [];\n  if (nums.length < 3) {\n    return rtn;\n  }\n  nums = nums.sort(function(a, b) {\n    return a - b;\n  });\n  for (var i = 0; i < nums.length - 1; i++) {\n    if (nums[i] > 0) {\n      return rtn;\n    }\n    if (i > 0 && nums[i] == nums[i - 1]) {\n      continue;\n    }\n\n    for (var j = i + 1, k = nums.length - 1; j < k; ) {\n      if (nums[i] + nums[j] + nums[k] === 0) {\n        rtn.push([nums[i], nums[j], nums[k]]);\n        j++;\n        k--;\n        while (j < k && nums[j] == nums[j - 1]) {\n          j++;\n        }\n        while (j < k && nums[k] == nums[k + 1]) {\n          k--;\n        }\n      } else if (nums[i] + nums[j] + nums[k] > 0) {\n        k--;\n      } else {\n        j++;\n      }\n    }\n  }\n  return rtn;\n};\n```\n\n# [16] 3Sum Closest\n\nGiven an array nums of n integers and an integer target, find three integers in numsÂ such that the sum is closest toÂ target. Return the sum of the three integers. You may assume that each input would have exactly one solution.\néš¾åº¦ï¼šMedium (41.40%)\næ€è·¯ï¼šä¸ä¸Šé¢˜ç±»ä¼¼\n\n```javascript\nvar threeSumClosest = function(nums, target) {\n  var sum;\n  if (nums.length < 3) {\n    return sum;\n  }\n  nums = nums.sort(function(a, b) {\n    return a - b;\n  });\n  var sum = nums[0] + nums[1] + nums[2];\n  var distance = Math.abs(sum - target);\n  for (var i = 0; i < nums.length - 2; i++) {\n    for (var j = i + 1, k = nums.length - 1; j < k; ) {\n      if (Math.abs(nums[i] + nums[j] + nums[k] - target) < distance) {\n        sum = nums[i] + nums[j] + nums[k];\n        distance = Math.abs(sum - target);\n      }\n      if (nums[i] + nums[j] + nums[k] === target) {\n        break;\n      }\n      if (nums[i] + nums[j] + nums[k] > target) {\n        k--;\n      } else if (nums[i] + nums[j] + nums[k] < target) {\n        j++;\n      }\n    }\n  }\n  return sum;\n};\n```\n\n# [18] 4Sum\n\nGiven an array nums of n integers and an integer target, are there elements a, b, c, and d in nums such that a + b + c + d = target? Find all unique quadruplets in the array which gives the sum of target.\nNote: The solution set must not contain duplicate quadruplets.\néš¾åº¦ï¼šMedium (29.83%)\næ€è·¯ï¼šæ€è·¯åŒ 3Sumï¼Œå¤šä¸€å±‚å¾ªç¯ã€‚æ³¨æ„è·³è¿‡ç›¸åŒçš„æ•°ï¼ˆæœ€å¤–ä¸¤å±‚çš„å¾ªç¯å˜é‡ï¼‰\n\n```javascript\nvar fourSum = function(nums, target) {\n  var rtn = [];\n  if (nums.length < 4) {\n    return rtn;\n  }\n  nums = nums.sort(function(a, b) {\n    return a - b;\n  });\n  for (var m = 0; m < nums.length - 3; m++) {\n    var complement = target - nums[m];\n    for (var i = m + 1; i < nums.length - 2; i++) {\n      for (var j = i + 1, k = nums.length - 1; j < k; ) {\n        if (nums[i] + nums[j] + nums[k] === complement) {\n          rtn.push([nums[m], nums[i], nums[j], nums[k]]);\n          j++;\n          k--;\n          while (j < k && nums[j] == nums[j - 1]) {\n            j++;\n          }\n          while (j < k && nums[k] == nums[k + 1]) {\n            k--;\n          }\n        } else if (nums[i] + nums[j] + nums[k] > complement) {\n          k--;\n        } else {\n          j++;\n        }\n        if (i < nums.length - 1 && nums[i] == nums[i + 1]) {\n          ++i;\n        }\n      }\n      if (m < nums.length - 1 && nums[m] == nums[m + 1]) {\n        ++m;\n      }\n    }\n  }\n  return rtn;\n};\n```\n\n# [26] Remove Duplicates from Sorted Array\n\nGiven a sorted array nums, remove the duplicates in-place such that each element appear only once and return the new length.\nDo not allocate extra space for another array, you must do this by modifying the input array in-place with O(1) extra memory.\néš¾åº¦ï¼šEasy (39.80%)\næ€è·¯ï¼šä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡é’ˆè´Ÿè´£å¯»æ‰¾å’Œåä¸€ä¸ªä¸ç›¸ç­‰çš„æ•°ï¼Œå¦ä¸€ä¸ªæŒ‡é’ˆè´Ÿè´£ä¸€æ­¥æ­¥å‘åç§»å»é‡ã€‚\n\n```javascript\nvar removeDuplicates = function(nums) {\n  if (nums.length == 0) {\n    return 0;\n  }\n  var i = 0;\n  var j = 0;\n  for (i = 0; i < nums.length - 1; ) {\n    if (nums[i] === nums[i + 1]) {\n      i++;\n    } else {\n      if (i !== j) {\n        nums[j + 1] = nums[i + 1];\n      }\n      j++;\n      i++;\n    }\n  }\n  nums = nums.slice(0, j + 1);\n  return nums.length;\n};\n```\n\n# [27] Remove Element\n\nGiven an array nums and a value val, remove all instances of that value in-place and return the new length.\nDo not allocate extra space for another array, you must do this by modifying the input array in-place with O(1) extra memory.\nThe order of elements can be changed. It doesn't matter what you leave beyond the new length.\néš¾åº¦ï¼šEasy (43.73%)\næ€è·¯ï¼šæ‰¾åˆ°å’Œ val å€¼ç›¸ç­‰çš„ä½ç½®ï¼Œå°†æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ èµ‹å€¼è¿‡æ¥ï¼ˆå»æ‰è¿™ä¸ª valï¼Œæ•°ç»„é•¿åº¦å‡ä¸€ï¼‰\n\n```javascript\nvar removeElement = function(nums, val) {\n  var i = 0;\n  var n = nums.length;\n  for (i = 0; i < n; ) {\n    if (nums[i] == val) {\n      nums[i] = nums[n - 1];\n      n--;\n    } else {\n      i++;\n    }\n  }\n  return n;\n};\n```\n\n# [31] Next Permutation\n\nImplement next permutation, which rearranges numbers into the lexicographically next greater permutation of numbers.\nIf such arrangement is not possible, it must rearrange it as the lowest possible order (ie, sorted in ascending order).\nThe replacement must be in-place and use only constantÂ extra memory.\nHere are some examples. Inputs are in the left-hand column and its corresponding outputs are in the right-hand column.\n1,2,3 â†’ 1,3,2\n3,2,1 â†’ 1,2,3\n1,1,5 â†’ 1,5,1\néš¾åº¦ï¼šMedium (30.09%)\næ€è·¯ï¼š\n\n1. ä»åå‘å‰æ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ ï¼Œç›´åˆ°å‰ä¸€ä¸ªå…ƒç´ å°äºåä¸€ä¸ªå…ƒç´ ï¼Œåœæ­¢ï¼ˆiï¼‰ã€‚\n2. è‹¥å·²ç»æ²¡æœ‰äº†å‰ä¸€ä¸ªå…ƒç´ ï¼ˆi=0ï¼‰ï¼Œåˆ™è¯¥åºåˆ—ä¸ºé€’å‡åºåˆ—ï¼Œæ²¡æœ‰ Next Permutationã€‚æŒ‰ç…§é¢˜ç›®è¦æ±‚ï¼Œç›´æ¥åè½¬åºåˆ—ã€‚\n3. å‰ä¸€ä¸ªå…ƒç´ ï¼ˆj=i-1ï¼‰å°äºåä¸€ä¸ªå…ƒç´ ï¼ˆiï¼‰ï¼Œæ‰¾åˆ°å‰ä¸€ä¸ªå…ƒç´ ï¼ˆjï¼‰è¦äº¤æ¢çš„å…ƒç´ ï¼Œä» i çš„åä¸€ä¸ªå…ƒç´ å¼€å§‹å¾€åæŸ¥æ‰¾ï¼Œæ‰¾åˆ°æœ€åä¸€ä¸ªæ¯”â€œå‰ä¸€ä¸ªå…ƒç´ ï¼ˆjï¼‰â€å¤§çš„å…ƒç´ ï¼ˆkï¼‰ï¼Œä¹Ÿå°±æ˜¯å†å¾€åçš„å…ƒç´ ï¼Œå°±æ¯”å…ƒç´  j å°äº†ã€‚äº¤æ¢ j å’Œ k å…ƒç´ ã€‚\n4. ä» i å¼€å§‹ï¼ŒåŒ…æ‹¬ i åˆ°åºåˆ—çš„å°¾éƒ¨ï¼Œåè½¬ã€‚\n   åˆ™å¾—å‡ºçš„å³æ˜¯ Next Permutation\n\n```javascript\nvar nextPermutation = function(nums) {\n  var i = nums.length - 1;\n  while (nums[i] <= nums[i - 1]) {\n    i--;\n  }\n  if (i !== 0) {\n    var j = i - 1;\n    var k = i + 1;\n    while (nums[j] < nums[k]) {\n      k++;\n    }\n    var temp = nums[k - 1];\n    nums[k - 1] = nums[j];\n    nums[j] = temp;\n    for (var m = i, n = nums.length - 1; m < n; m++, n--) {\n      var temp = nums[n];\n      nums[n] = nums[m];\n      nums[m] = temp;\n    }\n  } else {\n    nums = nums.reverse();\n  }\n};\n```\n\n# [33] Search in Rotated Sorted Array\n\nSuppose an array sorted in ascending order is rotated at some pivot unknown to you beforehand.(i.e., [0,1,2,4,5,6,7] might become [4,5,6,7,0,1,2]).\nYou are given a target value to search. If found in the array return its index, otherwise return -1.\nYou may assume no duplicate exists in the array.\nYour algorithm's runtime complexity must be in the order ofÂ O(logÂ n).\néš¾åº¦ï¼šMedium (32.68%)\nè€ƒç‚¹ï¼šäºŒåˆ†æ³•\næ³¨æ„ï¼šåˆ¤æ–­å’Œå¾ªç¯çš„è¾¹ç•Œæ¡ä»¶\n\n```javascript\nvar search = function(nums, target) {\n  if (nums.length == 0) {\n    return -1;\n  }\n  var start = 0;\n  var end = nums.length - 1;\n  while (start <= end) {\n    var middle = parseInt((start + end) / 2);\n    if (nums[middle] == target) {\n      return middle;\n    }\n    if (nums[middle] > nums[end]) {\n      if (target >= nums[start] && target < nums[middle]) {\n        end = middle - 1;\n      } else {\n        start = middle + 1;\n      }\n    } else {\n      if (target > nums[middle] && target <= nums[end]) {\n        start = middle + 1;\n      } else {\n        end = middle - 1;\n      }\n    }\n  }\n  return -1;\n};\n```\n\n# [34] Find First and Last Position of Element in Sorted Array\n\nGiven an array of integers nums sorted in ascending order, find the starting and ending position of a given target value.\nYour algorithm's runtime complexity must be in the order of O(log n).\nIf the target is not found in the array, return [-1, -1].\néš¾åº¦ï¼šMedium (33.06%)\nè€ƒç‚¹ï¼šäºŒåˆ†æ³•\næ³¨æ„ï¼šåˆ¤æ–­å’Œå¾ªç¯çš„è¾¹ç•Œæ¡ä»¶\n\n```javascript\nvar searchRange = function(nums, target) {\n  if (nums.length == 0) {\n    return [-1, -1];\n  }\n  var startFind = 0;\n  var endFind = nums.length - 1;\n  var start;\n  var end;\n  while (startFind <= endFind) {\n    var mid = parseInt((startFind + endFind) / 2);\n    if (nums[mid] == target) {\n      start = mid;\n      end = mid;\n      while (nums[start - 1] == target || nums[end + 1] == target) {\n        if (nums[start - 1] == target) {\n          start--;\n        }\n        if (nums[end + 1] == target) {\n          end++;\n        }\n      }\n      return [start, end];\n    } else if (nums[mid] < target) {\n      startFind = mid + 1;\n    } else {\n      endFind = mid - 1;\n    }\n  }\n  return [-1, -1];\n};\n```\n\n# [35] Search Insert Position\n\nGiven a sorted array and a target value, return the index if the target is found. If not, return the index where it would be if it were inserted in order.\nYou may assume no duplicates in the array.\néš¾åº¦ï¼šEasy (40.50%)\n\n```javascript\nvar searchInsert = function(nums, target) {\n  if (nums.length == 0) {\n    return 0;\n  }\n  let out = nums.indexOf(target);\n  if (out == -1) {\n    let i = 0;\n    for (; target > nums[i]; i++) {}\n    out = i;\n  }\n  return out;\n};\n```\n\n# [39] Combination Sum\n\nGiven a set of candidate numbers (candidates) (without duplicates) and a target number (target), find all unique combinations in candidatesÂ where the candidate numbers sums to target.\nThe same repeated number may be chosen from candidatesÂ unlimited number of times.\nNote:All numbers (including target) will be positive integers.The solution set must not contain duplicate combinations.\néš¾åº¦ï¼šMedium (46.97%)\nè€ƒç‚¹ï¼šé€’å½’\n\n```javascript\nvar combinationSum = function(candidates, target) {\n  var rt = [];\n  var solution = [];\n  if (candidates.length == 0) {\n    return rt;\n  }\n  candidates = candidates.sort(function(a, b) {\n    return a - b;\n  });\n  sarch(0, target);\n\n  function sarch(start, target) {\n    if (start == candidates.length) {\n      return;\n    }\n    if (target == 0) {\n      return rt.push(solution.slice());\n    }\n    if (target < 0) {\n      return;\n    }\n    solution.push(candidates[start]);\n    sarch(start, target - candidates[start]);\n    solution.pop();\n    sarch(start + 1, target);\n  }\n  return rt;\n};\n```\n\n# [40] Combination Sum II\n\nGiven a collection of candidate numbers (candidates) and a target number (target), find all unique combinations in candidatesÂ where the candidate numbers sums to target.\nEach number in candidatesÂ may only be used once in the combination.\nNote:All numbers (including target) will be positive integers.The solution set must not contain duplicate combinations.\néš¾åº¦ï¼šMedium (40.37%)\nè€ƒç‚¹ï¼šé€’å½’\næ³¨æ„ï¼šé™åˆ¶è¾¹ç•Œæ¡ä»¶ï¼Œè¿‡æ»¤é‡å¤çš„ç»“æœ\n\n```javascript\nvar combinationSum2 = function(candidates, target) {\n  var rt = [];\n  var solution = [];\n  if (candidates.length == 0) {\n    return rt;\n  }\n  candidates = candidates.sort(function(a, b) {\n    return a - b;\n  });\n  search(0, target);\n  return rt;\n\n  function search(start, target) {\n    if (target === 0 && start === candidates.length) {\n      return rt.push(solution.slice());\n    }\n    if (target < 0 || start === candidates.length) {\n      return;\n    }\n\n    solution.push(candidates[start]);\n    search(start + 1, target - candidates[start]);\n    solution.pop();\n    if (solution[solution.length - 1] !== candidates[start]) {\n      search(start + 1, target);\n    }\n  }\n};\n```\n","tags":["JavaScript","ç®—æ³•","LeetCode","æ•°ç»„"],"categories":["ç®—æ³•"]},{"title":"webpackåŸºç¡€çŸ¥è¯†ï¼ˆäºŒï¼‰","url":"/2018/12/05/webpackåŸºç¡€çŸ¥è¯†ï¼ˆäºŒï¼‰/","content":"\n## ä»£ç åˆ†ç¦»\n\nä»£ç åˆ†ç¦»æ˜¯ webpack ä¸­æœ€å¼•äººæ³¨ç›®çš„ç‰¹æ€§ä¹‹ä¸€ã€‚æ­¤ç‰¹æ€§èƒ½å¤ŸæŠŠä»£ç åˆ†ç¦»åˆ°ä¸åŒçš„ bundle ä¸­ï¼Œç„¶åå¯ä»¥æŒ‰éœ€åŠ è½½æˆ–å¹¶è¡ŒåŠ è½½è¿™äº›æ–‡ä»¶ã€‚ä»£ç åˆ†ç¦»å¯ä»¥ç”¨äºè·å–æ›´å°çš„ bundleï¼Œä»¥åŠæ§åˆ¶èµ„æºåŠ è½½ä¼˜å…ˆçº§ï¼Œå¦‚æœä½¿ç”¨åˆç†ï¼Œä¼šæå¤§å½±å“åŠ è½½æ—¶é—´ã€‚\n\næœ‰ä¸‰ç§å¸¸ç”¨çš„ä»£ç åˆ†ç¦»æ–¹æ³•ï¼š\n\n1. å…¥å£èµ·ç‚¹ï¼šä½¿ç”¨ entry é…ç½®æ‰‹åŠ¨åœ°åˆ†ç¦»ä»£ç ã€‚\n2. é˜²æ­¢é‡å¤ï¼šä½¿ç”¨ CommonsChunkPlugin å»é‡å’Œåˆ†ç¦» chunkã€‚\n3. åŠ¨æ€å¯¼å…¥ï¼šé€šè¿‡æ¨¡å—çš„å†…è”å‡½æ•°è°ƒç”¨æ¥åˆ†ç¦»ä»£ç ã€‚\n\n<!-- more -->\n\n### å…¥å£èµ·ç‚¹(entry points)\n\né—®é¢˜ï¼š\n\n1. å¦‚æœå…¥å£ chunks ä¹‹é—´åŒ…å«é‡å¤çš„æ¨¡å—ï¼Œé‚£äº›é‡å¤æ¨¡å—éƒ½ä¼šè¢«å¼•å…¥åˆ°å„ä¸ª bundle ä¸­ã€‚\n2. è¿™ç§æ–¹æ³•ä¸å¤Ÿçµæ´»ï¼Œå¹¶ä¸”ä¸èƒ½å°†æ ¸å¿ƒåº”ç”¨ç¨‹åºé€»è¾‘è¿›è¡ŒåŠ¨æ€æ‹†åˆ†ä»£ç ã€‚\n\n### é˜²æ­¢é‡å¤(prevent duplication)\n\nCommonsChunkPlugin æ’ä»¶å¯ä»¥å°†å…¬å…±çš„ä¾èµ–æ¨¡å—æå–åˆ°å·²æœ‰çš„å…¥å£ chunk ä¸­ï¼Œæˆ–è€…æå–åˆ°ä¸€ä¸ªæ–°ç”Ÿæˆçš„ chunkã€‚\nä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œå¯å°†é‡å¤çš„ lodash æ¨¡å—å»é™¤ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCommonsChunkPlugin æ’ä»¶å°† lodash åˆ†ç¦»åˆ°å•ç‹¬çš„ chunkï¼Œå¹¶ä¸”å°†å…¶ä» main bundle ä¸­ç§»é™¤ï¼Œå‡è½»äº†å¤§å°ã€‚\n\nä»¥ä¸‹æ˜¯ç”±ç¤¾åŒºæä¾›çš„ï¼Œä¸€äº›å¯¹äºä»£ç åˆ†ç¦»å¾ˆæœ‰å¸®åŠ©çš„æ’ä»¶å’Œ loadersï¼š\n\n1. ExtractTextPlugin: ç”¨äºå°† CSS ä»ä¸»åº”ç”¨ç¨‹åºä¸­åˆ†ç¦»ã€‚\n2. bundle-loader: ç”¨äºåˆ†ç¦»ä»£ç å’Œå»¶è¿ŸåŠ è½½ç”Ÿæˆçš„ bundleã€‚\n3. promise-loader: ç±»ä¼¼äº bundle-loader ï¼Œä½†æ˜¯ä½¿ç”¨çš„æ˜¯ promisesã€‚\n\nCommonsChunkPlugin æ’ä»¶è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨æ˜¾å¼çš„ vendor chunks åŠŸèƒ½ï¼Œä»åº”ç”¨ç¨‹åºä»£ç ä¸­åˆ†ç¦» vendor æ¨¡å—ã€‚\n\n### åŠ¨æ€å¯¼å…¥(dynamic imports)\n\nå½“æ¶‰åŠåˆ°åŠ¨æ€ä»£ç æ‹†åˆ†æ—¶ï¼Œwebpack æä¾›äº†ä¸¤ä¸ªç±»ä¼¼çš„æŠ€æœ¯ã€‚å¯¹äºåŠ¨æ€å¯¼å…¥ï¼Œç¬¬ä¸€ç§ï¼Œä¹Ÿæ˜¯ä¼˜å…ˆé€‰æ‹©çš„æ–¹å¼æ˜¯ï¼Œä½¿ç”¨ç¬¦åˆ ECMAScript ææ¡ˆ çš„ import() è¯­æ³•ã€‚ç¬¬äºŒç§ï¼Œåˆ™æ˜¯ä½¿ç”¨ webpack ç‰¹å®šçš„ require.ensureã€‚\n\n## æ‡’åŠ è½½\n\næ‡’åŠ è½½æˆ–è€…æŒ‰éœ€åŠ è½½ï¼Œæ˜¯ä¸€ç§å¾ˆå¥½çš„ä¼˜åŒ–ç½‘é¡µæˆ–åº”ç”¨çš„æ–¹å¼ã€‚è¿™ç§æ–¹å¼å®é™…ä¸Šæ˜¯å…ˆæŠŠä½ çš„ä»£ç åœ¨ä¸€äº›é€»è¾‘æ–­ç‚¹å¤„åˆ†ç¦»å¼€ï¼Œç„¶ååœ¨ä¸€äº›ä»£ç å—ä¸­å®ŒæˆæŸäº›æ“ä½œåï¼Œç«‹å³å¼•ç”¨æˆ–å³å°†å¼•ç”¨å¦å¤–ä¸€äº›æ–°çš„ä»£ç å—ã€‚è¿™æ ·åŠ å¿«äº†åº”ç”¨çš„åˆå§‹åŠ è½½é€Ÿåº¦ï¼Œå‡è½»äº†å®ƒçš„æ€»ä½“ä½“ç§¯ï¼Œå› ä¸ºæŸäº›ä»£ç å—å¯èƒ½æ°¸è¿œä¸ä¼šè¢«åŠ è½½ã€‚\n\n## ç¼“å­˜\n\næˆ‘ä»¬ä½¿ç”¨ webpack æ¥æ‰“åŒ…æˆ‘ä»¬çš„æ¨¡å—åŒ–åçš„åº”ç”¨ç¨‹åºï¼Œwebpack ä¼šç”Ÿæˆä¸€ä¸ªå¯éƒ¨ç½²çš„ /dist ç›®å½•ï¼Œç„¶åæŠŠæ‰“åŒ…åçš„å†…å®¹æ”¾ç½®åœ¨æ­¤ç›®å½•ä¸­ã€‚åªè¦ /dist ç›®å½•ä¸­çš„å†…å®¹éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œå®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰å°±èƒ½å¤Ÿè®¿é—®ç½‘ç«™æ­¤æœåŠ¡å™¨çš„ç½‘ç«™åŠå…¶èµ„æºã€‚è€Œæœ€åä¸€æ­¥è·å–èµ„æºæ˜¯æ¯”è¾ƒè€—è´¹æ—¶é—´çš„ã€‚å› æ­¤æˆ‘ä»¬ä½¿ç”¨ç¼“å­˜æŠ€æœ¯ã€‚\nä»¥é€šè¿‡å‘½ä¸­ç¼“å­˜ï¼Œä»¥é™ä½ç½‘ç»œæµé‡ï¼Œä½¿ç½‘ç«™åŠ è½½é€Ÿåº¦æ›´å¿«ï¼Œç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬åœ¨éƒ¨ç½²æ–°ç‰ˆæœ¬æ—¶ä¸æ›´æ”¹èµ„æºçš„æ–‡ä»¶åï¼Œæµè§ˆå™¨å¯èƒ½ä¼šè®¤ä¸ºå®ƒæ²¡æœ‰è¢«æ›´æ–°ï¼Œå°±ä¼šä½¿ç”¨å®ƒçš„ç¼“å­˜ç‰ˆæœ¬ã€‚ç”±äºç¼“å­˜çš„å­˜åœ¨ï¼Œå½“ä½ éœ€è¦è·å–æ–°çš„ä»£ç æ—¶ï¼Œå°±ä¼šæ˜¾å¾—å¾ˆæ£˜æ‰‹ã€‚\næ‰€ä»¥éœ€è¦é€šè¿‡å¿…è¦çš„é…ç½®ï¼Œä»¥ç¡®ä¿ webpack ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶èƒ½å¤Ÿè¢«å®¢æˆ·ç«¯ç¼“å­˜ï¼Œè€Œåœ¨æ–‡ä»¶å†…å®¹å˜åŒ–åï¼Œèƒ½å¤Ÿè¯·æ±‚åˆ°æ–°çš„æ–‡ä»¶ã€‚\n\n### è¾“å‡ºæ–‡ä»¶çš„æ–‡ä»¶å(Output Filenames)\n\né€šè¿‡ä½¿ç”¨ output.filename è¿›è¡Œæ–‡ä»¶åæ›¿æ¢ï¼Œå¯ä»¥ç¡®ä¿æµè§ˆå™¨è·å–åˆ°ä¿®æ”¹åçš„æ–‡ä»¶ã€‚[hash] æ›¿æ¢å¯ä»¥ç”¨äºåœ¨æ–‡ä»¶åä¸­åŒ…å«ä¸€ä¸ªæ„å»ºç›¸å…³(build-specific)çš„ hashï¼Œä½†æ˜¯æ›´å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨ [chunkhash] æ›¿æ¢ï¼Œåœ¨æ–‡ä»¶åä¸­åŒ…å«ä¸€ä¸ª chunk ç›¸å…³(chunk-specific)çš„å“ˆå¸Œã€‚\n\n### æå–æ¨¡æ¿(Extracting Boilerplate)\n\nCommonsChunkPlugin å¯ä»¥ç”¨äºå°†æ¨¡å—åˆ†ç¦»åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œè¿˜èƒ½å¤Ÿåœ¨æ¯æ¬¡ä¿®æ”¹åçš„æ„å»ºç»“æœä¸­ï¼Œå°† webpack çš„æ ·æ¿(boilerplate)å’Œ manifest æå–å‡ºæ¥ã€‚é€šè¿‡æŒ‡å®š entry é…ç½®ä¸­æœªç”¨åˆ°çš„åç§°ï¼Œæ­¤æ’ä»¶ä¼šè‡ªåŠ¨å°†æˆ‘ä»¬éœ€è¦çš„å†…å®¹æå–åˆ°å•ç‹¬çš„åŒ…ä¸­ï¼š\n\n```javascript\nconst path = require('path');\n+ const webpack = require('webpack');\n  const CleanWebpackPlugin = require('clean-webpack-plugin');\n  const HtmlWebpackPlugin = require('html-webpack-plugin');\n\n  module.exports = {\n    entry: './src/index.js',\n    plugins: [\n      new CleanWebpackPlugin(['dist']),\n      new HtmlWebpackPlugin({\n        title: 'Caching'\n-     })\n+     }),\n+     new webpack.optimize.CommonsChunkPlugin({\n+       name: 'manifest'\n+     })\n    ],\n    output: {\n      filename: '[name].[chunkhash].js',\n      path: path.resolve(__dirname, 'dist')\n    }\n  };\n```\n\nå°†ç¬¬ä¸‰æ–¹åº“(library)ï¼ˆä¾‹å¦‚ lodash æˆ– reactï¼‰æå–åˆ°å•ç‹¬çš„ vendor chunk æ–‡ä»¶ä¸­ï¼Œæ˜¯æ¯”è¾ƒæ¨èçš„åšæ³•ï¼Œè¿™æ˜¯å› ä¸ºï¼Œå®ƒä»¬å¾ˆå°‘åƒæœ¬åœ°çš„æºä»£ç é‚£æ ·é¢‘ç¹ä¿®æ”¹ã€‚å› æ­¤é€šè¿‡å®ç°ä»¥ä¸Šæ­¥éª¤ï¼Œåˆ©ç”¨å®¢æˆ·ç«¯çš„é•¿æ•ˆç¼“å­˜æœºåˆ¶ï¼Œå¯ä»¥é€šè¿‡å‘½ä¸­ç¼“å­˜æ¥æ¶ˆé™¤è¯·æ±‚ï¼Œå¹¶å‡å°‘å‘æœåŠ¡å™¨è·å–èµ„æºï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯å®¢æˆ·ç«¯ä»£ç å’ŒæœåŠ¡å™¨ç«¯ä»£ç ç‰ˆæœ¬ä¸€è‡´ã€‚\n\n### æ¨¡å—æ ‡è¯†ç¬¦(Module Identifiers)\n\næ¯ä¸ª module.id ä¼šåŸºäºé»˜è®¤çš„è§£æé¡ºåº(resolve order)è¿›è¡Œå¢é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“è§£æé¡ºåºå‘ç”Ÿå˜åŒ–ï¼ŒID ä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚\n\nå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ’ä»¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€ä¸ªæ’ä»¶æ˜¯ NamedModulesPluginï¼Œå°†ä½¿ç”¨æ¨¡å—çš„è·¯å¾„ï¼Œè€Œä¸æ˜¯æ•°å­—æ ‡è¯†ç¬¦ã€‚è™½ç„¶æ­¤æ’ä»¶æœ‰åŠ©äºåœ¨å¼€å‘è¿‡ç¨‹ä¸­è¾“å‡ºç»“æœçš„å¯è¯»æ€§ï¼Œç„¶è€Œæ‰§è¡Œæ—¶é—´ä¼šé•¿ä¸€äº›ã€‚ç¬¬äºŒä¸ªé€‰æ‹©æ˜¯ä½¿ç”¨ HashedModuleIdsPluginï¼Œæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒæ„å»ºã€‚\n\n## library\n\nå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æš´éœ² libraryï¼š\n\n1. å˜é‡ï¼šä½œä¸ºä¸€ä¸ªå…¨å±€å˜é‡ï¼Œé€šè¿‡ script æ ‡ç­¾æ¥è®¿é—®ï¼ˆlibraryTarget:'var'ï¼‰ã€‚\n2. thisï¼šé€šè¿‡ this å¯¹è±¡è®¿é—®ï¼ˆlibraryTarget:'this'ï¼‰ã€‚\n3. windowï¼šé€šè¿‡ window å¯¹è±¡è®¿é—®ï¼Œåœ¨æµè§ˆå™¨ä¸­ï¼ˆlibraryTarget:'window'ï¼‰ã€‚\n4. UMDï¼šåœ¨ AMD æˆ– CommonJS çš„ require ä¹‹åå¯è®¿é—®ï¼ˆlibraryTarget:'umd'ï¼‰ã€‚\n   å¦‚æœè®¾ç½®äº† library ä½†æ²¡è®¾ç½® libraryTargetï¼Œåˆ™ libraryTarget é»˜è®¤ä¸º var\n\n## shimming\n\nä¸€äº›ç¬¬ä¸‰æ–¹çš„åº“(library)å¯èƒ½ä¼šå¼•ç”¨ä¸€äº›å…¨å±€ä¾èµ–ï¼ˆä¾‹å¦‚ jQuery ä¸­çš„ \\$ï¼‰ã€‚è¿™äº›åº“ä¹Ÿå¯èƒ½åˆ›å»ºä¸€äº›éœ€è¦è¢«å¯¼å‡ºçš„å…¨å±€å˜é‡ã€‚è¿™äº›â€œä¸ç¬¦åˆè§„èŒƒçš„æ¨¡å—â€å°±æ˜¯ shimming å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚\n\n### shimming å…¨å±€å˜é‡\n\nä½¿ç”¨ ProvidePlugin åï¼Œèƒ½å¤Ÿåœ¨é€šè¿‡ webpack ç¼–è¯‘çš„æ¯ä¸ªæ¨¡å—ä¸­ï¼Œé€šè¿‡è®¿é—®ä¸€ä¸ªå˜é‡æ¥è·å–åˆ° package åŒ…ã€‚å¦‚æœ webpack çŸ¥é“è¿™ä¸ªå˜é‡åœ¨æŸä¸ªæ¨¡å—ä¸­è¢«ä½¿ç”¨äº†ï¼Œé‚£ä¹ˆ webpack å°†åœ¨æœ€ç»ˆ bundle ä¸­å¼•å…¥æˆ‘ä»¬ç»™å®šçš„ packageã€‚\næˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ ProvidePlugin æš´éœ²æŸä¸ªæ¨¡å—ä¸­å•ä¸ªå¯¼å‡ºå€¼ï¼Œåªéœ€é€šè¿‡ä¸€ä¸ªâ€œæ•°ç»„è·¯å¾„â€è¿›è¡Œé…ç½®ï¼ˆä¾‹å¦‚ [module, child, ...children?]ï¼‰\n\nsrc/index.js\n\n```javascript\n  function component() {\n    var element = document.createElement('div');\n\n-   element.innerHTML = _.join(['Hello', 'webpack'], ' ');\n+   element.innerHTML = join(['Hello', 'webpack'], ' ');\n\n    return element;\n  }\n\n  document.body.appendChild(component());\n```\n\nwebpack.config.js\n\n```javascript\n  const path = require('path');\n  const webpack = require('webpack');\n\n  module.exports = {\n    entry: './src/index.js',\n    output: {\n      filename: 'bundle.js',\n      path: path.resolve(__dirname, 'dist')\n    },\n    plugins: [\n      new webpack.ProvidePlugin({\n-       _: 'lodash'\n+       join: ['lodash', 'join']\n      })\n    ]\n  };\n```\n\nè¿™æ ·ï¼Œæ— è®º join æ–¹æ³•åœ¨ä½•å¤„è°ƒç”¨ï¼Œæˆ‘ä»¬éƒ½åªä¼šå¾—åˆ°çš„æ˜¯ lodash ä¸­æä¾›çš„ join æ–¹æ³•ã€‚ä¸ tree shaking é…åˆï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„å°† lodash åº“ä¸­çš„å…¶ä»–æ²¡ç”¨åˆ°çš„éƒ¨åˆ†å»é™¤ã€‚\n\n### ç»†ç²’åº¦ shimming\n\nä¸€äº›ä¼ ç»Ÿçš„æ¨¡å—ä¾èµ–çš„ this æŒ‡å‘çš„æ˜¯ window å¯¹è±¡ã€‚å½“æ¨¡å—è¿è¡Œåœ¨ CommonJS ç¯å¢ƒä¸‹è¿™å°†ä¼šå˜æˆä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶çš„ this æŒ‡å‘çš„æ˜¯ module.exportsã€‚\næ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ imports-loader è¦†å†™ thisï¼š\n\n```javascript\n  const path = require('path');\n  const webpack = require('webpack');\n\n  module.exports = {\n    entry: './src/index.js',\n    output: {\n      filename: 'bundle.js',\n      path: path.resolve(__dirname, 'dist')\n    },\n+   module: {\n+     rules: [\n+       {\n+         test: require.resolve('index.js'),\n+         use: 'imports-loader?this=>window'\n+       }\n+     ]\n+   },\n    plugins: [\n      new webpack.ProvidePlugin({\n        join: ['lodash', 'join']\n      })\n    ]\n  };\n```\n\n### å…¨å±€ exports\n\nä½¿ç”¨ exports-loaderï¼Œå°†ä¸€ä¸ªå…¨å±€å˜é‡ä½œä¸ºä¸€ä¸ªæ™®é€šçš„æ¨¡å—æ¥å¯¼å‡ºã€‚\n\n```javascript\n  const path = require('path');\n  const webpack = require('webpack');\n\n  module.exports = {\n    entry: './src/index.js',\n    output: {\n      filename: 'bundle.js',\n      path: path.resolve(__dirname, 'dist')\n    },\n    module: {\n      rules: [\n        {\n          test: require.resolve('index.js'),\n          use: 'imports-loader?this=>window'\n-       }\n+       },\n+       {\n+         test: require.resolve('globals.js'),\n+         use: 'exports-loader?file,parse=helpers.parse'\n+       }\n      ]\n    },\n    plugins: [\n      new webpack.ProvidePlugin({\n        join: ['lodash', 'join']\n      })\n    ]\n  };\n```\n\n## æ¸è¿›å¼ç½‘ç»œåº”ç”¨ç¨‹åº\n\næ¸è¿›å¼ç½‘ç»œåº”ç”¨ç¨‹åº(Progressive Web Application - PWA)ï¼Œæ˜¯ä¸€ç§å¯ä»¥æä¾›ç±»ä¼¼äºåŸç”Ÿåº”ç”¨ç¨‹åº(native app)ä½“éªŒçš„ç½‘ç»œåº”ç”¨ç¨‹åº(web app)ã€‚PWA å¯ä»¥ç”¨æ¥åšå¾ˆå¤šäº‹ã€‚å…¶ä¸­æœ€é‡è¦çš„æ˜¯ï¼Œåœ¨ç¦»çº¿(offline)æ—¶åº”ç”¨ç¨‹åºèƒ½å¤Ÿç»§ç»­è¿è¡ŒåŠŸèƒ½ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨åä¸º Service Workers çš„ç½‘ç»œæŠ€æœ¯æ¥å®ç°çš„ã€‚\n\n1. æ·»åŠ  Workbox\n2. æ³¨å†Œ Service Worker\n\nåœæ­¢æœåŠ¡å™¨å¹¶åˆ·æ–°é¡µé¢ã€‚å¦‚æœæµè§ˆå™¨èƒ½å¤Ÿæ”¯æŒ Service Workerï¼Œä½ åº”è¯¥å¯ä»¥çœ‹åˆ°ä½ çš„åº”ç”¨ç¨‹åºè¿˜åœ¨æ­£å¸¸è¿è¡Œã€‚ç„¶è€Œï¼ŒæœåŠ¡å™¨å·²ç»åœæ­¢äº†æœåŠ¡ï¼Œæ­¤åˆ»æ˜¯ Service Worker åœ¨æä¾›æœåŠ¡ã€‚\n\n## æ„å»ºæ€§èƒ½\n\n### chunks\n\nå‡å°‘ç¼–è¯‘çš„æ•´ä½“å¤§å°ï¼Œä»¥æé«˜æ„å»ºæ€§èƒ½ã€‚å°½é‡ä¿æŒ chunks å°å·§ã€‚\n\n1. ä½¿ç”¨ æ›´å°‘/æ›´å° çš„åº“ã€‚\n2. åœ¨å¤šé¡µé¢åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ CommonsChunksPluginã€‚\n3. åœ¨å¤šé¡µé¢åº”ç”¨ç¨‹åºä¸­ä»¥ async æ¨¡å¼ä½¿ç”¨ CommonsChunksPlugin ã€‚\n4. ç§»é™¤ä¸ä½¿ç”¨çš„ä»£ç ã€‚\n5. åªç¼–è¯‘ä½ å½“å‰æ­£åœ¨å¼€å‘éƒ¨åˆ†çš„ä»£ç ã€‚\n\næœ€å°åŒ–å…¥å£ chunk\nwebpack åªä¼šåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ç”Ÿæˆå·²ç»æ›´æ–°çš„ chunk ã€‚å¯¹äºæŸäº›é…ç½®é€‰é¡¹(HMR, [name]/[chunkhash] in output.chunkFilename, [hash])æ¥è¯´ï¼Œé™¤äº†æ›´æ–°çš„ chunks æ— æ•ˆä¹‹å¤–ï¼Œå…¥å£ chunk ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚\nåº”å½“åœ¨ç”Ÿæˆå…¥å£ chunk æ—¶ï¼Œå°½é‡å‡å°‘å…¥å£ chunk çš„ä½“ç§¯ï¼Œä»¥æé«˜æ€§èƒ½ã€‚ä¸‹è¿°ä»£ç å—å°†åªæå–åŒ…å« runtime çš„ chunk ï¼Œå…¶ä»– chunk éƒ½ä½œä¸ºå­æ¨¡å—:\n\n```javascript\nnew CommonsChunkPlugin({\n  name: \"manifest\",\n  minChunks: Infinity\n});\n```\n\n### Worker Pool\n\nthread-loader å¯ä»¥å°†éå¸¸æ¶ˆè€—èµ„æºçš„ loaders è½¬å­˜åˆ° worker pool ä¸­\n\n### æŒä¹…åŒ–ç¼“å­˜\n\nä½¿ç”¨ cache-loader å¯ç”¨æŒä¹…åŒ–ç¼“å­˜ã€‚ä½¿ç”¨ package.json ä¸­çš„ \"postinstall\" æ¸…é™¤ç¼“å­˜ç›®å½•ã€‚\n\n### Dlls\n\nä½¿ç”¨ DllPlugin å°†æ›´æ”¹ä¸é¢‘ç¹çš„ä»£ç è¿›è¡Œå•ç‹¬ç¼–è¯‘ã€‚è¿™å°†æ”¹å–„å¼•ç”¨ç¨‹åºçš„ç¼–è¯‘é€Ÿåº¦ï¼Œå³ä½¿å®ƒå¢åŠ äº†æ„å»ºè¿‡ç¨‹çš„å¤æ‚æ€§ã€‚\n\n## å…¬å…±è·¯å¾„(public path)\n\nwebpack æä¾›ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„é…ç½®ï¼Œè¯¥é…ç½®èƒ½å¸®åŠ©ä½ ä¸ºé¡¹ç›®ä¸­çš„æ‰€æœ‰èµ„æºæŒ‡å®šä¸€ä¸ªåŸºç¡€è·¯å¾„ã€‚å®ƒè¢«ç§°ä¸ºå…¬å…±è·¯å¾„(publicPath)ã€‚\nwebpack æä¾›ä¸€ä¸ªå…¨å±€å˜é‡ä¾›ä½ è®¾ç½®ï¼Œå®ƒåå« **webpack_public_path**\n\n```javascript\n__webpack_public_path__ = process.env.ASSET_PATH;\n```\n","tags":["webpack"],"categories":["å‰ç«¯å·¥å…·"]},{"title":"webpackåŸºç¡€çŸ¥è¯†ï¼ˆä¸€ï¼‰","url":"/2018/11/25/webpackåŸºç¡€çŸ¥è¯†ï¼ˆä¸€ï¼‰/","content":"\n# åŸºæœ¬æ¦‚å¿µ\n\nwebpack æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„é™æ€æ¨¡å—æ‰“åŒ…å™¨(module bundler)ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ªä¾èµ–å…³ç³»å›¾(dependency graph)ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª bundleã€‚\né€šè¿‡å£°æ˜æ¨¡å—æ‰€éœ€çš„ä¾èµ–ï¼Œwebpack èƒ½å¤Ÿåˆ©ç”¨è¿™äº›ä¿¡æ¯å»æ„å»ºä¾èµ–å›¾ï¼Œç„¶åä½¿ç”¨å›¾ç”Ÿæˆä¸€ä¸ªä¼˜åŒ–è¿‡çš„ï¼Œä¼šä»¥æ­£ç¡®é¡ºåºæ‰§è¡Œçš„ bundleã€‚\n\n<!-- more -->\n\n## ä¾èµ–å›¾(dependency graph)\n\nä»»ä½•æ—¶å€™ï¼Œä¸€ä¸ªæ–‡ä»¶ä¾èµ–äºå¦ä¸€ä¸ªæ–‡ä»¶ï¼Œwebpack å°±æŠŠæ­¤è§†ä¸ºæ–‡ä»¶ä¹‹é—´æœ‰ ä¾èµ–å…³ç³» ã€‚è¿™ä½¿å¾— webpack å¯ä»¥æ¥æ”¶éä»£ç èµ„æº(non-code asset)ï¼ˆä¾‹å¦‚å›¾åƒæˆ– web å­—ä½“ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥æŠŠå®ƒä»¬ä½œä¸º _ä¾èµ–_ æä¾›ç»™ä½ çš„åº”ç”¨ç¨‹åºã€‚\n\nwebpack ä»å‘½ä»¤è¡Œæˆ–é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ä¸€ä¸ªæ¨¡å—åˆ—è¡¨å¼€å§‹ï¼Œå¤„ç†ä½ çš„åº”ç”¨ç¨‹åºã€‚ ä»è¿™äº› å…¥å£èµ·ç‚¹ å¼€å§‹ï¼Œwebpack é€’å½’åœ°æ„å»ºä¸€ä¸ª ä¾èµ–å›¾ ï¼Œè¿™ä¸ªä¾èµ–å›¾åŒ…å«ç€åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…ä¸ºå°‘é‡çš„ bundle - é€šå¸¸åªæœ‰ä¸€ä¸ª - å¯ç”±æµè§ˆå™¨åŠ è½½ã€‚\n\n## å…¥å£\n\nå…¥å£èµ·ç‚¹(entry point)æŒ‡ç¤º webpack åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾çš„å¼€å§‹ã€‚è¿›å…¥å…¥å£èµ·ç‚¹åï¼Œwebpack ä¼šæ‰¾å‡ºæœ‰å“ªäº›æ¨¡å—å’Œåº“æ˜¯å…¥å£èµ·ç‚¹ï¼ˆç›´æ¥å’Œé—´æ¥ï¼‰ä¾èµ–çš„ã€‚\næ¯ä¸ªä¾èµ–é¡¹éšå³è¢«å¤„ç†ï¼Œæœ€åè¾“å‡ºåˆ°ç§°ä¹‹ä¸º bundles çš„æ–‡ä»¶ä¸­ã€‚\n\n```javascript\nmodule.exports = {\n  entry: \"./path/to/my/entry/file.js\"\n};\n```\n\nå…¥å£é…ç½®æ”¯æŒï¼š\n\n1. å•ä¸ªå…¥å£è¯­æ³•\n   æ³¨ï¼šå‘ entry ä¼ å…¥ä¸€ä¸ªã€Œæ–‡ä»¶è·¯å¾„(file path)æ•°ç»„ã€æ—¶å°†åˆ›å»ºâ€œå¤šä¸ªä¸»å…¥å£(multi-main entry)â€ã€‚åœ¨ä½ æƒ³è¦å¤šä¸ªä¾èµ–æ–‡ä»¶ä¸€èµ·æ³¨å…¥ï¼Œå¹¶ä¸”å°†å®ƒä»¬çš„ä¾èµ–å¯¼å‘(graph)åˆ°ä¸€ä¸ªâ€œchunkâ€æ—¶ï¼Œä¼ å…¥æ•°ç»„çš„æ–¹å¼å°±å¾ˆæœ‰ç”¨ã€‚\n2. å¯¹è±¡è¯­æ³•\n   è¿™æ˜¯åº”ç”¨ç¨‹åºä¸­å®šä¹‰å…¥å£çš„æœ€å¯æ‰©å±•çš„æ–¹å¼ã€‚\n\n## å‡ºå£(output)\n\noutput å±æ€§å‘Šè¯‰ webpack åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ bundlesï¼Œä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶ï¼Œé»˜è®¤å€¼ä¸º ./distã€‚åŸºæœ¬ä¸Šï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºç»“æ„ï¼Œéƒ½ä¼šè¢«ç¼–è¯‘åˆ°ä½ æŒ‡å®šçš„è¾“å‡ºè·¯å¾„çš„æ–‡ä»¶å¤¹ä¸­ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨é…ç½®ä¸­æŒ‡å®šä¸€ä¸ª output å­—æ®µï¼Œæ¥é…ç½®è¿™äº›å¤„ç†è¿‡ç¨‹ï¼š\n\n```javascript\nconst path = require(\"path\");\n\nmodule.exports = {\n  entry: \"./path/to/my/entry/file.js\",\n  output: {\n    path: path.resolve(__dirname, \"dist\"),\n    filename: \"my-first-webpack.bundle.js\"\n  }\n};\n```\n\nfilename ç”¨äºè¾“å‡ºæ–‡ä»¶çš„æ–‡ä»¶åã€‚ç›®æ ‡è¾“å‡ºç›®å½• path çš„ç»å¯¹è·¯å¾„ã€‚\n\næ³¨ï¼šå¦‚æœé…ç½®åˆ›å»ºäº†å¤šä¸ªå•ç‹¬çš„ \"chunk\"ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨å¤šä¸ªå…¥å£èµ·ç‚¹æˆ–ä½¿ç”¨åƒ CommonsChunkPlugin è¿™æ ·çš„æ’ä»¶ï¼‰ï¼Œåˆ™åº”è¯¥ä½¿ç”¨å ä½ç¬¦(substitutions)æ¥ç¡®ä¿æ¯ä¸ªæ–‡ä»¶å…·æœ‰å”¯ä¸€çš„åç§°ã€‚\n\nè®¾å®š HtmlWebpackPluginï¼Œè™½ç„¶åœ¨ dist/ æ–‡ä»¶å¤¹æˆ‘ä»¬å·²ç»æœ‰ index.html è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶è€Œ HtmlWebpackPlugin è¿˜æ˜¯ä¼šé»˜è®¤ç”Ÿæˆ index.html æ–‡ä»¶ã€‚è¿™å°±æ˜¯è¯´ï¼Œå®ƒä¼šç”¨æ–°ç”Ÿæˆçš„ index.html æ–‡ä»¶ï¼ŒæŠŠæˆ‘ä»¬çš„åŸæ¥çš„æ›¿æ¢ã€‚\n\n### ä½¿ç”¨ source map\n\nå½“ webpack æ‰“åŒ…æºä»£ç æ—¶ï¼Œå¯èƒ½ä¼šå¾ˆéš¾è¿½è¸ªåˆ°é”™è¯¯å’Œè­¦å‘Šåœ¨æºä»£ç ä¸­çš„åŸå§‹ä½ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†ä¸‰ä¸ªæºæ–‡ä»¶ï¼ˆa.js, b.js å’Œ c.jsï¼‰æ‰“åŒ…åˆ°ä¸€ä¸ª bundleï¼ˆbundle.jsï¼‰ä¸­ï¼Œè€Œå…¶ä¸­ä¸€ä¸ªæºæ–‡ä»¶åŒ…å«ä¸€ä¸ªé”™è¯¯ï¼Œé‚£ä¹ˆå †æ ˆè·Ÿè¸ªå°±ä¼šç®€å•åœ°æŒ‡å‘åˆ° bundle.jsã€‚\nä¸ºäº†æ›´å®¹æ˜“åœ°è¿½è¸ªé”™è¯¯å’Œè­¦å‘Šï¼ŒJavaScript æä¾›äº† source map åŠŸèƒ½ï¼Œå°†ç¼–è¯‘åçš„ä»£ç æ˜ å°„å›åŸå§‹æºä»£ç ã€‚å¦‚æœä¸€ä¸ªé”™è¯¯æ¥è‡ªäº b.jsï¼Œsource map å°±ä¼šæ˜ç¡®çš„å‘Šè¯‰ä½ ã€‚\n\n## loader\n\nloader è®© webpack èƒ½å¤Ÿå»å¤„ç†é‚£äº›é JavaScript æ–‡ä»¶ï¼ˆwebpack è‡ªèº«åªç†è§£ JavaScriptï¼‰ã€‚loader å¯ä»¥å°†æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶è½¬æ¢ä¸º webpack èƒ½å¤Ÿå¤„ç†çš„æœ‰æ•ˆæ¨¡å—ï¼Œç„¶åä½ å°±å¯ä»¥åˆ©ç”¨ webpack çš„æ‰“åŒ…èƒ½åŠ›ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ã€‚\n\næœ¬è´¨ä¸Šï¼Œwebpack loader å°†æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶ï¼Œè½¬æ¢ä¸ºåº”ç”¨ç¨‹åºçš„ä¾èµ–å›¾ï¼ˆå’Œæœ€ç»ˆçš„ bundleï¼‰å¯ä»¥ç›´æ¥å¼•ç”¨çš„æ¨¡å—ã€‚\n\n### åœ¨ webpack çš„é…ç½®ä¸­ loader æœ‰ä¸¤ä¸ªç›®æ ‡ï¼š\n\n1. test å±æ€§ï¼Œç”¨äºæ ‡è¯†å‡ºåº”è¯¥è¢«å¯¹åº”çš„ loader è¿›è¡Œè½¬æ¢çš„æŸä¸ªæˆ–æŸäº›æ–‡ä»¶ã€‚\n2. use å±æ€§ï¼Œè¡¨ç¤ºè¿›è¡Œè½¬æ¢æ—¶ï¼Œåº”è¯¥ä½¿ç”¨å“ªä¸ª loaderã€‚\n\n```javascript\nconst path = require(\"path\");\n\nconst config = {\n  output: {\n    filename: \"my-first-webpack.bundle.js\"\n  },\n  module: {\n    rules: [{ test: /\\.txt$/, use: \"raw-loader\" }]\n  }\n};\n\nmodule.exports = config;\n```\n\n### åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæœ‰ä¸‰ç§ä½¿ç”¨ loader çš„æ–¹å¼ï¼š\n\n1. é…ç½®ï¼ˆæ¨èï¼‰ï¼šåœ¨ webpack.config.js æ–‡ä»¶ä¸­æŒ‡å®š loaderã€‚\n   module.rules å…è®¸ä½ åœ¨ webpack é…ç½®ä¸­æŒ‡å®šå¤šä¸ª loaderã€‚ è¿™æ˜¯å±•ç¤º loader çš„ä¸€ç§ç®€æ˜æ–¹å¼ï¼Œå¹¶ä¸”æœ‰åŠ©äºä½¿ä»£ç å˜å¾—ç®€æ´ã€‚åŒæ—¶è®©ä½ å¯¹å„ä¸ª loader æœ‰ä¸ªå…¨å±€æ¦‚è§ˆ\n2. å†…è”ï¼šåœ¨æ¯ä¸ª import è¯­å¥ä¸­æ˜¾å¼æŒ‡å®š loaderã€‚\n   å¯ä»¥åœ¨ import è¯­å¥æˆ–ä»»ä½•ç­‰æ•ˆäº \"import\" çš„æ–¹å¼ä¸­æŒ‡å®š loaderã€‚ä½¿ç”¨ ! å°†èµ„æºä¸­çš„ loader åˆ†å¼€ã€‚åˆ†å¼€çš„æ¯ä¸ªéƒ¨åˆ†éƒ½ç›¸å¯¹äºå½“å‰ç›®å½•è§£æã€‚\n3. CLIï¼šåœ¨ shell å‘½ä»¤ä¸­æŒ‡å®šå®ƒä»¬ã€‚\n\n### loader ç‰¹æ€§ï¼š\n\n1. loader æ”¯æŒé“¾å¼ä¼ é€’ã€‚èƒ½å¤Ÿå¯¹èµ„æºä½¿ç”¨æµæ°´çº¿(pipeline)ã€‚ä¸€ç»„é“¾å¼çš„ loader å°†æŒ‰ç…§ç›¸åçš„é¡ºåºæ‰§è¡Œã€‚loader é“¾ä¸­çš„ç¬¬ä¸€ä¸ª loader è¿”å›å€¼ç»™ä¸‹ä¸€ä¸ª loaderã€‚åœ¨æœ€åä¸€ä¸ª loaderï¼Œè¿”å› webpack æ‰€é¢„æœŸçš„ JavaScriptã€‚\n2. loader å¯ä»¥æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥çš„ã€‚\n3. loader è¿è¡Œåœ¨ Node.js ä¸­ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ‰§è¡Œä»»ä½•å¯èƒ½çš„æ“ä½œã€‚\n4. loader æ¥æ”¶æŸ¥è¯¢å‚æ•°ã€‚ç”¨äºå¯¹ loader ä¼ é€’é…ç½®ã€‚\n5. loader ä¹Ÿèƒ½å¤Ÿä½¿ç”¨ options å¯¹è±¡è¿›è¡Œé…ç½®ã€‚\n6. é™¤äº†ä½¿ç”¨ package.json å¸¸è§çš„ main å±æ€§ï¼Œè¿˜å¯ä»¥å°†æ™®é€šçš„ npm æ¨¡å—å¯¼å‡ºä¸º loaderï¼Œåšæ³•æ˜¯åœ¨ package.json é‡Œå®šä¹‰ä¸€ä¸ª loader å­—æ®µã€‚\n7. æ’ä»¶(plugin)å¯ä»¥ä¸º loader å¸¦æ¥æ›´å¤šç‰¹æ€§ã€‚\n8. loader èƒ½å¤Ÿäº§ç”Ÿé¢å¤–çš„ä»»æ„æ–‡ä»¶ã€‚\n\n## æ’ä»¶(plugins)\n\nloader è¢«ç”¨äºè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—ï¼Œè€Œæ’ä»¶åˆ™å¯ä»¥ç”¨äºæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ã€‚æ’ä»¶çš„èŒƒå›´åŒ…æ‹¬ï¼Œä»æ‰“åŒ…ä¼˜åŒ–å’Œå‹ç¼©ï¼Œä¸€ç›´åˆ°é‡æ–°å®šä¹‰ç¯å¢ƒä¸­çš„å˜é‡ã€‚æ’ä»¶æ¥å£åŠŸèƒ½æå…¶å¼ºå¤§ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†å„ç§å„æ ·çš„ä»»åŠ¡ã€‚\næ’ä»¶ç›®çš„åœ¨äºè§£å†³ loader æ— æ³•å®ç°çš„å…¶ä»–äº‹ã€‚\n\n```javascript\nconst HtmlWebpackPlugin = require(\"html-webpack-plugin\"); // é€šè¿‡ npm å®‰è£…\nconst webpack = require(\"webpack\"); // ç”¨äºè®¿é—®å†…ç½®æ’ä»¶\n\nconst config = {\n  module: {\n    rules: [{ test: /\\.txt$/, use: \"raw-loader\" }]\n  },\n  plugins: [new HtmlWebpackPlugin({ template: \"./src/index.html\" })]\n};\n\nmodule.exports = config;\n```\n\n### ç”¨æ³•ï¼š\n\nç”¨ requireï¼ˆï¼‰å¼•å…¥\nç”±äºæ’ä»¶å¯ä»¥æºå¸¦å‚æ•°/é€‰é¡¹ï¼Œä½ å¿…é¡»åœ¨ webpack é…ç½®ä¸­ï¼Œå‘ plugins å±æ€§ä¼ å…¥ new å®ä¾‹ã€‚\n\n## æ¨¡å¼\n\næä¾› mode é…ç½®é€‰é¡¹ï¼Œå‘ŠçŸ¥ webpack ä½¿ç”¨ç›¸åº”æ¨¡å¼çš„å†…ç½®ä¼˜åŒ–ã€‚\né€šè¿‡é€‰æ‹© development æˆ– production ä¹‹ä¸­çš„ä¸€ä¸ªï¼Œæ¥è®¾ç½® mode å‚æ•°ï¼Œå¯ä»¥å¯ç”¨ç›¸åº”æ¨¡å¼ä¸‹çš„ webpack å†…ç½®çš„ä¼˜åŒ–\n\n### ç”¨æ³•ï¼š\n\n1. åªåœ¨é…ç½®ä¸­æä¾› mode é€‰é¡¹ï¼š\n\n```javascript\nmodule.exports = {\n  mode: \"production\"\n};\n```\n\n2. ä» CLI å‚æ•°ä¸­ä¼ é€’ï¼š\n\n```javascript\nwebpack --mode=production\n```\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j6u0wvurj30k5072glt.jpg)\n\n## æ¨¡å—çƒ­æ›¿æ¢(hot module replacement)\n\næ¨¡å—çƒ­æ›¿æ¢(HMR - Hot Module Replacement)åŠŸèƒ½ä¼šåœ¨åº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ›¿æ¢ã€æ·»åŠ æˆ–åˆ é™¤æ¨¡å—ï¼Œè€Œæ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ã€‚ä¸»è¦æ˜¯é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼Œæ¥æ˜¾è‘—åŠ å¿«å¼€å‘é€Ÿåº¦ï¼š\n\n1. ä¿ç•™åœ¨å®Œå…¨é‡æ–°åŠ è½½é¡µé¢æ—¶ä¸¢å¤±çš„åº”ç”¨ç¨‹åºçŠ¶æ€ã€‚\n2. åªæ›´æ–°å˜æ›´å†…å®¹ï¼Œä»¥èŠ‚çœå®è´µçš„å¼€å‘æ—¶é—´ã€‚\n3. è°ƒæ•´æ ·å¼æ›´åŠ å¿«é€Ÿ - å‡ ä¹ç›¸å½“äºåœ¨æµè§ˆå™¨è°ƒè¯•å™¨ä¸­æ›´æ”¹æ ·å¼ã€‚\n\n## tree shaking\n\né€šå¸¸ç”¨äºæè¿°ç§»é™¤ JavaScript ä¸Šä¸‹æ–‡ä¸­çš„æœªå¼•ç”¨ä»£ç (dead-code)ã€‚å®ƒä¾èµ–äº ES2015 æ¨¡å—ç³»ç»Ÿä¸­çš„é™æ€ç»“æ„ç‰¹æ€§ï¼Œä¾‹å¦‚ import å’Œ exportã€‚\n\nå¦‚æœæ‰€æœ‰ä»£ç éƒ½ä¸åŒ…å«å‰¯ä½œç”¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç®€å•åœ°å°† package.json çš„ \"sideEffects\" å±æ€§æ ‡è®°ä¸º falseï¼Œæ¥å‘ŠçŸ¥ webpackï¼Œå®ƒå¯ä»¥å®‰å…¨åœ°åˆ é™¤æœªç”¨åˆ°çš„ export å¯¼å‡ºã€‚\næ³¨ï¼šã€Œå‰¯ä½œç”¨ã€çš„å®šä¹‰æ˜¯ï¼Œåœ¨å¯¼å…¥æ—¶ä¼šæ‰§è¡Œç‰¹æ®Šè¡Œä¸ºçš„ä»£ç ï¼Œè€Œä¸æ˜¯ä»…ä»…æš´éœ²ä¸€ä¸ª export æˆ–å¤šä¸ª exportã€‚\n\nå¦‚æœä½ çš„ä»£ç ç¡®å®æœ‰ä¸€äº›å‰¯ä½œç”¨ï¼Œé‚£ä¹ˆå¯ä»¥æ”¹ä¸ºæä¾›ä¸€ä¸ªæ•°ç»„ï¼š\n\n```javascript\n{\n  \"name\": \"your-project\",\n  \"sideEffects\": [\n    \"./src/some-side-effectful-file.js\"\n  ]\n}\n```\n\næ•°ç»„æ–¹å¼æ”¯æŒç›¸å…³æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ã€ç»å¯¹è·¯å¾„å’Œ glob æ¨¡å¼ã€‚å®ƒåœ¨å†…éƒ¨ä½¿ç”¨ micromatchã€‚\n\næ³¨æ„ï¼Œä»»ä½•å¯¼å…¥çš„æ–‡ä»¶éƒ½ä¼šå—åˆ° tree shaking çš„å½±å“ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç±»ä¼¼ css-loader å¹¶å¯¼å…¥ CSS æ–‡ä»¶ï¼Œåˆ™éœ€è¦å°†å…¶æ·»åŠ åˆ° side effect åˆ—è¡¨ä¸­ï¼Œä»¥å…åœ¨ç”Ÿäº§æ¨¡å¼ä¸­æ— æ„ä¸­å°†å®ƒåˆ é™¤ã€‚\n\nä» webpack 4 å¼€å§‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ \"mode\" é…ç½®é€‰é¡¹è½»æ¾åˆ‡æ¢åˆ°å‹ç¼©è¾“å‡ºï¼Œåªéœ€è®¾ç½®ä¸º \"production\"ã€‚\n","tags":["webpack"],"categories":["å‰ç«¯å·¥å…·"]},{"title":"Reactç»„ä»¶","url":"/2018/11/11/Reactç»„ä»¶/","content":"\n# Web Copmpoents\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j6p2nvl3j314i0oqgm8.jpg)\n\n# React ç»„ä»¶\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j6p1c7t9j31am0gejro.jpg)\n\nReact ç»„ä»¶ï¼š\n\n1. è‡ªå®šä¹‰å…ƒç´ æ˜¯åº“è‡ªå·±æ„å»ºçš„\n2. æ¸²æŸ“è¿‡ç¨‹åŒ…å«äº†æ¨¡ç‰ˆçš„æ¦‚å¿µ\n3. å®ç°å‡åœ¨æ–¹æ³•ä¸ç±»ä¸­ï¼Œç›¸äº’éš”ç¦»ï¼ˆä¸åŒ…æ‹¬æ ·å¼ï¼‰\n4. å¼•ç”¨æ–¹å¼éµå¾ª ES6\n\næ„å»ºï¼š\n\n1. React æ–¹å¼ï¼šcreatClass\n2. ES6 æ–¹å¼ï¼šclass\n3. æ— çŠ¶æ€å‡½æ•°\n\n# React åº•å±‚â€”â€”åˆæˆäº‹ä»¶\n\n## äº‹ä»¶å§”æ´¾\n\næŠŠäº‹ä»¶å¤„ç†å‡½æ•°ç»‘å®šåˆ°ç»“æ„çš„æœ€å¤–å±‚ï¼Œä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€çš„äº‹ä»¶ç›‘å¬å™¨ã€‚ï¼ˆä¸ä¼šæŠŠäº‹ä»¶å¤„ç†å‡½æ•°ç›´æ¥ç»‘å®šåˆ°çœŸå®çš„èŠ‚ç‚¹ä¸Šï¼‰\n\n<!-- more -->\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j6p4jv10j31b20tmjse.jpg)\n\n## è‡ªåŠ¨ç»‘å®š\n\næ¯ä¸ªæ–¹æ³•çš„ä¸Šä¸‹æ–‡éƒ½ä¼šæŒ‡å‘è¯¥ç»„ä»¶çš„å®ä¾‹â€”â€”è‡ªåŠ¨ç»‘å®š this ä¸ºå½“å‰ç»„ä»¶ã€‚React ä¼šå¯¹è¿™ç§å¼•ç”¨è¿›è¡Œç¼“å­˜ï¼Œè¾¾åˆ° CPU å†…å­˜æœ€ä¼˜ã€‚ï¼ˆä½¿ç”¨ ES6 class æˆ–çº¯å‡½æ•°æ—¶ï¼Œè‡ªåŠ¨ç»‘å®šä¸å¤å­˜åœ¨ï¼Œéœ€è¦æ‰‹åŠ¨ç»‘å®š thisï¼‰\n\n1. bind ç»‘å®š\n   ç»‘å®šäº‹ä»¶å¤„ç†å™¨å†…çš„ thisï¼Œå¹¶å¯ä»¥å‘äº‹ä»¶å¤„ç†å™¨ä¸­ä¼ å‚\n\n2. æ„é€ å™¨å†…å£°æ˜\n   å¥½å¤„ï¼šä»…éœ€è¿›è¡Œä¸€æ¬¡ç»‘å®š\n\n3. ç®­å¤´å‡½æ•°\n   ç®­å¤´å‡½æ•°è‡ªåŠ¨ç»‘å®šäº†å®šä¹‰æ­¤å‡½æ•°ä½œç”¨åŸŸçš„ thisï¼Œå› æ­¤ä¸éœ€è¦å†ç”¨ bind ç»‘å®š\n\næ³¨æ„ï¼šReact ä¸­ä½¿ç”¨ DOM åŸç”Ÿäº‹ä»¶ï¼Œä¸€å®šè¦åœ¨ç»„ä»¶å¸è½½æ—¶æ‰‹åŠ¨ç§»é™¤ï¼Œå¦åˆ™å†…å­˜æ³„æ¼ã€‚ä½¿ç”¨åˆæˆäº‹ä»¶åˆ™ä¸éœ€è¦ã€‚\n\n# React åˆæˆäº‹ä»¶ä¸ JS åŸç”Ÿäº‹ä»¶å¯¹æ¯”\n\nåŸç”Ÿ DOM äº‹ä»¶ä¼ æ’­ 3 ä¸ªé˜¶æ®µï¼šäº‹ä»¶æ•è·é˜¶æ®µã€ç›®æ ‡å¯¹è±¡æœ¬èº«çš„äº‹ä»¶å¤„ç†ç¨‹åºè°ƒç”¨ï¼Œä»¥åŠäº‹ä»¶å†’æ³¡ã€‚\n\n1. äº‹ä»¶æ•è·é˜¶æ®µä¼šä¼˜å…ˆè°ƒç”¨ç»“æ„æ ‘æœ€å¤–å±‚çš„å…ƒç´ ä¸Šç»‘å®šçš„äº‹ä»¶ä¾¦å¬å™¨ï¼Œä¾æ¬¡å‘å†…è°ƒç”¨ï¼Œä¸€ç›´è°ƒç”¨åˆ°ç›®æ ‡å…ƒç´ ä¸Šçš„äº‹ä»¶ç›‘å¬å™¨ä¸ºæ­¢ã€‚\n\n```javascript\ne.addEventListener(\"click\", () => {}, false);\n```\n\nç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œè‹¥ä¼  trueï¼Œä¸ºå…ƒç´  e æ³¨å†Œæ•è·äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¹¶ä¸”åœ¨äº‹ä»¶æ•è·é˜¶æ®µè°ƒç”¨ã€‚\n\n2. äº‹ä»¶å†’æ³¡ä¸äº‹ä»¶æ•è·ç›¸åï¼Œå®ƒä¼šä»ç›®æ ‡å…ƒç´ å‘å¤–ä¼ æ’­ï¼Œç”±å†…è€Œå¤–ã€‚\n   React çš„åˆæˆäº‹ä»¶ä»…æ”¯æŒäº‹ä»¶å†’æ³¡\n   é˜»æ­¢åŸç”Ÿäº‹ä»¶å†’æ³¡ç”¨ e.preventDefault()\n\n# React å—æ§ç»„ä»¶æ›´æ–° state çš„æµç¨‹\n\n1. å¯ä»¥é€šè¿‡åœ¨åˆå§‹ state ä¸­è®¾ç½®è¡¨å•çš„é»˜è®¤å€¼\n2. æ¯å½“è¡¨å•çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè°ƒç”¨ onchange äº‹ä»¶å¤„ç†å™¨\n3. äº‹ä»¶å¤„ç†å™¨é€šè¿‡åˆæˆäº‹ä»¶å¯¹è±¡ e æ‹¿åˆ°æ”¹å˜åçš„çŠ¶æ€ï¼Œå¹¶æ›´è¡Œåº”ç”¨çš„ state\n4. setState è§¦å‘è§†å›¾çš„é‡æ–°æ¸²æŸ“ï¼Œå®Œæˆè¡¨å•çš„ç»„ä»¶å€¼æ›´æ–°\n\n# React éå—æ§ç»„ä»¶\n\næ˜¯ä¸€ç§åæ¨¡å¼ï¼Œä»–çš„å€¼ä¸å—ç»„ä»¶è‡ªèº«çš„ state æˆ– props æ§åˆ¶ã€‚é€šå¸¸éœ€è¦ä¸ºå…¶æ·»åŠ  ref prop æ¥è®¿é—®æ¸²æŸ“åçš„åº•å±‚ DOM\n","tags":["React"],"categories":["React"]},{"title":"æµè§ˆå™¨ç¼“å­˜ä½ç½®","url":"/2018/11/01/æµè§ˆå™¨ç¼“å­˜ä½ç½®/","content":"\n# æµè§ˆå™¨ç¼“å­˜ä½ç½®\n\n## ç¼“å­˜ä½ç½®\n\nä»ç¼“å­˜ä½ç½®ä¸Šæ¥è¯´åˆ†ä¸ºå››ç§ï¼Œå¹¶ä¸”å„è‡ªæœ‰ä¼˜å…ˆçº§ï¼Œå½“ä¾æ¬¡æŸ¥æ‰¾ç¼“å­˜ä¸”éƒ½æ²¡æœ‰å‘½ä¸­çš„æ—¶å€™ï¼Œæ‰ä¼šå»è¯·æ±‚ç½‘ç»œã€‚\n\n- Service Worker\n- Memory Cache\n- Disk Cache\n- Push Cache\n\n<!-- more -->\n\n### 1.Service Worker\n\nService Worker æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨èƒŒåçš„ç‹¬ç«‹çº¿ç¨‹ï¼Œä¸€èˆ¬å¯ä»¥ç”¨æ¥å®ç°ç¼“å­˜åŠŸèƒ½ã€‚ä½¿ç”¨ Service Worker çš„è¯ï¼Œä¼ è¾“åè®®å¿…é¡»ä¸º HTTPSã€‚å› ä¸º Service Worker ä¸­æ¶‰åŠåˆ°è¯·æ±‚æ‹¦æˆªï¼Œæ‰€ä»¥**å¿…é¡»ä½¿ç”¨ HTTPS åè®®**æ¥ä¿éšœå®‰å…¨ã€‚**Service Worker çš„ç¼“å­˜ä¸æµè§ˆå™¨å…¶ä»–å†…å»ºçš„ç¼“å­˜æœºåˆ¶ä¸åŒï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬è‡ªç”±æ§åˆ¶ç¼“å­˜å“ªäº›æ–‡ä»¶ã€å¦‚ä½•åŒ¹é…ç¼“å­˜ã€å¦‚ä½•è¯»å–ç¼“å­˜ï¼Œå¹¶ä¸”ç¼“å­˜æ˜¯æŒç»­æ€§çš„**ã€‚\n\nService Worker å®ç°ç¼“å­˜åŠŸèƒ½ä¸€èˆ¬åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šé¦–å…ˆéœ€è¦å…ˆæ³¨å†Œ Service Workerï¼Œç„¶åç›‘å¬åˆ° install äº‹ä»¶ä»¥åå°±å¯ä»¥ç¼“å­˜éœ€è¦çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆåœ¨ä¸‹æ¬¡ç”¨æˆ·è®¿é—®çš„æ—¶å€™å°±å¯ä»¥é€šè¿‡æ‹¦æˆªè¯·æ±‚çš„æ–¹å¼æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ç¼“å­˜ï¼Œå­˜åœ¨ç¼“å­˜çš„è¯å°±å¯ä»¥ç›´æ¥è¯»å–ç¼“å­˜æ–‡ä»¶ï¼Œå¦åˆ™å°±å»è¯·æ±‚æ•°æ®ã€‚\n\nå½“ Service Worker æ²¡æœ‰å‘½ä¸­ç¼“å­˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å»è°ƒç”¨ fetch å‡½æ•°è·å–æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨ Service Worker å‘½ä¸­ç¼“å­˜çš„è¯ï¼Œä¼šæ ¹æ®ç¼“å­˜æŸ¥æ‰¾ä¼˜å…ˆçº§å»æŸ¥æ‰¾æ•°æ®ã€‚ä½†æ˜¯ä¸ç®¡æˆ‘ä»¬æ˜¯ä» Memory Cache ä¸­è¿˜æ˜¯ä»ç½‘ç»œè¯·æ±‚ä¸­è·å–çš„æ•°æ®ï¼Œæµè§ˆå™¨éƒ½ä¼šæ˜¾ç¤ºæˆ‘ä»¬æ˜¯ä» Service Worker ä¸­è·å–çš„å†…å®¹ã€‚\n\n### 2.Memory Cache\n\nMemory Cache ä¹Ÿå°±æ˜¯å†…å­˜ä¸­çš„ç¼“å­˜ï¼Œä¸»è¦åŒ…å«çš„æ˜¯å½“å‰ä¸­é¡µé¢ä¸­å·²ç»æŠ“å–åˆ°çš„èµ„æº, ä¾‹å¦‚é¡µé¢ä¸Šå·²ç»ä¸‹è½½çš„æ ·å¼ã€è„šæœ¬ã€å›¾ç‰‡ç­‰ã€‚è¯»å–å†…å­˜ä¸­çš„æ•°æ®è‚¯å®šæ¯”ç£ç›˜å¿«, å†…å­˜ç¼“å­˜è™½ç„¶è¯»å–é«˜æ•ˆï¼Œå¯æ˜¯ç¼“å­˜æŒç»­æ€§å¾ˆçŸ­ï¼Œä¼šéšç€è¿›ç¨‹çš„é‡Šæ”¾è€Œé‡Šæ”¾ã€‚ **ä¸€æ—¦æˆ‘ä»¬å…³é—­ Tab é¡µé¢ï¼Œå†…å­˜ä¸­çš„ç¼“å­˜ä¹Ÿå°±è¢«é‡Šæ”¾äº†**ã€‚\n\né‚£ä¹ˆæ—¢ç„¶å†…å­˜ç¼“å­˜è¿™ä¹ˆé«˜æ•ˆï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯èƒ½è®©æ•°æ®éƒ½å­˜æ”¾åœ¨å†…å­˜ä¸­å‘¢ï¼Ÿ\nè¿™æ˜¯ä¸å¯èƒ½çš„ã€‚è®¡ç®—æœºä¸­çš„å†…å­˜ä¸€å®šæ¯”ç¡¬ç›˜å®¹é‡å°å¾—å¤šï¼Œæ“ä½œç³»ç»Ÿéœ€è¦ç²¾æ‰“ç»†ç®—å†…å­˜çš„ä½¿ç”¨ï¼Œæ‰€ä»¥èƒ½è®©æˆ‘ä»¬ä½¿ç”¨çš„å†…å­˜å¿…ç„¶ä¸å¤šã€‚\n\nå½“æˆ‘ä»¬è®¿é—®è¿‡é¡µé¢ä»¥åï¼Œå†æ¬¡åˆ·æ–°é¡µé¢ï¼Œå¯ä»¥å‘ç°å¾ˆå¤šæ•°æ®éƒ½æ¥è‡ªäºå†…å­˜ç¼“å­˜ã€‚\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6ixm7cw74j30og04h0ta.jpg)\n\nå†…å­˜ç¼“å­˜ä¸­æœ‰ä¸€å—é‡è¦çš„ç¼“å­˜èµ„æºæ˜¯ preloader ç›¸å…³æŒ‡ä»¤ï¼ˆä¾‹å¦‚`<link rel=\"prefetch\">`ï¼‰ä¸‹è½½çš„èµ„æºã€‚ä¼—æ‰€å‘¨çŸ¥ preloader çš„ç›¸å…³æŒ‡ä»¤å·²ç»æ˜¯é¡µé¢ä¼˜åŒ–çš„å¸¸è§æ‰‹æ®µä¹‹ä¸€ï¼Œå®ƒå¯ä»¥ä¸€è¾¹è§£æ js/css æ–‡ä»¶ï¼Œä¸€è¾¹ç½‘ç»œè¯·æ±‚ä¸‹ä¸€ä¸ªèµ„æºã€‚\n\néœ€è¦æ³¨æ„çš„äº‹æƒ…æ˜¯ï¼Œ**å†…å­˜ç¼“å­˜åœ¨ç¼“å­˜èµ„æºæ—¶å¹¶ä¸å…³å¿ƒè¿”å›èµ„æºçš„ HTTP ç¼“å­˜å¤´ Cache-Control æ˜¯ä»€ä¹ˆå€¼ï¼ŒåŒæ—¶èµ„æºçš„åŒ¹é…ä¹Ÿå¹¶éä»…ä»…æ˜¯å¯¹ URL åšåŒ¹é…ï¼Œè¿˜å¯èƒ½ä¼šå¯¹ Content-Typeï¼ŒCORS ç­‰å…¶ä»–ç‰¹å¾åšæ ¡éªŒ**ã€‚\n\n### 3.Disk Cache\n\nDisk Cache ä¹Ÿå°±æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­çš„ç¼“å­˜ï¼Œè¯»å–é€Ÿåº¦æ…¢ç‚¹ï¼Œä½†æ˜¯ä»€ä¹ˆéƒ½èƒ½å­˜å‚¨åˆ°ç£ç›˜ä¸­ï¼Œ**æ¯”ä¹‹ Memory Cache èƒœåœ¨å®¹é‡å’Œå­˜å‚¨æ—¶æ•ˆæ€§ä¸Š**ã€‚\n\nåœ¨æ‰€æœ‰æµè§ˆå™¨ç¼“å­˜ä¸­ï¼ŒDisk Cache è¦†ç›–é¢åŸºæœ¬æ˜¯æœ€å¤§çš„ã€‚å®ƒä¼šæ ¹æ® HTTP Herder ä¸­çš„å­—æ®µåˆ¤æ–­å“ªäº›èµ„æºéœ€è¦ç¼“å­˜ï¼Œå“ªäº›èµ„æºå¯ä»¥ä¸è¯·æ±‚ç›´æ¥ä½¿ç”¨ï¼Œå“ªäº›èµ„æºå·²ç»è¿‡æœŸéœ€è¦é‡æ–°è¯·æ±‚ã€‚å¹¶ä¸”å³ä½¿åœ¨è·¨ç«™ç‚¹çš„æƒ…å†µä¸‹ï¼Œç›¸åŒåœ°å€çš„èµ„æºä¸€æ—¦è¢«ç¡¬ç›˜ç¼“å­˜ä¸‹æ¥ï¼Œå°±ä¸ä¼šå†æ¬¡å»è¯·æ±‚æ•°æ®ã€‚ç»å¤§éƒ¨åˆ†çš„ç¼“å­˜éƒ½æ¥è‡ª Disk Cacheï¼Œå…³äº HTTP çš„åè®®å¤´ä¸­çš„ç¼“å­˜å­—æ®µï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹æ–‡è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚\n\n**æµè§ˆå™¨ä¼šæŠŠå“ªäº›æ–‡ä»¶ä¸¢è¿›å†…å­˜ä¸­ï¼Ÿå“ªäº›ä¸¢è¿›ç¡¬ç›˜ä¸­ï¼Ÿ**\nå…³äºè¿™ç‚¹ï¼Œç½‘ä¸Šè¯´æ³•ä¸ä¸€ï¼Œä¸è¿‡ä»¥ä¸‹è§‚ç‚¹æ¯”è¾ƒé å¾—ä½ï¼š\n\n- å¯¹äºå¤§æ–‡ä»¶æ¥è¯´ï¼Œå¤§æ¦‚ç‡æ˜¯ä¸å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œåä¹‹ä¼˜å…ˆï¼›\n- å½“å‰ç³»ç»Ÿå†…å­˜ä½¿ç”¨ç‡é«˜çš„è¯ï¼Œæ–‡ä»¶ä¼˜å…ˆå­˜å‚¨è¿›ç¡¬ç›˜ã€‚\n\n### 4.Push Cache\n\nPush Cacheï¼ˆæ¨é€ç¼“å­˜ï¼‰æ˜¯ HTTP/2 ä¸­çš„å†…å®¹ï¼Œå½“ä»¥ä¸Šä¸‰ç§ç¼“å­˜éƒ½æ²¡æœ‰å‘½ä¸­æ—¶ï¼Œå®ƒæ‰ä¼šè¢«ä½¿ç”¨ã€‚**å®ƒåªåœ¨ä¼šè¯ï¼ˆSessionï¼‰ä¸­å­˜åœ¨ï¼Œä¸€æ—¦ä¼šè¯ç»“æŸå°±è¢«é‡Šæ”¾ï¼Œå¹¶ä¸”ç¼“å­˜æ—¶é—´ä¹Ÿå¾ˆçŸ­æš‚**ï¼Œåœ¨ Chrome æµè§ˆå™¨ä¸­åªæœ‰ 5 åˆ†é’Ÿå·¦å³ï¼ŒåŒæ—¶å®ƒä¹Ÿå¹¶éä¸¥æ ¼æ‰§è¡Œ HTTP å¤´ä¸­çš„ç¼“å­˜æŒ‡ä»¤ã€‚\n\nPush Cache åœ¨å›½å†…èƒ½å¤ŸæŸ¥åˆ°çš„èµ„æ–™å¾ˆå°‘ï¼Œä¹Ÿæ˜¯å› ä¸º HTTP/2 åœ¨å›½å†…ä¸å¤Ÿæ™®åŠã€‚è¿™é‡Œæ¨èé˜…è¯»`Jake Archibald`çš„ [HTTP/2 push is tougher than I thought](https://jakearchibald.com/2017/h2-push-tougher-than-i-thought/) è¿™ç¯‡æ–‡ç« ï¼Œæ–‡ç« ä¸­çš„å‡ ä¸ªç»“è®ºï¼š\n\n- æ‰€æœ‰çš„èµ„æºéƒ½èƒ½è¢«æ¨é€ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«ç¼“å­˜, ä½†æ˜¯ Edge å’Œ Safari æµè§ˆå™¨æ”¯æŒç›¸å¯¹æ¯”è¾ƒå·®ï¼›\n- å¯ä»¥æ¨é€ no-cache å’Œ no-store çš„èµ„æºï¼›\n- ä¸€æ—¦è¿æ¥è¢«å…³é—­ï¼ŒPush Cache å°±è¢«é‡Šæ”¾ï¼›\n- å¤šä¸ªé¡µé¢å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ª HTTP/2 çš„è¿æ¥ï¼Œä¹Ÿå°±å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ª Push Cacheã€‚è¿™ä¸»è¦è¿˜æ˜¯ä¾èµ–æµè§ˆå™¨çš„å®ç°è€Œå®šï¼Œå‡ºäºå¯¹æ€§èƒ½çš„è€ƒè™‘ï¼Œæœ‰çš„æµè§ˆå™¨ä¼šå¯¹ç›¸åŒåŸŸåä½†ä¸åŒçš„ tab æ ‡ç­¾ä½¿ç”¨åŒä¸€ä¸ª HTTP è¿æ¥ï¼›\n- Push Cache ä¸­çš„ç¼“å­˜åªèƒ½è¢«ä½¿ç”¨ä¸€æ¬¡ï¼›\n- æµè§ˆå™¨å¯ä»¥æ‹’ç»æ¥å—å·²ç»å­˜åœ¨çš„èµ„æºæ¨é€ï¼›\n- ä½ å¯ä»¥ç»™å…¶ä»–åŸŸåæ¨é€èµ„æºã€‚\n\nå¦‚æœä»¥ä¸Šå››ç§ç¼“å­˜éƒ½æ²¡æœ‰å‘½ä¸­çš„è¯ï¼Œé‚£ä¹ˆåªèƒ½å‘èµ·è¯·æ±‚æ¥è·å–èµ„æºäº†ã€‚\n\né‚£ä¹ˆä¸ºäº†æ€§èƒ½ä¸Šçš„è€ƒè™‘ï¼Œå¤§éƒ¨åˆ†çš„æ¥å£éƒ½åº”è¯¥é€‰æ‹©å¥½ç¼“å­˜ç­–ç•¥ï¼Œ**é€šå¸¸æµè§ˆå™¨ç¼“å­˜ç­–ç•¥åˆ†ä¸ºä¸¤ç§ï¼šå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ï¼Œå¹¶ä¸”ç¼“å­˜ç­–ç•¥éƒ½æ˜¯é€šè¿‡è®¾ç½® HTTP Header æ¥å®ç°çš„**ã€‚\n\n## http çŠ¶æ€ç ä¸ç¼“å­˜ç­–ç•¥\n\n### 200 from memory cache\n\nä¸è®¿é—®æœåŠ¡å™¨ï¼Œç›´æ¥è¯»ç¼“å­˜ï¼Œä»å†…å­˜ä¸­è¯»å–ç¼“å­˜ã€‚æ­¤æ—¶çš„æ•°æ®æ—¶ç¼“å­˜åˆ°å†…å­˜ä¸­çš„ï¼Œå½“ kill è¿›ç¨‹åï¼Œä¹Ÿå°±æ˜¯æµè§ˆå™¨å…³é—­ä»¥åï¼Œæ•°æ®å°†ä¸å­˜åœ¨ã€‚\n\nä½†æ˜¯è¿™ç§æ–¹å¼åªèƒ½ç¼“å­˜æ´¾ç”Ÿèµ„æº\n\n### 200 from disk cache\n\nä¸è®¿é—®æœåŠ¡å™¨ï¼Œç›´æ¥è¯»ç¼“å­˜ï¼Œä»ç£ç›˜ä¸­è¯»å–ç¼“å­˜ï¼Œå½“ kill è¿›ç¨‹æ—¶ï¼Œæ•°æ®è¿˜æ˜¯å­˜åœ¨ã€‚\n\nè¿™ç§æ–¹å¼ä¹Ÿåªèƒ½ç¼“å­˜æ´¾ç”Ÿèµ„æº\n\n### 304 Not Modified\n\nè®¿é—®æœåŠ¡å™¨ï¼Œå‘ç°æ•°æ®æ²¡æœ‰\n\næ›´æ–°ï¼ŒæœåŠ¡å™¨è¿”å›æ­¤çŠ¶æ€ç ã€‚ç„¶åä»ç¼“å­˜ä¸­è¯»å–æ•°æ®ã€‚\n\n## ä¸‰çº§ç¼“å­˜åŸç†\n\n1. å…ˆå»å†…å­˜çœ‹ï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥åŠ è½½\n2. å¦‚æœå†…å­˜æ²¡æœ‰ï¼Œæ‹©å–ç¡¬ç›˜è·å–ï¼Œå¦‚æœæœ‰ç›´æ¥åŠ è½½\n3. å¦‚æœç¡¬ç›˜ä¹Ÿæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±è¿›è¡Œç½‘ç»œè¯·æ±‚\n4. åŠ è½½åˆ°çš„èµ„æºç¼“å­˜åˆ°ç¡¬ç›˜å’Œå†…å­˜\n\n## å¸¸è§ç¼“å­˜æƒ…å†µ\n\n1. ç¬¬ä¸€ä¸ªç°è±¡ï¼š\n\nè®¿é—®-> 200 -> é€€å‡ºæµè§ˆå™¨\n\nå†è¿›æ¥-> 200(from disk cache) -> åˆ·æ–° -> 200(from memory cache)\n\næ€»ç»“: ä¼šä¸ä¼šæ˜¯ chrome å¾ˆèªæ˜çš„åˆ¤æ–­æ—¢ç„¶å·²ç»ä» disk æ‹¿æ¥äº†ï¼Œ ç¬¬äºŒæ¬¡å°±å†…å­˜æ‹¿å§ å¿«ã€‚ï¼ˆç¬‘å“­)\n\n2. ç¬¬äºŒä¸ªç°è±¡:\n\nåªè¦å›¾ç‰‡æ˜¯ base64 éƒ½æ˜¯ from memroy cacheã€‚\n\næ€»ç»“: è§£ææ¸²æŸ“å›¾ç‰‡è¿™ä¹ˆè´¹åŠ²çš„äº‹æƒ…ï¼Œè¿˜æ˜¯åšä¸€æ¬¡ç„¶åæ”¾åˆ°å†…å­˜å§ã€‚ ç”¨çš„æ—¶å€™ç›´æ¥æ‹¿\n\n3. ç¬¬ä¸‰ä¸ªç°è±¡(ä»¥ js css ä¸ºä¾‹):\n\nä¸ªäººåœ¨åšé™æ€æµ‹è¯•çš„å‘ç°ï¼Œå¤§å‹çš„ js css æ–‡ä»¶éƒ½æ˜¯ç›´æ¥ disk cache\n\næ€»ç»“: chrome ä¼šä¸ä¼šè¯´ æˆ‘æ“¦ ä½ è¿™ä¹ˆå¤§ å¤ª JB å åœ°æ–¹äº†ã€‚ ä½ å°±å»ç¡¬ç›˜é‡Œå‘†ç€å§ã€‚ æ…¢å°±æ…¢ç‚¹å§ã€‚\n\n4. ç¬¬å››ä¸ªç°è±¡:\n\néšç§æ¨¡å¼ä¸‹ï¼Œå‡ ä¹éƒ½æ˜¯ from memroy cache.\n\næ€»ç»“: éšç§æ¨¡å¼ æ˜¯å§ã€‚ æˆ‘ä¸èƒ½æš´éœ²ä½ ä¸œè¥¿ã€‚è¿˜æ˜¯æ”¾åˆ°å†…å­˜å§ã€‚ ä½ å…³ï¼Œæˆ‘æ­»ã€‚\n","tags":["æµè§ˆå™¨","ç¼“å­˜"],"categories":["æµè§ˆå™¨"]},{"title":"Proxy","url":"/2018/10/27/Proxy/","content":"\n# æ¦‚è¿°\n\nES6 åŸç”Ÿæä¾› Proxy æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ Proxy å®ä¾‹ã€‚\n\n```javascript\nvar proxy = new Proxy(target, handler);\n```\n\nProxy å¯¹è±¡çš„æ‰€æœ‰ç”¨æ³•ï¼Œéƒ½æ˜¯ä¸Šé¢è¿™ç§å½¢å¼ï¼Œä¸åŒçš„åªæ˜¯ handler å‚æ•°çš„å†™æ³•ã€‚å…¶ä¸­ï¼Œnew Proxy()è¡¨ç¤ºç”Ÿæˆä¸€ä¸ª Proxy å®ä¾‹ï¼Œtarget å‚æ•°è¡¨ç¤ºæ‰€è¦æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ï¼Œhandler å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å®šåˆ¶æ‹¦æˆªè¡Œä¸ºã€‚\n\n<!-- more -->\n\nä¸‹é¢æ˜¯ä¸€ä¸ªæ‹¦æˆªè¯»å–å±æ€§è¡Œä¸ºçš„ä¾‹å­ã€‚\n\n```javascript\nvar proxy = new Proxy(\n  {},\n  {\n    get: function(target, property) {\n      return 35;\n    }\n  }\n);\n\nproxy.time; // 35\nproxy.name; // 35\nproxy.title; // 35\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œä½œä¸ºæ„é€ å‡½æ•°ï¼ŒProxy æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‰€è¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼ˆä¸Šä¾‹æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼‰ï¼Œå³å¦‚æœæ²¡æœ‰ Proxy çš„ä»‹å…¥ï¼Œæ“ä½œåŸæ¥è¦è®¿é—®çš„å°±æ˜¯è¿™ä¸ªå¯¹è±¡ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œå¯¹äºæ¯ä¸€ä¸ªè¢«ä»£ç†çš„æ“ä½œï¼Œéœ€è¦æä¾›ä¸€ä¸ªå¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æ‹¦æˆªå¯¹åº”çš„æ“ä½œã€‚æ¯”å¦‚ï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œé…ç½®å¯¹è±¡æœ‰ä¸€ä¸ª get æ–¹æ³•ï¼Œç”¨æ¥æ‹¦æˆªå¯¹ç›®æ ‡å¯¹è±¡å±æ€§çš„è®¿é—®è¯·æ±‚ã€‚get æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ç›®æ ‡å¯¹è±¡å’Œæ‰€è¦è®¿é—®çš„å±æ€§ã€‚å¯ä»¥çœ‹åˆ°ï¼Œç”±äºæ‹¦æˆªå‡½æ•°æ€»æ˜¯è¿”å› 35ï¼Œæ‰€ä»¥è®¿é—®ä»»ä½•å±æ€§éƒ½å¾—åˆ° 35ã€‚<font color=\"#DC143C\">æ³¨æ„ï¼Œè¦ä½¿å¾— Proxy èµ·ä½œç”¨ï¼Œå¿…é¡»é’ˆå¯¹ Proxy å®ä¾‹ï¼ˆä¸Šä¾‹æ˜¯ proxy å¯¹è±¡ï¼‰è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç›®æ ‡å¯¹è±¡ï¼ˆä¸Šä¾‹æ˜¯ç©ºå¯¹è±¡ï¼‰è¿›è¡Œæ“ä½œã€‚</font>å¦‚æœ handler æ²¡æœ‰è®¾ç½®ä»»ä½•æ‹¦æˆªï¼Œé‚£å°±ç­‰åŒäºç›´æ¥é€šå‘åŸå¯¹è±¡ã€‚\nåŒä¸€ä¸ªæ‹¦æˆªå™¨å‡½æ•°ï¼Œå¯ä»¥è®¾ç½®æ‹¦æˆªå¤šä¸ªæ“ä½œã€‚\n\n```javascript\nvar handler = {\n  get: function(target, name) {\n    if (name === \"prototype\") {\n      return Object.prototype;\n    }\n    return \"Hello, \" + name;\n  },\n\n  apply: function(target, thisBinding, args) {\n    return args[0];\n  },\n\n  construct: function(target, args) {\n    return { value: args[1] };\n  }\n};\n\nvar fproxy = new Proxy(function(x, y) {\n  return x + y;\n}, handler);\n\nfproxy(1, 2); // 1\nnew fproxy(1, 2); // {value: 2}\nfproxy.prototype === Object.prototype; // true\nfproxy.foo === \"Hello, foo\"; // true\n```\n\n# Proxy æ”¯æŒçš„æ‹¦æˆªæ“ä½œä¸€è§ˆ\n\nProxy æ”¯æŒçš„æ‹¦æˆªæ“ä½œä¸€è§ˆï¼Œä¸€å…± 13 ç§ã€‚\n\n## get(target, propKey, receiver)\n\næ‹¦æˆªå¯¹è±¡å±æ€§çš„è¯»å–ï¼Œæ¯”å¦‚ proxy.foo å’Œ proxy['foo']ã€‚\n\n## set(target, propKey, value, receiver)\n\næ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®ï¼Œæ¯”å¦‚ proxy.foo = v æˆ– proxy['foo'] = vï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚\n\n## has(target, propKey)\n\næ‹¦æˆª propKey in proxy çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚\n\n## deleteProperty(target, propKey)\n\næ‹¦æˆª delete proxy[propKey]çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚\n\n## ownKeys(target)\n\næ‹¦æˆª Object.getOwnPropertyNames(proxy)ã€Object.getOwnPropertySymbols(proxy)ã€Object.keys(proxy)ã€for...in å¾ªç¯ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›ç›®æ ‡å¯¹è±¡æ‰€æœ‰è‡ªèº«çš„å±æ€§çš„å±æ€§åï¼Œè€Œ Object.keys()çš„è¿”å›ç»“æœä»…åŒ…æ‹¬ç›®æ ‡å¯¹è±¡è‡ªèº«çš„å¯éå†å±æ€§ã€‚\n\n## getOwnPropertyDescriptor(target, propKey)\n\næ‹¦æˆª Object.getOwnPropertyDescriptor(proxy, propKey)ï¼Œè¿”å›å±æ€§çš„æè¿°å¯¹è±¡ã€‚\n\n## defineProperty(target, propKey, propDesc)\n\næ‹¦æˆª Object.defineProperty(proxy, propKey, propDescï¼‰ã€Object.defineProperties(proxy, propDescs)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚\n\n## preventExtensions(target)\n\næ‹¦æˆª Object.preventExtensions(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚\n\n## getPrototypeOf(target)\n\næ‹¦æˆª Object.getPrototypeOf(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚\n\n## isExtensible(target)\n\næ‹¦æˆª Object.isExtensible(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚\n\n## setPrototypeOf(target, proto)\n\næ‹¦æˆª Object.setPrototypeOf(proxy, proto)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æœç›®æ ‡å¯¹è±¡æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸¤ç§é¢å¤–æ“ä½œå¯ä»¥æ‹¦æˆªã€‚\n\n## apply(target, object, args)\n\næ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚ proxy(...args)ã€proxy.call(object, ...args)ã€proxy.apply(...)ã€‚\n\n## construct(target, args)\n\næ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚ new proxy(...args)ã€‚\n\n# Proxy å®ä¾‹çš„æ–¹æ³•\n\nä¸‹é¢æ˜¯ä¸Šé¢è¿™äº›æ‹¦æˆªæ–¹æ³•çš„è¯¦ç»†ä»‹ç»ã€‚\n\n## get()\n\nget æ–¹æ³•ç”¨äºæ‹¦æˆªæŸä¸ªå±æ€§çš„è¯»å–æ“ä½œï¼Œå¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºç›®æ ‡å¯¹è±¡ã€å±æ€§åå’Œ proxy å®ä¾‹æœ¬èº«ï¼ˆä¸¥æ ¼åœ°è¯´ï¼Œå®ƒæ€»æ˜¯æŒ‡å‘åŸå§‹çš„è¯»æ“ä½œæ‰€åœ¨çš„é‚£ä¸ªå¯¹è±¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å°±æ˜¯ Proxy å®ä¾‹ï¼‰ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªå‚æ•°å¯é€‰ã€‚\n\n```javascript\nvar person = {\n  name: \"å¼ ä¸‰\"\n};\n\nvar proxy = new Proxy(person, {\n  get: function(target, property) {\n    if (property in target) {\n      return target[property];\n    } else {\n      throw new ReferenceError('Property \"' + property + '\" does not exist.');\n    }\n  }\n});\n\nproxy.name; // \"å¼ ä¸‰\"\nproxy.age; // æŠ›å‡ºä¸€ä¸ªé”™è¯¯\n```\n\nget æ–¹æ³•å¯ä»¥ç»§æ‰¿ã€‚\n\n```javascript\nlet proto = new Proxy(\n  {},\n  {\n    get(target, propertyKey, receiver) {\n      console.log(\"GET \" + propertyKey);\n      return target[propertyKey];\n    }\n  }\n);\n\nlet obj = Object.create(proto);\nobj.foo; // \"GET foo\"\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œæ‹¦æˆªæ“ä½œå®šä¹‰åœ¨ Prototype å¯¹è±¡ä¸Šé¢ï¼Œæ‰€ä»¥å¦‚æœè¯»å– obj å¯¹è±¡ç»§æ‰¿çš„å±æ€§æ—¶ï¼Œæ‹¦æˆªä¼šç”Ÿæ•ˆã€‚\nåˆ©ç”¨ Proxyï¼Œå¯ä»¥å°†è¯»å–å±æ€§çš„æ“ä½œï¼ˆgetï¼‰ï¼Œè½¬å˜ä¸ºæ‰§è¡ŒæŸä¸ªå‡½æ•°ï¼Œä»è€Œå®ç°å±æ€§çš„é“¾å¼æ“ä½œã€‚\n\n```javascript\nvar pipe = (function() {\n  return function(value) {\n    var funcStack = [];\n    var oproxy = new Proxy(\n      {},\n      {\n        get: function(pipeObject, fnName) {\n          if (fnName === \"get\") {\n            return funcStack.reduce(function(val, fn) {\n              return fn(val);\n            }, value);\n          }\n          funcStack.push(window[fnName]);\n          return oproxy;\n        }\n      }\n    );\n\n    return oproxy;\n  };\n})();\n\nvar double = n => n * 2;\nvar pow = n => n * n;\nvar reverseInt = n =>\n  n\n    .toString()\n    .split(\"\")\n    .reverse()\n    .join(\"\") | 0;\n\npipe(3).double.pow.reverseInt.get; // 63\n```\n\nä¸‹é¢æ˜¯ä¸€ä¸ª get æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°çš„ä¾‹å­\n\n```javascript\nconst proxy = new Proxy(\n  {},\n  {\n    get: function(target, property, receiver) {\n      return receiver;\n    }\n  }\n);\n\nconst d = Object.create(proxy);\nd.a === d; // true\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œd å¯¹è±¡æœ¬èº«æ²¡æœ‰ a å±æ€§ï¼Œæ‰€ä»¥è¯»å– d.a çš„æ—¶å€™ï¼Œä¼šå» d çš„åŸå‹ proxy å¯¹è±¡æ‰¾ã€‚è¿™æ—¶ï¼Œreceiver å°±æŒ‡å‘ dï¼Œä»£è¡¨åŸå§‹çš„è¯»æ“ä½œæ‰€åœ¨çš„é‚£ä¸ªå¯¹è±¡ã€‚\nå¦‚æœä¸€ä¸ªå±æ€§ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰ä¸”ä¸å¯å†™ï¼ˆwritableï¼‰ï¼Œåˆ™ Proxy ä¸èƒ½ä¿®æ”¹è¯¥å±æ€§ï¼Œå¦åˆ™é€šè¿‡ Proxy å¯¹è±¡è®¿é—®è¯¥å±æ€§ä¼šæŠ¥é”™ã€‚\n\n```javascript\nconst target = Object.defineProperties(\n  {},\n  {\n    foo: {\n      value: 123,\n      writable: false,\n      configurable: false\n    }\n  }\n);\n\nconst handler = {\n  get(target, propKey) {\n    return \"abc\";\n  }\n};\n\nconst proxy = new Proxy(target, handler);\n\nproxy.foo;\n// TypeError: Invariant check failed\n```\n\n## set()\n\nset æ–¹æ³•ç”¨æ¥æ‹¦æˆªæŸä¸ªå±æ€§çš„èµ‹å€¼æ“ä½œï¼Œå¯ä»¥æ¥å—å››ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºç›®æ ‡å¯¹è±¡ã€å±æ€§åã€å±æ€§å€¼å’Œ Proxy å®ä¾‹æœ¬èº«ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªå‚æ•°å¯é€‰ã€‚\nåˆ©ç”¨ set æ–¹æ³•ï¼Œå¯ä»¥è¿›è¡Œæ•°æ®éªŒè¯ï¼Œè¿˜å¯ä»¥æ•°æ®ç»‘å®šï¼Œå³æ¯å½“å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè‡ªåŠ¨æ›´æ–° DOMã€‚\næœ‰æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨å¯¹è±¡ä¸Šé¢è®¾ç½®å†…éƒ¨å±æ€§ï¼Œå±æ€§åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä½¿ç”¨ä¸‹åˆ’çº¿å¼€å¤´ï¼Œè¡¨ç¤ºè¿™äº›å±æ€§ä¸åº”è¯¥è¢«å¤–éƒ¨ä½¿ç”¨ã€‚ç»“åˆ get å’Œ set æ–¹æ³•ï¼Œå°±å¯ä»¥åšåˆ°é˜²æ­¢è¿™äº›å†…éƒ¨å±æ€§è¢«å¤–éƒ¨è¯»å†™ã€‚\n\n```javascript\nconst handler = {\n  get(target, key) {\n    invariant(key, \"get\");\n    return target[key];\n  },\n  set(target, key, value) {\n    invariant(key, \"set\");\n    target[key] = value;\n    return true;\n  }\n};\nfunction invariant(key, action) {\n  if (key[0] === \"_\") {\n    throw new Error(`Invalid attempt to ${action} private \"${key}\" property`);\n  }\n}\nconst target = {};\nconst proxy = new Proxy(target, handler);\nproxy._prop;\n// Error: Invalid attempt to get private \"_prop\" property\nproxy._prop = \"c\";\n// Error: Invalid attempt to set private \"_prop\" property\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦è¯»å†™çš„å±æ€§åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸‹åˆ’çº¿ï¼Œä¸€å¾‹æŠ›é”™ï¼Œä»è€Œè¾¾åˆ°ç¦æ­¢è¯»å†™å†…éƒ¨å±æ€§çš„ç›®çš„ã€‚\nä¸‹é¢æ˜¯ set æ–¹æ³•ç¬¬å››ä¸ªå‚æ•°çš„ä¾‹å­ã€‚\n\n```javascript\nconst handler = {\n  set: function(obj, prop, value, receiver) {\n    obj[prop] = receiver;\n  }\n};\nconst proxy = new Proxy({}, handler);\nconst myObj = {};\nObject.setPrototypeOf(myObj, proxy);\n\nmyObj.foo = \"bar\";\nmyObj.foo === myObj; // true\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œè®¾ç½® myObj.foo å±æ€§çš„å€¼æ—¶ï¼ŒmyObj å¹¶æ²¡æœ‰ foo å±æ€§ï¼Œå› æ­¤å¼•æ“ä¼šåˆ° myObj çš„åŸå‹é“¾å»æ‰¾ foo å±æ€§ã€‚myObj çš„åŸå‹å¯¹è±¡ proxy æ˜¯ä¸€ä¸ª Proxy å®ä¾‹ï¼Œè®¾ç½®å®ƒçš„ foo å±æ€§ä¼šè§¦å‘ set æ–¹æ³•ã€‚è¿™æ—¶ï¼Œç¬¬å››ä¸ªå‚æ•° receiver å°±æŒ‡å‘åŸå§‹èµ‹å€¼è¡Œä¸ºæ‰€åœ¨çš„å¯¹è±¡ myObjã€‚\nå¦‚æœç›®æ ‡å¯¹è±¡è‡ªèº«çš„æŸä¸ªå±æ€§ï¼Œä¸å¯å†™ä¸”ä¸å¯é…ç½®ï¼Œé‚£ä¹ˆ set æ–¹æ³•å°†ä¸èµ·ä½œç”¨ã€‚\n\n```javascript\nconst obj = {};\nObject.defineProperty(obj, \"foo\", {\n  value: \"bar\",\n  writable: false\n});\n\nconst handler = {\n  set: function(obj, prop, value, receiver) {\n    obj[prop] = \"baz\";\n  }\n};\n\nconst proxy = new Proxy(obj, handler);\nproxy.foo = \"baz\";\nproxy.foo; // \"bar\"\n```\n\n## apply()\n\napply æ–¹æ³•æ‹¦æˆªå‡½æ•°çš„è°ƒç”¨ã€call å’Œ apply æ“ä½œã€‚apply æ–¹æ³•å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ç›®æ ‡å¯¹è±¡ã€ç›®æ ‡å¯¹è±¡çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆthisï¼‰å’Œç›®æ ‡å¯¹è±¡çš„å‚æ•°æ•°ç»„ã€‚\n\n```javascript\nvar target = function() {\n  return \"I am the target\";\n};\nvar handler = {\n  apply: function() {\n    return \"I am the proxy\";\n  }\n};\n\nvar p = new Proxy(target, handler);\n\np();\n// \"I am the proxy\"\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡ p æ˜¯ Proxy çš„å®ä¾‹ï¼Œå½“å®ƒä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼ˆp()ï¼‰ï¼Œå°±ä¼šè¢« apply æ–¹æ³•æ‹¦æˆªï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚\nå¦å¤–ï¼Œç›´æ¥è°ƒç”¨ Reflect.apply æ–¹æ³•ï¼Œä¹Ÿä¼šè¢«æ‹¦æˆªã€‚\n\n## has()\n\nhas æ–¹æ³•ç”¨æ¥æ‹¦æˆª HasProperty æ“ä½œï¼Œå³åˆ¤æ–­å¯¹è±¡æ˜¯å¦å…·æœ‰æŸä¸ªå±æ€§æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šç”Ÿæ•ˆã€‚å…¸å‹çš„æ“ä½œå°±æ˜¯ in è¿ç®—ç¬¦ã€‚has æ–¹æ³•å¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ç›®æ ‡å¯¹è±¡ã€éœ€æŸ¥è¯¢çš„å±æ€§åã€‚\nä¸‹é¢çš„ä¾‹å­ä½¿ç”¨ has æ–¹æ³•éšè—æŸäº›å±æ€§ï¼Œä¸è¢« in è¿ç®—ç¬¦å‘ç°ã€‚\n\n```javascript\nvar handler = {\n  has(target, key) {\n    if (key[0] === \"_\") {\n      return false;\n    }\n    return key in target;\n  }\n};\nvar target = { _prop: \"foo\", prop: \"foo\" };\nvar proxy = new Proxy(target, handler);\n\"_prop\" in proxy; // false\n```\n\nå¦‚æœåŸå¯¹è±¡ä¸å¯é…ç½®æˆ–è€…ç¦æ­¢æ‰©å±•ï¼Œè¿™æ—¶ has æ‹¦æˆªä¼šæŠ¥é”™ã€‚\n\n```javascript\nvar obj = { a: 10 };\nObject.preventExtensions(obj);\n\nvar p = new Proxy(obj, {\n  has: function(target, prop) {\n    return false;\n  }\n});\n\n\"a\" in p; // TypeError is thrown\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œobj å¯¹è±¡ç¦æ­¢æ‰©å±•ï¼Œç»“æœä½¿ç”¨ has æ‹¦æˆªå°±ä¼šæŠ¥é”™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸä¸ªå±æ€§ä¸å¯é…ç½®ï¼ˆæˆ–è€…ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼‰ï¼Œåˆ™ has æ–¹æ³•å°±ä¸å¾—â€œéšè—â€ï¼ˆå³è¿”å› falseï¼‰ç›®æ ‡å¯¹è±¡çš„è¯¥å±æ€§ã€‚\nhas æ–¹æ³•æ‹¦æˆªçš„æ˜¯ HasProperty æ“ä½œï¼Œè€Œä¸æ˜¯ HasOwnProperty æ“ä½œï¼Œå³ has æ–¹æ³•ä¸åˆ¤æ–­ä¸€ä¸ªå±æ€§æ˜¯å¯¹è±¡è‡ªèº«çš„å±æ€§ï¼Œè¿˜æ˜¯ç»§æ‰¿çš„å±æ€§ã€‚å¦å¤–ï¼Œè™½ç„¶ for...in å¾ªç¯ä¹Ÿç”¨åˆ°äº† in è¿ç®—ç¬¦ï¼Œä½†æ˜¯ has æ‹¦æˆªå¯¹ for...in å¾ªç¯ä¸ç”Ÿæ•ˆã€‚\n\n## construct()\n\nconstruct æ–¹æ³•ç”¨äºæ‹¦æˆª new å‘½ä»¤ï¼Œä¸‹é¢æ˜¯æ‹¦æˆªå¯¹è±¡çš„å†™æ³•ã€‚\n\n```javascript\nvar handler = {\n  construct(target, args, newTarget) {\n    return new target(...args);\n  }\n};\n```\n\nconstruct æ–¹æ³•å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ã€‚targetï¼šç›®æ ‡å¯¹è±¡ã€‚argsï¼šæ„é€ å‡½æ•°çš„å‚æ•°å¯¹è±¡ã€‚newTargetï¼šåˆ›é€ å®ä¾‹å¯¹è±¡æ—¶ï¼Œnew å‘½ä»¤ä½œç”¨çš„æ„é€ å‡½æ•°ã€‚\nconstruct æ–¹æ³•è¿”å›çš„å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚\n\n```javascript\nvar p = new Proxy(function() {}, {\n  construct: function(target, args) {\n    console.log(\"called: \" + args.join(\", \"));\n    return { value: args[0] * 10 };\n  }\n});\n\nnew p(1).value;\n// \"called: 1\"\n// 10\n```\n\n```javascript\nvar p = new Proxy(function() {}, {\n  construct: function(target, argumentsList) {\n    return 1;\n  }\n});\n\nnew p(); // æŠ¥é”™\n```\n\n## deleteProperty()\n\ndeleteProperty æ–¹æ³•ç”¨äºæ‹¦æˆª delete æ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•æŠ›å‡ºé”™è¯¯æˆ–è€…è¿”å› falseï¼Œå½“å‰å±æ€§å°±æ— æ³•è¢« delete å‘½ä»¤åˆ é™¤ã€‚\n\n```javascript\nvar handler = {\n  deleteProperty(target, key) {\n    invariant(key, \"delete\");\n    return true;\n  }\n};\nfunction invariant(key, action) {\n  if (key[0] === \"_\") {\n    throw new Error(`Invalid attempt to ${action} private \"${key}\" property`);\n  }\n}\n\nvar target = { _prop: \"foo\" };\nvar proxy = new Proxy(target, handler);\ndelete proxy._prop;\n// Error: Invalid attempt to delete private \"_prop\" property\n```\n\ndeleteProperty æ–¹æ³•æ‹¦æˆªäº† delete æ“ä½œç¬¦ï¼Œåˆ é™¤ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºä¸‹åˆ’çº¿çš„å±æ€§ä¼šæŠ¥é”™ã€‚\næ³¨æ„ï¼Œç›®æ ‡å¯¹è±¡è‡ªèº«çš„ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰çš„å±æ€§ï¼Œä¸èƒ½è¢« deleteProperty æ–¹æ³•åˆ é™¤ï¼Œå¦åˆ™æŠ¥é”™ã€‚\n\n## defineProperty()\n\ndefineProperty æ–¹æ³•æ‹¦æˆªäº† Object.defineProperty æ“ä½œã€‚\n\n```javascript\nvar handler = {\n  defineProperty(target, key, descriptor) {\n    return false;\n  }\n};\nvar target = {};\nvar proxy = new Proxy(target, handler);\nproxy.foo = \"bar\"; // ä¸ä¼šç”Ÿæ•ˆ\n```\n\ndefineProperty æ–¹æ³•è¿”å› falseï¼Œå¯¼è‡´æ·»åŠ æ–°å±æ€§æ€»æ˜¯æ— æ•ˆã€‚\næ³¨æ„ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼ˆextensibleï¼‰ï¼Œåˆ™ defineProperty ä¸èƒ½å¢åŠ ç›®æ ‡å¯¹è±¡ä¸Šä¸å­˜åœ¨çš„å±æ€§ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚å¦å¤–ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡çš„æŸä¸ªå±æ€§ä¸å¯å†™ï¼ˆwritableï¼‰æˆ–ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰ï¼Œåˆ™ defineProperty æ–¹æ³•ä¸å¾—æ”¹å˜è¿™ä¸¤ä¸ªè®¾ç½®ã€‚\n\n## getOwnPropertyDescriptor()\n\ngetOwnPropertyDescriptor æ–¹æ³•æ‹¦æˆª Object.getOwnPropertyDescriptor()ï¼Œè¿”å›ä¸€ä¸ªå±æ€§æè¿°å¯¹è±¡æˆ–è€… undefinedã€‚\n\n```javascript\nvar handler = {\n  getOwnPropertyDescriptor(target, key) {\n    if (key[0] === \"_\") {\n      return;\n    }\n    return Object.getOwnPropertyDescriptor(target, key);\n  }\n};\nvar target = { _foo: \"bar\", baz: \"tar\" };\nvar proxy = new Proxy(target, handler);\nObject.getOwnPropertyDescriptor(proxy, \"wat\");\n// undefined\nObject.getOwnPropertyDescriptor(proxy, \"_foo\");\n// undefined\nObject.getOwnPropertyDescriptor(proxy, \"baz\");\n// { value: 'tar', writable: true, enumerable: true, configurable: true }\n```\n\nhandler.getOwnPropertyDescriptor æ–¹æ³•å¯¹äºç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºä¸‹åˆ’çº¿çš„å±æ€§åä¼šè¿”å› undefinedã€‚\n\n## getPrototypeOf()\n\ngetPrototypeOf æ–¹æ³•ä¸»è¦ç”¨æ¥æ‹¦æˆªè·å–å¯¹è±¡åŸå‹ã€‚å…·ä½“æ¥è¯´ï¼Œæ‹¦æˆªä¸‹é¢è¿™äº›æ“ä½œã€‚\n\n1. Object.prototype.\\_\\_proto\\_\\_\n2. Object.prototype.isPrototypeOf()\n3. Object.getPrototypeOf()\n4. Reflect.getPrototypeOf()\n5. instanceof\n\n```javascript\nvar proto = {};\nvar p = new Proxy(\n  {},\n  {\n    getPrototypeOf(target) {\n      return proto;\n    }\n  }\n);\nObject.getPrototypeOf(p) === proto; // true\n```\n\ngetPrototypeOf æ–¹æ³•çš„è¿”å›å€¼å¿…é¡»æ˜¯å¯¹è±¡æˆ–è€… nullï¼Œå¦åˆ™æŠ¥é”™ã€‚å¦å¤–ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼ˆextensibleï¼‰ï¼Œ getPrototypeOf æ–¹æ³•å¿…é¡»è¿”å›ç›®æ ‡å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚\n\n## isExtensible()\n\nisExtensible æ–¹æ³•æ‹¦æˆª Object.isExtensible æ“ä½œ\n\n```javascript\nvar p = new Proxy(\n  {},\n  {\n    isExtensible: function(target) {\n      console.log(\"called\");\n      return true;\n    }\n  }\n);\n\nObject.isExtensible(p);\n// \"called\"\n// true\n```\n\nè¯¥æ–¹æ³•åªèƒ½è¿”å›å¸ƒå°”å€¼ï¼Œå¦åˆ™è¿”å›å€¼ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚\nè¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªå¼ºé™åˆ¶ï¼Œå®ƒçš„è¿”å›å€¼å¿…é¡»ä¸ç›®æ ‡å¯¹è±¡çš„ isExtensible å±æ€§ä¿æŒä¸€è‡´ï¼Œå¦åˆ™å°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚\n\n```javascript\nvar p = new Proxy(\n  {},\n  {\n    isExtensible: function(target) {\n      return false;\n    }\n  }\n);\n\nObject.isExtensible(p); // æŠ¥é”™\nObject.isExtensible(proxy) === Object.isExtensible(target); //true\n```\n\n## ownKeys()\n\nownKeys æ–¹æ³•ç”¨æ¥æ‹¦æˆªå¯¹è±¡è‡ªèº«å±æ€§çš„è¯»å–æ“ä½œã€‚å…·ä½“æ¥è¯´ï¼Œæ‹¦æˆªä»¥ä¸‹æ“ä½œã€‚\n\n1. Object.getOwnPropertyNames()\n2. Object.getOwnPropertySymbols()\n3. Object.keys()\n4. for...in å¾ªç¯\n\n```javascript\nlet target = {\n  a: 1,\n  b: 2,\n  c: 3\n};\n\nlet handler = {\n  ownKeys(target) {\n    return [\"a\"];\n  }\n};\n\nlet proxy = new Proxy(target, handler);\n\nObject.keys(proxy);\n// [ 'a' ]\n```\n\næ³¨æ„ï¼Œä½¿ç”¨ Object.keys æ–¹æ³•æ—¶ï¼Œæœ‰ä¸‰ç±»å±æ€§ä¼šè¢« ownKeys æ–¹æ³•è‡ªåŠ¨è¿‡æ»¤ï¼Œä¸ä¼šè¿”å›ã€‚\n\n1. ç›®æ ‡å¯¹è±¡ä¸Šä¸å­˜åœ¨çš„å±æ€§\n2. å±æ€§åä¸º Symbol å€¼\n3. ä¸å¯éå†ï¼ˆenumerableï¼‰çš„å±æ€§\n\n```javascript\nlet target = {\n  a: 1,\n  b: 2,\n  c: 3,\n  [Symbol.for(\"secret\")]: \"4\"\n};\n\nObject.defineProperty(target, \"key\", {\n  enumerable: false,\n  configurable: true,\n  writable: true,\n  value: \"static\"\n});\n\nlet handler = {\n  ownKeys(target) {\n    return [\"a\", \"d\", Symbol.for(\"secret\"), \"key\"];\n  }\n};\n\nlet proxy = new Proxy(target, handler);\n\nObject.keys(proxy);\n// ['a']\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼ŒownKeys æ–¹æ³•ä¹‹ä¸­ï¼Œæ˜¾å¼è¿”å›ä¸å­˜åœ¨çš„å±æ€§ï¼ˆdï¼‰ã€Symbol å€¼ï¼ˆSymbol.for('secret')ï¼‰ã€ä¸å¯éå†çš„å±æ€§ï¼ˆkeyï¼‰ï¼Œç»“æœéƒ½è¢«è‡ªåŠ¨è¿‡æ»¤æ‰ã€‚\n\n```javascript\n//ownKeysæ–¹æ³•è¿˜å¯ä»¥æ‹¦æˆªObject.getOwnPropertyNames()\nvar p = new Proxy(\n  {},\n  {\n    ownKeys: function(target) {\n      return [\"a\", \"b\", \"c\"];\n    }\n  }\n);\n\nObject.getOwnPropertyNames(p);\n// [ 'a', 'b', 'c' ]\n\n//for...inå¾ªç¯ä¹Ÿå—åˆ°ownKeysæ–¹æ³•çš„æ‹¦æˆª\nconst obj = { hello: \"world\" };\nconst proxy = new Proxy(obj, {\n  ownKeys: function() {\n    return [\"a\", \"b\"];\n  }\n});\n\nfor (let key in proxy) {\n  console.log(key); // æ²¡æœ‰ä»»ä½•è¾“å‡º\n}\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œownkeys æŒ‡å®šåªè¿”å› a å’Œ b å±æ€§ï¼Œç”±äº obj æ²¡æœ‰è¿™ä¸¤ä¸ªå±æ€§ï¼Œå› æ­¤ for...in å¾ªç¯ä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºã€‚\nownKeys æ–¹æ³•è¿”å›çš„æ•°ç»„æˆå‘˜ï¼Œåªèƒ½æ˜¯å­—ç¬¦ä¸²æˆ– Symbol å€¼ã€‚å¦‚æœæœ‰å…¶ä»–ç±»å‹çš„å€¼ï¼Œæˆ–è€…è¿”å›çš„æ ¹æœ¬ä¸æ˜¯æ•°ç»„ï¼Œå°±ä¼šæŠ¥é”™ã€‚\n\n```javascript\nvar obj = {};\n\nvar p = new Proxy(obj, {\n  ownKeys: function(target) {\n    return [123, true, undefined, null, {}, []];\n  }\n});\n\nObject.getOwnPropertyNames(p);\n// Uncaught TypeError: 123 is not a valid property name\n```\n\nå¦‚æœç›®æ ‡å¯¹è±¡è‡ªèº«åŒ…å«ä¸å¯é…ç½®çš„å±æ€§ï¼Œåˆ™è¯¥å±æ€§å¿…é¡»è¢« ownKeys æ–¹æ³•è¿”å›ï¼Œå¦åˆ™æŠ¥é”™ã€‚\n\n```javascript\nvar obj = {};\nObject.defineProperty(obj, \"a\", {\n  configurable: false,\n  enumerable: true,\n  value: 10\n});\n\nvar p = new Proxy(obj, {\n  ownKeys: function(target) {\n    return [\"b\"];\n  }\n});\n\nObject.getOwnPropertyNames(p);\n// Uncaught TypeError: 'ownKeys' on proxy: trap result did not include 'a'\n```\n\nå¦‚æœç›®æ ‡å¯¹è±¡æ˜¯ä¸å¯æ‰©å±•çš„ï¼ˆnon-extensitionï¼‰ï¼Œè¿™æ—¶ ownKeys æ–¹æ³•è¿”å›çš„æ•°ç»„ä¹‹ä¸­ï¼Œå¿…é¡»åŒ…å«åŸå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œä¸”ä¸èƒ½åŒ…å«å¤šä½™çš„å±æ€§ï¼Œå¦åˆ™æŠ¥é”™ã€‚\n\n```javascript\nvar obj = {\n  a: 1\n};\n\nObject.preventExtensions(obj);\n\nvar p = new Proxy(obj, {\n  ownKeys: function(target) {\n    return [\"a\", \"b\"];\n  }\n});\n\nObject.getOwnPropertyNames(p);\n// Uncaught TypeError: 'ownKeys' on proxy: trap returned extra keys but proxy target is non-extensible\n```\n\n## preventExtensions()\n\npreventExtensions æ–¹æ³•æ‹¦æˆª Object.preventExtensions()ã€‚è¯¥æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦åˆ™ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œåªæœ‰ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•æ—¶ï¼ˆå³ Object.isExtensible(proxy)ä¸º falseï¼‰ï¼Œproxy.preventExtensions æ‰èƒ½è¿”å› trueï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚\n\n```javascript\nvar p = new Proxy(\n  {},\n  {\n    preventExtensions: function(target) {\n      return true;\n    }\n  }\n);\n\nObject.preventExtensions(p); // æŠ¥é”™\n\n//ä¸ºäº†é˜²æ­¢å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œé€šå¸¸è¦åœ¨proxy.preventExtensionsæ–¹æ³•é‡Œé¢ï¼Œè°ƒç”¨ä¸€æ¬¡Object.preventExtensions\nvar p = new Proxy(\n  {},\n  {\n    preventExtensions: function(target) {\n      console.log(\"called\");\n      Object.preventExtensions(target);\n      return true;\n    }\n  }\n);\n\nObject.preventExtensions(p);\n// \"called\"\n// true\n```\n\n## setPrototypeOf()\n\nsetPrototypeOf æ–¹æ³•ä¸»è¦ç”¨æ¥æ‹¦æˆª Object.setPrototypeOf æ–¹æ³•ã€‚\n\n```javascript\nvar handler = {\n  setPrototypeOf(target, proto) {\n    throw new Error(\"Changing the prototype is forbidden\");\n  }\n};\nvar proto = {};\nvar target = function() {};\nvar proxy = new Proxy(target, handler);\nObject.setPrototypeOf(proxy, proto);\n// Error: Changing the prototype is forbidden\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦ä¿®æ”¹ target çš„åŸå‹å¯¹è±¡ï¼Œå°±ä¼šæŠ¥é”™ã€‚\næ³¨æ„ï¼Œè¯¥æ–¹æ³•åªèƒ½è¿”å›å¸ƒå°”å€¼ï¼Œå¦åˆ™ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚å¦å¤–ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼ˆextensibleï¼‰ï¼ŒsetPrototypeOf æ–¹æ³•ä¸å¾—æ”¹å˜ç›®æ ‡å¯¹è±¡çš„åŸå‹ã€‚\n\n# Proxy.revocable()\n\nProxy.revocable æ–¹æ³•è¿”å›ä¸€ä¸ªå¯å–æ¶ˆçš„ Proxy å®ä¾‹\n\n```javascript\nlet target = {};\nlet handler = {};\n\nlet { proxy, revoke } = Proxy.revocable(target, handler);\n\nproxy.foo = 123;\nproxy.foo; // 123\n\nrevoke();\nproxy.foo; // TypeError: Revoked\n```\n\nProxy.revocable æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„ proxy å±æ€§æ˜¯ Proxy å®ä¾‹ï¼Œrevoke å±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥å–æ¶ˆ Proxy å®ä¾‹ã€‚ä¸Šé¢ä»£ç ä¸­ï¼Œå½“æ‰§è¡Œ revoke å‡½æ•°ä¹‹åï¼Œå†è®¿é—® Proxy å®ä¾‹ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚\nProxy.revocable çš„ä¸€ä¸ªä½¿ç”¨åœºæ™¯æ˜¯ï¼Œç›®æ ‡å¯¹è±¡ä¸å…è®¸ç›´æ¥è®¿é—®ï¼Œå¿…é¡»é€šè¿‡ä»£ç†è®¿é—®ï¼Œä¸€æ—¦è®¿é—®ç»“æŸï¼Œå°±æ”¶å›ä»£ç†æƒï¼Œä¸å…è®¸å†æ¬¡è®¿é—®ã€‚\n\n# this é—®é¢˜\n\nè™½ç„¶ Proxy å¯ä»¥ä»£ç†é’ˆå¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ï¼Œä½†å®ƒä¸æ˜¯ç›®æ ‡å¯¹è±¡çš„é€æ˜ä»£ç†ï¼Œå³ä¸åšä»»ä½•æ‹¦æˆªçš„æƒ…å†µä¸‹ï¼Œä¹Ÿæ— æ³•ä¿è¯ä¸ç›®æ ‡å¯¹è±¡çš„è¡Œä¸ºä¸€è‡´ã€‚ä¸»è¦åŸå› å°±æ˜¯åœ¨ Proxy ä»£ç†çš„æƒ…å†µä¸‹ï¼Œç›®æ ‡å¯¹è±¡å†…éƒ¨çš„ this å…³é”®å­—ä¼šæŒ‡å‘ Proxy ä»£ç†ã€‚\n\n```javascript\nconst target = {\n  m: function() {\n    console.log(this === proxy);\n  }\n};\nconst handler = {};\n\nconst proxy = new Proxy(target, handler);\n\ntarget.m(); // false\nproxy.m(); // true\n```\n\n# proxy ç”¨é€”\n\nProxyï¼Œè§åçŸ¥æ„ï¼Œå…¶åŠŸèƒ½éå¸¸ç±»ä¼¼äºè®¾è®¡æ¨¡å¼ä¸­çš„ä»£ç†æ¨¡å¼ï¼Œè¯¥æ¨¡å¼å¸¸ç”¨äºä¸‰ä¸ªæ–¹é¢ï¼š\n\n- æ‹¦æˆªå’Œç›‘è§†å¤–éƒ¨å¯¹å¯¹è±¡çš„è®¿é—®\n- é™ä½å‡½æ•°æˆ–ç±»çš„å¤æ‚åº¦\n- åœ¨å¤æ‚æ“ä½œå‰å¯¹æ“ä½œè¿›è¡Œæ ¡éªŒæˆ–å¯¹æ‰€éœ€èµ„æºè¿›è¡Œç®¡ç†\n\nåœ¨æ”¯æŒ Proxy çš„æµè§ˆå™¨ç¯å¢ƒä¸­ï¼ŒProxy æ˜¯ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚`Proxy(target, handler)` æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œ`target` æ˜¯è¢«ä»£ç†çš„å¯¹è±¡ï¼Œ`handlder` æ˜¯å£°æ˜äº†å„ç±»ä»£ç†æ“ä½œçš„å¯¹è±¡ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚å¤–ç•Œæ¯æ¬¡é€šè¿‡ä»£ç†å¯¹è±¡è®¿é—® `target` å¯¹è±¡çš„å±æ€§æ—¶ï¼Œå°±ä¼šç»è¿‡ `handler` å¯¹è±¡ï¼Œä»è¿™ä¸ªæµç¨‹æ¥çœ‹ï¼Œä»£ç†å¯¹è±¡å¾ˆç±»ä¼¼ middlewareï¼ˆä¸­é—´ä»¶ï¼‰ã€‚é‚£ä¹ˆ Proxy å¯ä»¥æ‹¦æˆªä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿæœ€å¸¸è§çš„å°±æ˜¯ getï¼ˆè¯»å–ï¼‰ã€setï¼ˆä¿®æ”¹ï¼‰å¯¹è±¡å±æ€§ç­‰æ“ä½œï¼Œå®Œæ•´çš„å¯æ‹¦æˆªæ“ä½œåˆ—è¡¨è¯·ç‚¹å‡»[è¿™é‡Œ](http://www.ecma-international.org/ecma-262/6.0/#sec-proxy-object-internal-methods-and-internal-slots)ã€‚æ­¤å¤–ï¼ŒProxy å¯¹è±¡è¿˜æä¾›äº†ä¸€ä¸ª `revoke` æ–¹æ³•ï¼Œå¯ä»¥éšæ—¶æ³¨é”€æ‰€æœ‰çš„ä»£ç†æ“ä½œã€‚åœ¨æˆ‘ä»¬æ­£å¼ä»‹ç» Proxy ä¹‹å‰ï¼Œå»ºè®®ä½ å¯¹ Reflect æœ‰ä¸€å®šçš„äº†è§£ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª ES6 æ–°å¢çš„å…¨å±€å¯¹è±¡ï¼Œè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ [MDN Reflect](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect)ã€‚\n\n## Basic\n\n```javascript\nconst target = {\n  name: \"Billy Bob\",\n  age: 15\n};\n\nconst handler = {\n  get(target, key, proxy) {\n    const today = new Date();\n    console.log(`GET request made for ${key} at ${today}`);\n\n    return Reflect.get(target, key, proxy);\n  }\n};\n\nconst proxy = new Proxy(target, handler);\nproxy.name;\n// => \"GET request made for name at Thu Jul 21 2016 15:26:20 GMT+0800 (CST)\"\n// => \"Billy Bob\"\n```\n\nåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªè¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ `target`ï¼Œç„¶åå£°æ˜äº†åŒ…å«æ‰€æœ‰ä»£ç†æ“ä½œçš„ `handler` å¯¹è±¡ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨ `Proxy(target, handler)` åˆ›å»ºä»£ç†å¯¹è±¡ `proxy`ï¼Œæ­¤åæ‰€æœ‰ä½¿ç”¨ `proxy` å¯¹ `target` å±æ€§çš„è®¿é—®éƒ½ä¼šç»è¿‡ `handler` çš„å¤„ç†ã€‚\n\n## 1. æŠ½ç¦»æ ¡éªŒæ¨¡å—\n\nè®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ç±»å‹æ ¡éªŒå¼€å§‹åšèµ·ï¼Œè¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Proxy ä¿éšœæ•°æ®ç±»å‹çš„å‡†ç¡®æ€§ï¼š\n\n```javascript\nlet numericDataStore = {\n  count: 0,\n  amount: 1234,\n  total: 14\n};\n\nnumericDataStore = new Proxy(numericDataStore, {\n  set(target, key, value, proxy) {\n    if (typeof value !== \"number\") {\n      throw Error(\"Properties in numericDataStore can only be numbers\");\n    }\n    return Reflect.set(target, key, value, proxy);\n  }\n});\n\n// æŠ›å‡ºé”™è¯¯ï¼Œå› ä¸º \"foo\" ä¸æ˜¯æ•°å€¼\nnumericDataStore.count = \"foo\";\n\n// èµ‹å€¼æˆåŠŸ\nnumericDataStore.count = 333;\n```\n\nå¦‚æœè¦ç›´æ¥ä¸ºå¯¹è±¡çš„æ‰€æœ‰å±æ€§å¼€å‘ä¸€ä¸ªæ ¡éªŒå™¨å¯èƒ½å¾ˆå¿«å°±ä¼šè®©ä»£ç ç»“æ„å˜å¾—è‡ƒè‚¿ï¼Œä½¿ç”¨ Proxy åˆ™å¯ä»¥å°†æ ¡éªŒå™¨ä»æ ¸å¿ƒé€»è¾‘åˆ†ç¦»å‡ºæ¥è‡ªæˆä¸€ä½“ï¼š\n\n```javascript\nfunction createValidator(target, validator) {\n  return new Proxy(target, {\n    _validator: validator,\n    set(target, key, value, proxy) {\n      if (target.hasOwnProperty(key)) {\n        let validator = this._validator[key];\n        if (!!validator(value)) {\n          return Reflect.set(target, key, value, proxy);\n        } else {\n          throw Error(`Cannot set ${key} to ${value}. Invalid.`);\n        }\n      } else {\n        throw Error(`${key} is not a valid property`);\n      }\n    }\n  });\n}\n\nconst personValidators = {\n  name(val) {\n    return typeof val === \"string\";\n  },\n  age(val) {\n    return typeof age === \"number\" && age > 18;\n  }\n};\nclass Person {\n  constructor(name, age) {\n    this.name = name;\n    this.age = age;\n    return createValidator(this, personValidators);\n  }\n}\n\nconst bill = new Person(\"Bill\", 25);\n\n// ä»¥ä¸‹æ“ä½œéƒ½ä¼šæŠ¥é”™\nbill.name = 0;\nbill.age = \"Bill\";\nbill.age = 15;\n```\n\né€šè¿‡æ ¡éªŒå™¨å’Œä¸»é€»è¾‘çš„åˆ†ç¦»ï¼Œä½ å¯ä»¥æ— é™æ‰©å±• `personValidators` æ ¡éªŒå™¨çš„å†…å®¹ï¼Œè€Œä¸ä¼šå¯¹ç›¸å…³çš„ç±»æˆ–å‡½æ•°é€ æˆç›´æ¥ç ´åã€‚æ›´å¤æ‚ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ Proxy æ¨¡æ‹Ÿç±»å‹æ£€æŸ¥ï¼Œæ£€æŸ¥å‡½æ•°æ˜¯å¦æ¥æ”¶äº†ç±»å‹å’Œæ•°é‡éƒ½æ­£ç¡®çš„å‚æ•°ï¼š\n\n```javascript\nlet obj = {\n  pickyMethodOne: function(obj, str, num) {\n    /* ... */\n  },\n  pickyMethodTwo: function(num, obj) {\n    /*... */\n  }\n};\n\nconst argTypes = {\n  pickyMethodOne: [\"object\", \"string\", \"number\"],\n  pickyMethodTwo: [\"number\", \"object\"]\n};\n\nobj = new Proxy(obj, {\n  get: function(target, key, proxy) {\n    var value = target[key];\n    return function(...args) {\n      var checkArgs = argChecker(key, args, argTypes[key]);\n      return Reflect.apply(value, target, args);\n    };\n  }\n});\n\nfunction argChecker(name, args, checkers) {\n  for (var idx = 0; idx < args.length; idx++) {\n    var arg = args[idx];\n    var type = checkers[idx];\n    if (!arg || typeof arg !== type) {\n      console.warn(\n        `You are incorrectly implementing the signature of ${name}. Check param ${idx +\n          1}`\n      );\n    }\n  }\n}\n\nobj.pickyMethodOne();\n// > You are incorrectly implementing the signature of pickyMethodOne. Check param 1\n// > You are incorrectly implementing the signature of pickyMethodOne. Check param 2\n// > You are incorrectly implementing the signature of pickyMethodOne. Check param 3\n\nobj.pickyMethodTwo(\"wopdopadoo\", {});\n// > You are incorrectly implementing the signature of pickyMethodTwo. Check param 1\n\n// No warnings logged\nobj.pickyMethodOne({}, \"a little string\", 123);\nobj.pickyMethodOne(123, {});\n```\n\n## 2. ç§æœ‰å±æ€§\n\nåœ¨ JavaScript æˆ–å…¶ä»–è¯­è¨€ä¸­ï¼Œå¤§å®¶ä¼šçº¦å®šä¿—æˆåœ°åœ¨å˜é‡åä¹‹å‰æ·»åŠ ä¸‹åˆ’çº¿ `_` æ¥è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªç§æœ‰å±æ€§ï¼ˆå¹¶ä¸æ˜¯çœŸæ­£çš„ç§æœ‰ï¼‰ï¼Œä½†æˆ‘ä»¬æ— æ³•ä¿è¯çœŸçš„æ²¡äººä¼šå»è®¿é—®æˆ–ä¿®æ”¹å®ƒã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªç§æœ‰çš„ `apiKey`ï¼Œä¾¿äº `api` è¿™ä¸ªå¯¹è±¡å†…éƒ¨çš„æ–¹æ³•è°ƒç”¨ï¼Œä½†ä¸å¸Œæœ›ä»å¤–éƒ¨ä¹Ÿèƒ½å¤Ÿè®¿é—® `api._apiKey`:\n\n```javascript\nvar api = {\n  _apiKey: \"123abc456def\",\n  /* mock methods that use this._apiKey */\n  getUsers: function() {},\n  getUser: function(userId) {},\n  setUser: function(userId, config) {}\n};\n\n// logs '123abc456def';\nconsole.log(\"An apiKey we want to keep private\", api._apiKey);\n\n// get and mutate _apiKeys as desired\nvar apiKey = api._apiKey;\napi._apiKey = \"987654321\";\n```\n\nå¾ˆæ˜¾ç„¶ï¼Œçº¦å®šä¿—æˆæ˜¯æ²¡æœ‰æŸç¼šåŠ›çš„ã€‚ä½¿ç”¨ ES6 Proxy æˆ‘ä»¬å°±å¯ä»¥å®ç°çœŸå®çš„ç§æœ‰å˜é‡äº†ï¼Œä¸‹é¢é’ˆå¯¹ä¸åŒçš„è¯»å–æ–¹å¼æ¼”ç¤ºä¸¤ä¸ªä¸åŒçš„ç§æœ‰åŒ–æ–¹æ³•ã€‚ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ set / get æ‹¦æˆªè¯»å†™è¯·æ±‚å¹¶è¿”å› `undefined`:\n\n```javascript\nlet api = {\n  _apiKey: \"123abc456def\",\n  getUsers: function() {},\n  getUser: function(userId) {},\n  setUser: function(userId, config) {}\n};\n\nconst RESTRICTED = [\"_apiKey\"];\napi = new Proxy(api, {\n  get(target, key, proxy) {\n    if (RESTRICTED.indexOf(key) > -1) {\n      throw Error(\n        `${key} is restricted. Please see api documentation for further info.`\n      );\n    }\n    return Reflect.get(target, key, proxy);\n  },\n  set(target, key, value, proxy) {\n    if (RESTRICTED.indexOf(key) > -1) {\n      throw Error(\n        `${key} is restricted. Please see api documentation for further info.`\n      );\n    }\n    return Reflect.get(target, key, value, proxy);\n  }\n});\n\n// ä»¥ä¸‹æ“ä½œéƒ½ä¼šæŠ›å‡ºé”™è¯¯\nconsole.log(api._apiKey);\napi._apiKey = \"987654321\";\n```\n\nç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨ `has` æ‹¦æˆª `in` æ“ä½œï¼š\n\n```javascript\nvar api = {\n  _apiKey: \"123abc456def\",\n  getUsers: function() {},\n  getUser: function(userId) {},\n  setUser: function(userId, config) {}\n};\n\nconst RESTRICTED = [\"_apiKey\"];\napi = new Proxy(api, {\n  has(target, key) {\n    return RESTRICTED.indexOf(key) > -1 ? false : Reflect.has(target, key);\n  }\n});\n\n// these log false, and `for in` iterators will ignore _apiKey\nconsole.log(\"_apiKey\" in api);\n\nfor (var key in api) {\n  if (api.hasOwnProperty(key) && key === \"_apiKey\") {\n    console.log(\n      \"This will never be logged because the proxy obscures _apiKey...\"\n    );\n  }\n}\n```\n\n## 3. è®¿é—®æ—¥å¿—\n\nå¯¹äºé‚£äº›è°ƒç”¨é¢‘ç¹ã€è¿è¡Œç¼“æ…¢æˆ–å ç”¨æ‰§è¡Œç¯å¢ƒèµ„æºè¾ƒå¤šçš„å±æ€§æˆ–æ¥å£ï¼Œå¼€å‘è€…ä¼šå¸Œæœ›è®°å½•å®ƒä»¬çš„ä½¿ç”¨æƒ…å†µæˆ–æ€§èƒ½è¡¨ç°ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨ Proxy å……å½“ä¸­é—´ä»¶çš„è§’è‰²ï¼Œè½»è€Œæ˜“ä¸¾å®ç°æ—¥å¿—åŠŸèƒ½ï¼š\n\n```javascript\nlet api = {\n  _apiKey: \"123abc456def\",\n  getUsers: function() {\n    /* ... */\n  },\n  getUser: function(userId) {\n    /* ... */\n  },\n  setUser: function(userId, config) {\n    /* ... */\n  }\n};\n\nfunction logMethodAsync(timestamp, method) {\n  setTimeout(function() {\n    console.log(`${timestamp} - Logging ${method} request asynchronously.`);\n  }, 0);\n}\n\napi = new Proxy(api, {\n  get: function(target, key, proxy) {\n    var value = target[key];\n    return function(...arguments) {\n      logMethodAsync(new Date(), key);\n      return Reflect.apply(value, target, arguments);\n    };\n  }\n});\n\napi.getUsers();\n```\n\n## 4. é¢„è­¦å’Œæ‹¦æˆª\n\nå‡è®¾ä½ ä¸æƒ³è®©å…¶ä»–å¼€å‘è€…åˆ é™¤ `noDelete` å±æ€§ï¼Œè¿˜æƒ³è®©è°ƒç”¨ `oldMethod` çš„å¼€å‘è€…äº†è§£åˆ°è¿™ä¸ªæ–¹æ³•å·²ç»è¢«åºŸå¼ƒäº†ï¼Œæˆ–è€…å‘Šè¯‰å¼€å‘è€…ä¸è¦ä¿®æ”¹ `doNotChange` å±æ€§ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ Proxy æ¥å®ç°ï¼š\n\n```javascript\nlet dataStore = {\n  noDelete: 1235,\n  oldMethod: function() {\n    /*...*/\n  },\n  doNotChange: \"tried and true\"\n};\n\nconst NODELETE = [\"noDelete\"];\nconst NOCHANGE = [\"doNotChange\"];\nconst DEPRECATED = [\"oldMethod\"];\n\ndataStore = new Proxy(dataStore, {\n  set(target, key, value, proxy) {\n    if (NOCHANGE.includes(key)) {\n      throw Error(`Error! ${key} is immutable.`);\n    }\n    return Reflect.set(target, key, value, proxy);\n  },\n  deleteProperty(target, key) {\n    if (NODELETE.includes(key)) {\n      throw Error(`Error! ${key} cannot be deleted.`);\n    }\n    return Reflect.deleteProperty(target, key);\n  },\n  get(target, key, proxy) {\n    if (DEPRECATED.includes(key)) {\n      console.warn(`Warning! ${key} is deprecated.`);\n    }\n    var val = target[key];\n\n    return typeof val === \"function\"\n      ? function(...args) {\n          Reflect.apply(target[key], target, args);\n        }\n      : val;\n  }\n});\n\n// these will throw errors or log warnings, respectively\ndataStore.doNotChange = \"foo\";\ndelete dataStore.noDelete;\ndataStore.oldMethod();\n```\n\n## 5. è¿‡æ»¤æ“ä½œ\n\næŸäº›æ“ä½œä¼šéå¸¸å ç”¨èµ„æºï¼Œæ¯”å¦‚ä¼ è¾“å¤§æ–‡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæ–‡ä»¶å·²ç»åœ¨åˆ†å—å‘é€äº†ï¼Œå°±ä¸éœ€è¦åœ¨å¯¹æ–°çš„è¯·æ±‚ä½œå‡ºç›¸åº”ï¼ˆéç»å¯¹ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨ Proxy å¯¹å½“è¯·æ±‚è¿›è¡Œç‰¹å¾æ£€æµ‹ï¼Œå¹¶æ ¹æ®ç‰¹å¾è¿‡æ»¤å‡ºå“ªäº›æ˜¯ä¸éœ€è¦å“åº”çš„ï¼Œå“ªäº›æ˜¯éœ€è¦å“åº”çš„ã€‚ä¸‹é¢çš„ä»£ç ç®€å•æ¼”ç¤ºäº†è¿‡æ»¤ç‰¹å¾çš„æ–¹å¼ï¼Œå¹¶ä¸æ˜¯å®Œæ•´ä»£ç ï¼Œç›¸ä¿¡å¤§å®¶ä¼šç†è§£å…¶ä¸­çš„å¦™å¤„ï¼š\n\n```javascript\nlet obj = {\n  getGiantFile: function(fileId) {\n    /*...*/\n  }\n};\n\nobj = new Proxy(obj, {\n  get(target, key, proxy) {\n    return function(...args) {\n      const id = args[0];\n      let isEnroute = checkEnroute(id);\n      let isDownloading = checkStatus(id);\n      let cached = getCached(id);\n\n      if (isEnroute || isDownloading) {\n        return false;\n      }\n      if (cached) {\n        return cached;\n      }\n      return Reflect.apply(target[key], target, args);\n    };\n  }\n});\n```\n\n## 6. ä¸­æ–­ä»£ç†\n\nProxy æ”¯æŒéšæ—¶å–æ¶ˆå¯¹ `target` çš„ä»£ç†ï¼Œè¿™ä¸€æ“ä½œå¸¸ç”¨äºå®Œå…¨å°é—­å¯¹æ•°æ®æˆ–æ¥å£çš„è®¿é—®ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `Proxy.revocable` æ–¹æ³•åˆ›å»ºäº†å¯æ’¤é”€ä»£ç†çš„ä»£ç†å¯¹è±¡ï¼š\n\n```javascript\nlet sensitiveData = { username: \"devbryce\" };\nconst { sensitiveData, revokeAccess } = Proxy.revocable(sensitiveData, handler);\nfunction handleSuspectedHack() {\n  revokeAccess();\n}\n\n// logs 'devbryce'\nconsole.log(sensitiveData.username);\nhandleSuspectedHack();\n// TypeError: Revoked\nconsole.log(sensitiveData.username);\n```\n\n## Decorator\n\nES7 ä¸­å®ç°çš„ Decoratorï¼Œç›¸å½“äºè®¾è®¡æ¨¡å¼ä¸­çš„è£…é¥°å™¨æ¨¡å¼ã€‚å¦‚æœç®€å•åœ°åŒºåˆ† Proxy å’Œ Decorator çš„ä½¿ç”¨åœºæ™¯ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸ºï¼šProxy çš„æ ¸å¿ƒä½œç”¨æ˜¯æ§åˆ¶å¤–ç•Œå¯¹è¢«ä»£ç†è€…å†…éƒ¨çš„è®¿é—®ï¼ŒDecorator çš„æ ¸å¿ƒä½œç”¨æ˜¯å¢å¼ºè¢«è£…é¥°è€…çš„åŠŸèƒ½ã€‚åªè¦åœ¨å®ƒä»¬æ ¸å¿ƒçš„ä½¿ç”¨åœºæ™¯ä¸Šåšå¥½åŒºåˆ«ï¼Œé‚£ä¹ˆåƒæ˜¯è®¿é—®æ—¥å¿—è¿™æ ·çš„åŠŸèƒ½ï¼Œè™½ç„¶æœ¬æ–‡ä½¿ç”¨äº† Proxy å®ç°ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ Decorator å®ç°ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®é¡¹ç›®çš„éœ€æ±‚ã€å›¢é˜Ÿçš„è§„èŒƒã€è‡ªå·±çš„åå¥½è‡ªç”±é€‰æ‹©ã€‚\n","tags":["JavaScript","ES6"],"categories":["ES6"]},{"title":"æµè§ˆå™¨ç¼“å­˜æœºåˆ¶","url":"/2018/10/20/æµè§ˆå™¨ç¼“å­˜æœºåˆ¶/","content":"\n# æµè§ˆå™¨ç¼“å­˜æœºåˆ¶\n\n## æ¦‚å¿µ\n\næµè§ˆå™¨ç¼“å­˜ï¼ˆBrowser Cachingï¼‰æ˜¯æµè§ˆå™¨ç«¯ä¿å­˜æ•°æ®ç”¨äºå¿«é€Ÿè¯»å–æˆ–é¿å…é‡å¤èµ„æºè¯·æ±‚çš„ä¼˜åŒ–æœºåˆ¶ï¼Œæœ‰æ•ˆçš„ç¼“å­˜ä½¿ç”¨å¯ä»¥é¿å…é‡å¤çš„ç½‘ç»œè¯·æ±‚å’Œæµè§ˆå™¨å¿«é€Ÿåœ°è¯»å–æœ¬åœ°æ•°æ®ï¼Œæ•´ä½“ä¸ŠåŠ é€Ÿç½‘é¡µå±•ç¤ºç»™ç”¨æˆ·ã€‚ï¼ˆæµè§ˆå™¨ç¼“å­˜åˆ†ä¸ºå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ï¼‰\n\n<!-- more -->\n\n## æµè§ˆå™¨ç¼“å­˜æœºåˆ¶è¦ç´ ï¼š\n\n- æµè§ˆå™¨æ¯æ¬¡å‘èµ·è¯·æ±‚ï¼Œéƒ½ä¼šå…ˆåœ¨æµè§ˆå™¨ç¼“å­˜ä¸­æŸ¥æ‰¾è¯¥è¯·æ±‚çš„ç»“æœä»¥åŠç¼“å­˜æ ‡è¯†ï¼›\n- æµè§ˆå™¨æ¯æ¬¡æ‹¿åˆ°è¿”å›çš„è¯·æ±‚ç»“æœéƒ½ä¼šå°†è¯¥ç»“æœå’Œç¼“å­˜æ ‡è¯†å­˜å…¥æµè§ˆå™¨ç¼“å­˜ä¸­ã€‚\n\n## ä¹ç§æµè§ˆå™¨ç¼“å­˜ï¼š\n\n### http ç¼“å­˜\n\nhttp ç¼“å­˜æ˜¯åŸºäº HTTP åè®®çš„æµè§ˆå™¨æ–‡ä»¶çº§ç¼“å­˜æœºåˆ¶ã€‚å³é’ˆå¯¹æ–‡ä»¶çš„é‡å¤è¯·æ±‚æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨å¯ä»¥æ ¹æ®åè®®å¤´åˆ¤æ–­ä»æœåŠ¡å™¨ç«¯è¯·æ±‚æ–‡ä»¶è¿˜æ˜¯ä»æœ¬åœ°è¯»å–æ–‡ä»¶ã€‚ä¸»è¦æ˜¯é’ˆå¯¹é‡å¤çš„ http è¯·æ±‚ï¼Œåœ¨æœ‰ç¼“å­˜çš„æƒ…å†µä¸‹åˆ¤æ–­è¿‡ç¨‹ä¸»è¦åˆ† 3 æ­¥ï¼šåˆ¤æ–­ expiresï¼Œå¦‚æœæœªè¿‡æœŸï¼Œç›´æ¥è¯»å– http ç¼“å­˜æ–‡ä»¶ï¼Œä¸å‘ http è¯·æ±‚ï¼Œå¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ï¼›åˆ¤æ–­æ˜¯å¦å«æœ‰ etagï¼Œæœ‰åˆ™å¸¦ä¸Š if-none-match å‘é€è¯·æ±‚ï¼Œæœªä¿®æ”¹è¿”å› 304ï¼Œä¿®æ”¹è¿”å› 200ï¼Œå¦åˆ™è¿›å…¥ä¸‹ä¸€æ­¥ï¼›åˆ¤æ–­æ˜¯å¦å«æœ‰ last-modifiedï¼Œæœ‰åˆ™å¸¦ä¸Š if-modified-since å‘é€è¯·æ±‚ï¼Œæ— æ•ˆè¿”å› 200ï¼Œæœ‰æ•ˆè¿”å› 304ï¼Œå¦åˆ™ç›´æ¥å‘æœåŠ¡å™¨è¯·æ±‚\n\n### websql\n\nå®ƒæ˜¯å°†æ•°æ®ä»¥æ•°æ®åº“çš„å½¢å¼å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œæ ¹æ®éœ€æ±‚å»è¯»å–ï¼›è·Ÿ Storage çš„åŒºåˆ«æ˜¯ï¼š Storage å’Œ Cookie éƒ½æ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜åœ¨çš„ã€‚\n\n### indexDB\n\nIndexedDB æ˜¯ä¸€ä¸ªä¸ºäº†èƒ½å¤Ÿåœ¨å®¢æˆ·ç«¯å­˜å‚¨å¯è§‚æ•°é‡çš„ç»“æ„åŒ–æ•°æ®ï¼Œå¹¶ä¸”åœ¨è¿™äº›æ•°æ®ä¸Šä½¿ç”¨ç´¢å¼•è¿›è¡Œé«˜æ€§èƒ½æ£€ç´¢çš„ APIã€‚åŒæ­¥ API æœ¬æ¥æ˜¯è¦ç”¨äºä»…ä¾› Web Workers å†…éƒ¨ä½¿ç”¨ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¢«ä»»ä½•æµè§ˆå™¨æ‰€å®ç°ã€‚å¼‚æ­¥ API åœ¨ Web Workers å†…éƒ¨å’Œå¤–éƒ¨éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå¦å¤–æµè§ˆå™¨å¯èƒ½å¯¹ indexDB æœ‰ 50M å¤§å°çš„é™åˆ¶ï¼Œä¸€èˆ¬ç”¨æˆ·ä¿å­˜å¤§é‡ç”¨æˆ·æ•°æ®å¹¶è¦æ±‚æ•°æ®ä¹‹é—´æœ‰æœç´¢éœ€è¦çš„åœºæ™¯ã€‚\n\n### Cookie\n\næŒ‡ä¸€èˆ¬ç½‘ç«™ä¸ºäº†è¾¨åˆ«ç”¨æˆ·èº«ä»½ã€è¿›è¡Œ session è·Ÿè¸ªè€Œå‚¨å­˜åœ¨ç”¨æˆ·æœ¬åœ°ç»ˆç«¯ä¸Šçš„æ•°æ®ï¼ˆé€šå¸¸ç»è¿‡åŠ å¯†ï¼‰ã€‚cookie ä¸€èˆ¬é€šè¿‡ http è¯·æ±‚ä¸­åœ¨å¤´éƒ¨ä¸€èµ·å‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚ä¸€æ¡ cookie è®°å½•ä¸»è¦ç”±é”®ã€å€¼ã€åŸŸã€è¿‡æœŸæ—¶é—´ã€å¤§å°ç»„æˆï¼Œä¸€èˆ¬ç”¨äºä¿å­˜ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ã€‚cookie æœ€å¤§é•¿åº¦å’ŒåŸŸåä¸ªæ•°ç”±ä¸åŒæµè§ˆå™¨å†³å®šã€‚ä¸åŒåŸŸåä¹‹é—´çš„ cookie ä¿¡æ¯æ˜¯ç‹¬ç«‹çš„ï¼Œå¦‚æœéœ€è¦è®¾ç½®å…±äº«å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è®¾ç½® cookie çš„ path å’Œ domain æ¥å®ç°å…±äº«ã€‚æµè§ˆå™¨ç«¯ä¹Ÿå¯ä»¥é€šè¿‡ document.cookie æ¥è·å– cookieï¼Œå¹¶é€šè¿‡ js æµè§ˆå™¨ç«¯ä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°è¯»å–/è®¾ç½® cookie çš„å€¼ã€‚ï¼ˆCookie åªèƒ½å­˜å‚¨å°‘é‡çš„æ•°æ®ï¼Œæ¯ä¸ª Cookie çš„å¤§å°ä¸è¶…è¿‡ 4KBã€‚RFC æ ‡å‡†ä¸å…è®¸æµè§ˆå™¨ä¿å­˜è¶…è¿‡ 300 ä¸ª Cookieï¼Œä¸ºæ¯ä¸ª web æœåŠ¡å™¨ä¿å­˜çš„ Cookie æ•°ä¸è¶…è¿‡ 20 ä¸ªã€‚JavaScript ä¸­ä½¿ç”¨ Cookie ä¸ä¼šé‡‡ç”¨ä»»ä½•åŠ å¯†æœºåˆ¶ï¼Œå› æ­¤å®ƒä»¬æ˜¯ä¸å®‰å…¨çš„ã€‚ï¼‰\n\n### Localstorage\n\nlocalStorage æ˜¯ html5 çš„ä¸€ç§æ–°çš„æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆï¼Œç›®å‰ç”¨çš„æ¯”è¾ƒå¤šï¼Œä¸€èˆ¬ç”¨æ¥å­˜å‚¨ ajax è¿”å›çš„æ•°æ®ï¼ŒåŠ å¿«ä¸‹æ¬¡é¡µé¢æ‰“å¼€æ—¶çš„æ¸²æŸ“é€Ÿåº¦ã€‚\n\n### Sessionstorage\n\nsessionStorage å’Œ localstorage ç±»ä¼¼ï¼Œä½†æ˜¯æµè§ˆå™¨å…³é—­åˆ™ä¼šå…¨éƒ¨åˆ é™¤ï¼Œapi å’Œ localstorage ç›¸åŒï¼Œå®é™…é¡¹ç›®ä¸­ä½¿ç”¨è¾ƒå°‘ã€‚\n\n### application cache\n\napplication cahce æ˜¯å°†å¤§éƒ¨åˆ†å›¾ç‰‡èµ„æºã€jsã€css ç­‰é™æ€èµ„æºæ”¾åœ¨ manifest æ–‡ä»¶é…ç½®ä¸­ã€‚å½“é¡µé¢æ‰“å¼€æ—¶é€šè¿‡ manifest æ–‡ä»¶æ¥è¯»å–æœ¬åœ°æ–‡ä»¶æˆ–æ˜¯è¯·æ±‚æœåŠ¡å™¨æ–‡ä»¶ã€‚åœ¨çº¿çš„æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨å‘ç° html å¤´éƒ¨æœ‰ manifest å±æ€§ï¼Œå®ƒä¼šè¯·æ±‚ manifest æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è®¿é—® appï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šæ ¹æ® manifest æ–‡ä»¶çš„å†…å®¹ä¸‹è½½ç›¸åº”çš„èµ„æºå¹¶ä¸”è¿›è¡Œç¦»çº¿å­˜å‚¨ã€‚å¦‚æœå·²ç»è®¿é—®è¿‡ app å¹¶ä¸”èµ„æºå·²ç»ç¦»çº¿å­˜å‚¨äº†ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šä½¿ç”¨ç¦»çº¿çš„èµ„æºåŠ è½½é¡µé¢ï¼Œç„¶åæµè§ˆå™¨ä¼šå¯¹æ¯”æ–°çš„ manifest æ–‡ä»¶ä¸æ—§çš„ manifest æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œå°±ä¸åšä»»ä½•æ“ä½œï¼Œå¦‚æœæ–‡ä»¶æ”¹å˜äº†ï¼Œé‚£ä¹ˆå°±ä¼šé‡æ–°ä¸‹è½½æ–‡ä»¶ä¸­çš„èµ„æºå¹¶è¿›è¡Œç¦»çº¿å­˜å‚¨ã€‚å¹¶åœ¨ä¸‹ä¸€æ¬¡ç”Ÿæ•ˆã€‚ç¦»çº¿çš„æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨å°±ç›´æ¥ä½¿ç”¨ç¦»çº¿å­˜å‚¨çš„èµ„æºã€‚\n\n### cacheStorage\n\nCacheStorage æ˜¯åœ¨ ServiceWorker çš„è§„èŒƒä¸­å®šä¹‰çš„ã€‚CacheStorage å¯ä»¥ä¿å­˜æ¯ä¸ª serverWorker ç”³æ˜çš„ cache å¯¹è±¡ï¼ŒcacheStorage æœ‰ openã€matchã€hasã€deleteã€keys äº”ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œå¯ä»¥å¯¹ cache å¯¹è±¡çš„ä¸åŒåŒ¹é…è¿›è¡Œä¸åŒçš„å“åº”ã€‚\n\n### flash ç¼“å­˜\n\nè¿™ç§æ–¹å¼åŸºæœ¬ä¸ç”¨ï¼Œè¿™ä¸€æ–¹æ³•ä¸»è¦åŸºäº flash æœ‰è¯»å†™æµè§ˆå™¨ç«¯æœ¬åœ°ç›®å½•çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å‘ js æä¾›è°ƒç”¨çš„ apiï¼Œåˆ™é¡µé¢å¯ä»¥é€šè¿‡ js è°ƒç”¨ flash å»è¯»å†™ç‰¹å®šçš„ç£ç›˜ç›®å½•ï¼Œè¾¾åˆ°æœ¬åœ°æ•°æ®ç¼“å­˜çš„ç›®çš„ã€‚\n\n## cookie\n\n1. èƒŒæ™¯ï¼šæ—©æœŸ Web å¼€å‘é¢ä¸´çš„æœ€å¤§é—®é¢˜ä¹‹ä¸€æ˜¯å¦‚ä½•ç®¡ç†çŠ¶æ€ã€‚ç®€è¨€ä¹‹ï¼ŒæœåŠ¡å™¨ç«¯æ²¡æœ‰åŠæ³•çŸ¥é“ä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªäºåŒä¸€ä¸ªæµè§ˆå™¨ã€‚é‚£æ—¶çš„åŠæ³•æ˜¯åœ¨è¯·æ±‚çš„é¡µé¢ä¸­æ’å…¥ä¸€ä¸ª tokenï¼Œå¹¶ä¸”åœ¨ä¸‹ä¸€æ¬¡è¯·æ±‚ä¸­å°†è¿™ä¸ª token è¿”å›ï¼ˆè‡³æœåŠ¡å™¨ï¼‰ã€‚è¿™å°±éœ€è¦åœ¨ form ä¸­æ’å…¥ä¸€ä¸ªåŒ…å« token çš„éšè—è¡¨å•åŸŸï¼Œæˆ–ç€åœ¨ URL çš„ qurey å­—ç¬¦ä¸²ä¸­ä¼ é€’è¯¥ tokenã€‚è¿™ä¸¤ç§åŠæ³•éƒ½å¼ºè°ƒæ‰‹å·¥æ“ä½œå¹¶ä¸”ææ˜“å‡ºé”™ã€‚\n2. å†…å®¹ï¼šé”®ã€å€¼ã€åŸŸã€è¿‡æœŸæ—¶é—´ã€å¤§å°\n3. æ˜¯å¦ç”Ÿæ•ˆï¼šexpires æŒ‡å®šäº† cookie ä½•æ—¶ä¸ä¼šå†è¢«å‘é€åˆ°æœåŠ¡å™¨ç«¯çš„ï¼Œå› æ­¤è¯¥ cookie å¯èƒ½ä¼šè¢«æµè§ˆå™¨åˆ æ‰ã€‚ï¼ˆè¿‡æœŸæ—¶é—´ï¼‰åœ¨æ²¡æœ‰ expires é€‰é¡¹æ—¶ï¼Œcookie çš„å¯¿å‘½ä»…é™äºå•ä¸€çš„ä¼šè¯ä¸­ã€‚æµè§ˆå™¨çš„å…³é—­æ„å‘³è¿™ä¸€æ¬¡ä¼šè¯çš„ç»“æŸï¼Œæ‰€ä»¥ä¼šè¯ cookie åªå­˜åœ¨äºæµè§ˆå™¨ä¿æŒæ‰“å¼€çš„çŠ¶æ€ä¹‹ä¸‹ã€‚å¦‚æœ expires é€‰é¡¹è®¾ç½®äº†ä¸€ä¸ªè¿‡å»çš„æ—¶é—´ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ª cookie ä¼šè¢«ç«‹å³åˆ é™¤ã€‚\n4. å­˜åœ¨å“ªé‡Œï¼šcookie çš„å€¼è¢«å­˜å‚¨åœ¨åä¸º Cookie çš„ HTTP æ¶ˆæ¯å¤´ä¸­ï¼Œå¹¶ä¸”åªåŒ…å«äº† cookie çš„å€¼ï¼Œå…¶å®ƒçš„é€‰é¡¹å…¨éƒ¨è¢«å»é™¤ã€‚\n5. å­˜æ”¾å½¢å¼ï¼šCookies æ˜¯çº¯æ–‡æœ¬å½¢å¼ã€‚å‡ ä¹æ‰€æœ‰çš„å®ç°æ–¹å¼éƒ½å¯¹ cookie çš„å€¼è¿›è¡Œäº†ä¸€äº›åˆ—çš„ URL ç¼–ç ï¼ˆä½†ä¸æ˜¯å¿…é¡»ï¼‰ã€‚åŸå§‹çš„æ–‡æ¡£ä¸­æŒ‡ç¤ºä»…æœ‰ä¸‰ç§ç±»å‹çš„å­—ç¬¦å¿…é¡»è¿›è¡Œç¼–ç ï¼šåˆ†å·ï¼Œé€—å·ï¼Œå’Œç©ºæ ¼ã€‚\n6. ä¸åŒåŸŸåä¹‹é—´çš„ cookie ä¿¡æ¯æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šå†²çªã€‚æµè§ˆå™¨ä¼šå¯¹ domain çš„å€¼ä¸è¯·æ±‚æ‰€è¦å‘é€è‡³çš„åŸŸåï¼Œåšä¸€ä¸ªå°¾éƒ¨æ¯”è¾ƒï¼ˆå³ä»å­—ç¬¦ä¸²çš„å°¾éƒ¨å¼€å§‹æ¯”è¾ƒï¼‰ï¼Œå¹¶ä¸”åœ¨åŒ¹é…åå‘é€ä¸€ä¸ª Cookie æ¶ˆæ¯å¤´ã€‚domain è®¾ç½®çš„å€¼å¿…é¡»æ˜¯å‘é€ Set-Cookie æ¶ˆæ¯å¤´çš„åŸŸåã€‚ä¸ domain é€‰é¡¹ç›¸åŒçš„æ˜¯ï¼Œpath æŒ‡æ˜äº†åœ¨å‘ Cookie æ¶ˆæ¯å¤´ä¹‹å‰å¿…é¡»åœ¨è¯·æ±‚èµ„æºä¸­å­˜åœ¨ä¸€ä¸ª URL è·¯å¾„ã€‚è¿™ä¸ªæ¯”è¾ƒæ˜¯é€šè¿‡å°† path å±æ€§å€¼ä¸è¯·æ±‚çš„ URL ä»å¤´å¼€å§‹é€å­—ç¬¦ä¸²æ¯”è¾ƒå®Œæˆçš„ã€‚å¦‚æœå­—ç¬¦åŒ¹é…ï¼Œåˆ™å‘é€ Cookie æ¶ˆæ¯å¤´ã€‚åªæœ‰åœ¨ domain é€‰é¡¹æ ¸å®å®Œæ¯•ä¹‹åæ‰ä¼šå¯¹ path å±æ€§è¿›è¡Œæ¯”è¾ƒã€‚path å±æ€§çš„é»˜è®¤å€¼æ˜¯å‘é€ Set-Cookie æ¶ˆæ¯å¤´æ‰€å¯¹åº”çš„ URL ä¸­çš„ path éƒ¨åˆ†ã€‚path å€¼è¶Šè¯¦ç»†åˆ™ cookie è¶Šé å‰ã€‚domain-path è¶Šè¯¦ç»†åˆ™ cookie å­—ç¬¦ä¸²è¶Šé å‰ã€‚å¯ä»¥é€šè¿‡è®¾ç½® Cookie çš„ path å±æ€§æ¥ä¿®æ”¹ Cookie çš„ä½œç”¨åŸŸï¼Œå¦‚æœæŠŠ path è®¾ä¸ºâ€œ/â€ï¼Œå°±ç­‰åŒäºè®© Cookie æ‹¥æœ‰äº† localStorage çš„ä½œç”¨åŸŸï¼Œå³æ•´ä¸ªæ–‡æ¡£æºã€‚\n7. é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookie å¯¹äºåˆ›å»ºå®ƒçš„é¡µé¢ï¼Œä»¥åŠä¸è¯¥é¡µé¢åŒç›®å½•æˆ–å­ç›®å½•ä¸‹çš„å…¶ä»– web é¡µé¢å¯è§ã€‚åœ¨ a.example.com ä¸‹çš„ä¸€ä¸ªé¡µé¢è®¾ç½®äº† Cookieï¼Œå°†å…¶ path è®¾ä¸ºâ€œ/â€ï¼Œå¹¶å°† domain è®¾ä¸ºâ€œ.example.comâ€ï¼Œè¿™æ ·è¯¥ Cookie å°±å¯¹ example.com åŸŸä¸‹çš„æ‰€æœ‰é¡µé¢å¯è§ã€‚\n8. åˆ›å»ºå’Œå­˜å‚¨ Cookieï¼šå¯¹ Cookie çš„æ‰€æœ‰æ“ä½œéƒ½è¦é€šè¿‡è¯»å†™ document å¯¹è±¡çš„ Cookie å±æ€§æ¥å®Œæˆã€‚Cookie çš„å€¼éƒ½æ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨ã€‚åŒæ ·çš„ï¼Œå¦‚æœè¦è®¾ç½® pathã€domain ç­‰å±æ€§ï¼Œåªé¡»ä»¥å¦‚ä¸‹å½¢å¼è¿½åŠ åˆ° Cookie å€¼çš„åé¢:ã€€;path=path\n\n```javascript\n//åˆ›å»ºä¸€ä¸ªåå­—Cookieï¼ŒåŒæ—¶è®¾ç½®å®ƒçš„è¿‡æœŸæ—¶é—´\nfunction setCookie(c_name, value, expiredays) {\n  var exdate = new Date();\n  exdate.setDate(exdate.getDate() + expiredays);\n  //encodeURIComponent() å¯¹ URI è¿›è¡Œç¼–ç \n  document.cookie =\n    c_name +\n    \"=\" +\n    encodeURIComponent(value) +\n    (expiredays == null ? \"\" : \";expires=\" + exdate.toGMTString());\n}\n```\n\n9. è¯»å– Cookieï¼šä½¿ç”¨ document.cookie å¯ä»¥è·å–åˆ° Cookie çš„å€¼ï¼Œä¸è¿‡è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸ºäº†æ›´å¥½åœ°æŸ¥çœ‹ Cookie çš„å€¼ï¼Œå¾€å¾€ä¼šé‡‡ç”¨ split()æ–¹æ³•å°† Cookie ä¸­çš„åå€¼å¯¹åˆ†ç¦»å‡ºæ¥ã€‚\n\n```javascript\nfunction getCookie() {\n  // åˆå§‹åŒ–è¦è¿”å›çš„å¯¹è±¡\n  var cookie = {};\n  var all = document.cookie;\n  if (all === null) {\n    return cookie;\n  }\n  //åˆ†ç¦»å‡ºCookieçš„å„ä¸ªå±æ€§\n  var list = all.split(\";\");\n  for (var i = 0; i < list.length; i++) {\n    // æŸ¥è¯¢å‡ºç­‰å·æ‰€åœ¨çš„ä½ç½®\n    var p = list[i].indexOf(\"=\");\n    // åˆ†ç¦»å‡ºåå­—å’Œå€¼\n    var name = list[i].substring(0, p);\n    var value = list[i].substring(p + 1);\n    //å¯¹å€¼è¿›è¡Œè§£ç \n    value = decodeURIComponent(value);\n    // å°†åå€¼å¯¹å­˜å‚¨åˆ°å¯¹è±¡ä¸­\n    cookie[name] = value;\n  }\n  return cookie;\n}\n```\n\n## Localstorage å’Œ sessionstorage\n\nLocalstorage å’Œ sessionstorage æ˜¯åšä»€ä¹ˆçš„ï¼Ÿlocalstorage æ€ä¹ˆæ¸…é™¤å®ƒï¼Ÿåœ¨ä»£ç å±‚é¢æ€ä¹ˆæ¸…é™¤ï¼Ÿsetitem çš„æ˜¯ä»€ä¹ˆæ•°æ®ç±»å‹ï¼Ÿgetitem çš„å€¼æ˜¯ä»€ä¹ˆæ•°æ®ç±»å‹ï¼Ÿ\n\n- æ€ä¹ˆæ¸…é™¤\n\n```javascript\nlocalStorage.removeItem(key); //åˆ é™¤è¯¥åŸŸåä¸‹å•æ¡è®°å½•\nlocalStorage.clear(); //åˆ é™¤è¯¥åŸŸåä¸‹æ‰€æœ‰è®°å½•\n```\n\n- å­˜å‚¨æ ¼å¼ï¼šæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ä»¥æ–‡æœ¬æ ¼å¼ä¿å­˜ã€‚å…¶ä¸­ value éœ€ä¸ºå¯è½¬åŒ–ä¸ºå­—ç¬¦ä¸²çš„å¯¹è±¡ã€‚localStorage å¯¹è±¡çš„é”®å’Œå€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œå‡è®¾æˆ‘ä»¬è¦ä¿å­˜ä¸€ä¸ªå¯¹è±¡åˆ° localStorage ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ‹¼æ¥çš„æ–¹å¼ã€‚å½“ç„¶ä¹Ÿå¯ä»¥å€ŸåŠ© JSON ç±»ï¼Œå°†å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²ä¿å­˜ï¼Œç„¶ååœ¨å–å‡ºæ¥çš„æ—¶å€™å°† json å­—ç¬¦ä¸²è½¬æ¢æˆçœŸæ­£å¯ç”¨çš„ json å¯¹è±¡æ ¼å¼\n- æ•°æ®å…±äº«ï¼šä¸åŒæµè§ˆå™¨æ— æ³•å…±äº« localStorage æˆ– sessionStorage ä¸­çš„ä¿¡æ¯ã€‚ç›¸åŒæµè§ˆå™¨çš„ä¸åŒé¡µé¢é—´å¯ä»¥å…±äº«ç›¸åŒçš„ localStorageï¼ˆé¡µé¢å±äºç›¸åŒåŸŸåå’Œç«¯å£ï¼‰ï¼Œä½†æ˜¯ä¸åŒé¡µé¢æˆ–æ ‡ç­¾é¡µé—´æ— æ³•å…±äº« sessionStorage çš„ä¿¡æ¯ã€‚\n","tags":["æµè§ˆå™¨","ç¼“å­˜"],"categories":["æµè§ˆå™¨"]},{"title":"ç®­å¤´å‡½æ•°","url":"/2018/10/14/ç®­å¤´å‡½æ•°/","content":"\n# åŸºæœ¬ç”¨æ³•\n\nES6 å…è®¸ä½¿ç”¨â€œç®­å¤´â€ï¼ˆ=>ï¼‰å®šä¹‰å‡½æ•°ã€‚\n\n<!-- more -->\n\n```javascript\nvar f = v => v;\n\n// ç­‰åŒäº\nvar f = function(v) {\n  return v;\n};\n```\n\n## å‚æ•°éƒ¨åˆ†\n\nå¦‚æœç®­å¤´å‡½æ•°ä¸éœ€è¦å‚æ•°æˆ–éœ€è¦å¤šä¸ªå‚æ•°ï¼Œå°±ä½¿ç”¨ä¸€ä¸ªåœ†æ‹¬å·ä»£è¡¨å‚æ•°éƒ¨åˆ†ã€‚\n\n```javascript\nvar f = () => 5;\n// ç­‰åŒäº\nvar f = function() {\n  return 5;\n};\n\nvar sum = (num1, num2) => num1 + num2;\n// ç­‰åŒäº\nvar sum = function(num1, num2) {\n  return num1 + num2;\n};\n```\n\nå¦‚æœç®­å¤´å‡½æ•°çš„ä»£ç å—éƒ¨åˆ†å¤šäºä¸€æ¡è¯­å¥ï¼Œå°±è¦ä½¿ç”¨å¤§æ‹¬å·å°†å®ƒä»¬æ‹¬èµ·æ¥ï¼Œå¹¶ä¸”ä½¿ç”¨ return è¯­å¥è¿”å›ã€‚\n\n```javascript\nvar sum = (num1, num2) => {\n  return num1 + num2;\n};\n```\n\n## è¿”å›å¯¹è±¡\n\nç”±äºå¤§æ‹¬å·è¢«è§£é‡Šä¸ºä»£ç å—ï¼Œæ‰€ä»¥å¦‚æœç®­å¤´å‡½æ•°ç›´æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»åœ¨å¯¹è±¡å¤–é¢åŠ ä¸Šæ‹¬å·ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚\n\n```javascript\n// æŠ¥é”™\nlet getTempItem = id => { id: id, name: \"Temp\" };\n\n// ä¸æŠ¥é”™\nlet getTempItem = id => ({ id: id, name: \"Temp\" });\n```\n\nä¸‹é¢æ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œè™½ç„¶å¯ä»¥è¿è¡Œï¼Œä½†ä¼šå¾—åˆ°é”™è¯¯çš„ç»“æœã€‚\n\n```javascript\nlet foo = () => {\n  a: 1;\n};\nfoo(); // undefined\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼ŒåŸå§‹æ„å›¾æ˜¯è¿”å›ä¸€ä¸ªå¯¹è±¡{ a: 1 }ï¼Œä½†æ˜¯ç”±äºå¼•æ“è®¤ä¸ºå¤§æ‹¬å·æ˜¯ä»£ç å—ï¼Œæ‰€ä»¥æ‰§è¡Œäº†ä¸€è¡Œè¯­å¥ a: 1ã€‚è¿™æ—¶ï¼Œa å¯ä»¥è¢«è§£é‡Šä¸ºè¯­å¥çš„æ ‡ç­¾ï¼Œå› æ­¤å®é™…æ‰§è¡Œçš„è¯­å¥æ˜¯ 1;ï¼Œç„¶åå‡½æ•°å°±ç»“æŸäº†ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚\nç®­å¤´å‡½æ•°å¯ä»¥ä¸å˜é‡è§£æ„ç»“åˆä½¿ç”¨ã€‚\n\n```javascript\nconst full = ({ first, last }) => first + \" \" + last;\n\n// ç­‰åŒäº\nfunction full(person) {\n  return person.first + \" \" + person.last;\n}\n```\n\n## ç®€åŒ–å›è°ƒå‡½æ•°\n\nç®­å¤´å‡½æ•°çš„ä¸€ä¸ªç”¨å¤„æ˜¯ç®€åŒ–å›è°ƒå‡½æ•°ã€‚\n\n```javascript\n// æ­£å¸¸å‡½æ•°å†™æ³•\n[1, 2, 3].map(function(x) {\n  return x * x;\n});\n\n// ç®­å¤´å‡½æ•°å†™æ³•\n[1, 2, 3].map(x => x * x);\n```\n\n## rest å‚æ•°ä¸ç®­å¤´å‡½æ•°ç»“åˆ\n\n```javascript\nconst numbers = (...nums) => nums;\n\nnumbers(1, 2, 3, 4, 5);\n// [1,2,3,4,5]\n\nconst headAndTail = (head, ...tail) => [head, tail];\n\nheadAndTail(1, 2, 3, 4, 5);\n// [1,[2,3,4,5]]\n```\n\n# ä½¿ç”¨æ³¨æ„ç‚¹\n\nç®­å¤´å‡½æ•°æœ‰å‡ ä¸ªä½¿ç”¨æ³¨æ„ç‚¹ã€‚\n\n1. å‡½æ•°ä½“å†…çš„ this å¯¹è±¡ï¼Œå°±æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ—¶æ‰€åœ¨çš„å¯¹è±¡ã€‚\n2. ä¸å¯ä»¥å½“ä½œæ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯ä»¥ä½¿ç”¨ new å‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚\n3. ä¸å¯ä»¥ä½¿ç”¨ arguments å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åœ¨å‡½æ•°ä½“å†…ä¸å­˜åœ¨ã€‚å¦‚æœè¦ç”¨ï¼Œå¯ä»¥ç”¨ rest å‚æ•°ä»£æ›¿ã€‚\n4. ä¸å¯ä»¥ä½¿ç”¨ yield å‘½ä»¤ï¼Œå› æ­¤ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œ Generator å‡½æ•°ã€‚\n   ä¸Šé¢å››ç‚¹ä¸­ï¼Œç¬¬ä¸€ç‚¹å°¤å…¶å€¼å¾—æ³¨æ„ã€‚this å¯¹è±¡çš„æŒ‡å‘æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯åœ¨ç®­å¤´å‡½æ•°ä¸­ï¼Œå®ƒæ˜¯å›ºå®šçš„ã€‚\n\n```javascript\nfunction foo() {\n  setTimeout(() => {\n    console.log(\"id:\", this.id);\n  }, 100);\n}\n\nvar id = 21;\n\nfoo.call({ id: 42 });\n// id: 42\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼ŒsetTimeout çš„å‚æ•°æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°ï¼Œè¿™ä¸ªç®­å¤´å‡½æ•°çš„å®šä¹‰ç”Ÿæ•ˆæ˜¯åœ¨ foo å‡½æ•°ç”Ÿæˆæ—¶ï¼Œè€Œå®ƒçš„çœŸæ­£æ‰§è¡Œè¦ç­‰åˆ° 100 æ¯«ç§’åã€‚å¦‚æœæ˜¯æ™®é€šå‡½æ•°ï¼Œæ‰§è¡Œæ—¶ this åº”è¯¥æŒ‡å‘å…¨å±€å¯¹è±¡ windowï¼Œè¿™æ—¶åº”è¯¥è¾“å‡º 21ã€‚ä½†æ˜¯ï¼Œç®­å¤´å‡½æ•°å¯¼è‡´ this æ€»æ˜¯æŒ‡å‘å‡½æ•°å®šä¹‰ç”Ÿæ•ˆæ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼ˆæœ¬ä¾‹æ˜¯{id: 42}ï¼‰ï¼Œæ‰€ä»¥è¾“å‡ºçš„æ˜¯ 42ã€‚\n\n# åµŒå¥—çš„ç®­å¤´å‡½æ•°\n\nç®­å¤´å‡½æ•°å†…éƒ¨ï¼Œè¿˜å¯ä»¥å†ä½¿ç”¨ç®­å¤´å‡½æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª ES5 è¯­æ³•çš„å¤šé‡åµŒå¥—å‡½æ•°ã€‚\n\n```javascript\nfunction insert(value) {\n  return {\n    into: function(array) {\n      return {\n        after: function(afterValue) {\n          array.splice(array.indexOf(afterValue) + 1, 0, value);\n          return array;\n        }\n      };\n    }\n  };\n}\n\ninsert(2)\n  .into([1, 3])\n  .after(1); //[1, 2, 3]\n\n//ä½¿ç”¨ç®­å¤´å‡½æ•°æ”¹å†™\nlet insert = value => ({\n  into: array => ({\n    after: afterValue => {\n      array.splice(array.indexOf(afterValue) + 1, 0, value);\n      return array;\n    }\n  })\n});\n\ninsert(2)\n  .into([1, 3])\n  .after(1); //[1, 2, 3]\n```\n\n# æ”¹å†™ Î» æ¼”ç®—\n\n```javascript\n// Î»æ¼”ç®—çš„å†™æ³•\nfix = Î»f.(Î»x.f(Î»v.x(x)(v)))(Î»x.f(Î»v.x(x)(v)))\n\n// ES6çš„å†™æ³•\nvar fix = f => (x => f(v => x(x)(v)))\n               (x => f(v => x(x)(v)));\n```\n","tags":["JavaScript","ES6"],"categories":["ES6"]},{"title":"thiså’Œsuperå…³é”®å­—","url":"/2018/09/24/thiså’Œsuperå…³é”®å­—/","content":"\n# this å…³é”®å­—\n\nthis çš„æŒ‡å‘ï¼š\n\n## ä½œä¸ºæ™®é€šå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨\n\nä½œä¸ºæ™®é€šå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æ—¶ï¼Œthis æŒ‡å‘è¿™ä¸ªå¯¹è±¡æœ¬èº«\n\n<!-- more -->\n\n```javascript\nvar obj = {\n  a: 1,\n  getA: function() {\n    console.log(this === obj);\n    console.log(this.a);\n  }\n};\n\n//thisæŒ‡å‘objå¯¹è±¡\nobj.getA();\n```\n\n## ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨\n\nä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨æ—¶ï¼Œthis æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ä¸­å…¨å±€å¯¹è±¡æ˜¯ windowï¼Œåœ¨ NodeJs ä¸­å…¨å±€å¯¹è±¡æ˜¯ globalã€‚\n\n```javascript\nvar obj = {\n  a: 1,\n  getA: function() {\n    console.log(this === obj);\n    console.log(this.a);\n  }\n};\n\n//thisæŒ‡å‘windowå¯¹è±¡\nvar getA = obj.getA;\ngetA();\n```\n\nè¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œç›´æ¥è°ƒç”¨å¹¶ä¸æ˜¯æŒ‡åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹è¿›è¡Œè°ƒç”¨ï¼Œåœ¨ä»»ä½•ä½œç”¨åŸŸä¸‹ï¼Œç›´æ¥é€šè¿‡ å‡½æ•°å(...) æ¥å¯¹å‡½æ•°è¿›è¡Œè°ƒç”¨çš„æ–¹å¼ï¼Œéƒ½ç§°ä¸ºç›´æ¥è°ƒç”¨ã€‚\n\n## æ„é€ å™¨è°ƒç”¨\n\næ„é€ å™¨è°ƒç”¨æ—¶ï¼Œthis æŒ‡å‘è¿”å›çš„å¯¹è±¡ã€‚ç”¨ new è°ƒç”¨ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œå…¶ä¸­çš„ this å°±æŒ‡å‘è¿™ä¸ªæ–°å¯¹è±¡ã€‚\n\n```javascript\nvar a = 10;\nvar b = 20;\nfunction Point(x, y) {\n  this.x = x;\n  this.y = y;\n}\n\nvar a = new Point(1, 2);\nconsole.log(a.x); // 1\nconsole.log(x); // 10\n\nvar b = new Point(1, 2);\nconsole.log(a === b); // false\n```\n\n## call apply bind\n\nå½“å‡½æ•°é€šè¿‡ call()å’Œ apply()æ–¹æ³•ç»‘å®šæ—¶ï¼Œthis æŒ‡å‘ä¸¤ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯¹è±¡ä¸Šï¼Œè‹¥ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯å¯¹è±¡ï¼ŒJS å†…éƒ¨ä¼šå°è¯•å°†å…¶è½¬åŒ–ä¸ºå¯¹è±¡ç„¶åå†æŒ‡å‘å®ƒã€‚\né€šè¿‡ bind æ–¹æ³•ç»‘å®šåï¼Œæ— è®ºå…¶åœ¨ä»€ä¹ˆæƒ…å†µä¸‹è¢«è°ƒç”¨ï¼Œå‡½æ•°å°†è¢«æ°¸è¿œç»‘å®šåœ¨å…¶ç¬¬ä¸€ä¸ªå‚æ•°å¯¹è±¡ä¸Šï¼Œbind ç»‘å®šåè¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚\n\n### call, apply çš„ç”¨é€”\n\n1. æ”¹å˜ this çš„æŒ‡å‘\n2. Function.prototype.bind\n\n```javascript\nFunction.prototype.bind = function() {\n  var self = this;\n  var context = [].shift.call(arguments);\n  var args = [].slice.call(arguments);\n  return function() {\n    return self.apply(context, args.concat([].slice.call(arguments)));\n  };\n};\n```\n\n### ä¸‰è€…åŒºåˆ«\n\ncall åªèƒ½ä¸€ä¸ªä¸€ä¸ªä¼ å…¥å‚æ•°\napply å¯ç›´æ¥ä¼ å…¥å‚æ•°æ•°ç»„\nbind ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°\n\n# super å…³é”®å­—\n\nå…³é”®å­— superï¼ŒæŒ‡å‘å½“å‰å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚\n\n```javascript\nconst proto = {\n  foo: \"hello\"\n};\n\nconst obj = {\n  foo: \"world\",\n  find() {\n    return super.foo;\n  }\n};\n\nObject.setPrototypeOf(obj, proto);\nobj.find(); // \"hello\"\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œå¯¹è±¡ obj çš„ find æ–¹æ³•ä¹‹ä¸­ï¼Œé€šè¿‡ super.foo å¼•ç”¨äº†åŸå‹å¯¹è±¡ proto çš„ foo å±æ€§ã€‚\næ³¨æ„ï¼Œsuper å…³é”®å­—è¡¨ç¤ºåŸå‹å¯¹è±¡æ—¶ï¼Œåªèƒ½ç”¨åœ¨å¯¹è±¡çš„æ–¹æ³•ä¹‹ä¸­ï¼Œç”¨åœ¨å…¶ä»–åœ°æ–¹éƒ½ä¼šæŠ¥é”™ã€‚\n\n```javascript\n// æŠ¥é”™\nconst obj = {\n  foo: super.foo\n};\n\n// æŠ¥é”™\nconst obj = {\n  foo: () => super.foo\n};\n\n// æŠ¥é”™\nconst obj = {\n  foo: function() {\n    return super.foo;\n  }\n};\n```\n\nä¸Šé¢ä¸‰ç§ super çš„ç”¨æ³•éƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºå¯¹äº JavaScript å¼•æ“æ¥è¯´ï¼Œè¿™é‡Œçš„ super éƒ½æ²¡æœ‰ç”¨åœ¨å¯¹è±¡çš„æ–¹æ³•ä¹‹ä¸­ã€‚ç¬¬ä¸€ç§å†™æ³•æ˜¯ super ç”¨åœ¨å±æ€§é‡Œé¢ï¼Œç¬¬äºŒç§å’Œç¬¬ä¸‰ç§å†™æ³•æ˜¯ super ç”¨åœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œç„¶åèµ‹å€¼ç»™ foo å±æ€§ã€‚ç›®å‰ï¼Œåªæœ‰å¯¹è±¡æ–¹æ³•çš„ç®€å†™æ³•å¯ä»¥è®© JavaScript å¼•æ“ç¡®è®¤ï¼Œå®šä¹‰çš„æ˜¯å¯¹è±¡çš„æ–¹æ³•ã€‚\nJavaScript å¼•æ“å†…éƒ¨ï¼Œsuper.foo ç­‰åŒäº Object.getPrototypeOf(this).fooï¼ˆå±æ€§ï¼‰æˆ– Object.getPrototypeOf(this).foo.call(this)ï¼ˆæ–¹æ³•ï¼‰ã€‚\n\n```javascript\nconst proto = {\n  x: \"hello\",\n  foo() {\n    console.log(this.x);\n  }\n};\n\nconst obj = {\n  x: \"world\",\n  foo() {\n    super.foo();\n  }\n};\n\nObject.setPrototypeOf(obj, proto);\n\nobj.foo(); // \"world\"\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œsuper.foo æŒ‡å‘åŸå‹å¯¹è±¡ proto çš„ foo æ–¹æ³•ï¼Œä½†æ˜¯ç»‘å®šçš„ this å´è¿˜æ˜¯å½“å‰å¯¹è±¡ objï¼Œå› æ­¤è¾“å‡ºçš„å°±æ˜¯ worldã€‚\n","tags":["JavaScript","ES6"],"categories":["ES6"]},{"title":"å¸¸ç”¨gitå‘½ä»¤","url":"/2018/09/16/å¸¸ç”¨gitå‘½ä»¤/","content":"# å¸¸ç”¨gitå‘½ä»¤\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6j61mtymjj31e80qu3yu.jpg)\nçº¢è‰²ä»£è¡¨å·¥ä½œåŒºï¼Œç»¿è‰²ä»£è¡¨æš‚å­˜åŒº\n\n## æ–‡ä»¶æ“ä½œ\n\n1. git init  \n   åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª git ä»“åº“ï¼ˆmaster åˆ†æ”¯ï¼‰\n   git init [project-name]\n   æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œå°†å…¶åˆå§‹åŒ–ä¸º git ä»“åº“\n\n   <!-- more -->\n\n2. git status æŸ¥çœ‹çŠ¶æ€\n   â€œ.â€ ä»£è¡¨æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶\n\n3. git add [file1][file2]  \n   æ·»åŠ æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒº\n\n4. git commit\n   åœ¨ç¬¬ä¸€è¡Œå†™å…¥è¿™æ¬¡ä¿®æ”¹è®°å½•ã€‚å°†ç¼“å­˜åŒºæ–‡ä»¶æ”¾å…¥æäº¤åŒºã€‚\n   git commit -m ['message']\n   git commit -amend\n   ä¿®æ”¹ä¸Šæ¬¡è®°å½•ä¿¡æ¯\n\n5. git log\n   æŸ¥çœ‹æäº¤è®°å½•\n   vim ~/.zshrc é…ç½®æ–‡ä»¶ä¸­å¯è‡ªå®šä¹‰æ“ä½œ\n   source ~/.zshrc ä¿®æ”¹é…ç½®æ–‡ä»¶å source ä¿å­˜ç”Ÿæ•ˆ\n\n6. git config\n   æŸ¥çœ‹å½“å‰ git é…ç½®\n   git config -h\n   æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯\n   vim ~/.gitconfig è‡ªå®šä¹‰ git å‘½ä»¤ï¼Œä¿®æ”¹ä¸ªäººåå­—é‚®ç®±ç­‰ä¿¡æ¯\n   cat .git/config æœ¬åœ°é…ç½®\n\n7. touch .gitignore å¿½ç•¥ä¸€äº›æ–‡ä»¶\n\n```javascript\n .vscode\n node_modules\n```\n\nå†™å…¥ gitignore åå³å¯å¿½ç•¥ node_modules æ–‡ä»¶\næ›´å¤šä¿¡æ¯æŸ¥çœ‹[gitignore](https://github.com/github/gitignore)\n\n8. git diff\n   ç°å®æš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„å·®å¼‚\n\n9. git checkout --a\n   æ”¾å¼ƒ a çš„å˜æ›´\n   ä¾ç…§æäº¤åŒºæ¢å¤å·¥ä½œåŒºçš„æ–‡ä»¶ï¼Œä¸¢å¼ƒå·¥ä½œåŒºçš„å˜æ›´\n\n10. git reset HEAD --a\n    ä»æš‚å­˜åŒºæ¢å¤åˆ°å·¥ä½œåŒº\n\n11. git stash\n    æŠŠå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„æ–‡ä»¶éƒ½å­˜å…¥ stash ä¸­\n    git stash list\n    æŸ¥çœ‹ stash ä¸­çš„æ–‡ä»¶\n    git stash pop\n    æ¢å¤ stash ä¸­çš„æ–‡ä»¶åˆ°å·¥ä½œåŒºï¼ˆpop=apply+dropï¼‰\n\n12. git reset HEAD\b^\n    åé€€ä¸€æ­¥ï¼ˆå‡ ä¸ª^ä»£è¡¨åé€€å‡ æ­¥ï¼‰\n    git reset HEAD~[number]\n    æŠ›å¼ƒäº† number ä¸ª commit\n\n13. git reflog\n    æŸ¥çœ‹è¿‘æœŸçš„ log è®°å½•\n    git reset [ç‰ˆæœ¬å·]\n    å›é€€åˆ°ç‰ˆæœ¬å·ä¸ºâ€¦â€¦çš„ commit\n\n## åˆ†æ”¯æ“ä½œ\n\n1. git branch develop\n   åˆ›å»º develop åˆ†æ”¯,ä½†ä¾ç„¶åœç•™åœ¨å½“å‰åˆ†æ”¯\n   git branch -v\n   æŸ¥çœ‹åˆ†æ”¯\n\n2. git checkout develop\n   åˆ‡æ¢è¿›å…¥ develop åˆ†æ”¯\n   git checkout -b feature\n   åˆ›å»ºå¹¶åˆ‡æ¢è¿›å…¥ feature åˆ†æ”¯\n\n3. åˆå¹¶åˆ†æ”¯\n   a. å…ˆè¿›å…¥è¦åˆå¹¶çš„åˆ†æ”¯ï¼ˆcheckout developï¼‰\n   åœ¨æ‰§è¡Œ git merge feature å³å¯æŠŠ feature åˆå¹¶åˆ° develop åˆ†æ”¯ä¸Š\n   b. git merge feature develop\n   å¯è¾¾åˆ°åŒæ ·çš„æ•ˆæœ\n\n4. æ”¹å˜åŸºçº¿\n   git rebase -i [æäº¤è®°å½•å·]\n   å°† HEAD æŒ‡å‘è®°å½•å·æ‰€åœ¨ä½ç½®\n\n## è¿œç¨‹ä»“åº“\n\n1. git remote add origin [SSH åœ°å€]\n   åˆ›å»ºè¿œç¨‹ä»“åº“è¿æ¥\n\n2. git push -u origin develop\n   ä¸Šä¼  develop åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“ä¸Šï¼ˆè¿œç¨‹æ— é¡¹ç›®å¯ç›´æ¥ pushï¼Œæœ‰é¡¹ç›®å…ˆ merge å† pushï¼‰\n\n3. git pull origin feature\n   æ‹‰å–è¿œç¨‹ feature åˆ†æ”¯ï¼ˆpull=fetch+mergeï¼‰\n\n4. git brach -d feature\n   åˆ é™¤ feature åˆ†æ”¯\n\n5. git push origin :feature\n   åˆ é™¤è¿œç¨‹ feature åˆ†æ”¯\n\n6. git tag [æ ‡ç­¾å·]\n   git push origin [æ ‡ç­¾å·]\n   æ‰“æ ‡ç­¾\n\n7. git remote remove origin\n   å–æ¶ˆæœ¬åœ°ç›®å½•ä¸‹å…³è”çš„è¿œç¨‹ä»“åº“\n\n8. git clone [url]\n   ä¸‹è½½ä¸€ä¸ªé¡¹ç›®å’Œå®ƒçš„æ•´ä¸ªä»£ç å†å²\n\n## æ‰“ tag\n\n1. vim package.json\n   (vim package-lock.json)\n   å¯ä»¥æŸ¥çœ‹ version å·\n\n2. npm version -h\n   æŸ¥çœ‹è¿™ä¸€ä¸ª tag å³å°†æå‡çš„ç‰ˆæœ¬å·ï¼ˆå¤§ç‰ˆæœ¬æˆ–è€…å°ç‰ˆæœ¬ï¼‰\n\n3. npm version patch\n   æå‡ patch è¿™ä¸ªå°ç‰ˆæœ¬ï¼ˆv0.2.2ï¼‰\n\n4. git tag --list\n   æŸ¥çœ‹ tag çš„åˆ—è¡¨\n\n5. git push origin master\n   push ä»£ç \n\n6. git push origin v0.2.3\n   push tag\n","tags":["git"],"categories":["git"]},{"title":"è·¨åŸŸè¯·æ±‚ï¼šJSONP&&CORS","url":"/2018/09/03/è·¨åŸŸè¯·æ±‚ï¼šJSONP&&CORS/","content":"\n## JSONP\n\nJSONP æ˜¯ JSON with Padding çš„ç•¥ç§°ã€‚å®ƒæ˜¯ä¸€ä¸ªéå®˜æ–¹çš„åè®®ï¼Œå®ƒå…è®¸åœ¨æœåŠ¡å™¨ç«¯é›†æˆ Script tags è¿”å›è‡³å®¢æˆ·ç«¯ï¼Œé€šè¿‡ javascript callback çš„å½¢å¼å®ç°è·¨åŸŸè®¿é—®ï¼ˆè¿™ä»…ä»…æ˜¯ JSONP ç®€å•çš„å®ç°å½¢å¼ï¼‰\n\nJSONP çš„ç®€å•å®ç°æ¨¡å¼ï¼šåˆ›å»ºä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç„¶ååœ¨è¿œç¨‹æœåŠ¡ä¸Šè°ƒç”¨è¿™ä¸ªå‡½æ•°å¹¶ä¸”å°† JSON æ•°æ®å½¢å¼ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå®Œæˆå›è°ƒã€‚\n\næˆ‘ä»¬çŸ¥é“`script`ï¼Œ`link`ï¼Œ`img` ç­‰æ ‡ç­¾å¼•å…¥å¤–éƒ¨èµ„æºï¼Œéƒ½æ˜¯`GET`è¯·æ±‚çš„ï¼Œé‚£ä¹ˆå°±å†³å®šäº† **JSONP ä¸€å®šæ˜¯ GET**çš„ã€‚\n\n<!-- more -->\n\n### åŸç”Ÿ JS å®ç° JSONP çš„æ­¥éª¤ï¼š\n\n#### å®¢æˆ·ç«¯\n\n1. å®šä¹‰è·å–æ•°æ®åè°ƒç”¨çš„å›è°ƒå‡½æ•°\n2. åŠ¨æ€ç”Ÿæˆå¯¹æœåŠ¡ç«¯ JS è¿›è¡Œå¼•ç”¨çš„ä»£ç \n   - è®¾ç½®`url`ä¸ºæä¾›`jsonp`æœåŠ¡çš„`url`åœ°å€ï¼Œå¹¶åœ¨è¯¥`url`ä¸­è®¾ç½®ç›¸å…³`callback`å‚æ•°\n   - åˆ›å»º`script`æ ‡ç­¾ï¼Œå¹¶è®¾ç½®å…¶`src`å±æ€§\n   - æŠŠ`script`æ ‡ç­¾åŠ å…¥`head`ï¼Œæ­¤æ—¶è°ƒç”¨å¼€å§‹ã€‚\n\n#### æœåŠ¡ç«¯\n\nå°†å®¢æˆ·ç«¯å‘é€çš„`callback`å‚æ•°ä½œä¸ºå‡½æ•°åæ¥åŒ…è£¹ä½`JSON`æ•°æ®ï¼Œè¿”å›æ•°æ®è‡³å®¢æˆ·ç«¯ã€‚\n\n#### ä¾‹å­ï¼š\n\nå®¢æˆ·ç«¯ä»£ç ï¼š\n\n```html\n<!DOCTYPE html>\n<html>\n  <head>\n    <title></title>\n    <script type=\"text/javascript\">\n      // å¾—åˆ°èˆªç­ä¿¡æ¯æŸ¥è¯¢ç»“æœåçš„å›è°ƒå‡½æ•°\n      var flightHandler = function(data) {\n        alert(\n          \"ä½ æŸ¥è¯¢çš„èˆªç­ç»“æœæ˜¯ï¼šç¥¨ä»· \" +\n            data.price +\n            \" å…ƒï¼Œ\" +\n            \"ä½™ç¥¨ \" +\n            data.tickets +\n            \" å¼ ã€‚\"\n        );\n      };\n      // æä¾›jsonpæœåŠ¡çš„urlåœ°å€ï¼ˆä¸ç®¡æ˜¯ä»€ä¹ˆç±»å‹çš„åœ°å€ï¼Œæœ€ç»ˆç”Ÿæˆçš„è¿”å›å€¼éƒ½æ˜¯ä¸€æ®µjavascriptä»£ç ï¼‰\n      var url =\n        \"http://flightQuery.com/jsonp/flightResult.aspx?code=CA1998&callback=flightHandler\";\n      // åˆ›å»ºscriptæ ‡ç­¾ï¼Œè®¾ç½®å…¶å±æ€§\n      var script = document.createElement(\"script\");\n      script.setAttribute(\"src\", url);\n      // æŠŠscriptæ ‡ç­¾åŠ å…¥headï¼Œæ­¤æ—¶è°ƒç”¨å¼€å§‹\n      document.getElementsByTagName(\"head\")[0].appendChild(script);\n    </script>\n  </head>\n  <body></body>\n</html>\n```\n\nç¼–ç å®ç°**åŠ¨æ€æŸ¥è¯¢**ï¼Œè€Œ**è¿™ä¹Ÿæ­£æ˜¯ JSONP å®¢æˆ·ç«¯å®ç°çš„æ ¸å¿ƒéƒ¨åˆ†**ï¼Œæœ¬ä¾‹ä¸­çš„é‡ç‚¹ä¹Ÿå°±åœ¨äºå¦‚ä½•å®Œæˆ JSONP è°ƒç”¨çš„å…¨è¿‡ç¨‹ã€‚æˆ‘ä»¬çœ‹åˆ°è°ƒç”¨çš„`url`ä¸­ä¼ é€’äº†ä¸€ä¸ª`code`å‚æ•°ï¼Œå‘Šè¯‰æœåŠ¡å™¨æˆ‘è¦æŸ¥çš„æ˜¯ CA1998 æ¬¡èˆªç­çš„ä¿¡æ¯ï¼Œè€Œ`callback`å‚æ•°åˆ™å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘çš„æœ¬åœ°å›è°ƒå‡½æ•°å«åš`flightHandler`ï¼Œæ‰€ä»¥è¯·æŠŠæŸ¥è¯¢ç»“æœä¼ å…¥è¿™ä¸ªå‡½æ•°ä¸­è¿›è¡Œè°ƒç”¨ã€‚\nOKï¼ŒæœåŠ¡å™¨å¾ˆèªæ˜ï¼Œè¿™ä¸ªå«åš`flightResult.aspx`çš„é¡µé¢ç”Ÿæˆäº†ä¸€æ®µè¿™æ ·çš„ä»£ç æä¾›ç»™`jsonp.html`ï¼ˆæœåŠ¡ç«¯çš„å®ç°è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼Œä¸ä½ é€‰ç”¨çš„è¯­è¨€æ— å…³ï¼Œè¯´åˆ°åº•å°±æ˜¯æ‹¼æ¥å­—ç¬¦ä¸²ï¼‰ï¼š\n\n```javascript\nflightHandler({\n  code: \"CA1998\",\n  price: 1780,\n  tickets: 5\n});\n```\n\næˆ‘ä»¬çœ‹åˆ°ï¼Œä¼ é€’ç»™`flightHandler`å‡½æ•°çš„æ˜¯ä¸€ä¸ª`json`ï¼Œå®ƒæè¿°äº†èˆªç­çš„åŸºæœ¬ä¿¡æ¯ã€‚è¿è¡Œä¸€ä¸‹é¡µé¢ï¼ŒæˆåŠŸå¼¹å‡ºæç¤ºçª—å£ï¼ŒJSONP çš„æ‰§è¡Œå…¨è¿‡ç¨‹é¡ºåˆ©å®Œæˆï¼\n\n## CORS\n\nè·¨åŸŸèµ„æºå…±äº«([CORS](https://developer.mozilla.org/en-US/docs/Glossary/CORS)) æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒä½¿ç”¨é¢å¤–çš„ [HTTP](https://developer.mozilla.org/en-US/docs/Glossary/HTTP) å¤´æ¥å‘Šè¯‰æµè§ˆå™¨ è®©è¿è¡Œåœ¨ä¸€ä¸ª origin (domain) ä¸Šçš„ Web åº”ç”¨è¢«å‡†è®¸è®¿é—®æ¥è‡ªä¸åŒæºæœåŠ¡å™¨ä¸Šçš„æŒ‡å®šçš„èµ„æºã€‚å½“ä¸€ä¸ªèµ„æºä»ä¸è¯¥èµ„æºæœ¬èº«æ‰€åœ¨çš„æœåŠ¡å™¨**ä¸åŒçš„åŸŸã€åè®®æˆ–ç«¯å£**è¯·æ±‚ä¸€ä¸ªèµ„æºæ—¶ï¼Œèµ„æºä¼šå‘èµ·ä¸€ä¸ª**è·¨åŸŸ HTTP è¯·æ±‚**ã€‚\n\nCORS éœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒã€‚ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒè¯¥åŠŸèƒ½ï¼ŒIE æµè§ˆå™¨ä¸èƒ½ä½äº IE10ã€‚\n\næ•´ä¸ª CORS é€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCORS é€šä¿¡ä¸åŒæºçš„ AJAX é€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘ç° AJAX è¯·æ±‚è·¨æºï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„Ÿè§‰ã€‚\n\nå› æ­¤ï¼Œå®ç° CORS é€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®ç°äº† CORS æ¥å£ï¼Œå°±å¯ä»¥è·¨æºé€šä¿¡ã€‚\n\n### 1.ä¸¤ç§è¯·æ±‚\n\næµè§ˆå™¨å°† CORS è¯·æ±‚åˆ†æˆä¸¤ç±»ï¼šç®€å•è¯·æ±‚ï¼ˆsimple requestï¼‰å’Œéç®€å•è¯·æ±‚ï¼ˆnot-so-simple requestï¼‰ã€‚\n\nåªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚\n\nï¼ˆ1) è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š\n\n- HEAD\n- GET\n- POST\n\nï¼ˆ2ï¼‰HTTP çš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š\n\n- Accept\n- Accept-Language\n- Content-Language\n- Last-Event-ID\n- Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼`application/x-www-form-urlencoded`ã€`multipart/form-data`ã€`text/plain`\n\nå‡¡æ˜¯ä¸åŒæ—¶æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œå°±å±äºéç®€å•è¯·æ±‚ã€‚\n\næµè§ˆå™¨å¯¹è¿™ä¸¤ç§è¯·æ±‚çš„å¤„ç†ï¼Œæ˜¯ä¸ä¸€æ ·çš„ã€‚\n\n### 2.ç®€å•è¯·æ±‚\n\n- #### åŸºæœ¬æµç¨‹\n\nå¯¹äºç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ç›´æ¥å‘å‡º CORS è¯·æ±‚ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œå¢åŠ ä¸€ä¸ª`Origin`å­—æ®µã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæµè§ˆå™¨å‘ç°è¿™æ¬¡è·¨æº AJAX è¯·æ±‚æ˜¯ç®€å•è¯·æ±‚ï¼Œå°±è‡ªåŠ¨åœ¨å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª`Origin`å­—æ®µã€‚\n\n```http\nGET /cors HTTP/1.1\nOrigin: http://api.bob.com\nHost: api.alice.com\nAccept-Language: en-US\nConnection: keep-alive\nUser-Agent: Mozilla/5.0...\n```\n\nä¸Šé¢çš„å¤´ä¿¡æ¯ä¸­ï¼Œ`Origin`å­—æ®µç”¨æ¥è¯´æ˜ï¼Œæœ¬æ¬¡è¯·æ±‚æ¥è‡ªå“ªä¸ªæºï¼ˆåè®® + åŸŸå + ç«¯å£ï¼‰ã€‚æœåŠ¡å™¨æ ¹æ®è¿™ä¸ªå€¼ï¼Œå†³å®šæ˜¯å¦åŒæ„è¿™æ¬¡è¯·æ±‚ã€‚\n\nå¦‚æœ`Origin`æŒ‡å®šçš„æºï¼Œä¸åœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„ HTTP å›åº”ã€‚æµè§ˆå™¨å‘ç°ï¼Œè¿™ä¸ªå›åº”çš„å¤´ä¿¡æ¯æ²¡æœ‰åŒ…å«`Access-Control-Allow-Origin`å­—æ®µï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ï¼Œå°±çŸ¥é“å‡ºé”™äº†ï¼Œä»è€ŒæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¢«`XMLHttpRequest`çš„`onerror`å›è°ƒå‡½æ•°æ•è·ã€‚æ³¨æ„ï¼Œè¿™ç§é”™è¯¯æ— æ³•é€šè¿‡çŠ¶æ€ç è¯†åˆ«ï¼Œå› ä¸º HTTP å›åº”çš„çŠ¶æ€ç æœ‰å¯èƒ½æ˜¯ 200ã€‚\n\nå¦‚æœ`Origin`æŒ‡å®šçš„åŸŸååœ¨è®¸å¯èŒƒå›´å†…ï¼ŒæœåŠ¡å™¨è¿”å›çš„å“åº”ï¼Œä¼šå¤šå‡ºå‡ ä¸ªå¤´ä¿¡æ¯å­—æ®µã€‚\n\n```http\nAccess-Control-Allow-Origin: http://api.bob.com\nAccess-Control-Allow-Credentials: true\nAccess-Control-Expose-Headers: FooBar\nContent-Type: text/html; charset=utf-8\n```\n\nä¸Šé¢çš„å¤´ä¿¡æ¯ä¹‹ä¸­ï¼Œæœ‰ä¸‰ä¸ªä¸ CORS è¯·æ±‚ç›¸å…³çš„å­—æ®µï¼Œéƒ½ä»¥`Access-Control-`å¼€å¤´ã€‚\n\n**ï¼ˆ1ï¼‰Access-Control-Allow-Origin**\n\nè¯¥å­—æ®µæ˜¯å¿…é¡»çš„ã€‚å®ƒçš„å€¼è¦ä¹ˆæ˜¯è¯·æ±‚æ—¶`Origin`å­—æ®µçš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ª`*`ï¼Œè¡¨ç¤ºæ¥å—ä»»æ„åŸŸåçš„è¯·æ±‚ã€‚\n\n**ï¼ˆ2ï¼‰Access-Control-Allow-Credentials**\n\nè¯¥å­—æ®µå¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€ Cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookie ä¸åŒ…æ‹¬åœ¨ CORS è¯·æ±‚ä¹‹ä¸­ã€‚è®¾ä¸º`true`ï¼Œå³è¡¨ç¤ºæœåŠ¡å™¨æ˜ç¡®è®¸å¯ï¼ŒCookie å¯ä»¥åŒ…å«åœ¨è¯·æ±‚ä¸­ï¼Œä¸€èµ·å‘ç»™æœåŠ¡å™¨ã€‚è¿™ä¸ªå€¼ä¹Ÿåªèƒ½è®¾ä¸º`true`ï¼Œå¦‚æœæœåŠ¡å™¨ä¸è¦æµè§ˆå™¨å‘é€ Cookieï¼Œåˆ é™¤è¯¥å­—æ®µå³å¯ã€‚\n\n**ï¼ˆ3ï¼‰Access-Control-Expose-Headers**\n\nè¯¥å­—æ®µå¯é€‰ã€‚CORS è¯·æ±‚æ—¶ï¼Œ`XMLHttpRequest`å¯¹è±¡çš„`getResponseHeader()`æ–¹æ³•åªèƒ½æ‹¿åˆ° 6 ä¸ªåŸºæœ¬å­—æ®µï¼š`Cache-Control`ã€`Content-Language`ã€`Content-Type`ã€`Expires`ã€`Last-Modified`ã€`Pragma`ã€‚å¦‚æœæƒ³æ‹¿åˆ°å…¶ä»–å­—æ®µï¼Œå°±å¿…é¡»åœ¨`Access-Control-Expose-Headers`é‡Œé¢æŒ‡å®šã€‚ä¸Šé¢çš„ä¾‹å­æŒ‡å®šï¼Œ`getResponseHeader('FooBar')`å¯ä»¥è¿”å›`FooBar`å­—æ®µçš„å€¼ã€‚\n\n- #### withCredentials å±æ€§\n\nä¸Šé¢è¯´åˆ°ï¼ŒCORS è¯·æ±‚é»˜è®¤ä¸å‘é€ Cookie å’Œ HTTP è®¤è¯ä¿¡æ¯ã€‚å¦‚æœè¦æŠŠ Cookie å‘åˆ°æœåŠ¡å™¨ï¼Œä¸€æ–¹é¢è¦æœåŠ¡å™¨åŒæ„ï¼ŒæŒ‡å®š`Access-Control-Allow-Credentials`å­—æ®µã€‚\n\n```http\nAccess-Control-Allow-Credentials: true\n```\n\nå¦ä¸€æ–¹é¢ï¼Œå¼€å‘è€…å¿…é¡»åœ¨ AJAX è¯·æ±‚ä¸­æ‰“å¼€`withCredentials`å±æ€§ã€‚\n\n```javascript\nvar xhr = new XMLHttpRequest();\nxhr.withCredentials = true;\n```\n\nå¦åˆ™ï¼Œå³ä½¿æœåŠ¡å™¨åŒæ„å‘é€ Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå‘é€ã€‚æˆ–è€…ï¼ŒæœåŠ¡å™¨è¦æ±‚è®¾ç½® Cookieï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå¤„ç†ã€‚\n\nä½†æ˜¯ï¼Œå¦‚æœçœç•¥`withCredentials`è®¾ç½®ï¼Œæœ‰çš„æµè§ˆå™¨è¿˜æ˜¯ä¼šä¸€èµ·å‘é€ Cookieã€‚è¿™æ—¶ï¼Œå¯ä»¥æ˜¾å¼å…³é—­`withCredentials`ã€‚\n\n```javascript\nxhr.withCredentials = false;\n```\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦å‘é€ Cookieï¼Œ`Access-Control-Allow-Origin`å°±ä¸èƒ½è®¾ä¸ºæ˜Ÿå·ï¼Œå¿…é¡»æŒ‡å®šæ˜ç¡®çš„ã€ä¸è¯·æ±‚ç½‘é¡µä¸€è‡´çš„åŸŸåã€‚åŒæ—¶ï¼ŒCookie ä¾ç„¶éµå¾ªåŒæºæ”¿ç­–ï¼Œåªæœ‰ç”¨æœåŠ¡å™¨åŸŸåè®¾ç½®çš„ Cookie æ‰ä¼šä¸Šä¼ ï¼Œå…¶ä»–åŸŸåçš„ Cookie å¹¶ä¸ä¼šä¸Šä¼ ï¼Œä¸”ï¼ˆè·¨æºï¼‰åŸç½‘é¡µä»£ç ä¸­çš„`document.cookie`ä¹Ÿæ— æ³•è¯»å–æœåŠ¡å™¨åŸŸåä¸‹çš„ Cookieã€‚\n\n### 3.éç®€å•è¯·æ±‚\n\n- #### é¢„æ£€è¯·æ±‚\n\néç®€å•è¯·æ±‚æ˜¯é‚£ç§å¯¹æœåŠ¡å™¨æœ‰ç‰¹æ®Šè¦æ±‚çš„è¯·æ±‚ï¼Œæ¯”å¦‚è¯·æ±‚æ–¹æ³•æ˜¯`PUT`æˆ–`DELETE`ï¼Œæˆ–è€…`Content-Type`å­—æ®µçš„ç±»å‹æ˜¯`application/json`ã€‚\n\néç®€å•è¯·æ±‚çš„ CORS è¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡ HTTP æŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸º\"é¢„æ£€\"è¯·æ±‚ï¼ˆpreflightï¼‰ã€‚\n\næµè§ˆå™¨å…ˆè¯¢é—®æœåŠ¡å™¨ï¼Œå½“å‰ç½‘é¡µæ‰€åœ¨çš„åŸŸåæ˜¯å¦åœ¨æœåŠ¡å™¨çš„è®¸å¯åå•ä¹‹ä¸­ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨å“ªäº› HTTP åŠ¨è¯å’Œå¤´ä¿¡æ¯å­—æ®µã€‚åªæœ‰å¾—åˆ°è‚¯å®šç­”å¤ï¼Œæµè§ˆå™¨æ‰ä¼šå‘å‡ºæ­£å¼çš„`XMLHttpRequest`è¯·æ±‚ï¼Œå¦åˆ™å°±æŠ¥é”™ã€‚\n\nä¸‹é¢æ˜¯ä¸€æ®µæµè§ˆå™¨çš„ JavaScript è„šæœ¬ã€‚\n\n```javascript\nvar url = \"http://api.alice.com/cors\";\nvar xhr = new XMLHttpRequest();\nxhr.open(\"PUT\", url, true);\nxhr.setRequestHeader(\"X-Custom-Header\", \"value\");\nxhr.send();\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼ŒHTTP è¯·æ±‚çš„æ–¹æ³•æ˜¯`PUT`ï¼Œå¹¶ä¸”å‘é€ä¸€ä¸ªè‡ªå®šä¹‰å¤´ä¿¡æ¯`X-Custom-Header`ã€‚\n\næµè§ˆå™¨å‘ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªéç®€å•è¯·æ±‚ï¼Œå°±è‡ªåŠ¨å‘å‡ºä¸€ä¸ª\"é¢„æ£€\"è¯·æ±‚ï¼Œè¦æ±‚æœåŠ¡å™¨ç¡®è®¤å¯ä»¥è¿™æ ·è¯·æ±‚ã€‚ä¸‹é¢æ˜¯è¿™ä¸ª\"é¢„æ£€\"è¯·æ±‚çš„ HTTP å¤´ä¿¡æ¯ã€‚\n\n```http\nOPTIONS /cors HTTP/1.1\nOrigin: http://api.bob.com\nAccess-Control-Request-Method: PUT\nAccess-Control-Request-Headers: X-Custom-Header\nHost: api.alice.com\nAccept-Language: en-US\nConnection: keep-alive\nUser-Agent: Mozilla/5.0...\n```\n\n\"é¢„æ£€\"è¯·æ±‚ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯`OPTIONS`ï¼Œè¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ç”¨æ¥è¯¢é—®çš„ã€‚å¤´ä¿¡æ¯é‡Œé¢ï¼Œå…³é”®å­—æ®µæ˜¯`Origin`ï¼Œè¡¨ç¤ºè¯·æ±‚æ¥è‡ªå“ªä¸ªæºã€‚\n\né™¤äº†`Origin`å­—æ®µï¼Œ\"é¢„æ£€\"è¯·æ±‚çš„å¤´ä¿¡æ¯åŒ…æ‹¬ä¸¤ä¸ªç‰¹æ®Šå­—æ®µã€‚\n\n**ï¼ˆ1ï¼‰Access-Control-Request-Method**\n\nè¯¥å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œç”¨æ¥åˆ—å‡ºæµè§ˆå™¨çš„ CORS è¯·æ±‚ä¼šç”¨åˆ°å“ªäº› HTTP æ–¹æ³•ï¼Œä¸Šä¾‹æ˜¯`PUT`ã€‚\n\n**ï¼ˆ2ï¼‰Access-Control-Request-Headers**\n\nè¯¥å­—æ®µæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šæµè§ˆå™¨ CORS è¯·æ±‚ä¼šé¢å¤–å‘é€çš„å¤´ä¿¡æ¯å­—æ®µï¼Œä¸Šä¾‹æ˜¯`X-Custom-Header`ã€‚\n\n- #### é¢„æ£€è¯·æ±‚çš„å›åº”\n\næœåŠ¡å™¨æ”¶åˆ°\"é¢„æ£€\"è¯·æ±‚ä»¥åï¼Œæ£€æŸ¥äº†`Origin`ã€`Access-Control-Request-Method`å’Œ`Access-Control-Request-Headers`å­—æ®µä»¥åï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ï¼Œå°±å¯ä»¥åšå‡ºå›åº”ã€‚\n\n```http\nHTTP/1.1 200 OK\nDate: Mon, 01 Dec 2008 01:15:39 GMT\nServer: Apache/2.0.61 (Unix)\nAccess-Control-Allow-Origin: http://api.bob.com\nAccess-Control-Allow-Methods: GET, POST, PUT\nAccess-Control-Allow-Headers: X-Custom-Header\nContent-Type: text/html; charset=utf-8\nContent-Encoding: gzip\nContent-Length: 0\nKeep-Alive: timeout=2, max=100\nConnection: Keep-Alive\nContent-Type: text/plain\n```\n\nä¸Šé¢çš„ HTTP å›åº”ä¸­ï¼Œå…³é”®çš„æ˜¯`Access-Control-Allow-Origin`å­—æ®µï¼Œè¡¨ç¤º`http://api.bob.com`å¯ä»¥è¯·æ±‚æ•°æ®ã€‚è¯¥å­—æ®µä¹Ÿå¯ä»¥è®¾ä¸ºæ˜Ÿå·ï¼Œè¡¨ç¤ºåŒæ„ä»»æ„è·¨æºè¯·æ±‚ã€‚\n\n```http\nAccess-Control-Allow-Origin: *\n```\n\nå¦‚æœæµè§ˆå™¨å¦å®šäº†\"é¢„æ£€\"è¯·æ±‚ï¼Œä¼šè¿”å›ä¸€ä¸ªæ­£å¸¸çš„ HTTP å›åº”ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½• CORS ç›¸å…³çš„å¤´ä¿¡æ¯å­—æ®µã€‚è¿™æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šè®¤å®šï¼ŒæœåŠ¡å™¨ä¸åŒæ„é¢„æ£€è¯·æ±‚ï¼Œå› æ­¤è§¦å‘ä¸€ä¸ªé”™è¯¯ï¼Œè¢«`XMLHttpRequest`å¯¹è±¡çš„`onerror`å›è°ƒå‡½æ•°æ•è·ã€‚æ§åˆ¶å°ä¼šæ‰“å°å‡ºå¦‚ä¸‹çš„æŠ¥é”™ä¿¡æ¯ã€‚\n\n```bash\nXMLHttpRequest cannot load http://api.alice.com.\nOrigin http://api.bob.com is not allowed by Access-Control-Allow-Origin.\n```\n\næœåŠ¡å™¨å›åº”çš„å…¶ä»– CORS ç›¸å…³å­—æ®µå¦‚ä¸‹ã€‚\n\n```http\nAccess-Control-Allow-Methods: GET, POST, PUT\nAccess-Control-Allow-Headers: X-Custom-Header\nAccess-Control-Allow-Credentials: true\nAccess-Control-Max-Age: 1728000\n```\n\n**ï¼ˆ1ï¼‰Access-Control-Allow-Methods**\n\nè¯¥å­—æ®µå¿…éœ€ï¼Œå®ƒçš„å€¼æ˜¯é€—å·åˆ†éš”çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰è·¨åŸŸè¯·æ±‚çš„æ–¹æ³•ã€‚æ³¨æ„ï¼Œè¿”å›çš„æ˜¯æ‰€æœ‰æ”¯æŒçš„æ–¹æ³•ï¼Œè€Œä¸å•æ˜¯æµè§ˆå™¨è¯·æ±‚çš„é‚£ä¸ªæ–¹æ³•ã€‚è¿™æ˜¯ä¸ºäº†é¿å…å¤šæ¬¡\"é¢„æ£€\"è¯·æ±‚ã€‚\n\n**ï¼ˆ2ï¼‰Access-Control-Allow-Headers**\n\nå¦‚æœæµè§ˆå™¨è¯·æ±‚åŒ…æ‹¬`Access-Control-Request-Headers`å­—æ®µï¼Œåˆ™`Access-Control-Allow-Headers`å­—æ®µæ˜¯å¿…éœ€çš„ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µï¼Œä¸é™äºæµè§ˆå™¨åœ¨\"é¢„æ£€\"ä¸­è¯·æ±‚çš„å­—æ®µã€‚\n\n**ï¼ˆ3ï¼‰Access-Control-Allow-Credentials**\n\nè¯¥å­—æ®µä¸ç®€å•è¯·æ±‚æ—¶çš„å«ä¹‰ç›¸åŒã€‚\n\n**ï¼ˆ4ï¼‰Access-Control-Max-Age**\n\nè¯¥å­—æ®µå¯é€‰ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚ä¸Šé¢ç»“æœä¸­ï¼Œæœ‰æ•ˆæœŸæ˜¯ 20 å¤©ï¼ˆ1728000 ç§’ï¼‰ï¼Œå³å…è®¸ç¼“å­˜è¯¥æ¡å›åº” 1728000 ç§’ï¼ˆå³ 20 å¤©ï¼‰ï¼Œåœ¨æ­¤æœŸé—´ï¼Œä¸ç”¨å‘å‡ºå¦ä¸€æ¡é¢„æ£€è¯·æ±‚ã€‚\n\n- #### æµè§ˆå™¨çš„æ­£å¸¸è¯·æ±‚å’Œå›åº”\n\nä¸€æ—¦æœåŠ¡å™¨é€šè¿‡äº†\"é¢„æ£€\"è¯·æ±‚ï¼Œä»¥åæ¯æ¬¡æµè§ˆå™¨æ­£å¸¸çš„ CORS è¯·æ±‚ï¼Œå°±éƒ½è·Ÿç®€å•è¯·æ±‚ä¸€æ ·ï¼Œä¼šæœ‰ä¸€ä¸ª`Origin`å¤´ä¿¡æ¯å­—æ®µã€‚æœåŠ¡å™¨çš„å›åº”ï¼Œä¹Ÿéƒ½ä¼šæœ‰ä¸€ä¸ª`Access-Control-Allow-Origin`å¤´ä¿¡æ¯å­—æ®µã€‚\n\nä¸‹é¢æ˜¯\"é¢„æ£€\"è¯·æ±‚ä¹‹åï¼Œæµè§ˆå™¨çš„æ­£å¸¸ CORS è¯·æ±‚ã€‚\n\n```http\nPUT /cors HTTP/1.1\nOrigin: http://api.bob.com\nHost: api.alice.com\nX-Custom-Header: value\nAccept-Language: en-US\nConnection: keep-alive\nUser-Agent: Mozilla/5.0...\n```\n\nä¸Šé¢å¤´ä¿¡æ¯çš„`Origin`å­—æ®µæ˜¯æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ çš„ã€‚\n\nä¸‹é¢æ˜¯æœåŠ¡å™¨æ­£å¸¸çš„å›åº”ã€‚\n\n```http\nAccess-Control-Allow-Origin: http://api.bob.com\nContent-Type: text/html; charset=utf-8\n```\n\nä¸Šé¢å¤´ä¿¡æ¯ä¸­ï¼Œ`Access-Control-Allow-Origin`å­—æ®µæ˜¯æ¯æ¬¡å›åº”éƒ½å¿…å®šåŒ…å«çš„ã€‚\n\n### 4.ä¸ JSONP çš„æ¯”è¾ƒ\n\nCORS ä¸ JSONP çš„ä½¿ç”¨ç›®çš„ç›¸åŒï¼Œä½†æ˜¯æ¯” JSONP æ›´å¼ºå¤§ã€‚\n\nJSONP åªæ”¯æŒ`GET`è¯·æ±‚ï¼ŒCORS æ”¯æŒæ‰€æœ‰ç±»å‹çš„ HTTP è¯·æ±‚ã€‚JSONP çš„ä¼˜åŠ¿åœ¨äºæ”¯æŒè€å¼æµè§ˆå™¨ï¼Œä»¥åŠå¯ä»¥å‘ä¸æ”¯æŒ CORS çš„ç½‘ç«™è¯·æ±‚æ•°æ®ã€‚\n","tags":["JavaScript","æµè§ˆå™¨","è·¨åŸŸ"],"categories":["JavaScript"]},{"title":"æ­£åˆ™çš„æ‰©å±•","url":"/2018/08/29/æ­£åˆ™çš„æ‰©å±•/","content":"\n# RegExp æ„é€ å‡½æ•°\n\nRegExp æ„é€ å‡½æ•°çš„å‚æ•°æœ‰ä¸¤ç§æƒ…å†µã€‚\n\n1. å‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œè¿™æ—¶ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ï¼ˆflagï¼‰ã€‚\n2. å‚æ•°æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨ç¤ºå¼ï¼Œè¿™æ—¶ä¼šè¿”å›ä¸€ä¸ªåŸæœ‰æ­£åˆ™è¡¨è¾¾å¼çš„æ‹·è´ã€‚\n   <!-- more -->\n\n```javascript\nvar regex = new RegExp(\"xyz\", \"i\");\n// ç­‰ä»·äº\nvar regex = new RegExp(/xyz/i);\n// ç­‰ä»·äº\nvar regex = /xyz/i;\n```\n\nES6 ä¸­ï¼Œå¦‚æœ RegExp æ„é€ å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ­£åˆ™å¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¿®é¥°ç¬¦ã€‚è€Œä¸”ï¼Œè¿”å›çš„æ­£åˆ™è¡¨è¾¾å¼ä¼šå¿½ç•¥åŸæœ‰çš„æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ï¼Œåªä½¿ç”¨æ–°æŒ‡å®šçš„ä¿®é¥°ç¬¦ã€‚\n\n```javascript\nnew RegExp(/abc/gi, \"i\").flags;\n// \"i\"\n```\n\n# å­—ç¬¦ä¸²çš„æ­£åˆ™æ–¹æ³•\n\nå­—ç¬¦ä¸²å¯¹è±¡å…±æœ‰ 4 ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼šmatch()ã€replace()ã€search()å’Œ split()ã€‚ES6 å°†è¿™ 4 ä¸ªæ–¹æ³•ï¼Œåœ¨è¯­è¨€å†…éƒ¨å…¨éƒ¨è°ƒç”¨ RegExp çš„å®ä¾‹æ–¹æ³•ï¼Œä»è€Œåšåˆ°æ‰€æœ‰ä¸æ­£åˆ™ç›¸å…³çš„æ–¹æ³•ï¼Œå…¨éƒ½å®šä¹‰åœ¨ RegExp å¯¹è±¡ä¸Šã€‚\n\n1. String.prototype.match è°ƒç”¨ RegExp.prototype[Symbol.match]\n2. String.prototype.replace è°ƒç”¨ RegExp.prototype[Symbol.replace]\n3. String.prototype.search è°ƒç”¨ RegExp.prototype[Symbol.search]\n4. String.prototype.split è°ƒç”¨ RegExp.prototype[Symbol.split]\n\n# u ä¿®é¥°ç¬¦\n\nES6 å¯¹æ­£åˆ™è¡¨è¾¾å¼æ·»åŠ äº† u ä¿®é¥°ç¬¦ï¼Œå«ä¹‰ä¸ºâ€œUnicode æ¨¡å¼â€ï¼Œç”¨æ¥æ­£ç¡®å¤„ç†å¤§äº\\uFFFF çš„ Unicode å­—ç¬¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šæ­£ç¡®å¤„ç†å››ä¸ªå­—èŠ‚çš„ UTF-16 ç¼–ç ã€‚\n\n## ç‚¹å­—ç¬¦\n\nç‚¹ï¼ˆ.ï¼‰å­—ç¬¦åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå«ä¹‰æ˜¯é™¤äº†æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦ã€‚å¯¹äºç ç‚¹å¤§äº 0xFFFF çš„ Unicode å­—ç¬¦ï¼Œç‚¹å­—ç¬¦ä¸èƒ½è¯†åˆ«ï¼Œå¿…é¡»åŠ ä¸Š u ä¿®é¥°ç¬¦ã€‚\n\n```javascript\nvar s = 'ğ ®·';\n\n/^.$/.test(s) // false\n/^.$/u.test(s) // true\n```\n\n## Unicode å­—ç¬¦è¡¨ç¤ºæ³•\n\nES6 æ–°å¢äº†ä½¿ç”¨å¤§æ‹¬å·è¡¨ç¤º Unicode å­—ç¬¦ï¼Œè¿™ç§è¡¨ç¤ºæ³•åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­å¿…é¡»åŠ ä¸Š u ä¿®é¥°ç¬¦ï¼Œæ‰èƒ½è¯†åˆ«å½“ä¸­çš„å¤§æ‹¬å·ï¼Œå¦åˆ™ä¼šè¢«è§£è¯»ä¸ºé‡è¯ã€‚\n\n```javascript\n/\\u{61}/.test(\"a\") / // false\na /\nu.test(\"a\") / // true\n  ğ ®· /\n  u.test(\"ğ ®·\"); // true\n```\n\n## é‡è¯\n\nä½¿ç”¨ u ä¿®é¥°ç¬¦åï¼Œæ‰€æœ‰é‡è¯éƒ½ä¼šæ­£ç¡®è¯†åˆ«ç ç‚¹å¤§äº 0xFFFF çš„ Unicode å­—ç¬¦ã€‚\n\n```javascript\n/a{2}/.test('aa') // true\n/a{2}/u.test('aa') // true\n/ğ ®·{2}/.test('ğ ®·ğ ®·') // false\n/ğ ®·{2}/u.test('ğ ®·ğ ®·') // true\n```\n\n## é¢„å®šä¹‰æ¨¡å¼\n\n\\S æ˜¯é¢„å®šä¹‰æ¨¡å¼ï¼ŒåŒ¹é…æ‰€æœ‰éç©ºç™½å­—ç¬¦ã€‚åªæœ‰åŠ äº† u ä¿®é¥°ç¬¦ï¼Œå®ƒæ‰èƒ½æ­£ç¡®åŒ¹é…ç ç‚¹å¤§äº 0xFFFF çš„ Unicode å­—ç¬¦ã€‚\n\n```javascript\n/^\\S$/.test('ğ ®·') // false\n/^\\S$/u.test('ğ ®·') // true\n```\n\n## i ä¿®é¥°ç¬¦\n\næœ‰äº› Unicode å­—ç¬¦çš„ç¼–ç ä¸åŒï¼Œä½†æ˜¯å­—å‹å¾ˆç›¸è¿‘ï¼Œæ¯”å¦‚ï¼Œ\\u004B ä¸\\u212A éƒ½æ˜¯å¤§å†™çš„ Kã€‚ä¸åŠ  u ä¿®é¥°ç¬¦ï¼Œå°±æ— æ³•è¯†åˆ«éè§„èŒƒçš„ K å­—ç¬¦ã€‚\n\n```javascript\n/[a-z]/i.test(\"\\u212A\") / // false\n  [a - z] /\n  iu.test(\"\\u212A\"); // true\n```\n\n# RegExp.prototype.unicode å±æ€§\n\næ­£åˆ™å®ä¾‹å¯¹è±¡æ–°å¢ unicode å±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦è®¾ç½®äº† u ä¿®é¥°ç¬¦\n\n```javascript\nconst r1 = /hello/;\nconst r2 = /hello/u;\n\nr1.unicode; // false\nr2.unicode; // true\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦è®¾ç½®äº† u ä¿®é¥°ç¬¦ï¼Œå¯ä»¥ä» unicode å±æ€§çœ‹å‡ºæ¥ã€‚\n\n# y ä¿®é¥°ç¬¦\n\nES6 ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ·»åŠ äº† y ä¿®é¥°ç¬¦ï¼Œå«åšâ€œç²˜è¿â€ï¼ˆstickyï¼‰ä¿®é¥°ç¬¦ã€‚y ä¿®é¥°ç¬¦çš„ä½œç”¨ä¸ g ä¿®é¥°ç¬¦ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å…¨å±€åŒ¹é…ï¼Œåä¸€æ¬¡åŒ¹é…éƒ½ä»ä¸Šä¸€æ¬¡åŒ¹é…æˆåŠŸçš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œg ä¿®é¥°ç¬¦åªè¦å‰©ä½™ä½ç½®ä¸­å­˜åœ¨åŒ¹é…å°±å¯ï¼Œè€Œ y ä¿®é¥°ç¬¦ç¡®ä¿åŒ¹é…å¿…é¡»ä»å‰©ä½™çš„ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ï¼Œè¿™ä¹Ÿå°±æ˜¯â€œç²˜è¿â€çš„æ¶µä¹‰ã€‚\n\n```javascript\nvar s = \"aaa_aa_a\";\nvar r1 = /a+/g;\nvar r2 = /a+/y;\n\nr1.exec(s); // [\"aaa\"]\nr2.exec(s); // [\"aaa\"]\n\nr1.exec(s); // [\"aa\"]\nr2.exec(s); // null\n```\n\nå•å•ä¸€ä¸ª y ä¿®é¥°ç¬¦å¯¹ match æ–¹æ³•ï¼Œåªèƒ½è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…ï¼Œå¿…é¡»ä¸ g ä¿®é¥°ç¬¦è”ç”¨ï¼Œæ‰èƒ½è¿”å›æ‰€æœ‰åŒ¹é…ã€‚\n\n```javascript\n\"a1a2a3\".match(/a\\d/y); // [\"a1\"]\n\"a1a2a3\".match(/a\\d/gy); // [\"a1\", \"a2\", \"a3\"]\n```\n\n# RegExp.prototype.sticky å±æ€§\n\nä¸ y ä¿®é¥°ç¬¦ç›¸åŒ¹é…ï¼ŒES6 çš„æ­£åˆ™å®ä¾‹å¯¹è±¡å¤šäº† sticky å±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦è®¾ç½®äº† y ä¿®é¥°ç¬¦ã€‚\n\n```javascript\nvar r = /hello\\d/y;\nr.sticky; // true\n```\n\n# RegExp.prototype.flags å±æ€§\n\nES6 ä¸ºæ­£åˆ™è¡¨è¾¾å¼æ–°å¢äº† flags å±æ€§ï¼Œä¼šè¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦ã€‚\n\n```javascript\n// ES5 çš„ source å±æ€§\n// è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„æ­£æ–‡\n/abc/gi.source /\n  // \"abc\"\n\n  // ES6 çš„ flags å±æ€§\n  // è¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦\n  abc /\n  ig.flags;\n// 'gi'\n```\n\n# s ä¿®é¥°ç¬¦ï¼šdotAll æ¨¡å¼\n\næ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œç‚¹ï¼ˆ.ï¼‰æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œä»£è¡¨ä»»æ„çš„å•ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªä¾‹å¤–ã€‚ä¸€ä¸ªæ˜¯å››ä¸ªå­—èŠ‚çš„ UTF-16 å­—ç¬¦ï¼Œè¿™ä¸ªå¯ä»¥ç”¨ u ä¿®é¥°ç¬¦è§£å†³ï¼›å¦ä¸€ä¸ªæ˜¯è¡Œç»ˆæ­¢ç¬¦ã€‚\nè¡Œç»ˆæ­¢ç¬¦ï¼Œå°±æ˜¯è¯¥å­—ç¬¦è¡¨ç¤ºä¸€è¡Œçš„ç»ˆç»“ã€‚ä»¥ä¸‹å››ä¸ªå­—ç¬¦å±äºâ€è¡Œç»ˆæ­¢ç¬¦â€œã€‚\n\n1. U+000A æ¢è¡Œç¬¦ï¼ˆ\\nï¼‰\n2. U+000D å›è½¦ç¬¦ï¼ˆ\\rï¼‰\n3. U+2028 è¡Œåˆ†éš”ç¬¦ï¼ˆline separatorï¼‰\n4. U+2029 æ®µåˆ†éš”ç¬¦ï¼ˆparagraph separatorï¼‰\n   ES2018 å¼•å…¥ s ä¿®é¥°ç¬¦ï¼Œä½¿å¾—.å¯ä»¥åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦ã€‚\n\n```javascript\n/foo.bar/s.test(\"foo\\nbar\"); // true\n```\n\nè¿™è¢«ç§°ä¸º dotAll æ¨¡å¼ï¼Œå³ç‚¹ï¼ˆdotï¼‰ä»£è¡¨ä¸€åˆ‡å­—ç¬¦ã€‚æ‰€ä»¥ï¼Œæ­£åˆ™è¡¨è¾¾å¼è¿˜å¼•å…¥äº†ä¸€ä¸ª dotAll å±æ€§ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦å¤„åœ¨ dotAll æ¨¡å¼ã€‚\n/s ä¿®é¥°ç¬¦å’Œå¤šè¡Œä¿®é¥°ç¬¦/m ä¸å†²çªï¼Œä¸¤è€…ä¸€èµ·ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œ.åŒ¹é…æ‰€æœ‰å­—ç¬¦ï¼Œè€Œ^å’Œ\\$åŒ¹é…æ¯ä¸€è¡Œçš„è¡Œé¦–å’Œè¡Œå°¾ã€‚\n\n# åè¡Œæ–­è¨€\n\nâ€å…ˆè¡Œæ–­è¨€â€œæŒ‡çš„æ˜¯ï¼Œx åªæœ‰åœ¨ y å‰é¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ/x(?=y)/ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ç™¾åˆ†å·ä¹‹å‰çš„æ•°å­—ï¼Œè¦å†™æˆ/\\d+(?=%)/ã€‚\nâ€å…ˆè¡Œå¦å®šæ–­è¨€â€œæŒ‡çš„æ˜¯ï¼Œx åªæœ‰ä¸åœ¨ y å‰é¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ/x(?!y)/ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ä¸åœ¨ç™¾åˆ†å·ä¹‹å‰çš„æ•°å­—ï¼Œè¦å†™æˆ/\\d+(?!%)/ã€‚\nâ€œåè¡Œæ–­è¨€â€æ­£å¥½ä¸â€œå…ˆè¡Œæ–­è¨€â€ç›¸åï¼Œx åªæœ‰åœ¨ y åé¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ/(?<=y)x/ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ç¾å…ƒç¬¦å·ä¹‹åçš„æ•°å­—ï¼Œè¦å†™æˆ/(?<=\\$)\\d+/ã€‚\nâ€åè¡Œå¦å®šæ–­è¨€â€œåˆ™ä¸â€å…ˆè¡Œå¦å®šæ–­è¨€â€œç›¸åï¼Œx åªæœ‰ä¸åœ¨ y åé¢æ‰åŒ¹é…ï¼Œå¿…é¡»å†™æˆ/(?<!y)x/ã€‚æ¯”å¦‚ï¼ŒåªåŒ¹é…ä¸åœ¨ç¾å…ƒç¬¦å·åé¢çš„æ•°å­—ï¼Œè¦å†™æˆ/(?<!\\$)\\d+/ã€‚\n\n```javascript\nconst RE_DOLLAR_PREFIX = /(?<=\\$)foo/g;\n\"$foo %foo foo\".replace(RE_DOLLAR_PREFIX, \"bar\");\n// '$bar %foo foo'\n```\n\nâ€œåè¡Œæ–­è¨€â€çš„å®ç°ï¼Œéœ€è¦å…ˆåŒ¹é…/(?<=y)x/çš„ xï¼Œç„¶åå†å›åˆ°å·¦è¾¹ï¼ŒåŒ¹é… y çš„éƒ¨åˆ†ã€‚è¿™ç§â€œå…ˆå³åå·¦â€çš„æ‰§è¡Œé¡ºåºï¼Œä¸æ‰€æœ‰å…¶ä»–æ­£åˆ™æ“ä½œç›¸åï¼Œå¯¼è‡´äº†ä¸€äº›ä¸ç¬¦åˆé¢„æœŸçš„è¡Œä¸ºã€‚\né¦–å…ˆï¼Œåè¡Œæ–­è¨€çš„ç»„åŒ¹é…ï¼Œä¸æ­£å¸¸æƒ…å†µä¸‹ç»“æœæ˜¯ä¸ä¸€æ ·çš„ã€‚\n\n```javascript\n/(?<=(\\d+)(\\d+))$/.exec('1053') // [\"\", \"1\", \"053\"]\n/^(\\d+)(\\d+)$/.exec('1053') // [\"1053\", \"105\", \"3\"]\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œéœ€è¦æ•æ‰ä¸¤ä¸ªç»„åŒ¹é…ã€‚æ²¡æœ‰â€œåè¡Œæ–­è¨€â€æ—¶ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·æ˜¯è´ªå©ªæ¨¡å¼ï¼Œç¬¬äºŒä¸ªæ‹¬å·åªèƒ½æ•è·ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç»“æœæ˜¯ 105 å’Œ 3ã€‚è€Œâ€œåè¡Œæ–­è¨€â€æ—¶ï¼Œç”±äºæ‰§è¡Œé¡ºåºæ˜¯ä»å³åˆ°å·¦ï¼Œç¬¬äºŒä¸ªæ‹¬å·æ˜¯è´ªå©ªæ¨¡å¼ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·åªèƒ½æ•è·ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥ç»“æœæ˜¯ 1 å’Œ 053ã€‚\nå…¶æ¬¡ï¼Œâ€œåè¡Œæ–­è¨€â€çš„åæ–œæ å¼•ç”¨ï¼Œä¹Ÿä¸é€šå¸¸çš„é¡ºåºç›¸åï¼Œå¿…é¡»æ”¾åœ¨å¯¹åº”çš„é‚£ä¸ªæ‹¬å·ä¹‹å‰ã€‚\n\n# Unicode å±æ€§ç±»\n\nES2018 å¼•å…¥äº†ä¸€ç§æ–°çš„ç±»çš„å†™æ³•\\p{...}å’Œ\\P{...}ï¼Œå…è®¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç¬¦åˆ Unicode æŸç§å±æ€§çš„æ‰€æœ‰å­—ç¬¦ã€‚Unicode å±æ€§ç±»è¦æŒ‡å®šå±æ€§åå’Œå±æ€§å€¼ã€‚å¯¹äºæŸäº›å±æ€§ï¼Œå¯ä»¥åªå†™å±æ€§åï¼Œæˆ–è€…åªå†™å±æ€§å€¼ã€‚\\P{â€¦}æ˜¯\\p{â€¦}çš„åå‘åŒ¹é…ï¼Œå³åŒ¹é…ä¸æ»¡è¶³æ¡ä»¶çš„å­—ç¬¦ã€‚è¿™ä¸¤ç§ç±»åªå¯¹ Unicode æœ‰æ•ˆï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™ä¸€å®šè¦åŠ ä¸Š u ä¿®é¥°ç¬¦ã€‚å¦‚æœä¸åŠ  u ä¿®é¥°ç¬¦ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨\\p å’Œ\\P ä¼šæŠ¥é”™ï¼ŒECMAScript é¢„ç•™äº†è¿™ä¸¤ä¸ªç±»ã€‚\n\n```javascript\n// åŒ¹é…æ‰€æœ‰ç©ºæ ¼\n\\p{White_Space}\n\n// åŒ¹é…å„ç§æ–‡å­—çš„æ‰€æœ‰å­—æ¯ï¼Œç­‰åŒäº Unicode ç‰ˆçš„ \\w\n[\\p{Alphabetic}\\p{Mark}\\p{Decimal_Number}\\p{Connector_Punctuation}\\p{Join_Control}]\n\n// åŒ¹é…å„ç§æ–‡å­—çš„æ‰€æœ‰éå­—æ¯çš„å­—ç¬¦ï¼Œç­‰åŒäº Unicode ç‰ˆçš„ \\W\n[^\\p{Alphabetic}\\p{Mark}\\p{Decimal_Number}\\p{Connector_Punctuation}\\p{Join_Control}]\n\n// åŒ¹é… Emoji\n/\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?|\\p{Emoji_Presentation}|\\p{Emoji}\\uFE0F/gu\n\n// åŒ¹é…æ‰€æœ‰çš„ç®­å¤´å­—ç¬¦\nconst regexArrows = /^\\p{Block=Arrows}+$/u;\nregexArrows.test('â†â†‘â†’â†“â†”â†•â†–â†—â†˜â†™â‡â‡â‡‘â‡’â‡“â‡”â‡•â‡–â‡—â‡˜â‡™â‡§â‡©') // true\n```\n\n# å…·åç»„åŒ¹é…\n\næ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨åœ†æ‹¬å·è¿›è¡Œç»„åŒ¹é…ã€‚\n\n```javascript\nconst RE_DATE = /(\\d{4})-(\\d{2})-(\\d{2})/;\n\nconst matchObj = RE_DATE.exec(\"1999-12-31\");\nconst year = matchObj[1]; // 1999\nconst month = matchObj[2]; // 12\nconst day = matchObj[3]; // 31\n```\n\næ­£åˆ™è¡¨è¾¾å¼é‡Œé¢æœ‰ä¸‰ç»„åœ†æ‹¬å·ã€‚ä½¿ç”¨ exec æ–¹æ³•ï¼Œå°±å¯ä»¥å°†è¿™ä¸‰ç»„åŒ¹é…ç»“æœæå–å‡ºæ¥ã€‚ç»„åŒ¹é…çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæ¯ä¸€ç»„çš„åŒ¹é…å«ä¹‰ä¸å®¹æ˜“çœ‹å‡ºæ¥ï¼Œè€Œä¸”åªèƒ½ç”¨æ•°å­—åºå·ï¼ˆæ¯”å¦‚ matchObj[1]ï¼‰å¼•ç”¨ï¼Œè¦æ˜¯ç»„çš„é¡ºåºå˜äº†ï¼Œå¼•ç”¨çš„æ—¶å€™å°±å¿…é¡»ä¿®æ”¹åºå·ã€‚ES2018 å¼•å…¥äº†å…·åç»„åŒ¹é…ï¼ˆNamed Capture Groupsï¼‰ï¼Œå…è®¸ä¸ºæ¯ä¸€ä¸ªç»„åŒ¹é…æŒ‡å®šä¸€ä¸ªåå­—ï¼Œæ—¢ä¾¿äºé˜…è¯»ä»£ç ï¼Œåˆä¾¿äºå¼•ç”¨ã€‚\n\n```javascript\nconst RE_DATE = /(?<year>\\d{4})-(?<month>\\d{2})-(?<day>\\d{2})/;\n\nconst matchObj = RE_DATE.exec(\"1999-12-31\");\nconst year = matchObj.groups.year; // 1999\nconst month = matchObj.groups.month; // 12\nconst day = matchObj.groups.day; // 31\n```\n\nâ€œå…·åç»„åŒ¹é…â€åœ¨åœ†æ‹¬å·å†…éƒ¨ï¼Œæ¨¡å¼çš„å¤´éƒ¨æ·»åŠ â€œé—®å· + å°–æ‹¬å· + ç»„åâ€ï¼ˆ?<year>ï¼‰ï¼Œç„¶åå°±å¯ä»¥åœ¨ exec æ–¹æ³•è¿”å›ç»“æœçš„ groups å±æ€§ä¸Šå¼•ç”¨è¯¥ç»„åã€‚åŒæ—¶ï¼Œæ•°å­—åºå·ï¼ˆmatchObj[1]ï¼‰ä¾ç„¶æœ‰æ•ˆã€‚å…·åç»„åŒ¹é…ç­‰äºä¸ºæ¯ä¸€ç»„åŒ¹é…åŠ ä¸Šäº† IDï¼Œä¾¿äºæè¿°åŒ¹é…çš„ç›®çš„ã€‚å¦‚æœç»„çš„é¡ºåºå˜äº†ï¼Œä¹Ÿä¸ç”¨æ”¹å˜åŒ¹é…åçš„å¤„ç†ä»£ç ã€‚å¦‚æœå…·åç»„æ²¡æœ‰åŒ¹é…ï¼Œé‚£ä¹ˆå¯¹åº”çš„ groups å¯¹è±¡å±æ€§ä¼šæ˜¯ undefinedã€‚\n\n## è§£æ„èµ‹å€¼å’Œæ›¿æ¢\n\nå…·åç»„åŒ¹é…ä»¥åï¼Œå¯ä»¥ä½¿ç”¨è§£æ„èµ‹å€¼ç›´æ¥ä»åŒ¹é…ç»“æœä¸Šä¸ºå˜é‡èµ‹å€¼ã€‚å­—ç¬¦ä¸²æ›¿æ¢æ—¶ï¼Œä½¿ç”¨\\$<ç»„å>å¼•ç”¨å…·åç»„ã€‚\n\n```javascript\nlet re = /(?<year>\\d{4})-(?<month>\\d{2})-(?<day>\\d{2})/u;\n\n\"2015-01-02\".replace(re, \"$<day>/$<month>/$<year>\");\n// '02/01/2015'\n```\n\n## å¼•ç”¨\n\nå¦‚æœè¦åœ¨æ­£åˆ™è¡¨è¾¾å¼å†…éƒ¨å¼•ç”¨æŸä¸ªâ€œå…·åç»„åŒ¹é…â€ï¼Œå¯ä»¥ä½¿ç”¨\\k<ç»„å>çš„å†™æ³•æˆ–è€…æ•°å­—å¼•ç”¨ï¼ˆ\\1ï¼‰çš„å†™æ³•ã€‚\n\n```javascript\nconst RE_TWICE = /^(?<word>[a-z]+)!\\k<word>!\\1$/;\nRE_TWICE.test(\"abc!abc!abc\"); // true\nRE_TWICE.test(\"abc!abc!ab\"); // false\n```\n\n# String.prototype.matchAll\n\nå¦‚æœä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åœ¨å­—ç¬¦ä¸²é‡Œé¢æœ‰å¤šä¸ªåŒ¹é…ï¼Œç°åœ¨ä¸€èˆ¬ä½¿ç”¨ g ä¿®é¥°ç¬¦æˆ– y ä¿®é¥°ç¬¦ï¼Œåœ¨å¾ªç¯é‡Œé¢é€ä¸€å–å‡ºã€‚æˆ–è€…ä½¿ç”¨ String.prototype.matchAll æ–¹æ³•ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å–å‡ºæ‰€æœ‰åŒ¹é…ã€‚ä¸è¿‡ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªéå†å™¨ï¼ˆIteratorï¼‰ï¼Œè€Œä¸æ˜¯æ•°ç»„ã€‚\n\n```javascript\nconst string = \"test1test2test3\";\n\n// g ä¿®é¥°ç¬¦åŠ ä¸åŠ éƒ½å¯ä»¥\nconst regex = /t(e)(st(\\d?))/g;\n\nfor (const match of string.matchAll(regex)) {\n  console.log(match);\n}\n// [\"test1\", \"e\", \"st1\", \"1\", index: 0, input: \"test1test2test3\"]\n// [\"test2\", \"e\", \"st2\", \"2\", index: 5, input: \"test1test2test3\"]\n// [\"test3\", \"e\", \"st3\", \"3\", index: 10, input: \"test1test2test3\"]\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œç”±äº string.matchAll(regex)è¿”å›çš„æ˜¯éå†å™¨ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ for...of å¾ªç¯å–å‡ºã€‚ç›¸å¯¹äºè¿”å›æ•°ç»„ï¼Œè¿”å›éå†å™¨çš„å¥½å¤„åœ¨äºï¼Œå¦‚æœåŒ¹é…ç»“æœæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ç»„ï¼Œé‚£ä¹ˆéå†å™¨æ¯”è¾ƒèŠ‚çœèµ„æºã€‚\néå†å™¨è½¬ä¸ºæ•°ç»„æ˜¯éå¸¸ç®€å•çš„ï¼Œä½¿ç”¨...è¿ç®—ç¬¦å’Œ Array.from æ–¹æ³•å°±å¯ä»¥äº†ã€‚\n\n```javascript\n// è½¬ä¸ºæ•°ç»„æ–¹æ³•ä¸€\n[...string.matchAll(regex)];\n\n// è½¬ä¸ºæ•°ç»„æ–¹æ³•äºŒ\nArray.from(string.matchAll(regex));\n```\n","tags":["JavaScript","ES6","æ­£åˆ™"],"categories":["ES6"]},{"title":"æŸ¯é‡ŒåŒ–&&é—­åŒ…","url":"/2018/08/16/æŸ¯é‡ŒåŒ–&&é—­åŒ…/","content":"\n# æŸ¯é‡ŒåŒ–\n\n## é—­åŒ…å®ç°\n\nmulti(2)(3)(4)=24\n\n```javascript\nfunction multi(a) {\n  return function(b) {\n    return function(c) {\n      return a * b * c;\n    };\n  };\n}\n```\n\n<!-- more -->\n\n## å‡½æ•°æŸ¯é‡ŒåŒ–\n\nå‡½æ•°æŸ¯é‡ŒåŒ–æŒ‡çš„æ˜¯å°†èƒ½å¤Ÿæ¥æ”¶å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬åŒ–ä¸ºæ¥æ”¶å•ä¸€å‚æ•°çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›æ¥æ”¶ä½™ä¸‹å‚æ•°ä¸”è¿”å›ç»“æœçš„æ–°å‡½æ•°çš„æŠ€æœ¯ã€‚\n\nå‡½æ•°æŸ¯é‡ŒåŒ–çš„ä¸»è¦ä½œç”¨å’Œç‰¹ç‚¹å°±æ˜¯å‚æ•°å¤ç”¨ã€æå‰è¿”å›å’Œå»¶è¿Ÿæ‰§è¡Œã€‚\n\n### æ™®é€šç‰ˆ\n\næŠŠå›ºå®šçš„å‡½æ•°å˜æˆæŸ¯é‡ŒåŒ–ã€‚å¦‚æœä¼ å…¥çš„å‚æ•°ä¸ªæ•°å°äº fn æ‰€éœ€è¦çš„å½¢å‚ä¸ªæ•°ï¼Œå°±ç»§ç»­æ‰§è¡Œ curry å‡½æ•°æ¥æ”¶å‚æ•°ï¼Œå¦‚æœå‚æ•°è¾¾åˆ° fn æ‰€éœ€è¦çš„å½¢å‚ä¸ªæ•°ï¼Œå°±æ‰§è¡ŒæŸ¯é‡ŒåŒ–äº†çš„å‡½æ•°ã€‚\n\n```javascript\nfunction curry(fn, args) {\n  var length = fn.length;\n  var args = args || [];\n  return function() {\n    newArgs = args.concat(Array.prototype.slice.call(arguments));\n    if (newArgs.length < length) {\n      return curry.call(this, fn, newArgs);\n    } else {\n      return fn.apply(this, newArgs);\n    }\n  };\n}\nfunction multiFn(a, b, c) {\n  return a * b * c;\n}\nvar multi = curry(multiFn);\nmulti(2)(3)(4);\nmulti(2, 3, 4);\nmulti(2)(3, 4);\nmulti(2, 3)(4);\n```\n\n### ä¼˜åŒ–ç‰ˆ\n\nä¸éœ€è¦äº‹å…ˆçŸ¥é“å‡½æ•°å½¢å‚ä¸ªæ•°ã€‚å¯ä»¥ä»»æ„å‚æ•°ä¸ªæ•°è°ƒç”¨ã€‚ï¼ˆé‡å†™ valueOf å‡½æ•°ï¼‰\n\n```javascript\nfunction multi() {\n  var args = Array.prototype.slice.call(arguments);\n  var fn = function() {\n    var newArgs = args.concat(Array.prototype.slice.call(arguments));\n    return multi.apply(this, newArgs);\n  };\n  fn.valueOf = function() {\n    return args.reduce(function(a, b) {\n      return a * b;\n    });\n  };\n  return fn;\n}\n```\n\n![img](https://tva1.sinaimg.cn/large/006y8mN6ly1g6ixjy4e79j30ti0ey74z.jpg)\n\n# é—­åŒ…\n\n```javascript\nvar func = [];\nfor (var i = 0; i < 10; i++) {\n  func[i] = function() {\n    return i;\n  };\n}\nconsole.log(func[6]); //10\n```\n\næ”¹æˆ\n\n```javascript\nvar func = [];\n\nfor (var i = 0; i < 10; i++) {\n  func[i] = (function() {\n    return (function() {\n      return i;\n    })();\n  })();\n}\nconsole.log(func[6]); //6\n```\n","tags":["JavaScript"],"categories":["JavaScript"]},{"title":"å­—ç¬¦ä¸²çš„æ‰©å±•","url":"/2018/08/09/å­—ç¬¦ä¸²çš„æ‰©å±•/","content":"\n# å­—ç¬¦çš„ Unicode è¡¨ç¤ºæ³•\n\nJavaScript å…è®¸é‡‡ç”¨\\uxxxx å½¢å¼è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œå…¶ä¸­ xxxx è¡¨ç¤ºå­—ç¬¦çš„ Unicode ç ç‚¹ã€‚ç ç‚¹åœ¨\\u0000~\\uFFFF ä¹‹é—´çš„å­—ç¬¦ã€‚è¶…å‡ºè¿™ä¸ªèŒƒå›´çš„å­—ç¬¦ï¼Œå¿…é¡»ç”¨ä¸¤ä¸ªåŒå­—èŠ‚çš„å½¢å¼è¡¨ç¤ºã€‚\n\n<!-- more -->\n\n```javascript\n\"\\u0061\";\n// \"a\"\n\n\"\\uD842\\uDFB7\";\n// \"ğ ®·\"\n\n\"\\u20BB7\";\n// \" 7\"\n```\n\nå¦‚æœç›´æ¥åœ¨\\u åé¢è·Ÿä¸Šè¶…è¿‡ 0xFFFF çš„æ•°å€¼ï¼ˆæ¯”å¦‚\\u20BB7ï¼‰ï¼ŒJavaScript ä¼šç†è§£æˆ\\u20BB+7ã€‚ç”±äº\\u20BB æ˜¯ä¸€ä¸ªä¸å¯æ‰“å°å­—ç¬¦ï¼Œæ‰€ä»¥åªä¼šæ˜¾ç¤ºä¸€ä¸ªç©ºæ ¼ï¼Œåé¢è·Ÿç€ä¸€ä¸ª 7ã€‚ES6 å¯¹è¿™ä¸€ç‚¹åšå‡ºäº†æ”¹è¿›ï¼Œåªè¦å°†ç ç‚¹æ”¾å…¥å¤§æ‹¬å·ï¼Œå°±èƒ½æ­£ç¡®è§£è¯»è¯¥å­—ç¬¦ã€‚\n\n# codePointAt()\n\ncodePointAt æ–¹æ³•ä¼šæ­£ç¡®è¿”å› 32 ä½çš„ UTF-16 å­—ç¬¦çš„ç ç‚¹ã€‚å¯¹äºé‚£äº›ä¸¤ä¸ªå­—èŠ‚å‚¨å­˜çš„å¸¸è§„å­—ç¬¦ï¼Œå®ƒçš„è¿”å›ç»“æœä¸ charCodeAt æ–¹æ³•ç›¸åŒã€‚ä¾‹å¦‚ï¼Œæ±‰å­—â€œğ ®·â€ï¼ˆæ³¨æ„ï¼Œè¿™ä¸ªå­—ä¸æ˜¯â€œå‰ç¥¥â€çš„â€œå‰â€ï¼‰çš„ç ç‚¹æ˜¯ 0x20BB7ï¼ŒUTF-16 ç¼–ç ä¸º 0xD842 0xDFB7ï¼ˆåè¿›åˆ¶ä¸º 55362 57271ï¼‰ï¼Œéœ€è¦ 4 ä¸ªå­—èŠ‚å‚¨å­˜ã€‚å¯¹äºè¿™ç§ 4 ä¸ªå­—èŠ‚çš„å­—ç¬¦ï¼ŒJavaScript ä¸èƒ½æ­£ç¡®å¤„ç†ï¼Œå­—ç¬¦ä¸²é•¿åº¦ä¼šè¯¯åˆ¤ä¸º 2ï¼Œè€Œä¸” charAt æ–¹æ³•æ— æ³•è¯»å–æ•´ä¸ªå­—ç¬¦ï¼ŒcharCodeAt æ–¹æ³•åªèƒ½åˆ†åˆ«è¿”å›å‰ä¸¤ä¸ªå­—èŠ‚å’Œåä¸¤ä¸ªå­—èŠ‚çš„å€¼ã€‚ES6 æä¾›äº† codePointAt æ–¹æ³•ï¼Œèƒ½å¤Ÿæ­£ç¡®å¤„ç† 4 ä¸ªå­—èŠ‚å‚¨å­˜çš„å­—ç¬¦ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦çš„ç ç‚¹ï¼ˆcodePointAt æ–¹æ³•è¿”å›çš„æ˜¯ç ç‚¹çš„åè¿›åˆ¶å€¼ï¼‰ã€‚\n\n```javascript\nvar s = \"ğ ®·\";\n\ns.length; // 2\ns.charAt(0); // ''\ns.charAt(1); // ''\ns.charCodeAt(0); // 55362\ns.charCodeAt(1); // 57271\n\nlet a = \"ğ ®·a\";\n\na.codePointAt(0); // 134071\na.codePointAt(1); // 57271\n\na.codePointAt(2); // 97\n```\n\ncodePointAt æ–¹æ³•çš„å‚æ•°ï¼Œæ˜¯å­—ç¬¦åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ï¼ˆä» 0 å¼€å§‹ï¼‰ã€‚ä¸Šé¢ä»£ç ä¸­ï¼ŒJavaScript å°†â€œğ ®· aâ€è§†ä¸ºä¸‰ä¸ªå­—ç¬¦ï¼ŒcodePointAt æ–¹æ³•åœ¨ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸Šï¼Œæ­£ç¡®åœ°è¯†åˆ«äº†â€œğ ®·â€ï¼Œè¿”å›äº†å®ƒçš„åè¿›åˆ¶ç ç‚¹ 134071ï¼ˆå³åå…­è¿›åˆ¶çš„ 20BB7ï¼‰ã€‚åœ¨ç¬¬äºŒä¸ªå­—ç¬¦ï¼ˆå³â€œğ ®·â€çš„åä¸¤ä¸ªå­—èŠ‚ï¼‰å’Œç¬¬ä¸‰ä¸ªå­—ç¬¦â€œaâ€ä¸Šï¼ŒcodePointAt æ–¹æ³•çš„ç»“æœä¸ charCodeAt æ–¹æ³•ç›¸åŒã€‚\n\n# String.fromCodePoint()\n\nES5 æä¾› String.fromCharCode æ–¹æ³•ï¼Œç”¨äºä»ç ç‚¹è¿”å›å¯¹åº”å­—ç¬¦ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¸èƒ½è¯†åˆ« 32 ä½çš„ UTF-16 å­—ç¬¦ï¼ˆUnicode ç¼–å·å¤§äº 0xFFFFï¼‰ã€‚ES6 æä¾›äº† String.fromCodePoint æ–¹æ³•ï¼Œå¯ä»¥è¯†åˆ«å¤§äº 0xFFFF çš„å­—ç¬¦ï¼Œå¼¥è¡¥äº† String.fromCharCode æ–¹æ³•çš„ä¸è¶³ã€‚åœ¨ä½œç”¨ä¸Šï¼Œæ­£å¥½ä¸ codePointAt æ–¹æ³•ç›¸åã€‚ä¸”å¦‚æœ String.fromCodePoint æ–¹æ³•æœ‰å¤šä¸ªå‚æ•°ï¼Œåˆ™å®ƒä»¬ä¼šè¢«åˆå¹¶æˆä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›ã€‚\n\n```javascript\nString.fromCodePoint(0x20bb7);\n// \"ğ ®·\"\nString.fromCodePoint(0x78, 0x1f680, 0x79) === \"x\\uD83D\\uDE80y\";\n// true\n```\n\n# å­—ç¬¦ä¸²çš„éå†å™¨æ¥å£\n\nES6 ä¸ºå­—ç¬¦ä¸²æ·»åŠ äº†éå†å™¨æ¥å£ï¼Œä½¿å¾—å­—ç¬¦ä¸²å¯ä»¥è¢« for...of å¾ªç¯éå†,å¹¶ä¸”éå†å™¨æœ€å¤§çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è¯†åˆ«å¤§äº 0xFFFF çš„ç ç‚¹ã€‚\n\n```javascript\nfor (let codePoint of \"foo\") {\n  console.log(codePoint);\n}\n// \"f\"\n// \"o\"\n// \"o\"\n\nfor (let i of text) {\n  console.log(i);\n}\n// \"ğ ®·\"\n```\n\n# at()\n\nES5 å¯¹å­—ç¬¦ä¸²å¯¹è±¡æä¾› charAt æ–¹æ³•ï¼Œè¿”å›å­—ç¬¦ä¸²ç»™å®šä½ç½®çš„å­—ç¬¦ã€‚è¯¥æ–¹æ³•ä¸èƒ½è¯†åˆ«ç ç‚¹å¤§äº 0xFFFF çš„å­—ç¬¦ã€‚å­—ç¬¦ä¸²å®ä¾‹çš„ at æ–¹æ³•ï¼Œå¯ä»¥è¯†åˆ« Unicode ç¼–å·å¤§äº 0xFFFF çš„å­—ç¬¦ï¼Œè¿”å›æ­£ç¡®çš„å­—ç¬¦ã€‚\n\n```javascript\n\"abc\".at(0); // \"a\"\n\"ğ ®·\".at(0); // \"ğ ®·\"\n```\n\n# normalize()\n\nåœ¨å­—ç¬¦æ’åºæˆ–æ¯”è¾ƒæ—¶ï¼Œä¼šå‡ºç°ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯â€œç­‰æ•ˆâ€ã€‚\n\n1. è§„èŒƒçš„ç­‰æ•ˆæ˜¯æŒ‡ï¼Œæ— è®ºä»å“ªä¸ªè§’åº¦çœ‹ï¼Œä¸¤ä¸ªåºåˆ—çš„ç ä½éƒ½æ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚\n2. å…¼å®¹å…³ç³»ï¼Œä¸¤ä¸ªäº’ç›¸å…¼å®¹çš„ç ä½åºåˆ—çœ‹èµ·æ¥ä¸åŒï¼Œä½†æ˜¯åœ¨ç‰¹å®šçš„æƒ…å†µä¸‹å¯ä»¥ç›¸äº’äº¤æ¢ä½¿ç”¨ã€‚\n   ä¾‹å¦‚ Ç‘ï¼ˆ\\u01D1ï¼‰å’Œ Oï¼ˆ\\u004Fï¼‰ Ë‡ï¼ˆ\\u030Cï¼‰ä¸¤ä¸ªå­—ç¬¦çš„ç»„åˆï¼ˆ\\u004F\\u030Cï¼‰ï¼Œåœ¨è§†è§‰å’Œè¯­ä¹‰ä¸Šå…¶å®æ˜¯ç­‰æ•ˆçš„ã€‚\n\nES6 æä¾›å­—ç¬¦ä¸²å®ä¾‹çš„ normalize()æ–¹æ³•ï¼Œç”¨æ¥å°†å­—ç¬¦çš„ä¸åŒè¡¨ç¤ºæ–¹æ³•ç»Ÿä¸€ä¸ºåŒæ ·çš„å½¢å¼ï¼Œè¿™ç§°ä¸º Unicode æ­£è§„åŒ–ã€‚normalize æ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°æ¥æŒ‡å®š normalize çš„æ–¹å¼ï¼Œå‚æ•°çš„å››ä¸ªå¯é€‰å€¼å¦‚ä¸‹ã€‚\n\n1. NFCï¼Œé»˜è®¤å‚æ•°ï¼Œè¡¨ç¤ºâ€œæ ‡å‡†ç­‰ä»·åˆæˆâ€ï¼ˆNormalization Form Canonical Compositionï¼‰ï¼Œè¿”å›å¤šä¸ªç®€å•å­—ç¬¦çš„åˆæˆå­—ç¬¦ã€‚æ‰€è°“â€œæ ‡å‡†ç­‰ä»·â€æŒ‡çš„æ˜¯è§†è§‰å’Œè¯­ä¹‰ä¸Šçš„ç­‰ä»·ã€‚\n2. NFDï¼Œè¡¨ç¤ºâ€œæ ‡å‡†ç­‰ä»·åˆ†è§£â€ï¼ˆNormalization Form Canonical Decompositionï¼‰ï¼Œå³åœ¨æ ‡å‡†ç­‰ä»·çš„å‰æä¸‹ï¼Œè¿”å›åˆæˆå­—ç¬¦åˆ†è§£çš„å¤šä¸ªç®€å•å­—ç¬¦ã€‚\n3. NFKCï¼Œè¡¨ç¤ºâ€œå…¼å®¹ç­‰ä»·åˆæˆâ€ï¼ˆNormalization Form Compatibility Compositionï¼‰ï¼Œè¿”å›åˆæˆå­—ç¬¦ã€‚æ‰€è°“â€œå…¼å®¹ç­‰ä»·â€æŒ‡çš„æ˜¯è¯­ä¹‰ä¸Šå­˜åœ¨ç­‰ä»·ï¼Œä½†è§†è§‰ä¸Šä¸ç­‰ä»·ï¼Œæ¯”å¦‚â€œå›â€å’Œâ€œå–œå–œâ€ã€‚ï¼ˆè¿™åªæ˜¯ç”¨æ¥ä¸¾ä¾‹ï¼Œnormalize æ–¹æ³•ä¸èƒ½è¯†åˆ«ä¸­æ–‡ã€‚ï¼‰\n4. NFKDï¼Œè¡¨ç¤ºâ€œå…¼å®¹ç­‰ä»·åˆ†è§£â€ï¼ˆNormalization Form Compatibility Decompositionï¼‰ï¼Œå³åœ¨å…¼å®¹ç­‰ä»·çš„å‰æä¸‹ï¼Œè¿”å›åˆæˆå­—ç¬¦åˆ†è§£çš„å¤šä¸ªç®€å•å­—ç¬¦ã€‚\n\n```javascript\n\"\\u01D1\".normalize() === \"\\u004F\\u030C\".normalize();\n// true\n```\n\nä¸è¿‡ï¼Œnormalize æ–¹æ³•ç›®å‰ä¸èƒ½è¯†åˆ«ä¸‰ä¸ªæˆ–ä¸‰ä¸ªä»¥ä¸Šå­—ç¬¦çš„åˆæˆã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯åªèƒ½ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œé€šè¿‡ Unicode ç¼–å·åŒºé—´åˆ¤æ–­ã€‚\n\n# includes(), startsWith(), endsWith()\n\nincludes()ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°äº†å‚æ•°å­—ç¬¦ä¸²ã€‚\nstartsWith()ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨åŸå­—ç¬¦ä¸²çš„å¤´éƒ¨ã€‚\nendsWith()ï¼šè¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°å­—ç¬¦ä¸²æ˜¯å¦åœ¨åŸå­—ç¬¦ä¸²çš„å°¾éƒ¨ã€‚\nè¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ”¯æŒç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºå¼€å§‹æœç´¢çš„ä½ç½®ã€‚ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•° n æ—¶ï¼ŒendsWith çš„è¡Œä¸ºä¸å…¶ä»–ä¸¤ä¸ªæ–¹æ³•æœ‰æ‰€ä¸åŒã€‚å®ƒé’ˆå¯¹å‰ n ä¸ªå­—ç¬¦ï¼Œè€Œå…¶ä»–ä¸¤ä¸ªæ–¹æ³•é’ˆå¯¹ä»ç¬¬ n ä¸ªä½ç½®ç›´åˆ°å­—ç¬¦ä¸²ç»“æŸã€‚\n\n```javascript\nlet s = \"Hello world!\";\n\ns.startsWith(\"world\", 6); // true\ns.endsWith(\"Hello\", 5); // true\ns.includes(\"Hello\", 6); // false\n```\n\n# repeat()\n\nrepeat æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå°†åŸå­—ç¬¦ä¸²é‡å¤ n æ¬¡ã€‚å‚æ•°å¦‚æœæ˜¯å°æ•°ï¼Œä¼šè¢«å–æ•´ã€‚å¦‚æœ repeat çš„å‚æ•°æ˜¯è´Ÿæ•°æˆ–è€… Infinityï¼Œä¼šæŠ¥é”™ã€‚å‚æ•° NaN ç­‰åŒäº 0ã€‚å¦‚æœ repeat çš„å‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™ä¼šå…ˆè½¬æ¢æˆæ•°å­—ã€‚\n\n```javascript\n\"x\".repeat(3); // \"xxx\"\n\"hello\".repeat(2); // \"hellohello\"\n\"na\".repeat(0); // \"\"\n\"na\".repeat(2.9); // \"nana\"\n\n\"na\".repeat(Infinity);\n// RangeError\n\"na\".repeat(-1);\n// RangeError\n\n\"na\".repeat(NaN); // \"\"\n\n\"na\".repeat(\"na\"); // \"\"\n\"na\".repeat(\"3\"); // \"nanana\"\n```\n\n# padStart()ï¼ŒpadEnd()\n\nå¦‚æœæŸä¸ªå­—ç¬¦ä¸²ä¸å¤ŸæŒ‡å®šé•¿åº¦ï¼Œä¼šåœ¨å¤´éƒ¨æˆ–å°¾éƒ¨è¡¥å…¨ã€‚padStart()ç”¨äºå¤´éƒ¨è¡¥å…¨ï¼ŒpadEnd()ç”¨äºå°¾éƒ¨è¡¥å…¨ã€‚padStart å’Œ padEnd ä¸€å…±æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”¨æ¥æŒ‡å®šå­—ç¬¦ä¸²çš„æœ€å°é•¿åº¦ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç”¨æ¥è¡¥å…¨çš„å­—ç¬¦ä¸²ã€‚å¦‚æœåŸå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç­‰äºæˆ–å¤§äºæŒ‡å®šçš„æœ€å°é•¿åº¦ï¼Œåˆ™è¿”å›åŸå­—ç¬¦ä¸²ã€‚å¦‚æœç”¨æ¥è¡¥å…¨çš„å­—ç¬¦ä¸²ä¸åŸå­—ç¬¦ä¸²ï¼Œä¸¤è€…çš„é•¿åº¦ä¹‹å’Œè¶…è¿‡äº†æŒ‡å®šçš„æœ€å°é•¿åº¦ï¼Œåˆ™ä¼šæˆªå»è¶…å‡ºä½æ•°çš„è¡¥å…¨å­—ç¬¦ä¸²ã€‚å¦‚æœçœç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œé»˜è®¤ä½¿ç”¨ç©ºæ ¼è¡¥å…¨é•¿åº¦ã€‚\n\n```javascript\n\"x\".padStart(4, \"ab\"); // 'abax'\n\"x\".padEnd(5, \"ab\"); // 'xabab'\n\n\"xxx\".padStart(2, \"ab\"); // 'xxx'\n\"xxx\".padEnd(2, \"ab\"); // 'xxx'\n\n\"abc\".padStart(10, \"0123456789\");\n// '0123456abc'\n\n\"x\".padStart(4); // '   x'\n\"x\".padEnd(4); // 'x   '\n```\n\n# matchAll()\n\nmatchAll æ–¹æ³•è¿”å›ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åœ¨å½“å‰å­—ç¬¦ä¸²çš„æ‰€æœ‰åŒ¹é…\n\n# æ¨¡æ¿å­—ç¬¦ä¸²\n\næ¨¡æ¿å­—ç¬¦ä¸²ï¼ˆtemplate stringï¼‰æ˜¯å¢å¼ºç‰ˆçš„å­—ç¬¦ä¸²ï¼Œç”¨åå¼•å·ï¼ˆ`ï¼‰æ ‡è¯†ã€‚å®ƒå¯ä»¥å½“ä½œæ™®é€šå­—ç¬¦ä¸²ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å®šä¹‰å¤šè¡Œå­—ç¬¦ä¸²ï¼Œæˆ–è€…åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡ã€‚åµŒå…¥å˜é‡ï¼Œéœ€è¦å°†å˜é‡åå†™åœ¨\\${}ä¹‹ä¸­ã€‚å¤§æ‹¬å·å†…éƒ¨å¯ä»¥æ”¾å…¥ä»»æ„çš„ JavaScript è¡¨è¾¾å¼ï¼Œå¯ä»¥è¿›è¡Œè¿ç®—ï¼Œä»¥åŠå¼•ç”¨å¯¹è±¡å±æ€§ã€‚å¦‚æœå¤§æ‹¬å·ä¸­çš„å€¼ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå°†æŒ‰ç…§ä¸€èˆ¬çš„è§„åˆ™è½¬ä¸ºå­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼Œå¤§æ‹¬å·ä¸­æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°†é»˜è®¤è°ƒç”¨å¯¹è±¡çš„ toString æ–¹æ³•ã€‚å¦‚æœæ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„å˜é‡æ²¡æœ‰å£°æ˜ï¼Œå°†æŠ¥é”™ã€‚\nå¦‚æœåœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­éœ€è¦ä½¿ç”¨åå¼•å·ï¼Œåˆ™å‰é¢è¦ç”¨åæ–œæ è½¬ä¹‰ã€‚\n\n```javascript\n// æ™®é€šå­—ç¬¦ä¸²\n`In JavaScript '\\n' is a line-feed.``In JavaScript this is // å¤šè¡Œå­—ç¬¦ä¸²\n not legal.`;\n\nconsole.log(`string text line 1\nstring text line 2`);\n\n// å­—ç¬¦ä¸²ä¸­åµŒå…¥å˜é‡\nlet name = \"Bob\",\n  time = \"today\";\n`Hello ${name}, how are you ${time}?`;\n\nlet greeting = `\\`Yo\\` World!`;\n```\n\nå¦‚æœä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²è¡¨ç¤ºå¤šè¡Œå­—ç¬¦ä¸²ï¼Œæ‰€æœ‰çš„ç©ºæ ¼å’Œç¼©è¿›éƒ½ä¼šè¢«ä¿ç•™åœ¨è¾“å‡ºä¹‹ä¸­\n\n```html\n$('#list').html(`\n<ul>\n  <li>first</li>\n  <li>second</li>\n</ul>\n`);\n```\n\næ‰€æœ‰æ¨¡æ¿å­—ç¬¦ä¸²çš„ç©ºæ ¼å’Œæ¢è¡Œï¼Œéƒ½æ˜¯è¢«ä¿ç•™çš„ï¼Œæ¯”å¦‚\"< ul>\"æ ‡ç­¾å‰é¢ä¼šæœ‰ä¸€ä¸ªæ¢è¡Œã€‚å¦‚æœä½ ä¸æƒ³è¦è¿™ä¸ªæ¢è¡Œï¼Œå¯ä»¥ä½¿ç”¨ trim æ–¹æ³•æ¶ˆé™¤å®ƒã€‚\nå¦‚æœéœ€è¦å¼•ç”¨æ¨¡æ¿å­—ç¬¦ä¸²æœ¬èº«ï¼Œåœ¨éœ€è¦æ—¶æ‰§è¡Œï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·å†™ã€‚\n\n```javascript\n// å†™æ³•ä¸€\nlet str = \"return \" + \"`Hello ${name}!`\";\nlet func = new Function(\"name\", str);\nfunc(\"Jack\"); // \"Hello Jack!\"\n\n// å†™æ³•äºŒ\nlet str = \"(name) => `Hello ${name}!`\";\nlet func = eval.call(null, str);\nfunc(\"Jack\"); // \"Hello Jack!\"\n```\n\n# æ ‡ç­¾æ¨¡æ¿\n\næ¨¡æ¿å­—ç¬¦ä¸²ï¼Œç´§è·Ÿåœ¨ä¸€ä¸ªå‡½æ•°ååé¢ï¼Œè¯¥å‡½æ•°å°†è¢«è°ƒç”¨æ¥å¤„ç†è¿™ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ã€‚è¿™è¢«ç§°ä¸ºâ€œæ ‡ç­¾æ¨¡æ¿â€åŠŸèƒ½ï¼ˆtagged templateï¼‰ã€‚\næ ‡ç­¾æ¨¡æ¿å…¶å®ä¸æ˜¯æ¨¡æ¿ï¼Œè€Œæ˜¯å‡½æ•°è°ƒç”¨çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ã€‚â€œæ ‡ç­¾â€æŒ‡çš„å°±æ˜¯å‡½æ•°ï¼Œç´§è·Ÿåœ¨åé¢çš„æ¨¡æ¿å­—ç¬¦ä¸²å°±æ˜¯å®ƒçš„å‚æ•°ã€‚\nå¦‚æœæ¨¡æ¿å­—ç¬¦é‡Œé¢æœ‰å˜é‡ï¼Œå°±ä¸æ˜¯ç®€å•çš„è°ƒç”¨äº†ï¼Œè€Œæ˜¯ä¼šå°†æ¨¡æ¿å­—ç¬¦ä¸²å…ˆå¤„ç†æˆå¤šä¸ªå‚æ•°ï¼Œå†è°ƒç”¨å‡½æ•°ã€‚\n\n```javascript\nlet a = 5;\nlet b = 10;\n\ntag`Hello ${a + b} world ${a * b}`;\n// ç­‰åŒäº\ntag([\"Hello \", \" world \", \"\"], 15, 50);\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²å‰é¢æœ‰ä¸€ä¸ªæ ‡è¯†å tagï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ã€‚æ•´ä¸ªè¡¨è¾¾å¼çš„è¿”å›å€¼ï¼Œå°±æ˜¯ tag å‡½æ•°å¤„ç†æ¨¡æ¿å­—ç¬¦ä¸²åçš„è¿”å›å€¼ã€‚\nå‡½æ•° tag ä¾æ¬¡ä¼šæ¥æ”¶åˆ°å¤šä¸ªå‚æ•°ã€‚<font color=\"#04B486\">tag å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„çš„æˆå‘˜æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²ä¸­é‚£äº›æ²¡æœ‰å˜é‡æ›¿æ¢çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå˜é‡æ›¿æ¢åªå‘ç”Ÿåœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ä¸ç¬¬äºŒä¸ªæˆå‘˜ä¹‹é—´ã€ç¬¬äºŒä¸ªæˆå‘˜ä¸ç¬¬ä¸‰ä¸ªæˆå‘˜ä¹‹é—´ï¼Œä»¥æ­¤ç±»æ¨ã€‚tag å‡½æ•°çš„å…¶ä»–å‚æ•°ï¼Œéƒ½æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²å„ä¸ªå˜é‡è¢«æ›¿æ¢åçš„å€¼ã€‚</font>\n\nâ€œæ ‡ç­¾æ¨¡æ¿â€çš„ä¸€ä¸ªé‡è¦åº”ç”¨ï¼Œå°±æ˜¯è¿‡æ»¤ HTML å­—ç¬¦ä¸²ï¼Œé˜²æ­¢ç”¨æˆ·è¾“å…¥æ¶æ„å†…å®¹ã€‚\n\n```javascript\nlet message = SaferHTML`<p>${sender} has sent you a message.</p>`;\n\nfunction SaferHTML(templateData) {\n  let s = templateData[0];\n  for (let i = 1; i < arguments.length; i++) {\n    let arg = String(arguments[i]);\n\n    // Escape special characters in the substitution.\n    s += arg\n      .replace(/&/g, \"&amp;\")\n      .replace(/</g, \"&lt;\")\n      .replace(/>/g, \"&gt;\");\n\n    // Don't escape special characters in the template.\n    s += templateData[i];\n  }\n  return s;\n}\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œsender å˜é‡å¾€å¾€æ˜¯ç”¨æˆ·æä¾›çš„ï¼Œç»è¿‡ SaferHTML å‡½æ•°å¤„ç†ï¼Œé‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦éƒ½ä¼šè¢«è½¬ä¹‰ã€‚\n\næ ‡ç­¾æ¨¡æ¿çš„å¦ä¸€ä¸ªåº”ç”¨ï¼Œå°±æ˜¯å¤šè¯­è¨€è½¬æ¢ï¼ˆå›½é™…åŒ–å¤„ç†ï¼‰ã€‚å¤šè¯­è¨€è½¬æ¢ï¼ˆå›½é™…åŒ–å¤„ç†ï¼‰ã€‚å¯ä»¥ä½¿ç”¨æ ‡ç­¾æ¨¡æ¿ï¼Œåœ¨ JavaScript è¯­è¨€ä¹‹ä¸­åµŒå…¥å…¶ä»–è¯­è¨€ã€‚\n\næ¨¡æ¿å¤„ç†å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæ¨¡æ¿å­—ç¬¦ä¸²æ•°ç»„ï¼‰ï¼Œè¿˜æœ‰ä¸€ä¸ª raw å±æ€§ã€‚ä¿å­˜çš„æ˜¯è½¬ä¹‰åçš„åŸå­—ç¬¦ä¸²ã€‚\n\n```javascript\ntag`First line\\nSecond line`;\n\nfunction tag(strings) {\n  console.log(strings.raw[0]);\n  // strings.raw[0] ä¸º \"First line\\\\nSecond line\"\n  // æ‰“å°è¾“å‡º \"First line\\nSecond line\"\n}\n```\n\n# String.raw()\n\nES6 è¿˜ä¸ºåŸç”Ÿçš„ String å¯¹è±¡ï¼Œæä¾›äº†ä¸€ä¸ª raw æ–¹æ³•ã€‚\nString.raw æ–¹æ³•ï¼Œå¾€å¾€ç”¨æ¥å……å½“æ¨¡æ¿å­—ç¬¦ä¸²çš„å¤„ç†å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–œæ éƒ½è¢«è½¬ä¹‰ï¼ˆå³æ–œæ å‰é¢å†åŠ ä¸€ä¸ªæ–œæ ï¼‰çš„å­—ç¬¦ä¸²ï¼Œå¯¹åº”äºæ›¿æ¢å˜é‡åçš„æ¨¡æ¿å­—ç¬¦ä¸²ã€‚å¦‚æœåŸå­—ç¬¦ä¸²çš„æ–œæ å·²ç»è½¬ä¹‰ï¼Œé‚£ä¹ˆ String.raw ä¼šè¿›è¡Œå†æ¬¡è½¬ä¹‰ã€‚\n\n```javascript\nString.raw`Hi\\n${2 + 3}!`;\n// è¿”å› \"Hi\\\\n5!\"\n\nString.raw`Hi\\u000A!`;\n// è¿”å› \"Hi\\\\u000A!\"\n\nString.raw`Hi\\\\n`;\n// è¿”å› \"Hi\\\\\\\\n\"\n```\n","tags":["JavaScript","ES6"],"categories":["ES6"]},{"title":"é€’å½’ä¸å°¾é€’å½’","url":"/2018/07/23/é€’å½’ä¸å°¾é€’å½’/","content":"\n# é€’å½’çš„é—®é¢˜\n\nå‡½æ•°çš„é€’å½’è°ƒç”¨æ˜¯é€šè¿‡æ ˆæ¥å®ç°çš„ï¼Œæ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨éƒ½ä¼šæŠŠå½“å‰å‡½æ•°çš„çŠ¶æ€ï¼Œå¦‚å˜é‡ï¼Œè¿”å›åœ°å€ä¿å­˜åœ¨æ ˆä¸­ä¸€ç›´åˆ°å‡½æ•°è¿”å›æ‰èƒ½å‡ºæ ˆã€‚å› ä¸ºç¨‹åºè¿è¡Œæ—¶ï¼Œæ ˆçš„å¤§å°ä¸€èˆ¬å¾ˆæœ‰é™ï¼ˆåœ¨ chrome ä¸­è¿è¡Œä¸‹é¢çš„ä»£ç å¯ä»¥è®¡ç®—å‡º chrome ç»™æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°ï¼‰ï¼Œå› æ­¤å¦‚æœé€’å½’è°ƒç”¨çš„å±‚æ¬¡å¦‚æœè¿‡å¤šï¼Œå°†ä¼šä½¿æ ˆåŒºæº¢å‡ºã€‚\n\n<!-- more -->\n\n# å°¾é€’å½’\n\nå°¾é€’å½’å°±æ˜¯å‡½æ•°æœ€åçš„è¯­å¥æ˜¯è°ƒç”¨å‡½æ•°è‡ªèº«ï¼Œä½†è°ƒç”¨è‡ªå·±çš„æ—¶å€™ï¼Œå·²ç»ä¸å†éœ€è¦ä¸Šä¸€ä¸ªå‡½æ•°çš„ç¯å¢ƒäº†ã€‚\n\n```javascript\nfunction factorial(n,a){\n\tif(n<=0)\n\t\treturn 0;\n\tif(n == 1)\n\t\treturn a;\n\treturn factorial(n-1,a*n);\n\n```\n\nç›¸æ¯”è¾ƒä¹‹å‰ä¸€èˆ¬å½¢å¼çš„é€’å½’ä»£ç ï¼Œæœ‰ä¸¤ä¸ªä¸åŒçš„åœ°æ–¹ï¼š\n\n- é€’å½’è°ƒç”¨æ—¶ï¼ŒæŠŠ n å½“åšå‚æ•°ä¼ ç»™äº†é€’å½’å‡½æ•°ï¼Œæ— éœ€ç­‰å¾…é€’å½’è°ƒç”¨è¿”å›åå‚ä¸è®¡ç®—ã€‚\n- æœ€ç»ˆçš„è®¡ç®—ç»“æœåœ¨æœ€åä¸€æ¬¡é€’å½’è°ƒç”¨åäº§ç”Ÿï¼Œæ— éœ€å›æº¯ã€‚\n\næˆ‘ä»¬é€šè¿‡è¿™ç§å½¢å¼ï¼Œè§£å†³äº†éœ€è¦å‡½æ•°å›è·³æ‰èƒ½è®¡ç®—çš„é—®é¢˜ï¼Œä½†æœ€åäº§ç”Ÿçš„è®¡ç®—ç»“æœä»ç„¶éœ€è¦å±‚å±‚çš„å›è°ƒï¼Œä½†è¿™ç§ä»£ç çš„å½¢å¼å¯¹äºæ™®é€šçš„é€’å½’æ¥è¯´ï¼Œç¼–è¯‘å™¨æ›´å®¹æ˜“å¯¹å…¶è¿›è¡Œä¼˜åŒ–ã€‚è¿™ç§ç‰¹æ®Šçš„é€’å½’å«åšå°¾é€’å½’ï¼Œä»é€’å½’ä»£ç å½¢å¼ä¸Šçœ‹ï¼Œå®ƒè‡ªèº«çš„è°ƒç”¨æ˜¯å‡½æ•°çš„æœ€åä¸€ä¸ªæ“ä½œã€‚å°¾é€’å½’çš„ç›®çš„æ˜¯ä¸ºäº†ä¼˜åŒ–ï¼Œè€Œä¼˜åŒ–çš„ç›®æ ‡æ˜¯å‡å°‘æ ˆçš„ç©ºé—´ã€‚\n\n**å°¾é€’å½’æ˜¯é€’å½’çš„ä¸€ç§ä¼˜åŒ–**\n\næŒ‰ç…§å°¾é€’å½’çš„å®šä¹‰ï¼Œå°¾é€’å½’å°±è‡³å°‘å¿…é¡»è§£å†³ä¸€èˆ¬é€’å½’çš„ä¸¤ä¸ªé—®é¢˜ï¼š\n\n- ä¸èƒ½é‡å¤è®¡ç®—\n- é‡å¤åˆ©ç”¨æ ˆç©ºé—´\n\nç„¶è€Œå°¾é€’å½’æ˜¯ä¸ºç¼–è¯‘å™¨ä¼˜åŒ–çš„ç›®çš„ï¼Œæ‰€ä»¥è¿˜è¦ä¾èµ–äºç¼–è¯‘å™¨çš„å®ç°ï¼Œå¦‚æœä¸€ç§è¯­è¨€ä¸æ”¯æŒå°¾é€’å½’ï¼Œé‚£ä¹ˆå°¾é€’å½’ä¹Ÿå°±ä»…ä»…æ˜¯ä¸ªå½¢å¼ä¸Šé€’å½’äº†ï¼ŒJavaScript å°±æ˜¯è¿™æ ·çš„è¯­è¨€ï¼Œå› ä¸ºå®ƒæ— æ³•ä¼˜åŒ–æ ˆç©ºé—´çš„åˆ©ç”¨ã€‚\n\nå®é™…ä¸Šå°¾é€’å½’ä¸€ç›´è¢«çœ‹ä½œä¸€ç§ç¼–è¯‘æŠ€å·§ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€æ¥è¯´ï¼Œå°¾é€’å½’çš„ç¼–è¯‘å™¨å®ç°åšå½“åšçš„ä¸€ç§å¿…é¡»çš„æ ‡å‡†\n\n# es6 ä¸­çš„å°¾è°ƒç”¨ä¼˜åŒ–\n\nå°¾è°ƒç”¨è¢«è¯†åˆ«å‡ºæ¥ï¼Œé‡å¤åˆ©ç”¨äº†å·²å­˜åœ¨çš„æ ˆç»“æ„æ¥è¿›è¡Œé€’å½’ï¼Œç§»é™¤äº†ä¹‹å‰å‡½æ•°è°ƒç”¨çš„æœ¬åœ°å˜é‡å’ŒçŠ¶æ€ã€‚\n\nå¦‚æœä½¿ç”¨äº†**BABEL**ï¼Œå®ƒä¼šç›´æ¥ã€è‡ªé€’å½’åœ°å¤„ç†å°¾è°ƒç”¨ã€‚\n\n# çˆ†æ ˆé—®é¢˜è§£å†³\n\né€’å½’æ”¹å¾ªç¯\n","tags":["JavaScript","ç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"å˜é‡çš„è§£æ„èµ‹å€¼","url":"/2018/07/16/å˜é‡çš„è§£æ„èµ‹å€¼/","content":"\n# æ•°ç»„çš„è§£æ„èµ‹å€¼\n\nES6 å…è®¸æŒ‰ç…§ä¸€å®šæ¨¡å¼ï¼Œä»æ•°ç»„å’Œå¯¹è±¡ä¸­æå–å€¼ï¼Œå¯¹å˜é‡è¿›è¡Œèµ‹å€¼ï¼Œè¿™è¢«ç§°ä¸ºè§£æ„ï¼ˆDestructuringï¼‰ã€‚\n\n<!-- more -->\n\n```javascript\nlet [a, b, c] = [1, 2, 3];\n```\n\nä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¯ä»¥ä»æ•°ç»„ä¸­æå–å€¼ï¼ŒæŒ‰ç…§å¯¹åº”ä½ç½®ï¼Œå¯¹å˜é‡èµ‹å€¼ã€‚æœ¬è´¨ä¸Šï¼Œè¿™ç§å†™æ³•å±äºâ€œæ¨¡å¼åŒ¹é…â€ï¼Œåªè¦ç­‰å·ä¸¤è¾¹çš„æ¨¡å¼ç›¸åŒï¼Œå·¦è¾¹çš„å˜é‡å°±ä¼šè¢«èµ‹äºˆå¯¹åº”çš„å€¼ã€‚\n\n## è§£æ„ä¸æˆåŠŸ\n\nå¦‚æœè§£æ„ä¸æˆåŠŸï¼Œå˜é‡çš„å€¼å°±ç­‰äº undefinedã€‚\n\n```javascript\nlet [foo] = [];\nlet [bar, foo] = [1];\n```\n\nä»¥ä¸Šä¸¤ç§æƒ…å†µéƒ½å±äºè§£æ„ä¸æˆåŠŸï¼Œfoo çš„å€¼éƒ½ä¼šç­‰äº undefinedã€‚\n\n## ä¸å®Œå…¨è§£æ„\n\nç­‰å·å·¦è¾¹çš„æ¨¡å¼ï¼ŒåªåŒ¹é…ä¸€éƒ¨åˆ†çš„ç­‰å·å³è¾¹çš„æ•°ç»„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè§£æ„ä¾ç„¶å¯ä»¥æˆåŠŸã€‚\n\n```javascript\nlet [x, y] = [1, 2, 3];\nx; // 1\ny; // 2\n\nlet [a, [b], d] = [1, [2, 3], 4];\na; // 1\nb; // 2\nd; // 4\n```\n\n## ç­‰å·å³è¾¹ä¸æ˜¯æ•°ç»„\n\nå¦‚æœç­‰å·çš„å³è¾¹ä¸æ˜¯æ•°ç»„ï¼Œé‚£ä¹ˆå°†ä¼šæŠ¥é”™ã€‚\n\n```javascript\n// æŠ¥é”™\nlet [foo] = 1;\nlet [foo] = false;\nlet [foo] = NaN;\nlet [foo] = undefined;\nlet [foo] = null;\nlet [foo] = {};\n```\n\nåªè¦æŸç§æ•°æ®ç»“æ„å…·æœ‰ Iterator æ¥å£ï¼Œéƒ½å¯ä»¥é‡‡ç”¨æ•°ç»„å½¢å¼çš„è§£æ„èµ‹å€¼ã€‚\n\n## é»˜è®¤å€¼\n\nè§£æ„èµ‹å€¼å…è®¸æŒ‡å®šé»˜è®¤å€¼ã€‚\n\n```javascript\nlet [foo = true] = [];\nfoo; // true\n\nlet [x, y = \"b\"] = [\"a\"]; // x='a', y='b'\nlet [x, y = \"b\"] = [\"a\", undefined]; // x='a', y='b'\n```\n\nES6 å†…éƒ¨ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ===ï¼‰ï¼Œåˆ¤æ–­ä¸€ä¸ªä½ç½®æ˜¯å¦æœ‰å€¼ã€‚æ‰€ä»¥ï¼Œåªæœ‰å½“ä¸€ä¸ªæ•°ç»„æˆå‘˜ä¸¥æ ¼ç­‰äº undefinedï¼Œé»˜è®¤å€¼æ‰ä¼šç”Ÿæ•ˆã€‚null ä¸ä¸¥æ ¼ç­‰äº undefinedã€‚æ‰€ä»¥ï¼Œå¦‚æœæ•°ç»„æˆå‘˜æ˜¯ nullï¼Œé»˜è®¤å€¼åˆ™ä¸ä¼šç”Ÿæ•ˆã€‚\n\n```javascript\nlet [x = 1] = [undefined];\nx; // 1\n\nlet [x = 1] = [null];\nx; // null\n```\n\né»˜è®¤å€¼å¯ä»¥å¼•ç”¨è§£æ„èµ‹å€¼çš„å…¶ä»–å˜é‡ï¼Œä½†è¯¥å˜é‡å¿…é¡»å·²ç»å£°æ˜ã€‚\n\n```javascript\nlet [x = y, y = 1] = []; // ReferenceError: y is not defined\n```\n\nä¸Šå¼ä¹‹æ‰€ä»¥ä¼šæŠ¥é”™ï¼Œæ˜¯å› ä¸º x ç”¨ y åšé»˜è®¤å€¼æ—¶ï¼Œy è¿˜æ²¡æœ‰å£°æ˜ã€‚\n\n# å¯¹è±¡çš„è§£æ„èµ‹å€¼\n\næ•°ç»„çš„å…ƒç´ æ˜¯æŒ‰æ¬¡åºæ’åˆ—çš„ï¼Œå˜é‡çš„å–å€¼ç”±å®ƒçš„ä½ç½®å†³å®šï¼›è€Œå¯¹è±¡çš„å±æ€§æ²¡æœ‰æ¬¡åºï¼Œå˜é‡å¿…é¡»ä¸å±æ€§åŒåï¼Œæ‰èƒ½å–åˆ°æ­£ç¡®çš„å€¼ã€‚\n\n```javascript\nlet { bar, foo } = { foo: \"aaa\", bar: \"bbb\" };\nfoo; // \"aaa\"\nbar; // \"bbb\"\n\nlet { baz } = { foo: \"aaa\", bar: \"bbb\" };\nbaz; // undefined\n\nlet { foo: baz } = { foo: \"aaa\", bar: \"bbb\" };\nbaz; // \"aaa\"\n\nlet obj = { first: \"hello\", last: \"world\" };\nlet { first: f, last: l } = obj;\nf; // 'hello'\nl; // 'world'\n```\n\nå¯¹è±¡çš„è§£æ„èµ‹å€¼çš„å†…éƒ¨æœºåˆ¶ï¼Œæ˜¯å…ˆæ‰¾åˆ°åŒåå±æ€§ï¼Œç„¶åå†èµ‹ç»™å¯¹åº”çš„å˜é‡ã€‚çœŸæ­£è¢«èµ‹å€¼çš„æ˜¯åè€…ï¼Œè€Œä¸æ˜¯å‰è€…ã€‚\n\n```javascript\nlet { foo: baz } = { foo: \"aaa\", bar: \"bbb\" };\nbaz; // \"aaa\"\nfoo; // error: foo is not defined\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œfoo æ˜¯åŒ¹é…çš„æ¨¡å¼ï¼Œbaz æ‰æ˜¯å˜é‡ã€‚çœŸæ­£è¢«èµ‹å€¼çš„æ˜¯å˜é‡ bazï¼Œè€Œä¸æ˜¯æ¨¡å¼ fooã€‚\n\n## è§£æ„å¤±è´¥\n\nå¦‚æœè§£æ„å¤±è´¥ï¼Œå˜é‡çš„å€¼ç­‰äº undefinedã€‚\n\n```javascript\nlet { foo } = { bar: \"baz\" };\nfoo; // undefined\n```\n\nå¦‚æœè§£æ„æ¨¡å¼æ˜¯åµŒå¥—çš„å¯¹è±¡ï¼Œè€Œä¸”å­å¯¹è±¡æ‰€åœ¨çš„çˆ¶å±æ€§ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°†ä¼šæŠ¥é”™ã€‚\n\n```javascript\n// æŠ¥é”™\nlet {\n  foo: { bar }\n} = { baz: \"baz\" };\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œç­‰å·å·¦è¾¹å¯¹è±¡çš„ foo å±æ€§ï¼Œå¯¹åº”ä¸€ä¸ªå­å¯¹è±¡ã€‚è¯¥å­å¯¹è±¡çš„ bar å±æ€§ï¼Œè§£æ„æ—¶ä¼šæŠ¥é”™ã€‚åŸå› å¾ˆç®€å•ï¼Œå› ä¸º foo è¿™æ—¶ç­‰äº undefinedï¼Œå†å–å­å±æ€§å°±ä¼šæŠ¥é”™ã€‚\n\n## é»˜è®¤å€¼\n\nå¯¹è±¡çš„è§£æ„ä¹Ÿå¯ä»¥æŒ‡å®šé»˜è®¤å€¼ã€‚é»˜è®¤å€¼ç”Ÿæ•ˆçš„æ¡ä»¶æ˜¯ï¼Œå¯¹è±¡çš„å±æ€§å€¼ä¸¥æ ¼ç­‰äº undefinedã€‚\n\n```javascript\nvar { x = 3 } = { x: undefined };\nx; // 3\n\nvar { x = 3 } = { x: null };\nx; // null\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œå±æ€§ x ç­‰äº nullï¼Œå› ä¸º null ä¸ undefined ä¸ä¸¥æ ¼ç›¸ç­‰ï¼Œæ‰€ä»¥æ˜¯ä¸ªæœ‰æ•ˆçš„èµ‹å€¼ï¼Œå¯¼è‡´é»˜è®¤å€¼ 3 ä¸ä¼šç”Ÿæ•ˆã€‚\n\n# å­—ç¬¦ä¸²çš„è§£æ„èµ‹å€¼\n\nå­—ç¬¦ä¸²è¢«è½¬æ¢æˆäº†ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚\n\n```javascript\nconst [a, b, c, d, e] = \"hello\";\na; // \"h\"\nb; // \"e\"\nc; // \"l\"\nd; // \"l\"\ne; // \"o\"\n\nlet { length: len } = \"hello\";\nlen; // 5\n```\n\n# æ•°å€¼å’Œå¸ƒå°”å€¼çš„è§£æ„èµ‹å€¼\n\nç­‰å·å³è¾¹æ˜¯æ•°å€¼å’Œå¸ƒå°”å€¼ï¼Œåˆ™ä¼šå…ˆè½¬ä¸ºå¯¹è±¡ã€‚\nè§£æ„èµ‹å€¼çš„è§„åˆ™æ˜¯ï¼Œåªè¦ç­‰å·å³è¾¹çš„å€¼ä¸æ˜¯å¯¹è±¡æˆ–æ•°ç»„ï¼Œéƒ½ä¼šå…ˆå°†å…¶è½¬ä¸ºå¯¹è±¡ã€‚ç”±äº undefined å’Œ null æ— æ³•è½¬ä¸ºå¯¹è±¡ï¼Œæ‰€ä»¥å¯¹å®ƒä»¬è¿›è¡Œè§£æ„èµ‹å€¼ï¼Œéƒ½ä¼šæŠ¥é”™ã€‚\n\n```javascript\nlet { prop: x } = undefined; // TypeError\nlet { prop: y } = null; // TypeError\n```\n\n# å‡½æ•°å‚æ•°çš„è§£æ„èµ‹å€¼\n\n```javascript\nfunction add([x, y]) {\n  return x + y;\n}\nadd([1, 2]); // 3\n\n[[1, 2], [3, 4]].map(([a, b]) => a + b);\n// [ 3, 7 ]\n```\n\nå‡½æ•°å‚æ•°çš„è§£æ„ä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼ã€‚\n\n```javascript\nfunction move({ x = 0, y = 0 } = {}) {\n  return [x, y];\n}\n\nmove({ x: 3, y: 8 }); // [3, 8]\nmove({ x: 3 }); // [3, 0]\nmove({}); // [0, 0]\nmove(); // [0, 0]\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•° move çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œè§£æ„ï¼Œå¾—åˆ°å˜é‡ x å’Œ y çš„å€¼ã€‚å¦‚æœè§£æ„å¤±è´¥ï¼Œx å’Œ y ç­‰äºé»˜è®¤å€¼ã€‚\n\n```javascript\nfunction move({ x, y } = { x: 0, y: 0 }) {\n  return [x, y];\n}\n\nmove({ x: 3, y: 8 }); // [3, 8]\nmove({ x: 3 }); // [3, undefined]\nmove({}); // [undefined, undefined]\nmove(); // [0, 0]\n```\n\nä¸Šé¢ä»£ç æ˜¯ä¸ºå‡½æ•° move çš„å‚æ•°æŒ‡å®šé»˜è®¤å€¼ï¼Œè€Œä¸æ˜¯ä¸ºå˜é‡ x å’Œ y æŒ‡å®šé»˜è®¤å€¼ï¼Œæ‰€ä»¥ä¼šå¾—åˆ°ä¸å‰ä¸€ç§å†™æ³•ä¸åŒçš„ç»“æœã€‚\n","tags":["JavaScript","ES6"],"categories":["ES6"]},{"title":"varï¼Œletå’Œconstå£°æ˜åŠåŒºåˆ«","url":"/2018/07/04/varï¼Œletå’Œconstå£°æ˜åŠåŒºåˆ«/","content":"\n# var å£°æ˜\n\nåœ¨å‡½æ•°ä½œç”¨åŸŸæˆ–å…¨å±€ä½œç”¨åŸŸä¸­é€šè¿‡ var å£°æ˜çš„å˜é‡ï¼Œéƒ½ä¼šè¢«å½“æˆåœ¨å½“å‰ä½œç”¨åŸŸé¡¶éƒ¨å£°æ˜çš„å˜é‡ã€‚è¿™å°±æ˜¯æå‡ï¼ˆHoistingï¼‰æœºåˆ¶ã€‚\n\n<!-- more -->\n\nä¾‹å¦‚ï¼š\n\n```javascript\nfuction getValue(condition){\n    if(condition){\n        var value=\"blue\";\n        //å…¶ä»–ä»£ç \n        return value;\n    }\n    else{\n        //æ­¤å¤„å¯ä»¥è®¿é—®å˜é‡valueï¼Œå…¶å€¼ä¸ºundefined\n        return null;\n    }\n    //æ­¤å¤„å¯ä»¥è®¿é—®å˜é‡valueï¼Œå…¶å€¼ä¸ºundefined\n}\n```\n\näº‹å®ä¸Šï¼Œåœ¨é¢„ç¼–è¯‘é˜¶æ®µï¼ŒJavaScript å¼•æ“ä¼šå°†ä¸Šé¢çš„å‡½æ•°ä¿®æ”¹ä¸ºä¸‹é¢è¿™æ ·ï¼š\n\n```javascript\nfuction getValue(condition){\n    var value;\n    if(condition){\n        value=\"blue\";\n        //å…¶ä»–ä»£ç \n        return value;\n    }\n    else{\n        //æ­¤å¤„å¯ä»¥è®¿é—®å˜é‡valueï¼Œå…¶å€¼ä¸ºundefined\n        return null;\n    }\n    //æ­¤å¤„å¯ä»¥è®¿é—®å˜é‡valueï¼Œå…¶å€¼ä¸ºundefined\n}\n```\n\nå˜é‡ value çš„å£°æ˜ä¼šè¢«æå‡è‡³å‡½æ•°é¡¶éƒ¨ï¼Œè€Œåˆå§‹åŒ–æ“ä½œä¾ç„¶ç•™åœ¨åŸå¤„æ‰§è¡Œã€‚è¿™æ ·ï¼Œå°±æ„å‘³ç€ï¼Œåœ¨å‡½æ•°çš„å…¶ä»–éƒ¨åˆ†ï¼Œelse å­å¥ä¸­æˆ–è€… if-else å¤–ï¼Œä¹Ÿèƒ½è®¿é—®åˆ° value å˜é‡ï¼Œè€Œç”±äºæ­¤æ—¶ value å˜é‡å¹¶æœªè¢«åˆå§‹åŒ–èµ‹å€¼ï¼Œæ‰€ä»¥è®¿é—®åˆ°å€¼ä¸º undefinedã€‚\n\n# å—çº§å£°æ˜\n\nES6 ä¸­å¼•å…¥å—çº§ä½œç”¨åŸŸæ¥å¼ºåŒ–å¯¹å˜é‡ç”Ÿå‘½å‘¨æœŸçš„æ§åˆ¶ã€‚\nå—çº§å£°æ˜ç”¨äºå£°æ˜åœ¨æŒ‡å®šå—çš„ä½œç”¨åŸŸä¹‹å¤–æ— æ³•è®¿é—®çš„å˜é‡ã€‚å—çº§ä½œç”¨åŸŸï¼ˆè¯æ³•ä½œç”¨åŸŸï¼‰å­˜åœ¨äºï¼š\n\n1. å‡½æ•°å†…éƒ¨\n2. å—ä¸­ï¼ˆå­—ç¬¦{å’Œ}ä¹‹é—´çš„åŒºåŸŸï¼‰\n\n## let å£°æ˜\n\nlet å£°æ˜çš„ç”¨æ³•ä¸ var ç›¸åŒã€‚ç”¨ let ä»£æ›¿ var æ¥å£°æ˜å˜é‡ï¼Œå°±å¯ä»¥æŠŠå˜é‡çš„ä½œç”¨åŸŸé™åˆ¶åœ¨å½“å‰ä»£ç å—ä¸­ã€‚\nlet å£°æ˜<font color=\"#DC143C\">ä¸ä¼šè¢«æå‡</font>ï¼Œå› æ­¤é€šå¸¸å°† let å£°æ˜è¯­å¥æ”¾åœ¨å°é—­ä»£ç å—çš„é¡¶éƒ¨ï¼Œä»¥ä¾¿æ•´ä¸ªä»£ç å—éƒ½å¯ä»¥è®¿é—®ã€‚\n\n```javascript\nfuction getValue(condition){\n    if(condition){\n        var value=\"blue\";\n        //å…¶ä»–ä»£ç \n        return value;\n    }\n    else{\n        //å˜é‡valueåœ¨æ­¤å¤„ä¸å­˜åœ¨\n        return null;\n    }\n    //å˜é‡valueåœ¨æ­¤å¤„ä¸å­˜åœ¨\n}\n```\n\nlet å£°æ˜åï¼Œä¸ä¼šè¢«æå‡è‡³å‡½æ•°é¡¶éƒ¨ã€‚å› æ­¤æ‰§è¡Œæµç¦»å¼€ if å—ä¹‹åï¼Œvalue ç«‹åˆ»è¢«é”€æ¯ï¼Œå¦‚æœ condition çš„å€¼ä¸º falseï¼Œå°±æ°¸è¿œä¸ä¼šå£°æ˜å¹¶åˆå§‹åŒ– valueã€‚å¹¶ä¸”ï¼Œå‡è®¾ä½œç”¨åŸŸä¸­å·²ç»å­˜åœ¨äº†æŸä¸ªæ ‡è¯†ç¬¦ï¼Œæ­¤æ—¶å†ç”¨ let å…³é”®å­—å£°æ˜å®ƒï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ï¼š\n\n```javascript\nvar count = 30;\n//æŠ›å‡ºè¯­æ³•é”™è¯¯\nlet count = 40;\n```\n\nåœ¨åŒä¸€ä½œç”¨åŸŸä¸­ä¸èƒ½ç”¨ let é‡å¤å®šä¹‰å·²ç»å­˜åœ¨çš„æ ‡è¯†ç¬¦ï¼Œæ‰€ä»¥æ­¤å¤„ä½¿ç”¨ let å£°æ˜ä¼šæŠ›å‡ºé”™è¯¯ã€‚ä½†å¦‚æœå½“å‰ä½œç”¨åŸŸå†…å†…åµŒå¦ä¸€ä¸ªä½œç”¨åŸŸï¼Œå°±å¯åœ¨å†…åµŒçš„ä½œç”¨åŸŸä¸­ä½¿ç”¨ let å£°æ˜åŒåå˜é‡ã€‚\nä¾‹å¦‚ï¼š\n\n```javascript\nvar count = 30;\nif (condition) {\n  //ä¸ä¼šæŠ›å‡ºé”™è¯¯\n  let count = 40;\n}\n```\n\næ­¤æ—¶ï¼Œif å†…éƒ¨å—ä¸­çš„ count ä¼šé®è”½å…¨å±€ä½œç”¨åŸŸä¸­çš„ countï¼Œè€Œ var å£°æ˜çš„ count åªèƒ½åœ¨ if å—å¤–è®¿é—®åˆ°ã€‚\n\n## const å£°æ˜\n\nä½¿ç”¨ const å£°æ˜çš„æ˜¯å¸¸é‡ï¼Œå…¶å€¼ä¸€æ—¦è¢«è®¾å®šåä¸å¯æ›´æ”¹ã€‚å› æ­¤æ¯ä¸ªé€šè¿‡ const å£°æ˜çš„å¸¸é‡å¿…é¡»åœ¨å£°æ˜çš„åŒæ—¶è¢«åˆå§‹åŒ–ã€‚\n\n```javascript\n//æœ‰æ•ˆçš„å¸¸é‡\nconst max=30;\n\n//è¯­æ³•é”™è¯¯ï¼Œå¸¸é‡æœªåˆå§‹åŒ–\nconst name;\n```\n\nconst å’Œ let å£°æ˜éƒ½æ˜¯å—çº§æ ‡è¯†ç¬¦ï¼Œæ‰€ä»¥å¸¸é‡ä¹Ÿåªåœ¨å½“å‰çš„ä»£ç å—å†…æœ‰æ•ˆï¼Œä¸€æ—¦æ‰§è¡Œåˆ°ä»£ç å—å¤–ä¼šè¢«ç«‹å³é”€æ¯ã€‚å¹¶ä¸”ï¼Œå¸¸é‡ä¹Ÿä¸ä¼šè¢«æå‡è‡³ä½œç”¨åŸŸé¡¶éƒ¨ã€‚åŒæ ·ï¼Œä¸ let ç›¸ä¼¼ï¼Œåœ¨åŒä¸€ä½œç”¨åŸŸç”¨ const å£°æ˜å·²ç»å­˜åœ¨çš„æ ‡è¯†ç¬¦ï¼Œä¹Ÿä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ã€‚\n\nå¦‚ä¸Šæ‰€è¿°ï¼Œconst å®šä¹‰çš„å€¼ä¸€æ—¦è¢«è®¾å®šåä¸å¯æ›´æ”¹ï¼Œæ— è®ºåœ¨ä¸¥æ ¼æ¨¡å¼è¿˜æ˜¯éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œéƒ½ä¸å¯ä»¥ä¸º const å®šä¹‰çš„å¸¸é‡å†èµ‹å€¼ï¼Œå¦åˆ™ä¼šæŠ›å‡ºè¯­æ³•é”™è¯¯ï¼š\n\n```javascript\nconst max = 50;\n//æŠ›å‡ºè¯­æ³•é”™è¯¯\nmax = 30;\n```\n\nç„¶è€Œï¼Œä¸å…¶ä»–è¯­è¨€ä¸­çš„å¸¸é‡ä¸åŒçš„æ˜¯ï¼ŒJavaScript ä¸­çš„å¸¸é‡ï¼Œå¦‚æœæ˜¯å¯¹è±¡ï¼Œåˆ™å¯¹è±¡çš„å€¼å¯ä»¥ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯ const å£°æ˜<font color=\"#DC143C\">ä¸å…è®¸ä¿®æ”¹ç»‘å®šï¼Œä½†å…è®¸ä¿®æ”¹å€¼</font>è¿™ä¹Ÿæ„å‘³ç€ï¼Œconst å£°æ˜å¯¹è±¡åï¼Œå¯ä»¥ä¿®æ”¹å¯¹è±¡çš„å±æ€§ã€‚const å®é™…ä¸Šä¿è¯çš„ï¼Œå¹¶ä¸æ˜¯å˜é‡çš„å€¼ä¸å¾—æ”¹åŠ¨ï¼Œè€Œæ˜¯å˜é‡æŒ‡å‘çš„é‚£ä¸ªå†…å­˜åœ°å€ä¸å¾—æ”¹åŠ¨ã€‚å¯¹äºç®€å•ç±»å‹çš„æ•°æ®ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ï¼‰ï¼Œå€¼å°±ä¿å­˜åœ¨å˜é‡æŒ‡å‘çš„é‚£ä¸ªå†…å­˜åœ°å€ï¼Œå› æ­¤ç­‰åŒäºå¸¸é‡ã€‚ä½†å¯¹äºå¤åˆç±»å‹çš„æ•°æ®ï¼ˆä¸»è¦æ˜¯å¯¹è±¡å’Œæ•°ç»„ï¼‰ï¼Œå˜é‡æŒ‡å‘çš„å†…å­˜åœ°å€ï¼Œä¿å­˜çš„åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œconst åªèƒ½ä¿è¯è¿™ä¸ªæŒ‡é’ˆæ˜¯å›ºå®šçš„ï¼Œè‡³äºå®ƒæŒ‡å‘çš„æ•°æ®ç»“æ„æ˜¯ä¸æ˜¯å¯å˜çš„ï¼Œå°±å®Œå…¨ä¸èƒ½æ§åˆ¶äº†ã€‚\n\n```javascript\nconst person={\n    name:\"Nicholas\";\n};\n\n//å¯ä»¥ä¿®æ”¹å¯¹è±¡å±æ€§çš„å€¼\nperson.name=\"Greg\";\n\n//æŠ›å‡ºè¯­æ³•é”™è¯¯\nperson={\n    name:\"Greg\";\n};\n```\n\nå¦‚æœçœŸçš„æƒ³å°†å¯¹è±¡å†»ç»“ï¼Œåº”è¯¥ä½¿ç”¨ Object.freeze æ–¹æ³•ã€‚\n\n```javascript\nconst foo = Object.freeze({});\n\n// å¸¸è§„æ¨¡å¼æ—¶ï¼Œä¸‹é¢ä¸€è¡Œä¸èµ·ä½œç”¨ï¼›\n// ä¸¥æ ¼æ¨¡å¼æ—¶ï¼Œè¯¥è¡Œä¼šæŠ¥é”™\nfoo.prop = 123;\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œå¸¸é‡ foo æŒ‡å‘ä¸€ä¸ªå†»ç»“çš„å¯¹è±¡ï¼Œæ‰€ä»¥æ·»åŠ æ–°å±æ€§ä¸èµ·ä½œç”¨ï¼Œä¸¥æ ¼æ¨¡å¼æ—¶è¿˜ä¼šæŠ¥é”™ã€‚\né™¤äº†å°†å¯¹è±¡æœ¬èº«å†»ç»“ï¼Œå¯¹è±¡çš„å±æ€§ä¹Ÿåº”è¯¥å†»ç»“ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå°†å¯¹è±¡å½»åº•å†»ç»“çš„å‡½æ•°ã€‚\n\n```javascript\nvar constantize = obj => {\n  Object.freeze(obj);\n  Object.keys(obj).forEach((key, i) => {\n    if (typeof obj[key] === \"object\") {\n      constantize(obj[key]);\n    }\n  });\n};\n```\n\n## ä¸´æ—¶æ­»åŒºï¼ˆTemporal Dead Zoneï¼‰\n\nä¸´æ—¶æ­»åŒºå¸¸è¢«æè¿° let å’Œ const çš„ä¸æå‡çš„æ•ˆæœã€‚JavaScript å¼•æ“åœ¨æ‰«æä»£ç å‘ç°å˜é‡å£°æ˜æ—¶ï¼Œè¦ä¹ˆå°†å®ƒä»¬æå‡è‡³ä½œç”¨åŸŸé¡¶éƒ¨ï¼ˆé‡åˆ° var å£°æ˜æ—¶ï¼‰ï¼Œè¦ä¹ˆå°†å£°æ˜æ”¾åˆ° TDZ ä¸­ï¼ˆé‡åˆ° let å’Œ const å£°æ˜æ—¶ï¼‰ã€‚è®¿é—® TDZ ä¸­çš„å˜é‡ä¼šè§¦å‘è¿è¡Œé”™è¯¯ã€‚åªæœ‰åœ¨æ‰§è¡Œè¿‡å˜é‡å£°æ˜è¯­å¥åï¼Œå˜é‡æ‰ä¼šä» TDZ ä¸­ç§»å‡ºï¼Œç„¶åæ–¹å¯æ­£å¸¸è®¿é—®ã€‚ES6 æ˜ç¡®è§„å®šï¼Œå¦‚æœåŒºå—ä¸­å­˜åœ¨ let å’Œ const å‘½ä»¤ï¼Œè¿™ä¸ªåŒºå—å¯¹è¿™äº›å‘½ä»¤å£°æ˜çš„å˜é‡ï¼Œä»ä¸€å¼€å§‹å°±å½¢æˆäº†å°é—­ä½œç”¨åŸŸã€‚å‡¡æ˜¯åœ¨å£°æ˜ä¹‹å‰å°±ä½¿ç”¨è¿™äº›å˜é‡ï¼Œå°±ä¼šæŠ¥é”™ã€‚\n\n```javascript\nif (condition) {\n  console.log(typeof value); //å¼•ç”¨é”™è¯¯ï¼\n  let value = \"blue\";\n}\n```\n\nä½†åœ¨ let å£°æ˜çš„ä½œç”¨åŸŸå¤–å¯¹è¯¥å˜é‡ä½¿ç”¨ typeof åˆ™ä¸ä¼šæŠ¥é”™ï¼š\n\n```javascript\nconsole.log(typeof value); //\"undefined\"\n\nif (condition) {\n  let value = \"blue\";\n}\n```\n\ntypeof æ˜¯åœ¨å£°æ˜å˜é‡ value çš„ä»£ç å—å¤–æ‰§è¡Œçš„ï¼Œæ­¤æ—¶ value å¹¶ä¸åœ¨ TDZ ä¸­ï¼Œä¹Ÿå°±æ„å‘³ç€ä¸å­˜åœ¨ value è¿™ä¸ªç»‘å®šï¼Œtypeof æ“ä½œæœ€ç»ˆè¿”å›\"undefined\"ã€‚\n\n# å¾ªç¯ä¸­çš„å—çº§ä½œç”¨åŸŸç»‘å®š\n\nå…ˆçœ‹è¿™æ®µä»£ç ï¼š\n\n```javascript\nvar funcs = [];\n\nfor (var i = 0; i < 10; i++) {\n  funcs.push(function() {\n    console.log(i);\n  });\n}\n\nfuncs.forEach(function(func) {\n  func(); //è¾“å‡º10æ¬¡æ•°å­—10\n});\n```\n\né¢„æƒ³ç»“æœæ˜¯è¾“å‡ºæ•°å­— 0 ï½ 9ï¼Œä½†æ˜¯å› ä¸ºå¾ªç¯é‡Œçš„æ¯æ¬¡è¿­ä»£åŒæ—¶å…±äº«ç€ iï¼Œå¾ªç¯å†…éƒ¨åˆ›å»ºçš„å‡½æ•°å…¨éƒ¨éƒ½ä¿å­˜äº†å¯¹ç›¸åŒå˜é‡çš„å¼•ç”¨ã€‚å¾ªç¯ç»“æŸæ—¶å˜é‡ i çš„å€¼ä¸º 10ï¼Œæ‰€ä»¥æ¯æ¬¡è°ƒç”¨ console.logï¼ˆiï¼‰æ—¶éƒ½ä¼šè¾“å‡ºæ•°å­— 10ã€‚\nè€Œä½¿ç”¨ let å£°æ˜ï¼Œæ¯æ¬¡è¿­ä»£å¾ªç¯éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å˜é‡ï¼Œå¹¶ä»¥ä¹‹å‰çš„è¿­ä»£ä¸­åŒåå˜é‡çš„å€¼å°†å…¶åˆå§‹åŒ–ï¼Œå¾—åˆ°é¢„æœŸçš„æ•ˆæœã€‚\n\n```javascript\nvar funcs = [];\n\nfor (let i = 0; i < 10; i++) {\n  funcs.push(function() {\n    console.log(i);\n  });\n}\n\nfuncs.forEach(function(func) {\n  func(); //è¾“å‡º0ï¼Œ1ï¼Œ2ï¼Œâ€¦â€¦ï¼Œ9\n});\n```\n\nå½“å‰çš„ i åªåœ¨æœ¬è½®å¾ªç¯æœ‰æ•ˆï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡å¾ªç¯çš„ i å…¶å®éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å˜é‡ï¼ŒJavaScript å¼•æ“å†…éƒ¨ä¼šè®°ä½ä¸Šä¸€è½®å¾ªç¯çš„å€¼ï¼Œåˆå§‹åŒ–æœ¬è½®çš„å˜é‡ i æ—¶ï¼Œå°±åœ¨ä¸Šä¸€è½®å¾ªç¯çš„åŸºç¡€ä¸Šè¿›è¡Œè®¡ç®—ã€‚å¦å¤–ï¼Œfor å¾ªç¯è¿˜æœ‰ä¸€ä¸ªç‰¹åˆ«ä¹‹å¤„ï¼Œå°±æ˜¯è®¾ç½®å¾ªç¯å˜é‡çš„é‚£éƒ¨åˆ†æ˜¯ä¸€ä¸ªçˆ¶ä½œç”¨åŸŸï¼Œè€Œå¾ªç¯ä½“å†…éƒ¨æ˜¯ä¸€ä¸ªå•ç‹¬çš„å­ä½œç”¨åŸŸã€‚\nconst ä¹Ÿæ˜¯åŒæ ·ï¼Œä½†åœ¨å¾ªç¯ä¸­ä¸èƒ½ä¿®æ”¹ const å£°æ˜çš„å˜é‡ï¼Œå¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚\n\n# å…¨å±€ä½œç”¨åŸŸç»‘å®š\n\nå½“ var è¢«ç”¨åœ¨å…¨å±€ä½œç”¨åŸŸæ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å…¨å±€å˜é‡ä½œä¸ºå…¨å±€å¯¹è±¡ï¼ˆæµè§ˆå™¨ç¯å¢ƒä¸­çš„ window å¯¹è±¡ï¼‰çš„å±æ€§ã€‚è¿™æ„å‘³ç€ï¼Œç”¨ var å¾ˆå¯èƒ½ä¼šæ— æ„ä¸­è¦†ç›–ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å…¨å±€å±æ€§ã€‚ä¾‹å¦‚ï¼š\n\n```javascript\n//åœ¨æµè§ˆå™¨ä¸­\nvar RegExp = \"Hello!\";\nconsole.log(window.RegExp); //\"Hello!\"\n```\n\nå…¨å±€å¯¹è±¡å®šä¹‰åœ¨ RegExp å®šä¹‰åœ¨ window ä¸Šï¼Œä½†ä¸èƒ½å¹¸å…<font color=\"#DC143C\">è¢« var è¦†ç›–ï¼Œæˆä¸º window çš„å±æ€§ã€‚</font>\nä½†å¦‚æœåœ¨å…¨å±€ä½œç”¨åŸŸä¸­ä½¿ç”¨ let æˆ–è€… constï¼Œä¼šåœ¨å…¨å±€ä½œç”¨åŸŸä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç»‘å®šï¼Œä½†è¯¥ç»‘å®šä¸ä¼šæ·»åŠ å…¨å±€å¯¹è±¡çš„å±æ€§ã€‚<font color=\"#DC143C\">ç”¨ let æˆ– const ä¸èƒ½è¦†ç›–å…¨å±€å˜é‡ï¼Œåªèƒ½é®è”½å®ƒã€‚</font>\n\n```javascript\n//åœ¨æµè§ˆå™¨ä¸­\nlet RegExp = \"Hello!\";\nconsole.log(RegExp); //\"Hello!\"\nconsole.log(window.RegExp === RegExp); //false\n```\n\nè¿™é‡Œ let å£°æ˜çš„ RegExp åˆ›å»ºäº†ä¸€ä¸ªç»‘å®šå¹¶é®è”½äº†å…¨å±€çš„ RegExp å˜é‡ï¼Œä½† window.RegExp å’Œ RegExp å¹¶ä¸ç›¸åŒï¼Œè¯´æ˜å®ƒä¸ä¼šç ´åå…¨å±€ä½œç”¨åŸŸï¼Œä¸ä¼šä¸ºå…¨å±€å¯¹è±¡åˆ›å»ºå±æ€§ã€‚\n\n# ES6 å£°æ˜å˜é‡çš„å…­ç§æ–¹æ³•\n\nES5 åªæœ‰ä¸¤ç§å£°æ˜å˜é‡çš„æ–¹æ³•ï¼švar å‘½ä»¤å’Œ function å‘½ä»¤ã€‚ES6 é™¤äº†æ·»åŠ  let å’Œ const å‘½ä»¤ï¼Œè¿˜æœ‰å¦å¤–ä¸¤ç§å£°æ˜å˜é‡çš„æ–¹æ³•ï¼šimport å‘½ä»¤å’Œ class å‘½ä»¤ã€‚æ‰€ä»¥ï¼ŒES6 ä¸€å…±æœ‰ 6 ç§å£°æ˜å˜é‡çš„æ–¹æ³•ã€‚\n","tags":["JavaScript","ES6"],"categories":["ES6"]}]